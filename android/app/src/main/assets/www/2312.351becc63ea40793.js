"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2312],{12312:(e,t,n)=>{n.r(t),n.d(t,{AddonBlogLazyModule:()=>j});var o=n(19212),i=n(67643),r=n(13386),a=n(49671),s=n(70261),l=n(7739),d=n(52467),c=n(76777),g=n(45151),_=n(43468),u=n(43555),m=n(53564),p=n(13010),f=n(34749),h=n(857),x=n(75803),I=n(88817),E=n(96814),b=n(55126),y=n(9693),T=n(52133),A=n(66931),L=n(80070),Z=n(86700),M=n(8947),P=n(21525),v=n(29657),w=n(56223),B=n(31903),U=n(81856),J=n(83779),Q=n(83431),q=n(5385),N=n(54490),k=n(89515);function AddonBlogEntriesPage_ion_item_16_Template(e,t){if(1&e){const e=o.EpF();o.TgZ(0,"ion-item")(1,"ion-toggle",11),o.NdJ("ngModelChange",(function AddonBlogEntriesPage_ion_item_16_Template_ion_toggle_ngModelChange_1_listener(t){o.CHM(e);const n=o.oxw();return o.KtG(n.onlyMyEntries=t)}))("ionChange",(function AddonBlogEntriesPage_ion_item_16_Template_ion_toggle_ionChange_1_listener(){o.CHM(e);const t=o.oxw();return o.KtG(t.onlyMyEntriesToggleChanged(t.onlyMyEntries))})),o._uU(2),o.ALo(3,"translate"),o.qZA()()}if(2&e){const e=o.oxw();o.xp6(),o.Q6J("ngModel",e.onlyMyEntries),o.xp6(),o.hij(" ",o.lcZ(3,2,"addon.blog.showonlyyourentries")," ")}}function AddonBlogEntriesPage_core_empty_box_17_Template(e,t){1&e&&(o._UZ(0,"core-empty-box",12),o.ALo(1,"translate")),2&e&&o.Q6J("message",o.lcZ(1,1,"addon.blog.noentriesyet"))}function AddonBlogEntriesPage_ng_container_18_ion_card_1_ion_item_19_Template(e,t){if(1&e&&(o.TgZ(0,"ion-item",13)(1,"ion-label")(2,"div",0),o._uU(3),o.ALo(4,"translate"),o.qZA(),o._UZ(5,"core-tag-list",24),o.qZA()()),2&e){const e=o.oxw(2).$implicit;o.xp6(3),o.hij("",o.lcZ(4,2,"core.tag.tags"),":"),o.xp6(2),o.Q6J("tags",e.tags)}}function AddonBlogEntriesPage_ng_container_18_ion_card_1_core_comments_20_Template(e,t){if(1&e&&o._UZ(0,"core-comments",25),2&e){const e=o.oxw(2).$implicit,t=o.oxw();o.Q6J("component",t.component)("itemId",e.id)("instanceId",e.userid)("showItem",!0)}}function AddonBlogEntriesPage_ng_container_18_ion_card_1_core_file_21_Template(e,t){if(1&e&&o._UZ(0,"core-file",26),2&e){const e=t.$implicit,n=o.oxw(2).$implicit,i=o.oxw();o.Q6J("file",e)("component",i.component)("componentId",n.id)}}function AddonBlogEntriesPage_ng_container_18_ion_card_1_ion_item_22_Template(e,t){if(1&e&&(o.TgZ(0,"ion-item",27)(1,"ion-label"),o._uU(2),o.ALo(3,"translate"),o.qZA()()),2&e){const e=o.oxw(2).$implicit;o.Q6J("href",e.uniquehash)("detail",!0),o.xp6(2),o.Oqu(o.lcZ(3,3,"addon.blog.linktooriginalentry"))}}function AddonBlogEntriesPage_ng_container_18_ion_card_1_div_23_Template(e,t){if(1&e&&(o.TgZ(0,"div",28)(1,"ion-note"),o._UZ(2,"ion-icon",29),o.ALo(3,"translate"),o._uU(4),o.ALo(5,"coreTimeAgo"),o.qZA()()),2&e){const e=o.oxw(2).$implicit;o.xp6(2),o.uIk("aria-label",o.lcZ(3,2,"core.lastmodified")),o.xp6(2),o.hij(" ",o.lcZ(5,4,e.lastmodified)," ")}}function AddonBlogEntriesPage_ng_container_18_ion_card_1_Template(e,t){if(1&e&&(o.TgZ(0,"ion-card")(1,"ion-item",13),o._UZ(2,"core-user-avatar",14),o.TgZ(3,"ion-label")(4,"div",15)(5,"h2"),o._UZ(6,"core-format-text",16),o.qZA(),o.TgZ(7,"ion-note",17),o._uU(8),o.ALo(9,"translate"),o.qZA()(),o.TgZ(10,"div",15),o._uU(11),o.TgZ(12,"ion-note",17),o._uU(13),o.ALo(14,"coreDateDayOrTime"),o.qZA()()()(),o.TgZ(15,"ion-card-content")(16,"ion-item",13)(17,"ion-label"),o._UZ(18,"core-format-text",18),o.qZA()(),o.YNc(19,AddonBlogEntriesPage_ng_container_18_ion_card_1_ion_item_19_Template,6,4,"ion-item",19)(20,AddonBlogEntriesPage_ng_container_18_ion_card_1_core_comments_20_Template,1,4,"core-comments",20)(21,AddonBlogEntriesPage_ng_container_18_ion_card_1_core_file_21_Template,1,3,"core-file",21)(22,AddonBlogEntriesPage_ng_container_18_ion_card_1_ion_item_22_Template,4,5,"ion-item",22),o.qZA(),o.YNc(23,AddonBlogEntriesPage_ng_container_18_ion_card_1_div_23_Template,6,6,"div",23),o.qZA()),2&e){const e=o.oxw().$implicit,t=o.oxw();o.xp6(2),o.Q6J("user",e.user)("courseId",e.courseid),o.xp6(4),o.Q6J("text",e.subject)("contextLevel",t.contextLevel)("contextInstanceId",t.contextInstanceId),o.xp6(2),o.hij(" ",o.lcZ(9,18,"addon.blog."+e.publishTranslated)," "),o.xp6(3),o.hij(" ",e.user&&e.user.fullname," "),o.xp6(2),o.hij(" ",o.lcZ(14,20,e.created)," "),o.xp6(5),o.Q6J("text",e.summary)("component",t.component)("componentId",e.id)("contextLevel",t.contextLevel)("contextInstanceId",t.contextInstanceId),o.xp6(),o.Q6J("ngIf",t.tagsEnabled&&e.tags&&e.tags.length>0),o.xp6(),o.Q6J("ngIf",t.commentsEnabled),o.xp6(),o.Q6J("ngForOf",e.attachmentfiles),o.xp6(),o.Q6J("ngIf",e.uniquehash),o.xp6(),o.Q6J("ngIf",e.lastmodified>e.created)}}function AddonBlogEntriesPage_ng_container_18_Template(e,t){if(1&e&&(o.ynx(0),o.YNc(1,AddonBlogEntriesPage_ng_container_18_ion_card_1_Template,24,22,"ion-card",7),o.BQk()),2&e){const e=t.$implicit,n=o.oxw();o.xp6(),o.Q6J("ngIf",!n.onlyMyEntries||e.userid===n.currentUserId)}}let C=(()=>{var e;class AddonBlogEntriesPage{constructor(){var e=this;this.title="",this.filter={},this.pageLoaded=0,this.userPageLoaded=0,this.canLoadMoreEntries=!1,this.canLoadMoreUserEntries=!0,this.loaded=!1,this.canLoadMore=!1,this.loadMoreError=!1,this.entries=[],this.showMyEntriesToggle=!1,this.onlyMyEntries=!1,this.component=s.Y.COMPONENT,this.commentsEnabled=!1,this.tagsEnabled=!1,this.contextLevel="system",this.contextInstanceId=0,this.currentUserId=m.m9.getCurrentSiteUserId(),this.siteHomeId=m.m9.getCurrentSiteHomeId(),this.logView=I.V.once((0,a.Z)((function*(){yield x.Tr.ignoreErrors(s.H.logView(e.filter)),_.ke.logEvent({type:_.gM.VIEW_ITEM_LIST,ws:"core_blog_view_entries",name:e.title,data:{...e.filter,category:"blog"},url:h.T.addParamsToUrl("/blog/index.php",{...e.filter,modid:e.filter.cmid,cmid:void 0})})})))}ngOnInit(){var e=this;return(0,a.Z)((function*(){const t=u.b.getRouteNumberParam("userId"),n=u.b.getRouteNumberParam("courseId"),o=u.b.getRouteNumberParam("cmId"),i=u.b.getRouteNumberParam("entryId"),r=u.b.getRouteNumberParam("groupId"),a=u.b.getRouteNumberParam("tagId");e.title=t||n||o||i||r||a?"addon.blog.blogentries":"addon.blog.siteblogheading",t&&(e.filter.userid=t),n&&(e.filter.courseid=n),o&&(e.filter.cmid=o),i&&(e.filter.entryid=i),r&&(e.filter.groupid=r),a&&(e.filter.tagid=a),e.showMyEntriesToggle=!t&&!e.filter.entryid,!t||n||o?n&&n!=e.siteHomeId?(e.contextLevel="course",e.contextInstanceId=n):(e.contextLevel="system",e.contextInstanceId=0):(e.contextLevel="user",e.contextInstanceId=t),e.commentsEnabled=!l.N.areCommentsDisabledInSite(),e.tagsEnabled=c.e.areTagsAvailableInSite();(new d.L).treatLink(),yield e.fetchEntries()}))()}fetchEntries(e=!1){var t=this;return(0,a.Z)((function*(){t.loadMoreError=!1,e&&(t.pageLoaded=0,t.userPageLoaded=0);const n=t.onlyMyEntries?t.userPageLoaded:t.pageLoaded;try{const o=yield s.H.getEntries(t.filter,n),i=o.entries.map(function(){var e=(0,a.Z)((function*(e){switch(e.publishstate){case"draft":e.publishTranslated="publishtonoone";break;case"site":e.publishTranslated="publishtosite";break;case"public":e.publishTranslated="publishtoworld";break;default:e.publishTranslated="privacy:unknown"}e.moduleid||e.coursemoduleid?(e.contextLevel="module",e.contextInstanceId=e.moduleid||e.coursemoduleid):e.courseid?(e.contextLevel="course",e.contextInstanceId=e.courseid):(e.contextLevel="user",e.contextInstanceId=e.userid),e.summary=f._1.replacePluginfileUrls(e.summary,e.summaryfiles||[]),e.user=yield x.Tr.ignoreErrors(g.My.getProfile(e.userid,e.courseid,!0))}));return function(t){return e.apply(this,arguments)}}());if(t.entries=e?o.entries:x.Tr.uniqueArray(t.entries.concat(o.entries),"id").sort(((e,t)=>t.created-e.created)),t.onlyMyEntries){const e=t.entries.filter((e=>e.userid==t.currentUserId)).length;t.canLoadMoreUserEntries=o.totalentries>e,t.canLoadMore=t.canLoadMoreUserEntries,t.userPageLoaded++}else t.canLoadMoreEntries=o.totalentries>t.entries.length,t.canLoadMore=t.canLoadMoreEntries,t.pageLoaded++;yield Promise.all(i),t.logView()}catch(e){p.OQ.showErrorModalDefault(e,"addon.blog.errorloadentries",!0),t.loadMoreError=!0}finally{t.loaded=!0}}))()}onlyMyEntriesToggleChanged(e){if(this.canLoadMore=e?this.canLoadMoreUserEntries:this.canLoadMoreEntries,!e)return delete this.filter.userid,void 0;const t=this.entries.filter((e=>e.userid==this.currentUserId)).length;this.userPageLoaded=Math.floor(t/s.Y.ENTRIES_PER_PAGE),this.filter.userid=this.currentUserId,0==t&&this.canLoadMoreUserEntries&&this.loadMore()}loadMore(e){return this.fetchEntries().finally((()=>{e&&e()}))}refresh(e){const t=this.entries.map((e=>l.N.invalidateCommentsData("user",e.userid,this.component,e.id,"format_blog")));t.push(s.H.invalidateEntries(this.filter)),this.showMyEntriesToggle&&(this.filter.userid=this.currentUserId,t.push(s.H.invalidateEntries(this.filter)),this.onlyMyEntries||delete this.filter.userid),x.Tr.allPromises(t).finally((()=>{this.fetchEntries(!0).finally((()=>{e&&(null==e||e.complete())}))}))}}return(e=AddonBlogEntriesPage).ɵfac=function AddonBlogEntriesPage_Factory(t){return new(t||e)},e.ɵcmp=o.Xpm({type:e,selectors:[["page-addon-blog-entries"]],decls:20,vars:16,consts:[["slot","start"],[3,"text"],["slot","end"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[4,"ngIf"],["icon","far-newspaper",3,"message",4,"ngIf"],[4,"ngFor","ngForOf"],[3,"enabled","error","action"],[3,"ngModel","ngModelChange","ionChange"],["icon","far-newspaper",3,"message"],[1,"ion-text-wrap"],["slot","start",3,"user","courseId"],[1,"flex-row","ion-justify-content-between","ion-align-items-center"],[3,"text","contextLevel","contextInstanceId"],[1,"ion-text-end"],[3,"text","component","componentId","contextLevel","contextInstanceId"],["class","ion-text-wrap",4,"ngIf"],["area","format_blog","contextLevel","user",3,"component","itemId","instanceId","showItem",4,"ngIf"],[3,"file","component","componentId",4,"ngFor","ngForOf"],["core-link","",3,"href","detail",4,"ngIf"],["class","ion-text-center ion-margin-bottom",4,"ngIf"],[3,"tags"],["area","format_blog","contextLevel","user",3,"component","itemId","instanceId","showItem"],[3,"file","component","componentId"],["core-link","",3,"href","detail"],[1,"ion-text-center","ion-margin-bottom"],["name","fas-clock"]],template:function AddonBlogEntriesPage_Template(e,t){1&e&&(o.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),o._UZ(3,"ion-back-button",1),o.ALo(4,"translate"),o.qZA(),o.TgZ(5,"ion-title")(6,"h1"),o._uU(7),o.ALo(8,"translate"),o.qZA()(),o.TgZ(9,"ion-buttons",2),o._UZ(10,"core-user-menu-button"),o.qZA()()(),o.TgZ(11,"ion-content",3)(12,"ion-refresher",4),o.NdJ("ionRefresh",(function AddonBlogEntriesPage_Template_ion_refresher_ionRefresh_12_listener(e){return t.refresh(e.target)})),o._UZ(13,"ion-refresher-content",5),o.ALo(14,"translate"),o.qZA(),o.TgZ(15,"core-loading",6),o.YNc(16,AddonBlogEntriesPage_ion_item_16_Template,4,4,"ion-item",7)(17,AddonBlogEntriesPage_core_empty_box_17_Template,2,3,"core-empty-box",8)(18,AddonBlogEntriesPage_ng_container_18_Template,2,1,"ng-container",9),o.TgZ(19,"core-infinite-loading",10),o.NdJ("action",(function AddonBlogEntriesPage_Template_core_infinite_loading_action_19_listener(e){return t.loadMore(e)})),o.qZA()()()),2&e&&(o.xp6(3),o.Q6J("text",o.lcZ(4,10,"core.back")),o.xp6(4),o.Oqu(o.lcZ(8,12,t.title)),o.xp6(5),o.Q6J("disabled",!t.loaded),o.xp6(),o.s9C("pullingText",o.lcZ(14,14,"core.pulltorefresh")),o.xp6(2),o.Q6J("hideUntil",t.loaded),o.xp6(),o.Q6J("ngIf",t.showMyEntriesToggle),o.xp6(),o.Q6J("ngIf",t.entries&&0===t.entries.length),o.xp6(),o.Q6J("ngForOf",t.entries),o.xp6(),o.Q6J("enabled",t.canLoadMore)("error",t.loadMoreError))},dependencies:[E.sg,E.O5,b.z,y.Y,T.n,A.r,L.X,Z.I,M.r,P.y,v.t,w.JJ,w.On,B.Sm,B.PM,B.FN,B.W2,B.Gu,B.gu,B.Ie,B.Q$,B.uN,B.nJ,B.Wo,B.wd,B.ho,B.sr,B.w,B.oU,U.H,J.I,Q.o,q.c,N.e,k.X$],encapsulation:2}),AddonBlogEntriesPage})();var R=n(24672),O=n(51845),H=n(39716),F=n(11375),$=n(56283);function buildRoutes(e){return[...(0,H.o)(e,{data:{mainMenuTabRoot:F.c.PAGE_NAME},component:C})]}let j=(()=>{var e;class AddonBlogLazyModule{}return(e=AddonBlogLazyModule).ɵfac=function AddonBlogLazyModule_Factory(t){return new(t||e)},e.ɵmod=o.oAB({type:e}),e.ɵinj=o.cJS({providers:[{provide:i.Z6,multi:!0,deps:[o.zs3],useFactory:buildRoutes}],imports:[r.L,R.H,O.g,$.g,i.Bz]}),AddonBlogLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&o.kYT(j,{declarations:[C],imports:[r.L,R.H,O.g,$.g],exports:[i.Bz]}))}}]);