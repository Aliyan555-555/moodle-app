"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2940],{82940:(e,i,o)=>{o.r(i),o.d(i,{AddonPrivateFilesLazyModule:()=>U});var t=o(13386),n=o(49671),a=o(2864),l=o(81370),r=o(53564),s=o(13010),d=o(34749),c=o(10727),_=o(98370),f=o(24392),p=o(25464),u=o(75803),g=o(43555),h=o(88817),m=o(43468),v=o(19212),x=o(96814),P=o(55126),F=o(9693),I=o(66931),b=o(31189),A=o(73946),T=o(86700),y=o(29657),w=o(31903),Z=o(89515);function AddonPrivateFilesIndexPage_core_loading_12_core_combobox_1_Template(e,i){if(1&e){const e=v.EpF();v.TgZ(0,"core-combobox",12),v.NdJ("onChange",(function AddonPrivateFilesIndexPage_core_loading_12_core_combobox_1_Template_core_combobox_onChange_0_listener(i){v.CHM(e);const o=v.oxw(2);return v.KtG(o.rootChanged(i))})),v.TgZ(1,"ion-select-option",13),v._uU(2),v.ALo(3,"translate"),v.qZA(),v.TgZ(4,"ion-select-option",14),v._uU(5),v.ALo(6,"translate"),v.qZA()()}if(2&e){const e=v.oxw(2);v.Q6J("selection",e.root),v.xp6(2),v.hij(" ",v.lcZ(3,3,"addon.privatefiles.privatefiles")," "),v.xp6(3),v.hij(" ",v.lcZ(6,5,"addon.privatefiles.sitefiles")," ")}}const _c0=(e,i)=>({used:e,total:i}),_c1=e=>({$a:e});function AddonPrivateFilesIndexPage_core_loading_12_ion_card_2_Template(e,i){if(1&e&&(v.TgZ(0,"ion-card",15)(1,"ion-item")(2,"ion-label"),v._uU(3),v.ALo(4,"translate"),v.qZA()()()),2&e){const e=v.oxw(2);v.xp6(3),v.hij(" ",v.xi3(4,1,"core.quotausage",v.VKq(7,_c1,v.WLB(4,_c0,e.spaceUsed,e.userQuotaReadable)))," ")}}function AddonPrivateFilesIndexPage_core_loading_12_ion_list_3_ng_container_1_ion_item_1_Template(e,i){if(1&e){const e=v.EpF();v.TgZ(0,"ion-item",19),v.NdJ("click",(function AddonPrivateFilesIndexPage_core_loading_12_ion_list_3_ng_container_1_ion_item_1_Template_ion_item_click_0_listener(){v.CHM(e);const i=v.oxw().$implicit,o=v.oxw(3);return v.KtG(o.openFolder(i))})),v._UZ(1,"ion-icon",20),v.ALo(2,"translate"),v.TgZ(3,"ion-label"),v._uU(4),v.qZA()()}if(2&e){const e=v.oxw().$implicit;v.Q6J("detail",!0),v.xp6(),v.uIk("aria-label",v.lcZ(2,3,"core.folder")),v.xp6(3),v.Oqu(e.filename)}}function AddonPrivateFilesIndexPage_core_loading_12_ion_list_3_ng_container_1_core_file_2_Template(e,i){if(1&e&&v._UZ(0,"core-file",21),2&e){const e=v.oxw().$implicit,i=v.oxw(3);v.Q6J("file",e)("component",i.component)("componentId",e.contextid)}}function AddonPrivateFilesIndexPage_core_loading_12_ion_list_3_ng_container_1_Template(e,i){if(1&e&&(v.ynx(0),v.YNc(1,AddonPrivateFilesIndexPage_core_loading_12_ion_list_3_ng_container_1_ion_item_1_Template,5,5,"ion-item",17)(2,AddonPrivateFilesIndexPage_core_loading_12_ion_list_3_ng_container_1_core_file_2_Template,1,3,"core-file",18),v.BQk()),2&e){const e=i.$implicit;v.xp6(),v.Q6J("ngIf",e.isdir),v.xp6(),v.Q6J("ngIf",!e.isdir)}}function AddonPrivateFilesIndexPage_core_loading_12_ion_list_3_Template(e,i){if(1&e&&(v.TgZ(0,"ion-list"),v.YNc(1,AddonPrivateFilesIndexPage_core_loading_12_ion_list_3_ng_container_1_Template,3,2,"ng-container",16),v.qZA()),2&e){const e=v.oxw(2);v.xp6(),v.Q6J("ngForOf",e.files)}}function AddonPrivateFilesIndexPage_core_loading_12_core_empty_box_4_Template(e,i){1&e&&(v._UZ(0,"core-empty-box",22),v.ALo(1,"translate")),2&e&&v.Q6J("message",v.lcZ(1,1,"addon.privatefiles.emptyfilelist"))}function AddonPrivateFilesIndexPage_core_loading_12_Template(e,i){if(1&e&&(v.TgZ(0,"core-loading",7),v.YNc(1,AddonPrivateFilesIndexPage_core_loading_12_core_combobox_1_Template,7,7,"core-combobox",8)(2,AddonPrivateFilesIndexPage_core_loading_12_ion_card_2_Template,5,9,"ion-card",9)(3,AddonPrivateFilesIndexPage_core_loading_12_ion_list_3_Template,2,1,"ion-list",10)(4,AddonPrivateFilesIndexPage_core_loading_12_core_empty_box_4_Template,2,3,"core-empty-box",11),v.qZA()),2&e){const e=v.oxw();v.Q6J("hideUntil",e.filesLoaded),v.xp6(),v.Q6J("ngIf",e.showPrivateFiles&&e.showSiteFiles&&!e.path),v.xp6(),v.Q6J("ngIf",e.userQuota&&e.filesInfo&&e.filesInfo.filecount>0),v.xp6(),v.Q6J("ngIf",e.files&&e.files.length>0),v.xp6(),v.Q6J("ngIf",!e.files||!e.files.length)}}function AddonPrivateFilesIndexPage_ion_fab_13_Template(e,i){if(1&e){const e=v.EpF();v.TgZ(0,"ion-fab",23)(1,"ion-fab-button",24),v.NdJ("click",(function AddonPrivateFilesIndexPage_ion_fab_13_Template_ion_fab_button_click_1_listener(){v.CHM(e);const i=v.oxw();return v.KtG(i.uploadFile())})),v.ALo(2,"translate"),v._UZ(3,"ion-icon",25),v.TgZ(4,"span",26),v._uU(5),v.ALo(6,"translate"),v.qZA()()()}2&e&&(v.xp6(),v.uIk("aria-label",v.lcZ(2,2,"core.fileuploader.uploadafile")),v.xp6(4),v.Oqu(v.lcZ(6,4,"core.fileuploader.uploadafile")))}let Q=(()=>{var e;class AddonPrivateFilesIndexPage{constructor(){this.filesLoaded=!1,this.updateSiteObserver=_.R.on(_.R.SITE_UPDATED,(()=>{this.setVisibility()}),r.m9.getCurrentSiteId()),this.logView=h.V.once((0,n.Z)((function*(){m.ke.logEvent({type:m.gM.VIEW_ITEM_LIST,ws:"core_files_get_files",name:c.vN.instant("addon.privatefiles.files"),data:{category:"files"},url:"/user/files.php"})})))}ngOnInit(){var e,i;try{this.root=g.b.getRouteParam("root");const e=g.b.getRouteNumberParam("contextid");e&&(this.path={contextid:e,component:g.b.getRequiredRouteParam("component"),filearea:g.b.getRequiredRouteParam("filearea"),itemid:g.b.getRequiredRouteNumberParam("itemid"),filepath:g.b.getRequiredRouteParam("filepath"),filename:g.b.getRequiredRouteParam("filename")})}catch(e){return s.OQ.showErrorModal(e),g.b.back(),void 0}this.title=(null===(e=this.path)||void 0===e?void 0:e.filename)||c.vN.instant("addon.privatefiles.files"),this.setVisibility(),this.userQuota=null===(i=r.m9.getCurrentSite())||void 0===i||null===(i=i.getInfo())||void 0===i?void 0:i.userquota,this.root||(this.showPrivateFiles?this.root="my":this.showSiteFiles&&(this.root="site")),this.root?this.rootChanged(this.root):this.filesLoaded=!0}setVisibility(){this.showPrivateFiles=f.G.canViewPrivateFiles(),this.showSiteFiles=f.G.canViewSiteFiles(),this.showUpload=f.G.canUploadFiles()}refreshData(e){this.refreshFiles().finally((()=>{null==e||e.complete()}))}rootChanged(e){this.root=e,this.filesLoaded=!1,this.component="my"==this.root?f.c.PRIVATE_FILES_COMPONENT:f.c.SITE_FILES_COMPONENT,this.fetchFiles().finally((()=>{this.filesLoaded=!0}))}uploadFile(){var e=this;return(0,n.Z)((function*(){if(!l.AS.isOnline())return s.OQ.showErrorModal("core.fileuploader.errormustbeonlinetoupload",!0),void 0;try{yield p.V.uploadPrivateFile(e.filesInfo),e.filesLoaded=!1,yield u.Tr.ignoreErrors(e.refreshFiles()),e.filesLoaded=!0}catch(e){s.OQ.showErrorModalDefault(e,"core.fileuploader.errorwhileuploading",!0)}}))()}fetchFiles(){var e=this;return(0,n.Z)((function*(){try{if(e.path)return e.files=yield f.G.getFiles(e.path),void 0;"site"==e.root?(e.title=c.vN.instant("addon.privatefiles.sitefiles"),e.files=yield f.G.getSiteFiles()):"my"==e.root?(e.title=c.vN.instant("addon.privatefiles.files"),e.files=yield f.G.getPrivateFiles(),e.showUpload&&e.userQuota&&e.userQuota>0?(e.filesInfo=yield f.G.getPrivateFilesInfo(),e.spaceUsed=d._1.bytesToSize(e.filesInfo.filesizewithoutreferences,1),e.userQuotaReadable=d._1.bytesToSize(e.userQuota,1)):delete e.userQuota,e.logView()):s.OQ.showErrorModal("addon.privatefiles.couldnotloadfiles",!0)}catch(e){s.OQ.showErrorModalDefault(e,"addon.privatefiles.couldnotloadfiles",!0)}}))()}refreshFiles(){var e=this;return(0,n.Z)((function*(){try{yield Promise.all([f.G.invalidateDirectory(e.root,e.path),f.G.invalidatePrivateFilesInfoForUser()])}finally{yield e.fetchFiles()}}))()}openFolder(e){const i={contextid:e.contextid,component:e.component||"",filearea:e.filearea||"",itemid:e.itemid||0,filepath:e.filepath||"",filename:e.filename||""};e.component&&(i.filename="");const o=a.V.hashAsciiStr(JSON.stringify(i));g.b.navigate(`../${o}`,{params:i})}ngOnDestroy(){var e;null===(e=this.updateSiteObserver)||void 0===e||e.off()}}return(e=AddonPrivateFilesIndexPage).ɵfac=function AddonPrivateFilesIndexPage_Factory(i){return new(i||e)},e.ɵcmp=v.Xpm({type:e,selectors:[["page-addon-privatefiles-index"]],decls:14,vars:10,consts:[["slot","start"],[3,"text"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil",4,"ngIf"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end",4,"ngIf"],[3,"hideUntil"],[3,"selection","onChange",4,"ngIf"],["class","core-info-card",4,"ngIf"],[4,"ngIf"],["icon","far-folder-open",3,"message",4,"ngIf"],[3,"selection","onChange"],["value","my",1,"ion-text-wrap"],["value","site",1,"ion-text-wrap"],[1,"core-info-card"],[4,"ngFor","ngForOf"],["button","","class","ion-text-wrap item-file item-directory",3,"detail","click",4,"ngIf"],[3,"file","component","componentId",4,"ngIf"],["button","",1,"ion-text-wrap","item-file","item-directory",3,"detail","click"],["name","fas-folder","slot","start"],[3,"file","component","componentId"],["icon","far-folder-open",3,"message"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],[3,"click"],["name","fas-plus","aria-hidden","true"],[1,"sr-only"]],template:function AddonPrivateFilesIndexPage_Template(e,i){1&e&&(v.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),v._UZ(3,"ion-back-button",1),v.ALo(4,"translate"),v.qZA(),v.TgZ(5,"ion-title")(6,"h1"),v._uU(7),v.qZA()()()(),v.TgZ(8,"ion-content",2)(9,"ion-refresher",3),v.NdJ("ionRefresh",(function AddonPrivateFilesIndexPage_Template_ion_refresher_ionRefresh_9_listener(e){return i.refreshData(e.target)})),v._UZ(10,"ion-refresher-content",4),v.ALo(11,"translate"),v.qZA(),v.YNc(12,AddonPrivateFilesIndexPage_core_loading_12_Template,5,5,"core-loading",5)(13,AddonPrivateFilesIndexPage_ion_fab_13_Template,7,6,"ion-fab",6),v.qZA()),2&e&&(v.xp6(3),v.Q6J("text",v.lcZ(4,6,"core.back")),v.xp6(4),v.Oqu(i.title),v.xp6(2),v.Q6J("disabled",!i.filesLoaded||!i.showPrivateFiles&&!i.showSiteFiles),v.xp6(),v.s9C("pullingText",v.lcZ(11,8,"core.pulltorefresh")),v.xp6(2),v.Q6J("ngIf",i.showPrivateFiles||i.showSiteFiles),v.xp6(),v.Q6J("ngIf",i.showUpload&&"site"!==i.root&&!i.path))},dependencies:[x.sg,x.O5,P.z,F.Y,I.r,b.F,A.U,T.I,y.t,w.Sm,w.PM,w.W2,w.IJ,w.W4,w.Gu,w.gu,w.Ie,w.Q$,w.q_,w.nJ,w.Wo,w.n0,w.wd,w.sr,w.oU,Z.X$],encapsulation:2}),AddonPrivateFilesIndexPage})();var L=o(67643),J=o(39716);function buildRoutes(e){return[{path:"root",component:Q},{path:":hash",component:Q},...(0,J.o)(e,{redirectTo:"root",pathMatch:"full"})]}let U=(()=>{var e;class AddonPrivateFilesLazyModule{}return(e=AddonPrivateFilesLazyModule).ɵfac=function AddonPrivateFilesLazyModule_Factory(i){return new(i||e)},e.ɵmod=v.oAB({type:e}),e.ɵinj=v.cJS({providers:[{provide:L.Z6,multi:!0,deps:[v.zs3],useFactory:buildRoutes}],imports:[t.L,L.Bz]}),AddonPrivateFilesLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&v.kYT(U,{declarations:[Q],imports:[t.L],exports:[L.Bz]}))}}]);