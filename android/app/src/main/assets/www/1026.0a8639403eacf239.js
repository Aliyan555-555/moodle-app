"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1026],{11026:(e,r,t)=>{t.r(r),t.d(r,{CoreSearchGlobalSearchFiltersComponent:()=>F,CoreSearchGlobalSearchFiltersComponentModule:()=>x});var o=t(13386),n=t(49671),a=t(92974),i=t(24442),l=t(98370),s=t(10727),c=t(75803),h=t(19212),_=t(96814),u=t(76025),C=t(86700),d=t(8947),g=t(29657),p=t(22068),m=t(56223),S=t(31903),f=t(89515);function CoreSearchGlobalSearchFiltersComponent_ng_container_15_ion_item_10_Template(e,r){if(1&e){const e=h.EpF();h.TgZ(0,"ion-item",8)(1,"ion-checkbox",11),h.NdJ("ngModelChange",(function CoreSearchGlobalSearchFiltersComponent_ng_container_15_ion_item_10_Template_ion_checkbox_ngModelChange_1_listener(r){const t=h.CHM(e);return h.KtG(t.$implicit.checked=r)}))("ionChange",(function CoreSearchGlobalSearchFiltersComponent_ng_container_15_ion_item_10_Template_ion_checkbox_ionChange_1_listener(){const r=h.CHM(e).$implicit,t=h.oxw(2);return h.KtG(t.onSearchAreaCategoryInputChanged(r))})),h._UZ(2,"core-format-text",12),h.qZA()()}if(2&e){const e=r.$implicit;h.xp6(),h.Q6J("ngModel",e.checked),h.xp6(),h.Q6J("text",e.name)}}function CoreSearchGlobalSearchFiltersComponent_ng_container_15_Template(e,r){if(1&e){const e=h.EpF();h.ynx(0),h._UZ(1,"core-spacer"),h.TgZ(2,"ion-item",7)(3,"ion-label"),h._uU(4),h.ALo(5,"translate"),h.qZA()(),h.TgZ(6,"ion-item",8)(7,"ion-checkbox",9),h.NdJ("ngModelChange",(function CoreSearchGlobalSearchFiltersComponent_ng_container_15_Template_ion_checkbox_ngModelChange_7_listener(r){h.CHM(e);const t=h.oxw();return h.KtG(t.allSearchAreaCategories=r)}))("ionChange",(function CoreSearchGlobalSearchFiltersComponent_ng_container_15_Template_ion_checkbox_ionChange_7_listener(){h.CHM(e);const r=h.oxw();return h.KtG(r.allSearchAreaCategoriesUpdated())})),h._uU(8),h.ALo(9,"translate"),h.qZA()(),h.YNc(10,CoreSearchGlobalSearchFiltersComponent_ng_container_15_ion_item_10_Template,3,2,"ion-item",10),h.BQk()}if(2&e){const e=h.oxw();h.xp6(4),h.hij(" ",h.lcZ(5,5,"core.search.filtercategories")," "),h.xp6(3),h.Q6J("ngModel",e.allSearchAreaCategories)("indeterminate",null===e.allSearchAreaCategories),h.xp6(),h.Oqu(h.lcZ(9,7,"core.search.allcategories")),h.xp6(2),h.Q6J("ngForOf",e.searchAreaCategories)}}function CoreSearchGlobalSearchFiltersComponent_ng_container_16_ion_item_10_Template(e,r){if(1&e){const e=h.EpF();h.TgZ(0,"ion-item",8)(1,"ion-checkbox",11),h.NdJ("ngModelChange",(function CoreSearchGlobalSearchFiltersComponent_ng_container_16_ion_item_10_Template_ion_checkbox_ngModelChange_1_listener(r){const t=h.CHM(e);return h.KtG(t.$implicit.checked=r)}))("ionChange",(function CoreSearchGlobalSearchFiltersComponent_ng_container_16_ion_item_10_Template_ion_checkbox_ionChange_1_listener(){const r=h.CHM(e).$implicit,t=h.oxw(2);return h.KtG(t.onCourseInputChanged(r))})),h._UZ(2,"core-format-text",12),h.qZA()()}if(2&e){const e=r.$implicit;h.xp6(),h.Q6J("ngModel",e.checked),h.xp6(),h.Q6J("text",e.shortname)}}function CoreSearchGlobalSearchFiltersComponent_ng_container_16_Template(e,r){if(1&e){const e=h.EpF();h.ynx(0),h._UZ(1,"core-spacer"),h.TgZ(2,"ion-item",7)(3,"ion-label"),h._uU(4),h.ALo(5,"translate"),h.qZA()(),h.TgZ(6,"ion-item",8)(7,"ion-checkbox",9),h.NdJ("ngModelChange",(function CoreSearchGlobalSearchFiltersComponent_ng_container_16_Template_ion_checkbox_ngModelChange_7_listener(r){h.CHM(e);const t=h.oxw();return h.KtG(t.allCourses=r)}))("ionChange",(function CoreSearchGlobalSearchFiltersComponent_ng_container_16_Template_ion_checkbox_ionChange_7_listener(){h.CHM(e);const r=h.oxw();return h.KtG(r.allCoursesUpdated())})),h._uU(8),h.ALo(9,"translate"),h.qZA()(),h.YNc(10,CoreSearchGlobalSearchFiltersComponent_ng_container_16_ion_item_10_Template,3,2,"ion-item",10),h.BQk()}if(2&e){const e=h.oxw();h.xp6(4),h.hij(" ",h.lcZ(5,5,"core.search.filtercourses")," "),h.xp6(3),h.Q6J("ngModel",e.allCourses)("indeterminate",null===e.allCourses),h.xp6(),h.hij(" ",h.lcZ(9,7,"core.search.allcourses"),""),h.xp6(2),h.Q6J("ngForOf",e.courses)}}let F=(()=>{var e;class CoreSearchGlobalSearchFiltersComponent{constructor(){this.allSearchAreaCategories=!0,this.searchAreaCategories=[],this.allCourses=!0,this.courses=[],this.newFilters={}}ngOnInit(){var e=this;return(0,n.Z)((function*(){var r;e.newFilters=null!==(r=e.filters)&&void 0!==r?r:{},yield e.updateSearchAreaCategories(),yield e.updateCourses()}))()}close(){s.IN.dismiss()}allSearchAreaCategoriesUpdated(){if(null===this.allSearchAreaCategories)return;const e=this.allSearchAreaCategories;this.searchAreaCategories.forEach((r=>{r.checked!==e&&(r.checked=e)}))}onSearchAreaCategoryInputChanged(e){(e.checked||!this.newFilters.searchAreaCategoryIds||this.newFilters.searchAreaCategoryIds.includes(e.id))&&(!e.checked||this.newFilters.searchAreaCategoryIds&&!this.newFilters.searchAreaCategoryIds.includes(e.id))&&this.searchAreaCategoryUpdated()}allCoursesUpdated(){if(null===this.allCourses)return;const e=this.allCourses;this.courses.forEach((r=>{r.checked!==e&&(r.checked=e)}))}onCourseInputChanged(e){(e.checked||!this.newFilters.courseIds||this.newFilters.courseIds.includes(e.id))&&(!e.checked||this.newFilters.courseIds&&!this.newFilters.courseIds.includes(e.id))&&this.courseUpdated()}refreshFilters(e){var r=this;return(0,n.Z)((function*(){yield c.Tr.ignoreErrors(Promise.all([i.HA.invalidateSearchAreas(),a.B.invalidateUserCourses()])),yield r.updateSearchAreaCategories(),yield r.updateCourses(),null==e||e.complete()}))()}updateSearchAreaCategories(){var e=this;return(0,n.Z)((function*(){const r=yield i.HA.getSearchAreas(),t=new Set;e.searchAreaCategories=[];for(const a of r){var o,n;t.has(a.category.id)||(t.add(a.category.id),e.searchAreaCategories.push({...a.category,checked:null===(o=null===(n=e.filters)||void 0===n||null===(n=n.searchAreaCategoryIds)||void 0===n?void 0:n.includes(a.category.id))||void 0===o||o}))}e.allSearchAreaCategories=e.getGroupFilterStatus(e.searchAreaCategories)}))()}updateCourses(){var e=this;return(0,n.Z)((function*(){const r=yield a.B.getUserCourses();e.courses=r.sort(((e,r)=>{var t,o,n,a;return(null!==(t=null===(o=e.shortname)||void 0===o?void 0:o.toLowerCase())&&void 0!==t?t:"").localeCompare(null!==(n=null===(a=r.shortname)||void 0===a?void 0:a.toLowerCase())&&void 0!==n?n:"")})).map((r=>{var t,o;return{...r,checked:null===(t=null===(o=e.filters)||void 0===o||null===(o=o.courseIds)||void 0===o?void 0:o.includes(r.id))||void 0===t||t}})),e.allCourses=e.getGroupFilterStatus(e.courses)}))()}searchAreaCategoryUpdated(){const e=this.getGroupFilterStatus(this.searchAreaCategories);e!==this.allSearchAreaCategories&&(this.allSearchAreaCategories=e),this.emitFiltersUpdated()}courseUpdated(){const e=this.getGroupFilterStatus(this.courses);e!==this.allCourses&&(this.allCourses=e),this.emitFiltersUpdated()}getGroupFilterStatus(e){if(0===e.length)return null;const r=e[0].checked;for(const t of e)if(t.checked!==r)return null;return r}emitFiltersUpdated(){this.newFilters={},this.allSearchAreaCategories||(this.newFilters.searchAreaCategoryIds=this.searchAreaCategories.filter((({checked:e})=>e)).map((({id:e})=>e))),this.allCourses||(this.newFilters.courseIds=this.courses.filter((({checked:e})=>e)).map((({id:e})=>e))),l.R.trigger(i.R6,this.newFilters)}}return(e=CoreSearchGlobalSearchFiltersComponent).ɵfac=function CoreSearchGlobalSearchFiltersComponent_Factory(r){return new(r||e)},e.ɵcmp=h.Xpm({type:e,selectors:[["core-search-global-search-filters"]],inputs:{hideCourses:"hideCourses",filters:"filters"},decls:17,vars:12,consts:[["slot","end"],["fill","clear",3,"click"],["name","fas-xmark","slot","icon-only","aria-hidden","true"],[3,"fullscreen"],["slot","fixed",3,"ionRefresh"],[3,"pullingText"],[4,"ngIf"],[1,"ion-text-wrap","help"],[1,"ion-text-wrap"],["labelPlacement","start",3,"ngModel","indeterminate","ngModelChange","ionChange"],["class","ion-text-wrap",4,"ngFor","ngForOf"],["labelPlacement","start",3,"ngModel","ngModelChange","ionChange"],[3,"text"]],template:function CoreSearchGlobalSearchFiltersComponent_Template(e,r){1&e&&(h.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title")(3,"h1"),h._uU(4),h.ALo(5,"translate"),h.qZA()(),h.TgZ(6,"ion-buttons",0)(7,"ion-button",1),h.NdJ("click",(function CoreSearchGlobalSearchFiltersComponent_Template_ion_button_click_7_listener(){return r.close()})),h.ALo(8,"translate"),h._UZ(9,"ion-icon",2),h.qZA()()()(),h.TgZ(10,"ion-content",3)(11,"ion-refresher",4),h.NdJ("ionRefresh",(function CoreSearchGlobalSearchFiltersComponent_Template_ion_refresher_ionRefresh_11_listener(e){return r.refreshFilters(e.target)})),h._UZ(12,"ion-refresher-content",5),h.ALo(13,"translate"),h.qZA(),h.TgZ(14,"ion-list"),h.YNc(15,CoreSearchGlobalSearchFiltersComponent_ng_container_15_Template,11,9,"ng-container",6)(16,CoreSearchGlobalSearchFiltersComponent_ng_container_16_Template,11,9,"ng-container",6),h.qZA()()),2&e&&(h.xp6(4),h.Oqu(h.lcZ(5,6,"core.search.filterheader")),h.xp6(3),h.uIk("aria-label",h.lcZ(8,8,"core.close")),h.xp6(3),h.Q6J("fullscreen",!0),h.xp6(2),h.s9C("pullingText",h.lcZ(13,10,"core.pulltorefresh")),h.xp6(3),h.Q6J("ngIf",r.searchAreaCategories.length>0),h.xp6(),h.Q6J("ngIf",!r.hideCourses&&r.courses.length>0))},dependencies:[_.sg,_.O5,u.w,C.I,d.r,g.t,p.O,m.JJ,m.On,S.YG,S.Sm,S.nz,S.W2,S.Gu,S.gu,S.Ie,S.Q$,S.q_,S.nJ,S.Wo,S.wd,S.sr,S.w,f.X$],styles:["[_nghost-%COMP%]{--help-text-color: var(--gray-700)}[_nghost-%COMP%]   ion-item.help[_ngcontent-%COMP%]{color:var(--help-text-color)}[_nghost-%COMP%]   ion-item.help[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-bottom:0}[_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]:not(.help){font-size:16px}html.dark[_nghost-%COMP%], html.dark   [_nghost-%COMP%]{--help-text-color: var(--gray-400)}"]}),CoreSearchGlobalSearchFiltersComponent})(),x=(()=>{var e;class CoreSearchGlobalSearchFiltersComponentModule{}return(e=CoreSearchGlobalSearchFiltersComponentModule).ɵfac=function CoreSearchGlobalSearchFiltersComponentModule_Factory(r){return new(r||e)},e.ɵmod=h.oAB({type:e}),e.ɵinj=h.cJS({imports:[o.L]}),CoreSearchGlobalSearchFiltersComponentModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&h.kYT(x,{declarations:[F],imports:[o.L]}))}}]);