"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8107],{85904:(o,e,n)=>{n.d(e,{W:()=>M});var s=n(49671),i=n(56223),t=n(31381),d=n(90030),a=n(76474),r=n(65254),_=n(56173),c=n(53564),l=n(12265),p=n(13010),m=n(34749),u=n(75803),h=n(10727),f=n(98370),g=n(40067),k=n(3984),b=n(78452),A=n(11850),I=n(63294),x=n(1248),w=n(19212);const v=["assessmentForm"];function AddonModWorkshopAssessmentStrategyComponent_ng_container_6_Template(o,e){if(1&o&&(w.ynx(0),w._UZ(1,"core-dynamic-component",6),w.BQk()),2&o){const o=w.oxw();w.xp6(),w.Q6J("component",o.componentClass)("data",o.data)}}const _c1=o=>({$a:o});function AddonModWorkshopAssessmentStrategyComponent_ion_card_7_Template(o,e){if(1&o&&(w.TgZ(0,"ion-card",7)(1,"ion-item")(2,"ion-label")(3,"p"),w._uU(4),w.ALo(5,"translate"),w.qZA()()()()),2&o){const o=w.oxw();w.xp6(4),w.Oqu(w.xi3(5,1,"addon.mod_workshop.assessmentstrategynotsupported",w.VKq(4,_c1,o.strategy)))}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_6_core_input_errors_6_Template(o,e){if(1&o&&w._UZ(0,"core-input-errors",16),2&o){const o=w.oxw(3);w.Q6J("errorText",o.data.fieldErrors.feedbackauthor)}}const _c2=o=>({asid:o});function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_6_Template(o,e){if(1&o){const o=w.EpF();w.TgZ(0,"ion-item")(1,"ion-label",12)(2,"span",13),w._uU(3),w.ALo(4,"translate"),w.qZA()(),w.TgZ(5,"core-rich-text-editor",14),w.NdJ("contentChanged",(function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_6_Template_core_rich_text_editor_contentChanged_5_listener(e){w.CHM(o);const n=w.oxw(2);return w.KtG(n.onFeedbackChange(e))})),w.qZA(),w.YNc(6,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_6_core_input_errors_6_Template,1,1,"core-input-errors",15),w.qZA()}if(2&o){const o=w.oxw(2);w.xp6(2),w.Q6J("core-mark-required",o.overallFeedkbackRequired),w.xp6(),w.hij(" ",w.lcZ(4,9,"addon.mod_workshop.feedbackauthor")," "),w.xp6(2),w.Q6J("control",o.feedbackControl)("component",o.component)("componentId",o.workshop.coursemodule)("autoSave",!0)("contextInstanceId",o.workshop.coursemodule)("draftExtraParams",w.VKq(11,_c2,o.assessmentId)),w.xp6(),w.Q6J("ngIf",o.overallFeedkbackRequired&&o.data.fieldErrors&&o.data.fieldErrors.feedbackauthor)}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_core_attachments_7_Template(o,e){if(1&o&&w._UZ(0,"core-attachments",17),2&o){const o=w.oxw(2);w.Q6J("files",null==o.data.assessment?null:o.data.assessment.feedbackattachmentfiles)("maxSize",o.workshop.overallfeedbackmaxbytes)("maxSubmissions",o.workshop.overallfeedbackfiles)("component",o.component)("componentId",o.componentId)("allowOffline",!0)("courseId",o.workshop.course)}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_8_ion_select_option_7_Template(o,e){if(1&o&&(w.TgZ(0,"ion-select-option",21),w._uU(1),w.qZA()),2&o){const o=e.$implicit;w.Q6J("value",o),w.xp6(),w.Oqu(o)}}const _c3=o=>({header:o});function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_8_Template(o,e){if(1&o){const o=w.EpF();w.TgZ(0,"ion-item")(1,"ion-select",18),w.NdJ("ngModelChange",(function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_8_Template_ion_select_ngModelChange_1_listener(e){w.CHM(o);const n=w.oxw(2);return w.KtG(n.weight=e)})),w.ALo(2,"translate"),w.ALo(3,"translate"),w.TgZ(4,"div",19),w._uU(5),w.ALo(6,"translate"),w.qZA(),w.YNc(7,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_8_ion_select_option_7_Template,2,2,"ion-select-option",20),w.qZA()()}if(2&o){const o=w.oxw(2);w.xp6(),w.Q6J("ngModel",o.weight)("cancelText",w.lcZ(2,6,"core.cancel"))("interfaceOptions",w.VKq(12,_c3,w.lcZ(3,8,"addon.mod_workshop.assessmentweight"))),w.xp6(3),w.Q6J("core-mark-required",!0),w.xp6(),w.hij(" ",w.lcZ(6,10,"addon.mod_workshop.assessmentweight")," "),w.xp6(2),w.Q6J("ngForOf",o.weights)}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_9_Template(o,e){if(1&o&&(w.TgZ(0,"ion-item",8)(1,"ion-label"),w._UZ(2,"core-format-text",22),w.qZA()()),2&o){const o=w.oxw(2);w.xp6(2),w.Q6J("component",o.component)("componentId",o.componentId)("text",null==o.data.assessment?null:o.data.assessment.feedbackauthor)("contextInstanceId",o.workshop.coursemodule)("courseId",o.workshop.course)}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_10_Template(o,e){if(1&o&&(w.TgZ(0,"ion-item")(1,"ion-label"),w._UZ(2,"core-files",23),w.qZA()()),2&o){const o=w.oxw(2);w.xp6(2),w.Q6J("files",null==o.data.assessment?null:o.data.assessment.feedbackattachmentfiles)("component",o.component)("componentId",o.componentId)}}function AddonModWorkshopAssessmentStrategyComponent_ion_card_8_Template(o,e){if(1&o&&(w.TgZ(0,"ion-card")(1,"ion-item",8)(2,"ion-label")(3,"h3",9),w._uU(4),w.ALo(5,"translate"),w.qZA()()(),w.YNc(6,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_6_Template,7,13,"ion-item",4)(7,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_core_attachments_7_Template,1,7,"core-attachments",10)(8,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_8_Template,8,14,"ion-item",4)(9,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_9_Template,3,5,"ion-item",11)(10,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_ion_item_10_Template,3,3,"ion-item",4),w.qZA()),2&o){const o=w.oxw();w.xp6(4),w.Oqu(w.lcZ(5,6,"addon.mod_workshop.overallfeedback")),w.xp6(2),w.Q6J("ngIf",o.edit),w.xp6(),w.Q6J("ngIf",o.edit&&o.workshop.overallfeedbackfiles),w.xp6(),w.Q6J("ngIf",o.edit&&o.access&&o.access.canallocate),w.xp6(),w.Q6J("ngIf",!o.edit&&(null==o.data.assessment?null:o.data.assessment.feedbackauthor)),w.xp6(),w.Q6J("ngIf",!o.edit&&o.workshop.overallfeedbackfiles&&(null==o.data.assessment||null==o.data.assessment.feedbackattachmentfiles?null:o.data.assessment.feedbackattachmentfiles.length))}}let M=(()=>{var o;class AddonModWorkshopAssessmentStrategyComponent{constructor(){this.edit=!1,this.data={workshopId:0,assessment:void 0,edit:!1,selectedValues:[],fieldErrors:{},strategy:"",moduleId:0,courseId:void 0},this.assessmentStrategyLoaded=!1,this.notSupported=!1,this.feedbackText="",this.feedbackControl=new i.NI(null),this.overallFeedkback=!1,this.overallFeedkbackRequired=!1,this.component=x.qR,this.weights=[],this.hasOffline=!1,this.originalData={text:"",files:[],weight:1,selectedValues:[]}}ngOnInit(){var o=this;return(0,s.Z)((function*(){if(!o.assessmentId||!o.strategy)return o.assessmentStrategyLoaded=!0,void 0;if(o.data.workshopId=o.workshop.id,o.data.edit=o.edit,o.data.strategy=o.strategy,o.data.moduleId=o.workshop.coursemodule,o.data.courseId=o.workshop.course,o.componentClass=yield k.AddonWorkshopAssessmentStrategyDelegate.getComponentForPlugin(o.strategy),o.componentClass){if(o.overallFeedkback=o.workshop.overallfeedbackmode!=b.AddonModWorkshopOverallFeedbackMode.DISABLED,o.overallFeedkbackRequired=o.workshop.overallfeedbackmode==b.AddonModWorkshopOverallFeedbackMode.ENABLED_REQUIRED,o.componentId=o.workshop.coursemodule,o.edit&&o.access.canallocate){o.weights=[];for(let e=16;e>=0;e--)o.weights[e]=e}o.edit&&l.d.blockOperation(x.qR,o.workshop.id);try{yield o.load(),o.obsInvalidated=f.R.on(b.AddonModWorkshopProvider.ASSESSMENT_INVALIDATED,(()=>o.load()),c.m9.getCurrentSiteId())}catch(e){o.componentClass=void 0,p.OQ.showErrorModalDefault(e,"Error loading assessment.")}finally{o.assessmentStrategyLoaded=!0}}else o.notSupported=!k.AddonWorkshopAssessmentStrategyDelegate.isPluginSupported(o.strategy),o.assessmentStrategyLoaded=!0}))()}load(){var o=this;return(0,s.Z)((function*(){if(o.data.assessment=yield A.AddonModWorkshopHelper.getReviewerAssessmentById(o.workshop.id,o.assessmentId,{userId:o.userId,cmId:o.workshop.coursemodule}),o.data.assessment.form){if(o.edit)try{const e=(yield I.AddonModWorkshopOffline.getAssessment(o.workshop.id,o.assessmentId)).inputdata;o.hasOffline=!0,o.data.assessment.feedbackauthor=e.feedbackauthor,o.access.canallocate&&(o.data.assessment.weight=e.weight),o.data.assessment.form.current=b.AddonModWorkshop.parseFields(u.Tr.objectToArrayOfObjects(e,"name","value")),e&&(o.data.assessment.feedbackattachmentfiles=yield A.AddonModWorkshopHelper.getAssessmentFilesFromOfflineFilesObject(e.feedbackauthorattachmentsid,o.workshop.id,o.assessmentId))}catch{o.hasOffline=!1}finally{o.feedbackText=o.data.assessment.feedbackauthor,o.feedbackControl.setValue(o.feedbackText),o.originalData.text=o.data.assessment.feedbackauthor,o.access.canallocate&&(o.originalData.weight=o.data.assessment.weight),o.originalData.files=[],o.data.assessment.feedbackattachmentfiles.forEach((e=>{let n=a.l.getFileName(e);n||(n=r.X.getFilenameFromPath(e)||""),o.originalData.files.push({filename:n,fileurl:""})}))}try{o.data.selectedValues=yield k.AddonWorkshopAssessmentStrategyDelegate.getOriginalValues(o.strategy,o.data.assessment.form,o.workshop.id)}finally{o.originalData.selectedValues=u.Tr.clone(o.data.selectedValues),o.edit&&(_.q.setFiles(x.qR,o.workshop.id+"_"+o.assessmentId,o.data.assessment.feedbackattachmentfiles),o.access.canallocate&&(o.weight=o.data.assessment.weight))}}}))()}hasDataChanged(){var o;if(!this.assessmentStrategyLoaded||!this.workshop.strategy)return!1;const e=m._1.restorePluginfileUrls(this.feedbackText,(null===(o=this.data.assessment)||void 0===o?void 0:o.feedbackcontentfiles)||[]);if(this.originalData.text!=e)return!0;if(this.access.canallocate&&this.originalData.weight!=this.weight)return!0;const n=_.q.getFiles(x.qR,this.workshop.id+"_"+this.assessmentId)||[];return!!d.b.areFileListDifferent(n,this.originalData.files)||k.AddonWorkshopAssessmentStrategyDelegate.hasDataChanged(this.workshop.strategy,this.originalData.selectedValues,this.data.selectedValues)}saveAssessment(){var o=this;return(0,s.Z)((function*(){var e;if(null===(e=o.data.assessment)||void 0===e||!e.form)return;const n=_.q.getFiles(x.qR,o.workshop.id+"_"+o.assessmentId)||[];let s=!1,i=!n.length;const a=yield p.OQ.showModalLoading("core.sending",!0);o.data.fieldErrors={};try{var r;let e;try{e=yield A.AddonModWorkshopHelper.uploadOrStoreAssessmentFiles(o.workshop.id,o.assessmentId,n,s)}catch(t){if(u.Tr.isWebServiceError(t))throw t;s=!0,i=!0,e=yield A.AddonModWorkshopHelper.uploadOrStoreAssessmentFiles(o.workshop.id,o.assessmentId,n,s)}const a=m._1.restorePluginfileUrls(o.feedbackText,(null===(r=o.data.assessment)||void 0===r?void 0:r.feedbackcontentfiles)||[]);let _;try{_=yield A.AddonModWorkshopHelper.prepareAssessmentData(o.workshop,o.data.selectedValues,a,o.data.assessment.form,e)}catch(e){throw o.data.fieldErrors=e,new t.G(h.vN.instant("core.errorinvalidform"))}let l=!1;s?yield I.AddonModWorkshopOffline.saveAssessment(o.workshop.id,o.assessmentId,o.workshop.course,_):l=yield b.AddonModWorkshop.updateAssessment(o.workshop.id,o.assessmentId,o.workshop.course,_,void 0,i),g.o.triggerFormSubmittedEvent(o.formElement,!!l,c.m9.getCurrentSiteId());const p=[];l&&(p.push(A.AddonModWorkshopHelper.deleteAssessmentStoredFiles(o.workshop.id,o.assessmentId)),p.push(b.AddonModWorkshop.invalidateAssessmentFormData(o.workshop.id,o.assessmentId)),p.push(b.AddonModWorkshop.invalidateAssessmentData(o.workshop.id,o.assessmentId))),yield u.Tr.ignoreErrors(Promise.all(p)),f.R.trigger(b.AddonModWorkshopProvider.ASSESSMENT_SAVED,{workshopId:o.workshop.id,assessmentId:o.assessmentId,userId:c.m9.getCurrentSiteUserId()},c.m9.getCurrentSiteId()),n&&d.b.clearTmpFiles(n)}catch(o){p.OQ.showErrorModalDefault(o,"Error saving assessment.")}finally{a.dismiss()}}))()}onFeedbackChange(o){this.feedbackText=null!=o?o:""}ngOnDestroy(){var o,e;null===(o=this.obsInvalidated)||void 0===o||o.off(),null!==(e=this.data.assessment)&&void 0!==e&&e.feedbackattachmentfiles&&d.b.clearTmpFiles(this.data.assessment.feedbackattachmentfiles)}}return(o=AddonModWorkshopAssessmentStrategyComponent).ɵfac=function AddonModWorkshopAssessmentStrategyComponent_Factory(e){return new(e||o)},o.ɵcmp=w.Xpm({type:o,selectors:[["addon-mod-workshop-assessment-strategy"]],viewQuery:function AddonModWorkshopAssessmentStrategyComponent_Query(o,e){if(1&o&&w.Gf(v,5),2&o){let o;w.iGM(o=w.CRH())&&(e.formElement=o.first)}},inputs:{workshop:"workshop",access:"access",assessmentId:"assessmentId",userId:"userId",strategy:"strategy",edit:"edit"},decls:9,vars:7,consts:[[1,"ion-padding"],["name","mma-mod_workshop-assessment-form"],["assessmentForm",""],[3,"hideUntil"],[4,"ngIf"],["class","core-info-card",4,"ngIf"],[3,"component","data"],[1,"core-info-card"],[1,"ion-text-wrap"],[1,"item-heading"],[3,"files","maxSize","maxSubmissions","component","componentId","allowOffline","courseId",4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],["position","stacked"],[3,"core-mark-required"],["contextLevel","module","elementId","feedbackauthor_editor",3,"control","component","componentId","autoSave","contextInstanceId","draftExtraParams","contentChanged"],[3,"errorText",4,"ngIf"],[3,"errorText"],[3,"files","maxSize","maxSubmissions","component","componentId","allowOffline","courseId"],["labelPlacement","stacked","interface","action-sheet","name","weight",3,"ngModel","cancelText","interfaceOptions","ngModelChange"],["slot","label",3,"core-mark-required"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],[3,"files","component","componentId"]],template:function AddonModWorkshopAssessmentStrategyComponent_Template(o,e){1&o&&(w.TgZ(0,"h2",0),w._uU(1),w.ALo(2,"translate"),w.qZA(),w.TgZ(3,"form",1,2)(5,"core-loading",3),w.YNc(6,AddonModWorkshopAssessmentStrategyComponent_ng_container_6_Template,2,2,"ng-container",4)(7,AddonModWorkshopAssessmentStrategyComponent_ion_card_7_Template,6,6,"ion-card",5)(8,AddonModWorkshopAssessmentStrategyComponent_ion_card_8_Template,11,8,"ion-card",4),w.qZA()()),2&o&&(w.xp6(),w.Oqu(w.lcZ(2,5,"addon.mod_workshop.assessmentform")),w.xp6(4),w.Q6J("hideUntil",e.assessmentStrategyLoaded),w.xp6(),w.Q6J("ngIf",e.componentClass&&e.assessmentStrategyLoaded),w.xp6(),w.Q6J("ngIf",e.notSupported),w.xp6(),w.Q6J("ngIf",e.assessmentStrategyLoaded&&e.overallFeedkback&&(e.edit||(null==e.data.assessment?null:e.data.assessment.feedbackauthor)||(null==e.data.assessment||null==e.data.assessment.feedbackattachmentfiles?null:e.data.assessment.feedbackattachmentfiles.length))))},encapsulation:2}),AddonModWorkshopAssessmentStrategyComponent})()},58107:(o,e,n)=>{n.r(e),n.d(e,{AddonModWorkshopIndexComponent:()=>Q});var s=n(49671),i=n(31381),t=n(92413),d=n(95800),a=n(43555),r=n(43571),_=n(13010),c=n(75803),l=n(98370),p=n(78452),m=n(11850),u=n(63294),h=n(3641),f=n(52707),g=n(1248),k=n(19212),b=n(31903),A=n(74273),I=n(96814),x=n(72526),w=n(66931),v=n(78308),M=n(86700),T=n(8947),S=n(22742),Z=n(19289),W=n(22068),C=n(6846),y=n(10875),P=n(78025),q=n(89515);function AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_ion_icon_1_Template(o,e){1&o&&(k._UZ(0,"ion-icon",18),k.ALo(1,"translate")),2&o&&k.uIk("aria-label",k.lcZ(1,1,"addon.mod_workshop.tasktodo"))}function AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_ion_icon_2_Template(o,e){1&o&&(k._UZ(0,"ion-icon",19),k.ALo(1,"translate")),2&o&&k.uIk("aria-label",k.lcZ(1,1,"addon.mod_workshop.taskfail"))}function AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_ion_icon_3_Template(o,e){1&o&&(k._UZ(0,"ion-icon",20),k.ALo(1,"translate")),2&o&&k.uIk("aria-label",k.lcZ(1,1,"addon.mod_workshop.taskinfo"))}function AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_ion_icon_4_Template(o,e){1&o&&(k._UZ(0,"ion-icon",21),k.ALo(1,"translate")),2&o&&k.uIk("aria-label",k.lcZ(1,1,"addon.mod_workshop.taskdone"))}function AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_p_8_Template(o,e){if(1&o&&k._UZ(0,"p",22),2&o){const o=k.oxw().$implicit;k.Q6J("innerHTML",o.details,k.oJD)}}function AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_ion_icon_9_Template(o,e){1&o&&k._UZ(0,"ion-icon",23)}function AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_Template(o,e){if(1&o){const o=k.EpF();k.TgZ(0,"ion-item",10),k.NdJ("click",(function AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_Template_ion_item_click_0_listener(){const e=k.CHM(o).$implicit,n=k.oxw(3);return k.KtG(n.runTask(e))})),k.YNc(1,AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_ion_icon_1_Template,2,3,"ion-icon",11)(2,AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_ion_icon_2_Template,2,3,"ion-icon",12)(3,AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_ion_icon_3_Template,2,3,"ion-icon",13)(4,AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_ion_icon_4_Template,2,3,"ion-icon",14),k.TgZ(5,"ion-label")(6,"p",15),k._uU(7),k.qZA(),k.YNc(8,AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_p_8_Template,1,1,"p",16),k.qZA(),k.YNc(9,AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_ion_icon_9_Template,1,0,"ion-icon",17),k.qZA()}if(2&o){const o=e.$implicit,n=k.oxw(3);k.ekj("item-dimmed","submit"===o.code&&!n.showSubmit),k.Q6J("detail",!1),k.xp6(),k.Q6J("ngIf",null===o.completed),k.xp6(),k.Q6J("ngIf",""===o.completed),k.xp6(),k.Q6J("ngIf","info"===o.completed),k.xp6(),k.Q6J("ngIf","1"===o.completed),k.xp6(3),k.Oqu(o.title),k.xp6(),k.Q6J("ngIf",o.details),k.xp6(),k.Q6J("ngIf",o.link&&"submit"!==o.code)}}function AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_Template(o,e){if(1&o&&(k.ynx(0),k.YNc(1,AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_ion_item_1_Template,10,10,"ion-item",9),k.BQk()),2&o){const o=k.oxw(2);k.xp6(),k.Q6J("ngForOf",o.phases[o.workshop.phase].tasks)}}function AddonModWorkshopIndexComponent_ion_card_6_Template(o,e){if(1&o){const o=k.EpF();k.TgZ(0,"ion-card")(1,"ion-item",7),k.NdJ("click",(function AddonModWorkshopIndexComponent_ion_card_6_Template_ion_item_click_1_listener(){k.CHM(o);const e=k.oxw();return k.KtG(e.viewPhaseInfo())})),k.TgZ(2,"ion-label")(3,"h2",8),k._uU(4),k.qZA()()(),k.YNc(5,AddonModWorkshopIndexComponent_ion_card_6_ng_container_5_Template,2,1,"ng-container",5),k.qZA()}if(2&o){const o=k.oxw();k.xp6(),k.Q6J("detail",!0),k.xp6(3),k.Oqu(o.phases[o.workshop.phase].title),k.xp6(),k.Q6J("ngIf",o.phases&&o.phases[o.workshop.phase]&&o.phases[o.workshop.phase].tasks&&o.phases[o.workshop.phase].tasks.length)}}function AddonModWorkshopIndexComponent_ion_card_7_Template(o,e){if(1&o&&(k.TgZ(0,"ion-card")(1,"ion-item",8)(2,"ion-label")(3,"h3",15),k._uU(4),k.ALo(5,"translate"),k.qZA(),k._UZ(6,"core-format-text",24),k.qZA()()()),2&o){const o=k.oxw();k.xp6(4),k.Oqu(k.lcZ(5,6,"core.description")),k.xp6(2),k.Q6J("text",o.description)("component",o.component)("componentId",o.componentId)("contextInstanceId",o.module.id)("courseId",o.courseId)}}function AddonModWorkshopIndexComponent_div_8_ng_container_1_ion_card_1_Template(o,e){if(1&o&&(k.TgZ(0,"ion-card")(1,"ion-item",8)(2,"ion-label")(3,"h3",15),k._uU(4),k.ALo(5,"translate"),k.qZA(),k._UZ(6,"core-format-text",25),k.qZA()()()),2&o){const o=k.oxw(3);k.xp6(4),k.Oqu(k.lcZ(5,6,"addon.mod_workshop.conclusion")),k.xp6(2),k.Q6J("component",o.component)("componentId",o.module.id)("text",o.workshop.conclusion)("contextInstanceId",o.module.id)("courseId",o.courseId)}}function AddonModWorkshopIndexComponent_div_8_ng_container_1_ion_card_2_ion_item_6_Template(o,e){if(1&o&&(k.TgZ(0,"ion-item",8)(1,"ion-label")(2,"p",15),k._uU(3),k.ALo(4,"translate"),k.qZA(),k.TgZ(5,"p"),k._uU(6),k.qZA()()()),2&o){const o=k.oxw(4);k.xp6(3),k.Oqu(k.lcZ(4,2,"addon.mod_workshop.submissiongrade")),k.xp6(3),k.Oqu(o.userGrades.submissionlongstrgrade)}}function AddonModWorkshopIndexComponent_div_8_ng_container_1_ion_card_2_ion_item_7_Template(o,e){if(1&o&&(k.TgZ(0,"ion-item",8)(1,"ion-label")(2,"p",15),k._uU(3),k.ALo(4,"translate"),k.qZA(),k.TgZ(5,"p"),k._uU(6),k.qZA()()()),2&o){const o=k.oxw(4);k.xp6(3),k.Oqu(k.lcZ(4,2,"addon.mod_workshop.gradinggrade")),k.xp6(3),k.Oqu(o.userGrades.assessmentlongstrgrade)}}function AddonModWorkshopIndexComponent_div_8_ng_container_1_ion_card_2_Template(o,e){if(1&o&&(k.TgZ(0,"ion-card")(1,"ion-item-divider",8)(2,"ion-label")(3,"h3",15),k._uU(4),k.ALo(5,"translate"),k.qZA()()(),k.YNc(6,AddonModWorkshopIndexComponent_div_8_ng_container_1_ion_card_2_ion_item_6_Template,7,4,"ion-item",26)(7,AddonModWorkshopIndexComponent_div_8_ng_container_1_ion_card_2_ion_item_7_Template,7,4,"ion-item",26),k.qZA()),2&o){const o=k.oxw(3);k.xp6(4),k.Oqu(k.lcZ(5,3,"addon.mod_workshop.yourgrades")),k.xp6(2),k.Q6J("ngIf",o.userGrades.submissionlongstrgrade),k.xp6(),k.Q6J("ngIf",o.userGrades.assessmentlongstrgrade)}}function AddonModWorkshopIndexComponent_div_8_ng_container_1_Template(o,e){if(1&o&&(k.ynx(0),k.YNc(1,AddonModWorkshopIndexComponent_div_8_ng_container_1_ion_card_1_Template,7,8,"ion-card",5)(2,AddonModWorkshopIndexComponent_div_8_ng_container_1_ion_card_2_Template,8,5,"ion-card",5),k.BQk()),2&o){const o=k.oxw(2);k.xp6(),k.Q6J("ngIf",o.workshop.conclusion),k.xp6(),k.Q6J("ngIf",o.userGrades)}}function AddonModWorkshopIndexComponent_div_8_ion_card_2_Template(o,e){if(1&o&&(k.TgZ(0,"ion-card")(1,"ion-item",8)(2,"ion-label")(3,"h3",15),k._uU(4),k.ALo(5,"translate"),k.qZA(),k._UZ(6,"core-format-text",25),k.qZA()()()),2&o){const o=k.oxw(2);k.xp6(4),k.Oqu(k.lcZ(5,6,"addon.mod_workshop.areainstructauthors")),k.xp6(2),k.Q6J("component",o.component)("componentId",o.module.id)("text",o.workshop.instructauthors)("contextInstanceId",o.module.id)("courseId",o.courseId)}}function AddonModWorkshopIndexComponent_div_8_ion_card_3_h3_3_Template(o,e){1&o&&(k.TgZ(0,"h3",15),k._uU(1),k.ALo(2,"translate"),k.qZA()),2&o&&(k.xp6(),k.hij(" ",k.lcZ(2,1,"addon.mod_workshop.yoursubmission")," "))}function AddonModWorkshopIndexComponent_div_8_ion_card_3_h3_4_Template(o,e){1&o&&(k.TgZ(0,"h3",15),k._uU(1),k.ALo(2,"translate"),k.qZA()),2&o&&(k.xp6(),k.hij(" ",k.lcZ(2,1,"addon.mod_workshop.yoursubmissionwithassessments")," "))}function AddonModWorkshopIndexComponent_div_8_ion_card_3_ion_item_5_p_2_Template(o,e){1&o&&(k.TgZ(0,"p"),k._uU(1),k.ALo(2,"translate"),k.qZA()),2&o&&(k.xp6(),k.Oqu(k.lcZ(2,1,"addon.mod_workshop.noyoursubmission")))}function AddonModWorkshopIndexComponent_div_8_ion_card_3_ion_item_5_Template(o,e){if(1&o&&(k.TgZ(0,"ion-item",8)(1,"ion-label"),k.YNc(2,AddonModWorkshopIndexComponent_div_8_ion_card_3_ion_item_5_p_2_Template,3,3,"p",5),k.qZA()()),2&o){const o=k.oxw(3);k.xp6(2),k.Q6J("ngIf",!o.submission)}}function AddonModWorkshopIndexComponent_div_8_ion_card_3_addon_mod_workshop_submission_6_Template(o,e){if(1&o&&k._UZ(0,"addon-mod-workshop-submission",29),2&o){const o=k.oxw(3);k.Q6J("submission",o.submission)("courseId",o.workshop.course)("module",o.module)("workshop",o.workshop)("access",o.access)}}function AddonModWorkshopIndexComponent_div_8_ion_card_3_Template(o,e){if(1&o&&(k.TgZ(0,"ion-card")(1,"ion-item-divider",8)(2,"ion-label"),k.YNc(3,AddonModWorkshopIndexComponent_div_8_ion_card_3_h3_3_Template,3,3,"h3",27)(4,AddonModWorkshopIndexComponent_div_8_ion_card_3_h3_4_Template,3,3,"h3",27),k.qZA()(),k.YNc(5,AddonModWorkshopIndexComponent_div_8_ion_card_3_ion_item_5_Template,3,1,"ion-item",26)(6,AddonModWorkshopIndexComponent_div_8_ion_card_3_addon_mod_workshop_submission_6_Template,1,5,"addon-mod-workshop-submission",28),k.qZA()),2&o){const o=k.oxw(2);k.xp6(3),k.Q6J("ngIf",o.workshop.phase!==o.PHASE_CLOSED||!o.submission),k.xp6(),k.Q6J("ngIf",o.workshop.phase===o.PHASE_CLOSED&&o.submission),k.xp6(),k.Q6J("ngIf",!o.submission),k.xp6(),k.Q6J("ngIf",o.submission)}}function AddonModWorkshopIndexComponent_div_8_ng_container_4_ion_card_1_ng_container_6_Template(o,e){if(1&o&&(k.ynx(0),k._UZ(1,"addon-mod-workshop-submission",31),k.BQk()),2&o){const o=e.$implicit,n=k.oxw(4);k.xp6(),k.Q6J("submission",o)("courseId",n.workshop.course)("module",n.module)("workshop",n.workshop)("access",n.access)}}function AddonModWorkshopIndexComponent_div_8_ng_container_4_ion_card_1_Template(o,e){if(1&o&&(k.TgZ(0,"ion-card")(1,"ion-item-divider",8)(2,"ion-label")(3,"h3",15),k._uU(4),k.ALo(5,"translate"),k.qZA()()(),k.YNc(6,AddonModWorkshopIndexComponent_div_8_ng_container_4_ion_card_1_ng_container_6_Template,2,5,"ng-container",30),k.qZA()),2&o){const o=k.oxw(3);k.xp6(4),k.Oqu(k.lcZ(5,2,"addon.mod_workshop.publishedsubmissions")),k.xp6(2),k.Q6J("ngForOf",o.publishedSubmissions)}}function AddonModWorkshopIndexComponent_div_8_ng_container_4_Template(o,e){if(1&o&&(k.ynx(0),k.YNc(1,AddonModWorkshopIndexComponent_div_8_ng_container_4_ion_card_1_Template,7,4,"ion-card",5),k.BQk()),2&o){const o=k.oxw(2);k.xp6(),k.Q6J("ngIf",o.publishedSubmissions&&o.publishedSubmissions.length)}}function AddonModWorkshopIndexComponent_div_8_ng_container_5_ion_card_1_Template(o,e){if(1&o&&(k.TgZ(0,"ion-card")(1,"ion-item",8)(2,"ion-label")(3,"h3",15),k._uU(4),k.ALo(5,"translate"),k.qZA(),k._UZ(6,"core-format-text",25),k.qZA()()()),2&o){const o=k.oxw(3);k.xp6(4),k.Oqu(k.lcZ(5,6,"addon.mod_workshop.areainstructreviewers")),k.xp6(2),k.Q6J("component",o.component)("componentId",o.module.id)("text",o.workshop.instructreviewers)("contextInstanceId",o.module.id)("courseId",o.courseId)}}function AddonModWorkshopIndexComponent_div_8_ng_container_5_ion_card_2_ion_item_6_Template(o,e){1&o&&(k.TgZ(0,"ion-item",8)(1,"ion-label")(2,"p"),k._uU(3),k.ALo(4,"translate"),k.qZA()()()),2&o&&(k.xp6(3),k.Oqu(k.lcZ(4,1,"addon.mod_workshop.assignedassessmentsnone")))}function AddonModWorkshopIndexComponent_div_8_ng_container_5_ion_card_2_ng_container_7_Template(o,e){if(1&o&&(k.ynx(0),k._UZ(1,"addon-mod-workshop-submission",32),k.BQk()),2&o){const o=e.$implicit,n=k.oxw(4);k.xp6(),k.Q6J("submission",o.submission)("assessment",o)("courseId",n.workshop.course)("module",n.module)("workshop",n.workshop)("access",n.access)}}const _c0=()=>[];function AddonModWorkshopIndexComponent_div_8_ng_container_5_ion_card_2_Template(o,e){if(1&o&&(k.TgZ(0,"ion-card")(1,"ion-item-divider",8)(2,"ion-label")(3,"h3",15),k._uU(4),k.ALo(5,"translate"),k.qZA()()(),k.YNc(6,AddonModWorkshopIndexComponent_div_8_ng_container_5_ion_card_2_ion_item_6_Template,5,3,"ion-item",26)(7,AddonModWorkshopIndexComponent_div_8_ng_container_5_ion_card_2_ng_container_7_Template,2,6,"ng-container",30),k.qZA()),2&o){const o=k.oxw(3);k.xp6(4),k.Oqu(k.lcZ(5,3,"addon.mod_workshop.assignedassessments")),k.xp6(2),k.Q6J("ngIf",!o.assessments||!o.assessments.length),k.xp6(),k.Q6J("ngForOf",o.assessments||k.DdM(5,_c0))}}function AddonModWorkshopIndexComponent_div_8_ng_container_5_Template(o,e){if(1&o&&(k.ynx(0),k.YNc(1,AddonModWorkshopIndexComponent_div_8_ng_container_5_ion_card_1_Template,7,8,"ion-card",5)(2,AddonModWorkshopIndexComponent_div_8_ng_container_5_ion_card_2_Template,8,6,"ion-card",5),k.BQk()),2&o){const o=k.oxw(2);k.xp6(),k.Q6J("ngIf",o.workshop.phase===o.PHASE_ASSESSMENT&&o.workshop.instructreviewers),k.xp6(),k.Q6J("ngIf",o.canAssess)}}function AddonModWorkshopIndexComponent_div_8_ion_card_6_h3_3_Template(o,e){1&o&&(k.TgZ(0,"h3",15),k._uU(1),k.ALo(2,"translate"),k.qZA()),2&o&&(k.xp6(),k.Oqu(k.lcZ(2,1,"addon.mod_workshop.submissionsreport")))}function AddonModWorkshopIndexComponent_div_8_ion_card_6_h3_4_Template(o,e){1&o&&(k.TgZ(0,"h3",15),k._uU(1),k.ALo(2,"translate"),k.qZA()),2&o&&(k.xp6(),k.hij("",k.lcZ(2,1,"addon.mod_workshop.gradesreport")," "))}function AddonModWorkshopIndexComponent_div_8_ion_card_6_ng_container_6_Template(o,e){if(1&o&&(k.ynx(0),k._UZ(1,"addon-mod-workshop-submission",31),k.BQk()),2&o){const o=e.$implicit,n=k.oxw(3);k.xp6(),k.Q6J("submission",o)("courseId",n.workshop.course)("module",n.module)("workshop",n.workshop)("access",n.access)}}function AddonModWorkshopIndexComponent_div_8_ion_card_6_ion_grid_7_ion_col_2_Template(o,e){if(1&o){const o=k.EpF();k.TgZ(0,"ion-col")(1,"ion-button",35),k.NdJ("click",(function AddonModWorkshopIndexComponent_div_8_ion_card_6_ion_grid_7_ion_col_2_Template_ion_button_click_1_listener(){k.CHM(o);const e=k.oxw(4);return k.KtG(e.gotoSubmissionsPage(e.page-1))})),k._UZ(2,"ion-icon",36),k._uU(3),k.ALo(4,"translate"),k.qZA()()}2&o&&(k.xp6(3),k.hij(" ",k.lcZ(4,1,"core.previous")," "))}function AddonModWorkshopIndexComponent_div_8_ion_card_6_ion_grid_7_ion_col_3_Template(o,e){if(1&o){const o=k.EpF();k.TgZ(0,"ion-col")(1,"ion-button",37),k.NdJ("click",(function AddonModWorkshopIndexComponent_div_8_ion_card_6_ion_grid_7_ion_col_3_Template_ion_button_click_1_listener(){k.CHM(o);const e=k.oxw(4);return k.KtG(e.gotoSubmissionsPage(e.page+1))})),k._uU(2),k.ALo(3,"translate"),k._UZ(4,"ion-icon",38),k.qZA()()}2&o&&(k.xp6(2),k.hij(" ",k.lcZ(3,1,"core.next")," "))}function AddonModWorkshopIndexComponent_div_8_ion_card_6_ion_grid_7_Template(o,e){if(1&o&&(k.TgZ(0,"ion-grid")(1,"ion-row",34),k.YNc(2,AddonModWorkshopIndexComponent_div_8_ion_card_6_ion_grid_7_ion_col_2_Template,5,3,"ion-col",5)(3,AddonModWorkshopIndexComponent_div_8_ion_card_6_ion_grid_7_ion_col_3_Template,5,3,"ion-col",5),k.qZA()()),2&o){const o=k.oxw(3);k.xp6(2),k.Q6J("ngIf",o.page>0),k.xp6(),k.Q6J("ngIf",o.hasNextPage)}}function AddonModWorkshopIndexComponent_div_8_ion_card_6_Template(o,e){if(1&o){const o=k.EpF();k.TgZ(0,"ion-card")(1,"ion-item-divider",8)(2,"ion-label"),k.YNc(3,AddonModWorkshopIndexComponent_div_8_ion_card_6_h3_3_Template,3,3,"h3",27)(4,AddonModWorkshopIndexComponent_div_8_ion_card_6_h3_4_Template,3,3,"h3",27),k.qZA()(),k.TgZ(5,"core-group-selector",33),k.NdJ("selectedChange",(function AddonModWorkshopIndexComponent_div_8_ion_card_6_Template_core_group_selector_selectedChange_5_listener(e){k.CHM(o);const n=k.oxw(2);return k.KtG(n.group=e)}))("selectedChange",(function AddonModWorkshopIndexComponent_div_8_ion_card_6_Template_core_group_selector_selectedChange_5_listener(){k.CHM(o);const e=k.oxw(2);return k.KtG(e.setGroup(e.group))})),k.qZA(),k.YNc(6,AddonModWorkshopIndexComponent_div_8_ion_card_6_ng_container_6_Template,2,5,"ng-container",30)(7,AddonModWorkshopIndexComponent_div_8_ion_card_6_ion_grid_7_Template,4,2,"ion-grid",5),k.qZA()}if(2&o){const o=k.oxw(2);k.xp6(3),k.Q6J("ngIf",o.workshop.phase===o.PHASE_SUBMISSION),k.xp6(),k.Q6J("ngIf",o.workshop.phase>o.PHASE_SUBMISSION),k.xp6(),k.Q6J("groupInfo",o.groupInfo)("selected",o.group)("courseId",o.courseId),k.xp6(),k.Q6J("ngForOf",o.grades),k.xp6(),k.Q6J("ngIf",o.page>0||o.hasNextPage)}}function AddonModWorkshopIndexComponent_div_8_Template(o,e){if(1&o&&(k.TgZ(0,"div"),k.YNc(1,AddonModWorkshopIndexComponent_div_8_ng_container_1_Template,3,2,"ng-container",5)(2,AddonModWorkshopIndexComponent_div_8_ion_card_2_Template,7,8,"ion-card",5)(3,AddonModWorkshopIndexComponent_div_8_ion_card_3_Template,7,4,"ion-card",5)(4,AddonModWorkshopIndexComponent_div_8_ng_container_4_Template,2,1,"ng-container",5)(5,AddonModWorkshopIndexComponent_div_8_ng_container_5_Template,3,2,"ng-container",5)(6,AddonModWorkshopIndexComponent_div_8_ion_card_6_Template,8,7,"ion-card",5),k.qZA()),2&o){const o=k.oxw();k.xp6(),k.Q6J("ngIf",o.workshop.phase>=o.PHASE_CLOSED),k.xp6(),k.Q6J("ngIf",o.workshop.phase===o.PHASE_SUBMISSION&&o.workshop.instructauthors),k.xp6(),k.Q6J("ngIf",o.canSubmit),k.xp6(),k.Q6J("ngIf",o.workshop.phase>=o.PHASE_CLOSED),k.xp6(),k.Q6J("ngIf",o.workshop.phase>=o.PHASE_ASSESSMENT),k.xp6(),k.Q6J("ngIf",o.access.canviewallsubmissions&&o.workshop.phase>=o.PHASE_SUBMISSION&&(o.grades&&o.grades.length||o.groupInfo&&(o.groupInfo.separateGroups||o.groupInfo.visibleGroups)))}}function AddonModWorkshopIndexComponent_div_9_div_1_ion_button_1_Template(o,e){if(1&o){const o=k.EpF();k.TgZ(0,"ion-button",44),k.NdJ("click",(function AddonModWorkshopIndexComponent_div_9_div_1_ion_button_1_Template_ion_button_click_0_listener(){k.CHM(o);const e=k.oxw(3);return k.KtG(e.gotoSubmit())})),k._UZ(1,"ion-icon",45),k._uU(2),k.ALo(3,"translate"),k.qZA()}2&o&&(k.xp6(2),k.hij(" ",k.lcZ(3,1,"addon.mod_workshop.createsubmission")," "))}function AddonModWorkshopIndexComponent_div_9_div_1_ion_button_2_Template(o,e){if(1&o){const o=k.EpF();k.TgZ(0,"ion-button",44),k.NdJ("click",(function AddonModWorkshopIndexComponent_div_9_div_1_ion_button_2_Template_ion_button_click_0_listener(){k.CHM(o);const e=k.oxw(3);return k.KtG(e.gotoSubmit())})),k._UZ(1,"ion-icon",46),k._uU(2),k.ALo(3,"translate"),k.qZA()}2&o&&(k.xp6(2),k.hij(" ",k.lcZ(3,1,"addon.mod_workshop.editsubmission")," "))}function AddonModWorkshopIndexComponent_div_9_div_1_Template(o,e){if(1&o&&(k.TgZ(0,"div",42),k.YNc(1,AddonModWorkshopIndexComponent_div_9_div_1_ion_button_1_Template,4,3,"ion-button",43)(2,AddonModWorkshopIndexComponent_div_9_div_1_ion_button_2_Template,4,3,"ion-button",43),k.qZA()),2&o){const o=k.oxw(2);k.xp6(),k.Q6J("ngIf",o.access.creatingsubmissionallowed&&!o.submission),k.xp6(),k.Q6J("ngIf",o.access.modifyingsubmissionallowed&&o.submission)}}function AddonModWorkshopIndexComponent_div_9_Template(o,e){if(1&o&&(k.TgZ(0,"div",39),k.YNc(1,AddonModWorkshopIndexComponent_div_9_div_1_Template,3,2,"div",40),k._UZ(2,"core-course-module-navigation",41),k.qZA()),2&o){const o=k.oxw();k.xp6(),k.Q6J("ngIf",o.access&&(null==o.workshop?null:o.workshop.phase)>=o.PHASE_SUBMISSION&&o.canSubmit&&o.showSubmit&&(o.access.creatingsubmissionallowed&&!o.submission||o.access.modifyingsubmissionallowed&&o.submission)),k.xp6(),k.Q6J("courseId",o.courseId)("currentModuleId",o.module.id)}}let Q=(()=>{var o;class AddonModWorkshopIndexComponent extends t.L{constructor(o,e){super("AddonModWorkshopIndexComponent",o,e),this.group=0,this.component=g.qR,this.pluginName="workshop",this.page=0,this.grades=[],this.assessments=[],this.publishedSubmissions=[],this.groupInfo={groups:[],separateGroups:!1,visibleGroups:!1,defaultGroupId:0,canAccessAllGroups:!1},this.canSubmit=!1,this.showSubmit=!1,this.canAssess=!1,this.hasNextPage=!1,this.PHASE_SETUP=p.AddonModWorkshopPhase.PHASE_SETUP,this.PHASE_SUBMISSION=p.AddonModWorkshopPhase.PHASE_SUBMISSION,this.PHASE_ASSESSMENT=p.AddonModWorkshopPhase.PHASE_ASSESSMENT,this.PHASE_EVALUATION=p.AddonModWorkshopPhase.PHASE_EVALUATION,this.PHASE_CLOSED=p.AddonModWorkshopPhase.PHASE_CLOSED,this.offlineSubmissions=[],this.syncEventName=h.AddonModWorkshopSyncProvider.AUTO_SYNCED,this.obsSubmissionChanged=l.R.on(p.AddonModWorkshopProvider.SUBMISSION_CHANGED,(o=>{this.eventReceived(o)}),this.siteId),this.obsAssessmentSaved=l.R.on(p.AddonModWorkshopProvider.ASSESSMENT_SAVED,(o=>{this.eventReceived(o)}),this.siteId),this.appResumeSubscription=r.n.resume.subscribe((()=>{this.showLoadingAndRefresh(!0)})),this.syncObserver=l.R.on(h.AddonModWorkshopSyncProvider.AUTO_SYNCED,(o=>{this.eventReceived(o)}),this.siteId)}ngOnInit(){var _superprop_getNgOnInit=()=>super.ngOnInit,o=this;return(0,s.Z)((function*(){_superprop_getNgOnInit().call(o),yield o.loadContent(!1,!0)}))()}eventReceived(o){var e;(null===(e=this.workshop)||void 0===e?void 0:e.id)===o.workshopId&&(this.showLoadingAndRefresh(!0),this.checkCompletion())}invalidateContent(){var o=this;return(0,s.Z)((function*(){const e=[];var n;(e.push(p.AddonModWorkshop.invalidateWorkshopData(o.courseId)),o.workshop)&&(e.push(p.AddonModWorkshop.invalidateWorkshopAccessInformationData(o.workshop.id)),e.push(p.AddonModWorkshop.invalidateUserPlanPhasesData(o.workshop.id)),o.canSubmit&&e.push(p.AddonModWorkshop.invalidateSubmissionsData(o.workshop.id)),null!==(n=o.access)&&void 0!==n&&n.canviewallsubmissions&&(e.push(p.AddonModWorkshop.invalidateGradeReportData(o.workshop.id)),e.push(d.t.invalidateActivityAllowedGroups(o.workshop.coursemodule)),e.push(d.t.invalidateActivityGroupMode(o.workshop.coursemodule))),o.canAssess&&e.push(p.AddonModWorkshop.invalidateReviewerAssesmentsData(o.workshop.id)),e.push(p.AddonModWorkshop.invalidateGradesData(o.workshop.id)),e.push(p.AddonModWorkshop.invalidateWorkshopWSData(o.workshop.id)));yield Promise.all(e)}))()}isRefreshSyncNeeded(o){var e;return!(!this.workshop||o.workshopId!=this.workshop.id)&&(null===(e=this.content)||void 0===e||e.scrollToTop(),!0)}fetchContent(o,e=!1,n=!1){var i=this;return(0,s.Z)((function*(){i.workshop=yield p.AddonModWorkshop.getWorkshop(i.courseId,i.module.id),i.description=i.workshop.intro,i.dataRetrieved.emit(i.workshop),e&&(yield i.syncActivity(n)),i.access=yield p.AddonModWorkshop.getWorkshopAccessInformation(i.workshop.id,{cmId:i.module.id}),i.access.canviewallsubmissions&&(i.groupInfo=yield d.t.getActivityGroupInfo(i.workshop.coursemodule),i.group=d.t.validateGroupId(i.group,i.groupInfo)),i.phases=yield p.AddonModWorkshop.getUserPlanPhases(i.workshop.id,{cmId:i.module.id}),i.phases[i.workshop.phase].tasks.forEach((o=>{o.link||"examples"!=o.code&&"prepareexamples"!=o.code||(o.link=i.module.url||"")})),i.hasOffline=yield u.AddonModWorkshopOffline.hasWorkshopOfflineData(i.workshop.id),i.offlineSubmissions=i.hasOffline?yield u.AddonModWorkshopOffline.getSubmissions(i.workshop.id):[],yield i.setPhaseInfo()}))()}logActivity(){var o=this;return(0,s.Z)((function*(){o.workshop&&(yield c.Tr.ignoreErrors(p.AddonModWorkshop.logView(o.workshop.id)),o.analyticsLogEvent("mod_workshop_view_workshop"))}))()}gotoSubmissionsPage(o){var e=this;return(0,s.Z)((function*(){if(!e.workshop)return;const n=e.workshop,i=yield p.AddonModWorkshop.getGradesReport(n.id,{groupId:e.group,page:o,cmId:e.module.id}),t=i&&i.grades&&i.grades.length||0;e.page=o,e.hasNextPage=t>=p.AddonModWorkshopProvider.PER_PAGE&&(e.page+1)*p.AddonModWorkshopProvider.PER_PAGE<i.totalcount;const d=i.grades||[];e.grades=[],yield Promise.all(d.map(function(){var o=(0,s.Z)((function*(o){const s={id:o.submissionid||0,workshopid:n.id,example:!1,authorid:o.userid,timecreated:o.submissionmodified||0,timemodified:o.submissionmodified||0,title:o.submissiontitle||"",content:"",contenttrust:0,attachment:0,grade:o.submissiongrade,gradeover:o.submissiongradeover,gradeoverby:o.submissiongradeoverby,published:!!o.submissionpublished,gradinggrade:o.gradinggrade,late:0,reviewedby:e.parseReviewer(o.reviewedby),reviewerof:e.parseReviewer(o.reviewerof)};var i,t,d,a;n.phase==p.AddonModWorkshopPhase.PHASE_ASSESSMENT&&(s.reviewedbydone=(null===(i=o.reviewedby)||void 0===i?void 0:i.reduce(((o,e)=>o+(e.grade?1:0)),0))||0,s.reviewerofdone=(null===(t=o.reviewerof)||void 0===t?void 0:t.reduce(((o,e)=>o+(e.grade?1:0)),0))||0,s.reviewedbycount=(null===(d=o.reviewedby)||void 0===d?void 0:d.length)||0,s.reviewerofcount=(null===(a=o.reviewerof)||void 0===a?void 0:a.length)||0);const r=yield m.AddonModWorkshopHelper.applyOfflineData(s,e.offlineSubmissions);void 0!==r&&e.grades.push(r)}));return function(e){return o.apply(this,arguments)}}()))}))()}parseReviewer(o=[]){return o.map((o=>({grade:o.grade,gradinggrade:o.gradinggrade,gradinggradeover:o.gradinggradeover,id:o.assessmentid,reviewerid:o.userid,submissionid:o.submissionid,weight:o.weight,timecreated:0,timemodified:0,feedbackauthor:"",gradinggradeoverby:0,feedbackattachmentfiles:[],feedbackcontentfiles:[],feedbackauthorattachment:0})))}runTask(o){var e=this;return(0,s.Z)((function*(){"submit"==o.code?e.gotoSubmit():o.link&&c.Tr.openInBrowser(o.link)}))()}gotoSubmit(){if(this.canSubmit&&this.access&&(this.access.creatingsubmissionallowed&&!this.submission||this.access.modifyingsubmissionallowed&&this.submission)){var o;const e=(null===(o=this.submission)||void 0===o?void 0:o.id)||0;a.b.navigateToSitePath(`${g.IM}/${this.courseId}/${this.module.id}/${e}/edit`,{params:{module:this.module,access:this.access}})}}viewPhaseInfo(){var o=this;return(0,s.Z)((function*(){if(!o.phases||!o.workshop)return;!0===(yield _.OQ.openModal({component:f.C,componentProps:{phases:c.Tr.objectToArray(o.phases),workshopPhase:o.workshop.phase,externalUrl:o.module.url,showSubmit:o.showSubmit}}))&&o.gotoSubmit()}))()}setGroup(o){var e=this;return(0,s.Z)((function*(){e.group=o,yield e.gotoSubmissionsPage(0)}))()}setPhaseInfo(){var o=this;return(0,s.Z)((function*(){if(!o.phases||!o.workshop||!o.access)return;o.submission=void 0,o.canAssess=!1,o.assessments=[],o.userGrades=void 0,o.publishedSubmissions=[];const e=o.workshop;o.canSubmit=m.AddonModWorkshopHelper.canSubmit(o.workshop,o.access,o.phases[p.AddonModWorkshopPhase.PHASE_SUBMISSION].tasks),o.showSubmit=o.canSubmit&&(o.access.creatingsubmissionallowed&&!o.submission||o.access.modifyingsubmissionallowed&&!!o.submission);const n=[];o.canSubmit&&n.push(m.AddonModWorkshopHelper.getUserSubmission(o.workshop.id,{cmId:o.module.id}).then(function(){var e=(0,s.Z)((function*(e){o.submission=yield m.AddonModWorkshopHelper.applyOfflineData(e,o.offlineSubmissions)}));return function(o){return e.apply(this,arguments)}}())),o.access.canviewallsubmissions&&o.workshop.phase>=p.AddonModWorkshopPhase.PHASE_SUBMISSION&&n.push(o.gotoSubmissionsPage(o.page));let i=Promise.resolve();o.workshop.phase>=p.AddonModWorkshopPhase.PHASE_ASSESSMENT&&(o.canAssess=m.AddonModWorkshopHelper.canAssess(o.workshop,o.access),o.canAssess&&(i=m.AddonModWorkshopHelper.getReviewerAssessments(o.workshop.id,{cmId:o.module.id}).then(function(){var n=(0,s.Z)((function*(n){yield Promise.all(n.map(function(){var n=(0,s.Z)((function*(n){if(n.strategy=e.strategy,o.hasOffline)try{const o=yield u.AddonModWorkshopOffline.getAssessment(e.id,n.id);n.offline=!0,n.timemodified=Math.floor(o.timemodified/1e3)}catch{}}));return function(o){return n.apply(this,arguments)}}())),o.assessments=n}));return function(o){return n.apply(this,arguments)}}()))),o.workshop.phase===p.AddonModWorkshopPhase.PHASE_CLOSED&&(n.push(p.AddonModWorkshop.getGrades(o.workshop.id,{cmId:o.module.id}).then((e=>{o.userGrades=e.submissionlongstrgrade||e.assessmentlongstrgrade?e:void 0}))),o.access.canviewpublishedsubmissions&&n.push(i.then((0,s.Z)((function*(){const n=yield p.AddonModWorkshop.getSubmissions(e.id,{cmId:o.module.id});o.publishedSubmissions=n.filter((n=>!!n.published&&(n.reviewedby=o.assessments.filter((o=>o.submissionid===n.id)).map((o=>m.AddonModWorkshopHelper.realGradeValue(e,o))),!0)))}))))),yield Promise.all(n)}))()}sync(){if(!this.workshop)throw new i.G("Cannot sync without a workshop.");return h.AddonModWorkshopSync.syncWorkshop(this.workshop.id)}ngOnDestroy(){var o,e,n;super.ngOnDestroy(),null===(o=this.obsSubmissionChanged)||void 0===o||o.off(),null===(e=this.obsAssessmentSaved)||void 0===e||e.off(),null===(n=this.appResumeSubscription)||void 0===n||n.unsubscribe()}}return(o=AddonModWorkshopIndexComponent).ɵfac=function AddonModWorkshopIndexComponent_Factory(e){return new(e||o)(k.Y36(b.W2,8),k.Y36(A.e,8))},o.ɵcmp=k.Xpm({type:o,selectors:[["addon-mod-workshop-index"]],inputs:{group:"group"},features:[k.qOj],decls:10,vars:13,consts:[["slot","end"],["fill","clear","aria-haspopup","true",3,"click"],["name","fas-circle-info","slot","icon-only","aria-hidden","true"],[3,"hideUntil"],[3,"module","component","componentId","courseId","hasDataToSync","completionChanged"],[4,"ngIf"],["collapsible-footer","","slot","fixed",4,"ngIf"],["button","",3,"detail","click"],[1,"ion-text-wrap"],["button","","class","ion-text-wrap",3,"item-dimmed","detail","click",4,"ngFor","ngForOf"],["button","",1,"ion-text-wrap",3,"detail","click"],["slot","start","name","far-circle",4,"ngIf"],["slot","start","name","fas-circle-xmark","color","danger",4,"ngIf"],["slot","start","name","fas-circle-info","color","info",4,"ngIf"],["slot","start","name","fas-circle-check","color","success",4,"ngIf"],[1,"item-heading"],[3,"innerHTML",4,"ngIf"],["slot","end","name","fas-up-right-from-square","aria-hidden","true",4,"ngIf"],["slot","start","name","far-circle"],["slot","start","name","fas-circle-xmark","color","danger"],["slot","start","name","fas-circle-info","color","info"],["slot","start","name","fas-circle-check","color","success"],[3,"innerHTML"],["slot","end","name","fas-up-right-from-square","aria-hidden","true"],["contextLevel","module",3,"text","component","componentId","contextInstanceId","courseId"],["collapsible-item","","contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],["class","ion-text-wrap",4,"ngIf"],["class","item-heading",4,"ngIf"],[3,"submission","courseId","module","workshop","access",4,"ngIf"],[3,"submission","courseId","module","workshop","access"],[4,"ngFor","ngForOf"],["summary","true",1,"core-as-item",3,"submission","courseId","module","workshop","access"],["summary","true",1,"core-as-item",3,"submission","assessment","courseId","module","workshop","access"],[3,"groupInfo","selected","courseId","selectedChange"],[1,"ion-align-items-center"],["expand","block","fill","outline",3,"click"],["name","fas-chevron-left","slot","start","aria-hidden","true"],["expand","block",3,"click"],["name","fas-chevron-right","slot","end","aria-hidden","true"],["collapsible-footer","","slot","fixed"],["class","list-item-limited-width",4,"ngIf"],[3,"courseId","currentModuleId"],[1,"list-item-limited-width"],["expand","block","class","ion-text-wrap ion-margin",3,"click",4,"ngIf"],["expand","block",1,"ion-text-wrap","ion-margin",3,"click"],["slot","start","name","fas-plus","aria-hidden","true"],["slot","start","name","fas-pen","aria-hidden","true"]],template:function AddonModWorkshopIndexComponent_Template(o,e){1&o&&(k.TgZ(0,"core-navbar-buttons",0)(1,"ion-button",1),k.NdJ("click",(function AddonModWorkshopIndexComponent_Template_ion_button_click_1_listener(){return e.openModuleSummary()})),k.ALo(2,"translate"),k._UZ(3,"ion-icon",2),k.qZA()(),k.TgZ(4,"core-loading",3)(5,"core-course-module-info",4),k.NdJ("completionChanged",(function AddonModWorkshopIndexComponent_Template_core_course_module_info_completionChanged_5_listener(){return e.onCompletionChange()})),k.qZA(),k.YNc(6,AddonModWorkshopIndexComponent_ion_card_6_Template,6,3,"ion-card",5)(7,AddonModWorkshopIndexComponent_ion_card_7_Template,7,8,"ion-card",5)(8,AddonModWorkshopIndexComponent_div_8_Template,7,6,"div",5)(9,AddonModWorkshopIndexComponent_div_9_Template,3,3,"div",6),k.qZA()),2&o&&(k.xp6(),k.uIk("aria-label",k.lcZ(2,11,"core.info")),k.xp6(3),k.Q6J("hideUntil",!e.showLoading),k.xp6(),k.Q6J("module",e.module)("component",e.component)("componentId",e.componentId)("courseId",e.courseId)("hasDataToSync",e.hasOffline),k.xp6(),k.Q6J("ngIf",e.phases&&e.workshop),k.xp6(),k.Q6J("ngIf",e.description&&e.workshop&&e.workshop.phase===e.PHASE_SETUP),k.xp6(),k.Q6J("ngIf",e.access&&e.workshop&&e.workshop.phase>=e.PHASE_SUBMISSION),k.xp6(),k.Q6J("ngIf",!e.showLoading))},dependencies:[I.sg,I.O5,x.Q,w.r,v.J,M.I,T.r,S._,Z.u,W.O,b.YG,b.PM,b.wI,b.jY,b.gu,b.Ie,b.rH,b.Q$,b.Nd,C.v,y.Y,P.W,q.X$],encapsulation:2}),AddonModWorkshopIndexComponent})()},52707:(o,e,n)=>{n.d(e,{C:()=>m});var s=n(49671),i=n(75803),t=n(10727),d=n(19212),a=n(96814),r=n(86700),_=n(29657),c=n(22068),l=n(31903),p=n(89515);function AddonModWorkshopPhaseInfoComponent_ng_container_12_p_5_Template(o,e){1&o&&(d.TgZ(0,"p",7),d._uU(1),d.ALo(2,"translate"),d.qZA()),2&o&&(d.xp6(),d.hij(" ",d.lcZ(2,1,"addon.mod_workshop.userplancurrentphase")," "))}function AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_6_Template(o,e){if(1&o&&(d.TgZ(0,"ion-item",8),d._UZ(1,"ion-icon",9),d.TgZ(2,"ion-label")(3,"p"),d._uU(4),d.ALo(5,"translate"),d.qZA()(),d._UZ(6,"ion-icon",10),d.qZA()),2&o){const o=d.oxw().$implicit;d.Q6J("href",o.switchUrl)("detail",!1),d.xp6(4),d.Oqu(d.lcZ(5,3,"addon.mod_workshop.switchphase"+o.code))}}function AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_ion_icon_1_Template(o,e){1&o&&(d._UZ(0,"ion-icon",19),d.ALo(1,"translate")),2&o&&d.uIk("aria-label",d.lcZ(1,1,"addon.mod_workshop.tasktodo"))}function AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_ion_icon_2_Template(o,e){1&o&&(d._UZ(0,"ion-icon",20),d.ALo(1,"translate")),2&o&&d.uIk("aria-label",d.lcZ(1,1,"addon.mod_workshop.taskfail"))}function AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_ion_icon_3_Template(o,e){1&o&&(d._UZ(0,"ion-icon",21),d.ALo(1,"translate")),2&o&&d.uIk("aria-label",d.lcZ(1,1,"addon.mod_workshop.taskinfo"))}function AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_ion_icon_4_Template(o,e){1&o&&(d._UZ(0,"ion-icon",22),d.ALo(1,"translate")),2&o&&d.uIk("aria-label",d.lcZ(1,1,"addon.mod_workshop.taskdone"))}function AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_p_8_Template(o,e){if(1&o&&d._UZ(0,"p",23),2&o){const o=d.oxw().$implicit;d.Q6J("innerHTML",o.details,d.oJD)}}function AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_ion_icon_9_Template(o,e){1&o&&d._UZ(0,"ion-icon",10)}function AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_Template(o,e){if(1&o){const o=d.EpF();d.TgZ(0,"ion-item",11),d.NdJ("click",(function AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_Template_ion_item_click_0_listener(){const e=d.CHM(o).$implicit,n=d.oxw(2);return d.KtG(n.runTask(e))})),d.YNc(1,AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_ion_icon_1_Template,2,3,"ion-icon",12)(2,AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_ion_icon_2_Template,2,3,"ion-icon",13)(3,AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_ion_icon_3_Template,2,3,"ion-icon",14)(4,AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_ion_icon_4_Template,2,3,"ion-icon",15),d.TgZ(5,"ion-label")(6,"p",16),d._uU(7),d.qZA(),d.YNc(8,AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_p_8_Template,1,1,"p",17),d.qZA(),d.YNc(9,AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_ion_icon_9_Template,1,0,"ion-icon",18),d.qZA()}if(2&o){const o=e.$implicit,n=d.oxw().$implicit,s=d.oxw();d.ekj("item-dimmed",n.code!==s.workshopPhase||"submit"===o.code&&!s.showSubmit),d.Q6J("detail",!1),d.xp6(),d.Q6J("ngIf",null===o.completed),d.xp6(),d.Q6J("ngIf",""===o.completed),d.xp6(),d.Q6J("ngIf","info"===o.completed),d.xp6(),d.Q6J("ngIf","1"===o.completed),d.xp6(3),d.Oqu(o.title),d.xp6(),d.Q6J("ngIf",o.details),d.xp6(),d.Q6J("ngIf",o.link&&"submit"!==o.code)}}function AddonModWorkshopPhaseInfoComponent_ng_container_12_Template(o,e){if(1&o&&(d.ynx(0),d.TgZ(1,"ion-item-divider")(2,"ion-label")(3,"h2"),d._uU(4),d.qZA(),d.YNc(5,AddonModWorkshopPhaseInfoComponent_ng_container_12_p_5_Template,3,3,"p",4),d.qZA()(),d.YNc(6,AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_6_Template,7,5,"ion-item",5)(7,AddonModWorkshopPhaseInfoComponent_ng_container_12_ion_item_7_Template,10,10,"ion-item",6),d.BQk()),2&o){const o=e.$implicit,n=d.oxw();d.xp6(),d.uIk("aria-current",n.workshopPhase===o.code?"page":"false"),d.xp6(3),d.Oqu(o.title),d.xp6(),d.Q6J("ngIf",n.workshopPhase===o.code),d.xp6(),d.Q6J("ngIf",o.switchUrl),d.xp6(),d.Q6J("ngForOf",o.tasks)}}let m=(()=>{var o;class AddonModWorkshopPhaseInfoComponent{constructor(){this.showSubmit=!1}ngOnInit(){for(const o in this.phases){this.phases[o].tasks.forEach((o=>{o.link||"examples"!=o.code&&"prepareexamples"!=o.code||(o.link=this.externalUrl)}));const e=this.phases[o].actions.find((o=>o.url&&"switchphase"==o.type));this.phases[o].switchUrl=e?e.url:""}}closeModal(){t.IN.dismiss()}runTask(o){return(0,s.Z)((function*(){"submit"==o.code?t.IN.dismiss(!0):o.link&&i.Tr.openInBrowser(o.link)}))()}}return(o=AddonModWorkshopPhaseInfoComponent).ɵfac=function AddonModWorkshopPhaseInfoComponent_Factory(e){return new(e||o)},o.ɵcmp=d.Xpm({type:o,selectors:[["ng-component"]],inputs:{phases:"phases",workshopPhase:"workshopPhase",showSubmit:"showSubmit",externalUrl:"externalUrl"},decls:13,vars:7,consts:[["slot","end"],["fill","clear",3,"click"],["name","fas-xmark","slot","icon-only","aria-hidden","true"],[4,"ngFor","ngForOf"],["class","ion-text-wrap",4,"ngIf"],["class","ion-text-wrap",3,"href","detail",4,"ngIf"],["class","ion-text-wrap","button","",3,"item-dimmed","detail","click",4,"ngFor","ngForOf"],[1,"ion-text-wrap"],[1,"ion-text-wrap",3,"href","detail"],["slot","start","name","fas-right-left","aria-hidden","true"],["slot","end","name","fas-up-right-from-square","aria-hidden","true"],["button","",1,"ion-text-wrap",3,"detail","click"],["slot","start","name","far-circle",4,"ngIf"],["slot","start","name","fas-circle-xmark","color","danger",4,"ngIf"],["slot","start","name","fas-circle-info","color","info",4,"ngIf"],["slot","start","name","fas-circle-check","color","success",4,"ngIf"],[1,"item-heading","ion-text-wrap"],[3,"innerHTML",4,"ngIf"],["slot","end","name","fas-up-right-from-square","aria-hidden","true",4,"ngIf"],["slot","start","name","far-circle"],["slot","start","name","fas-circle-xmark","color","danger"],["slot","start","name","fas-circle-info","color","info"],["slot","start","name","fas-circle-check","color","success"],[3,"innerHTML"]],template:function AddonModWorkshopPhaseInfoComponent_Template(o,e){1&o&&(d.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title")(3,"h1"),d._uU(4),d.ALo(5,"translate"),d.qZA()(),d.TgZ(6,"ion-buttons",0)(7,"ion-button",1),d.NdJ("click",(function AddonModWorkshopPhaseInfoComponent_Template_ion_button_click_7_listener(){return e.closeModal()})),d.ALo(8,"translate"),d._UZ(9,"ion-icon",2),d.qZA()()()(),d.TgZ(10,"ion-content")(11,"ion-list"),d.YNc(12,AddonModWorkshopPhaseInfoComponent_ng_container_12_Template,8,5,"ng-container",3),d.qZA()()),2&o&&(d.xp6(4),d.Oqu(d.lcZ(5,3,"addon.mod_workshop.userplan")),d.xp6(3),d.uIk("aria-label",d.lcZ(8,5,"core.close")),d.xp6(5),d.Q6J("ngForOf",e.phases))},dependencies:[a.sg,a.O5,r.I,_.t,c.O,l.YG,l.Sm,l.W2,l.Gu,l.gu,l.Ie,l.rH,l.Q$,l.q_,l.wd,l.sr,p.X$],encapsulation:2}),AddonModWorkshopPhaseInfoComponent})()},78025:(o,e,n)=>{n.d(e,{W:()=>x});var s=n(45151),i=n(43555),t=n(53564),d=n(58346),a=n(78452),r=n(11850),_=n(63294),c=n(1248),l=n(19212),p=n(96814),m=n(64009),u=n(66931),h=n(80070),f=n(86700),g=n(8947),k=n(22068),b=n(31903),A=n(5385),I=n(89515);function AddonModWorkshopSubmissionComponent_div_1_h2_4_Template(o,e){if(1&o&&(l.TgZ(0,"h2"),l._UZ(1,"core-format-text",10),l.qZA()),2&o){const o=l.oxw(2);l.xp6(),l.Q6J("text",o.submission.title)("contextInstanceId",o.module.id)("courseId",o.courseId)}}function AddonModWorkshopSubmissionComponent_div_1_p_5_Template(o,e){if(1&o&&(l.TgZ(0,"p"),l._uU(1),l.qZA()),2&o){const o=l.oxw(2);l.xp6(),l.Oqu(o.profile.fullname)}}const _c0=o=>({$a:o});function AddonModWorkshopSubmissionComponent_div_1_p_6_Template(o,e){if(1&o&&(l.TgZ(0,"p"),l._uU(1),l.ALo(2,"translate"),l.qZA()),2&o){const o=l.oxw(2);l.ekj("addon-has-overriden-grade",o.showGrade(o.submission.gradeover)),l.xp6(),l.AsE(" ",l.xi3(2,4,"addon.mod_workshop.submissiongradeof",l.VKq(7,_c0,o.workshop.grade)),": ",o.submission.grade," ")}}function AddonModWorkshopSubmissionComponent_div_1_p_7_Template(o,e){if(1&o&&(l.TgZ(0,"p",11),l._uU(1),l.ALo(2,"translate"),l.qZA()),2&o){const o=l.oxw(2);l.xp6(),l.AsE(" ",l.lcZ(2,2,"addon.mod_workshop.gradeover"),": ",o.submission.gradeover," ")}}function AddonModWorkshopSubmissionComponent_div_1_p_8_Template(o,e){if(1&o&&(l.TgZ(0,"p"),l._uU(1),l.ALo(2,"translate"),l.qZA()),2&o){const o=l.oxw(2);l.xp6(),l.AsE(" ",l.xi3(2,2,"addon.mod_workshop.gradinggradeof",l.VKq(5,_c0,o.workshop.gradinggrade)),": ",o.submission.gradinggrade," ")}}function AddonModWorkshopSubmissionComponent_div_1_ion_note_9_Template(o,e){1&o&&(l.TgZ(0,"ion-note",12),l._UZ(1,"ion-icon",13),l._uU(2),l.ALo(3,"translate"),l.qZA()),2&o&&(l.xp6(2),l.hij(" ",l.lcZ(3,1,"core.notsent")," "))}function AddonModWorkshopSubmissionComponent_div_1_ion_note_10_ng_container_3_Template(o,e){1&o&&(l.ynx(0),l._UZ(1,"ion-icon",13),l._uU(2),l.ALo(3,"translate"),l.BQk()),2&o&&(l.xp6(2),l.hij(" ",l.lcZ(3,1,"core.notsent")," "))}function AddonModWorkshopSubmissionComponent_div_1_ion_note_10_ng_container_4_Template(o,e){1&o&&(l.ynx(0),l._UZ(1,"ion-icon",14),l._uU(2),l.ALo(3,"translate"),l.BQk()),2&o&&(l.xp6(2),l.hij(" ",l.lcZ(3,1,"core.deletedoffline")," "))}function AddonModWorkshopSubmissionComponent_div_1_ion_note_10_Template(o,e){if(1&o&&(l.TgZ(0,"ion-note",12),l._uU(1),l.ALo(2,"coreDateDayOrTime"),l.YNc(3,AddonModWorkshopSubmissionComponent_div_1_ion_note_10_ng_container_3_Template,4,3,"ng-container",1)(4,AddonModWorkshopSubmissionComponent_div_1_ion_note_10_ng_container_4_Template,4,3,"ng-container",1),l.qZA()),2&o){const o=l.oxw(2);l.xp6(),l.hij(" ",l.lcZ(2,3,o.submission.timemodified)," "),l.xp6(2),l.Q6J("ngIf",o.submission.offline),l.xp6(),l.Q6J("ngIf",o.submission.deleted)}}function AddonModWorkshopSubmissionComponent_div_1_ion_item_11_Template(o,e){if(1&o&&(l.TgZ(0,"ion-item",15)(1,"ion-label"),l._UZ(2,"core-format-text",16),l.qZA()()),2&o){const o=l.oxw(2);l.xp6(2),l.Q6J("component",o.component)("componentId",o.componentId)("text",o.submission.content)("contextInstanceId",o.module.id)("courseId",o.courseId)}}function AddonModWorkshopSubmissionComponent_div_1_ion_item_13_core_user_avatar_1_Template(o,e){if(1&o&&l._UZ(0,"core-user-avatar",4),2&o){const o=l.oxw(3);l.Q6J("user",o.evaluateByProfile)("courseId",o.courseId)("userId",o.evaluateByProfile.id)}}function AddonModWorkshopSubmissionComponent_div_1_ion_item_13_p_3_Template(o,e){if(1&o&&(l.TgZ(0,"p",19),l._uU(1),l.ALo(2,"translate"),l.qZA()),2&o){const o=l.oxw(3);l.xp6(),l.hij(" ",l.xi3(2,1,"addon.mod_workshop.feedbackby",l.VKq(4,_c0,o.evaluateByProfile.fullname))," ")}}function AddonModWorkshopSubmissionComponent_div_1_ion_item_13_Template(o,e){if(1&o&&(l.TgZ(0,"ion-item",15),l.YNc(1,AddonModWorkshopSubmissionComponent_div_1_ion_item_13_core_user_avatar_1_Template,1,3,"core-user-avatar",17),l.TgZ(2,"ion-label"),l.YNc(3,AddonModWorkshopSubmissionComponent_div_1_ion_item_13_p_3_Template,3,6,"p",18),l._UZ(4,"core-format-text",10),l.qZA()()),2&o){const o=l.oxw(2);l.xp6(),l.Q6J("ngIf",o.evaluateByProfile),l.xp6(2),l.Q6J("ngIf",o.evaluateByProfile&&o.evaluateByProfile.fullname),l.xp6(),l.Q6J("text",o.submission.feedbackauthor)("contextInstanceId",o.module.id)("courseId",o.courseId)}}function AddonModWorkshopSubmissionComponent_div_1_ion_item_14_Template(o,e){if(1&o){const o=l.EpF();l.TgZ(0,"ion-item")(1,"ion-label")(2,"ion-button",20),l.NdJ("click",(function AddonModWorkshopSubmissionComponent_div_1_ion_item_14_Template_ion_button_click_2_listener(){l.CHM(o);const e=l.oxw(2);return l.KtG(e.gotoSubmission())})),l._uU(3),l.ALo(4,"translate"),l._UZ(5,"ion-icon",21),l.qZA()()()}2&o&&(l.xp6(3),l.hij(" ",l.lcZ(4,1,"core.showmore")," "))}function AddonModWorkshopSubmissionComponent_div_1_Template(o,e){if(1&o&&(l.TgZ(0,"div")(1,"ion-item",3),l._UZ(2,"core-user-avatar",4),l.TgZ(3,"ion-label"),l.YNc(4,AddonModWorkshopSubmissionComponent_div_1_h2_4_Template,2,3,"h2",1)(5,AddonModWorkshopSubmissionComponent_div_1_p_5_Template,2,1,"p",1)(6,AddonModWorkshopSubmissionComponent_div_1_p_6_Template,3,9,"p",5)(7,AddonModWorkshopSubmissionComponent_div_1_p_7_Template,3,4,"p",6)(8,AddonModWorkshopSubmissionComponent_div_1_p_8_Template,3,7,"p",1),l.qZA(),l.YNc(9,AddonModWorkshopSubmissionComponent_div_1_ion_note_9_Template,4,3,"ion-note",7)(10,AddonModWorkshopSubmissionComponent_div_1_ion_note_10_Template,5,5,"ion-note",7),l.qZA(),l.YNc(11,AddonModWorkshopSubmissionComponent_div_1_ion_item_11_Template,3,5,"ion-item",8),l._UZ(12,"core-files",9),l.YNc(13,AddonModWorkshopSubmissionComponent_div_1_ion_item_13_Template,5,5,"ion-item",8)(14,AddonModWorkshopSubmissionComponent_div_1_ion_item_14_Template,6,3,"ion-item",1),l.qZA()),2&o){const o=l.oxw();l.xp6(2),l.Q6J("user",o.profile)("courseId",o.courseId)("userId",null==o.profile?null:o.profile.id),l.xp6(2),l.Q6J("ngIf",o.submission.title),l.xp6(),l.Q6J("ngIf",o.profile&&(null==o.profile?null:o.profile.fullname)),l.xp6(),l.Q6J("ngIf",o.showGrade(o.submission.grade)),l.xp6(),l.Q6J("ngIf",o.showGrade(o.submission.gradeover)),l.xp6(),l.Q6J("ngIf",o.access.canviewallsubmissions&&o.showGrade(o.submission.gradinggrade)),l.xp6(),l.Q6J("ngIf",!o.submission.timemodified),l.xp6(),l.Q6J("ngIf",o.submission.timemodified),l.xp6(),l.Q6J("ngIf",o.submission.content),l.xp6(),l.Q6J("files",o.submission.attachmentfiles)("component",o.component)("componentId",o.componentId),l.xp6(),l.Q6J("ngIf",o.viewDetails&&o.submission.feedbackauthor),l.xp6(),l.Q6J("ngIf",o.viewDetails)}}function AddonModWorkshopSubmissionComponent_ion_item_2_h2_3_Template(o,e){if(1&o&&(l.TgZ(0,"h2"),l._UZ(1,"core-format-text",10),l.qZA()),2&o){const o=l.oxw(2);l.xp6(),l.Q6J("text",o.submission.title)("contextInstanceId",o.module.id)("courseId",o.courseId)}}function AddonModWorkshopSubmissionComponent_ion_item_2_p_4_Template(o,e){if(1&o&&(l.TgZ(0,"p"),l._uU(1),l.qZA()),2&o){const o=l.oxw(2);l.xp6(),l.Oqu(o.profile.fullname)}}function AddonModWorkshopSubmissionComponent_ion_item_2_p_5_Template(o,e){if(1&o&&(l.TgZ(0,"p"),l._uU(1),l.ALo(2,"translate"),l.qZA()),2&o){const o=l.oxw(2);l.xp6(),l.lnq(" ",l.lcZ(2,3,"addon.mod_workshop.receivedgrades"),": ",o.submission.reviewedbydone," / ",o.submission.reviewedbycount," ")}}function AddonModWorkshopSubmissionComponent_ion_item_2_p_6_Template(o,e){if(1&o&&(l.TgZ(0,"p"),l._uU(1),l.ALo(2,"translate"),l.qZA()),2&o){const o=l.oxw(2);l.xp6(),l.lnq(" ",l.lcZ(2,3,"addon.mod_workshop.givengrades"),": ",o.submission.reviewerofdone," / ",o.submission.reviewerofcount," ")}}function AddonModWorkshopSubmissionComponent_ion_item_2_p_7_Template(o,e){if(1&o&&(l.TgZ(0,"p"),l._uU(1),l.ALo(2,"translate"),l.qZA()),2&o){const o=l.oxw(2);l.xp6(),l.AsE(" ",l.xi3(2,2,"addon.mod_workshop.submissiongradeof",l.VKq(5,_c0,o.workshop.grade)),": ",o.submission.grade," ")}}function AddonModWorkshopSubmissionComponent_ion_item_2_p_8_Template(o,e){if(1&o&&(l.TgZ(0,"p",11),l._uU(1),l.ALo(2,"translate"),l.qZA()),2&o){const o=l.oxw(2);l.xp6(),l.AsE(" ",l.xi3(2,2,"addon.mod_workshop.submissiongradeof",l.VKq(5,_c0,o.workshop.grade)),": ",o.submission.gradeover," ")}}function AddonModWorkshopSubmissionComponent_ion_item_2_p_9_Template(o,e){if(1&o&&(l.TgZ(0,"p"),l._uU(1),l.ALo(2,"translate"),l.qZA()),2&o){const o=l.oxw(2);l.xp6(),l.AsE(" ",l.xi3(2,2,"addon.mod_workshop.gradinggradeof",l.VKq(5,_c0,o.workshop.gradinggrade)),": ",o.submission.gradinggrade," ")}}function AddonModWorkshopSubmissionComponent_ion_item_2_ion_badge_10_Template(o,e){1&o&&(l.TgZ(0,"ion-badge",25),l._uU(1),l.ALo(2,"translate"),l.qZA()),2&o&&(l.xp6(),l.hij(" ",l.lcZ(2,1,"addon.mod_workshop.assessedsubmission")," "))}function AddonModWorkshopSubmissionComponent_ion_item_2_ion_badge_11_Template(o,e){1&o&&(l.TgZ(0,"ion-badge",26),l._uU(1),l.ALo(2,"translate"),l.qZA()),2&o&&(l.xp6(),l.hij(" ",l.lcZ(2,1,"addon.mod_workshop.notassessed")," "))}function AddonModWorkshopSubmissionComponent_ion_item_2_ion_note_12_div_3_Template(o,e){1&o&&(l.TgZ(0,"div"),l._UZ(1,"ion-icon",13),l._uU(2),l.ALo(3,"translate"),l.qZA()),2&o&&(l.xp6(2),l.hij(" ",l.lcZ(3,1,"core.notsent")," "))}function AddonModWorkshopSubmissionComponent_ion_item_2_ion_note_12_div_4_Template(o,e){1&o&&(l.TgZ(0,"div"),l._UZ(1,"ion-icon",14),l._uU(2),l.ALo(3,"translate"),l.qZA()),2&o&&(l.xp6(2),l.hij(" ",l.lcZ(3,1,"core.deletedoffline")," "))}function AddonModWorkshopSubmissionComponent_ion_item_2_ion_note_12_Template(o,e){if(1&o&&(l.TgZ(0,"ion-note",12),l._uU(1),l.ALo(2,"coreDateDayOrTime"),l.YNc(3,AddonModWorkshopSubmissionComponent_ion_item_2_ion_note_12_div_3_Template,4,3,"div",1)(4,AddonModWorkshopSubmissionComponent_ion_item_2_ion_note_12_div_4_Template,4,3,"div",1),l.qZA()),2&o){const o=l.oxw(2);l.xp6(),l.hij(" ",l.lcZ(2,3,o.submission.timemodified)," "),l.xp6(2),l.Q6J("ngIf",o.offline),l.xp6(),l.Q6J("ngIf",o.submission.deleted)}}function AddonModWorkshopSubmissionComponent_ion_item_2_Template(o,e){if(1&o){const o=l.EpF();l.TgZ(0,"ion-item",22),l.NdJ("click",(function AddonModWorkshopSubmissionComponent_ion_item_2_Template_ion_item_click_0_listener(){l.CHM(o);const e=l.oxw();return l.KtG(e.gotoSubmission())})),l._UZ(1,"core-user-avatar",4),l.TgZ(2,"ion-label"),l.YNc(3,AddonModWorkshopSubmissionComponent_ion_item_2_h2_3_Template,2,3,"h2",1)(4,AddonModWorkshopSubmissionComponent_ion_item_2_p_4_Template,2,1,"p",1)(5,AddonModWorkshopSubmissionComponent_ion_item_2_p_5_Template,3,5,"p",1)(6,AddonModWorkshopSubmissionComponent_ion_item_2_p_6_Template,3,5,"p",1)(7,AddonModWorkshopSubmissionComponent_ion_item_2_p_7_Template,3,7,"p",1)(8,AddonModWorkshopSubmissionComponent_ion_item_2_p_8_Template,3,7,"p",6)(9,AddonModWorkshopSubmissionComponent_ion_item_2_p_9_Template,3,7,"p",1)(10,AddonModWorkshopSubmissionComponent_ion_item_2_ion_badge_10_Template,3,3,"ion-badge",23)(11,AddonModWorkshopSubmissionComponent_ion_item_2_ion_badge_11_Template,3,3,"ion-badge",24),l.qZA(),l.YNc(12,AddonModWorkshopSubmissionComponent_ion_item_2_ion_note_12_Template,5,5,"ion-note",7),l.qZA()}if(2&o){const o=l.oxw();l.Q6J("detail",o.submission.timemodified)("button",o.submission.timemodified),l.xp6(),l.Q6J("user",o.profile)("courseId",o.courseId)("userId",null==o.profile?null:o.profile.id),l.xp6(2),l.Q6J("ngIf",o.submission.title),l.xp6(),l.Q6J("ngIf",o.profile&&o.profile.fullname),l.xp6(),l.Q6J("ngIf",o.submission.reviewedbydone),l.xp6(),l.Q6J("ngIf",o.submission.reviewerofdone),l.xp6(),l.Q6J("ngIf",!o.showGrade(o.submission.gradeover)&&o.showGrade(o.submission.grade)),l.xp6(),l.Q6J("ngIf",o.showGrade(o.submission.gradeover)),l.xp6(),l.Q6J("ngIf",o.access.canviewallsubmissions&&o.showGrade(o.submission.gradinggrade)),l.xp6(),l.Q6J("ngIf",o.assessment&&(o.showGrade(o.assessment.grade)||o.assessment.offline)),l.xp6(),l.Q6J("ngIf",o.assessment&&!o.showGrade(o.assessment.grade)&&!o.assessment.offline),l.xp6(),l.Q6J("ngIf",o.submission.timemodified)}}let x=(()=>{var o;class AddonModWorkshopSubmissionComponent{constructor(){this.summary=!1,this.component=c.qR,this.loaded=!1,this.offline=!1,this.viewDetails=!1,this.userId=t.m9.getCurrentSiteUserId(),this.showGrade=r.AddonModWorkshopHelper.showGrade}ngOnInit(){var o,e;this.componentId=this.module.instance,this.userId=this.submission.authorid||this.userId;const n=[];this.offline=!(null===(o=this.submission)||void 0===o||!o.offline)||!(null===(e=this.assessment)||void 0===e||!e.offline),this.submission.id&&n.push(_.AddonModWorkshopOffline.getEvaluateSubmission(this.workshop.id,this.submission.id).then((o=>{this.submission.gradeover=parseInt(o.gradeover,10),this.offline=!0})).catch((()=>{}))),this.userId&&n.push(s.My.getProfile(this.userId,this.courseId,!0).then((o=>{this.profile=o}))),this.viewDetails=!this.summary&&this.workshop.phase==a.AddonModWorkshopPhase.PHASE_CLOSED&&i.b.getCurrentRoute().component!=d.B,this.viewDetails&&this.submission.gradeoverby&&n.push(s.My.getProfile(this.submission.gradeoverby,this.courseId,!0).then((o=>{this.evaluateByProfile=o}))),Promise.all(n).finally((()=>{this.loaded=!0}))}gotoSubmission(){if(this.submission.timemodified){i.b.navigateToSitePath(`${c.IM}/${this.courseId}/${this.module.id}/${this.submission.id}`,{params:{module:this.module,workshop:this.workshop,access:this.access,profile:this.profile,submission:this.submission,assessment:this.assessment}})}}}return(o=AddonModWorkshopSubmissionComponent).ɵfac=function AddonModWorkshopSubmissionComponent_Factory(e){return new(e||o)},o.ɵcmp=l.Xpm({type:o,selectors:[["addon-mod-workshop-submission"]],inputs:{submission:"submission",module:"module",workshop:"workshop",access:"access",courseId:"courseId",assessment:"assessment",summary:"summary"},decls:3,vars:3,consts:[[3,"hideUntil"],[4,"ngIf"],["class","ion-text-wrap",3,"detail","button","click",4,"ngIf"],[1,"ion-text-wrap","addon-workshop-submission-title"],["slot","start",3,"user","courseId","userId"],[3,"addon-has-overriden-grade",4,"ngIf"],["class","addon-overriden-grade",4,"ngIf"],["slot","end",4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],[3,"files","component","componentId"],["contextLevel","module",3,"text","contextInstanceId","courseId"],[1,"addon-overriden-grade"],["slot","end"],["name","fas-clock","aria-hidden","true"],["name","fas-trash","aria-hidden","true"],[1,"ion-text-wrap"],["contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],["slot","start",3,"user","courseId","userId",4,"ngIf"],["class","item-heading",4,"ngIf"],[1,"item-heading"],["expand","block",3,"click"],["name","fas-chevron-right","slot","end","aria-hidden","true"],[1,"ion-text-wrap",3,"detail","button","click"],["color","success","class","ion-text-wrap",4,"ngIf"],["color","danger","class","ion-text-wrap",4,"ngIf"],["color","success",1,"ion-text-wrap"],["color","danger",1,"ion-text-wrap"]],template:function AddonModWorkshopSubmissionComponent_Template(o,e){1&o&&(l.TgZ(0,"core-loading",0),l.YNc(1,AddonModWorkshopSubmissionComponent_div_1_Template,15,16,"div",1)(2,AddonModWorkshopSubmissionComponent_ion_item_2_Template,13,15,"ion-item",2),l.qZA()),2&o&&(l.Q6J("hideUntil",e.loaded),l.xp6(),l.Q6J("ngIf",!e.summary),l.xp6(),l.Q6J("ngIf",e.summary))},dependencies:[p.O5,m.F,u.r,h.X,f.I,g.r,k.O,b.yp,b.YG,b.gu,b.Ie,b.Q$,b.uN,A.c,I.X$],styles:["[_nghost-%COMP%]   p.addon-overriden-grade[_ngcontent-%COMP%]{color:var(--success)}[_nghost-%COMP%]   p.addon-has-overriden-grade[_ngcontent-%COMP%]{color:var(--danger);text-decoration:line-through}"]}),AddonModWorkshopSubmissionComponent})()},58346:(o,e,n)=>{n.d(e,{B:()=>S});var s=n(49671),i=n(56223),t=n(73180),d=n(4496),a=n(45151),r=n(43555),_=n(53564),c=n(12265),l=n(13010),p=n(34749),m=n(10727),u=n(98370),h=n(40067),f=n(85904),g=n(78452),k=n(11850),b=n(63294),A=n(3641),I=n(43468),x=n(88817),w=n(1248),v=n(19212),M=n(31903);o=n.hmd(o);const T=["feedbackFormEl"];function AddonModWorkshopSubmissionPage_core_format_text_7_Template(o,e){if(1&o&&v._UZ(0,"core-format-text",11),2&o){const o=v.oxw();v.Q6J("text",o.title)("contextInstanceId",o.module.id)("courseId",o.courseId)}}function AddonModWorkshopSubmissionPage_ion_button_9_Template(o,e){if(1&o){const o=v.EpF();v.TgZ(0,"ion-button",12),v.NdJ("click",(function AddonModWorkshopSubmissionPage_ion_button_9_Template_ion_button_click_0_listener(){v.CHM(o);const e=v.oxw();return v.KtG(e.saveAssessment())})),v.ALo(1,"translate"),v._uU(2),v.ALo(3,"translate"),v.qZA()}2&o&&(v.uIk("aria-label",v.lcZ(1,2,"core.save")),v.xp6(2),v.hij(" ",v.lcZ(3,4,"core.save")," "))}function AddonModWorkshopSubmissionPage_ion_button_10_Template(o,e){if(1&o){const o=v.EpF();v.TgZ(0,"ion-button",12),v.NdJ("click",(function AddonModWorkshopSubmissionPage_ion_button_10_Template_ion_button_click_0_listener(){v.CHM(o);const e=v.oxw();return v.KtG(e.saveEvaluation())})),v._uU(1),v.ALo(2,"translate"),v.qZA()}2&o&&(v.xp6(),v.hij(" ",v.lcZ(2,1,"core.save")," "))}function AddonModWorkshopSubmissionPage_ion_refresher_12_Template(o,e){if(1&o){const o=v.EpF();v.TgZ(0,"ion-refresher",13),v.NdJ("ionRefresh",(function AddonModWorkshopSubmissionPage_ion_refresher_12_Template_ion_refresher_ionRefresh_0_listener(e){v.CHM(o);const n=v.oxw();return v.KtG(n.refreshSubmission(e.target))})),v._UZ(1,"ion-refresher-content",14),v.ALo(2,"translate"),v.qZA()}if(2&o){const o=v.oxw();v.Q6J("disabled",!o.loaded),v.xp6(),v.s9C("pullingText",v.lcZ(2,2,"core.pulltorefresh"))}}function AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_2_Template(o,e){if(1&o){const o=v.EpF();v.TgZ(0,"ion-button",21),v.NdJ("click",(function AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_2_Template_ion_button_click_0_listener(){v.CHM(o);const e=v.oxw(3);return v.KtG(e.editSubmission())})),v._UZ(1,"ion-icon",22),v._uU(2),v.ALo(3,"translate"),v.qZA()}2&o&&(v.xp6(2),v.hij(" ",v.lcZ(3,1,"addon.mod_workshop.editsubmission")," "))}function AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_3_Template(o,e){if(1&o){const o=v.EpF();v.TgZ(0,"ion-button",23),v.NdJ("click",(function AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_3_Template_ion_button_click_0_listener(){v.CHM(o);const e=v.oxw(3);return v.KtG(e.deleteSubmission())})),v._UZ(1,"ion-icon",24),v._uU(2),v.ALo(3,"translate"),v.qZA()}2&o&&(v.xp6(2),v.hij(" ",v.lcZ(3,1,"addon.mod_workshop.deletesubmission")," "))}function AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_4_Template(o,e){if(1&o){const o=v.EpF();v.TgZ(0,"ion-button",25),v.NdJ("click",(function AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_4_Template_ion_button_click_0_listener(){v.CHM(o);const e=v.oxw(3);return v.KtG(e.undoDeleteSubmission())})),v._UZ(1,"ion-icon",26),v._uU(2),v.ALo(3,"translate"),v.qZA()}2&o&&(v.xp6(2),v.hij(" ",v.lcZ(3,1,"core.restore")," "))}function AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_Template(o,e){if(1&o&&(v.TgZ(0,"ion-item",17)(1,"ion-label"),v.YNc(2,AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_2_Template,4,3,"ion-button",18)(3,AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_3_Template,4,3,"ion-button",19)(4,AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_ion_button_4_Template,4,3,"ion-button",20),v.qZA()()),2&o){const o=v.oxw(2);v.xp6(2),v.Q6J("ngIf",o.canEdit),v.xp6(),v.Q6J("ngIf",!o.submission.deleted&&o.canDelete),v.xp6(),v.Q6J("ngIf",o.submission.deleted&&o.canDelete)}}function AddonModWorkshopSubmissionPage_ion_list_14_Template(o,e){if(1&o&&(v.TgZ(0,"ion-list"),v._UZ(1,"addon-mod-workshop-submission",15),v.YNc(2,AddonModWorkshopSubmissionPage_ion_list_14_ion_item_2_Template,5,3,"ion-item",16),v.qZA()),2&o){const o=v.oxw();v.xp6(),v.Q6J("submission",o.submission)("courseId",o.courseId)("module",o.module)("workshop",o.workshop)("access",o.access),v.xp6(),v.Q6J("ngIf",o.canEdit||o.canDelete)}}function AddonModWorkshopSubmissionPage_ion_list_15_core_user_avatar_2_Template(o,e){if(1&o&&v._UZ(0,"core-user-avatar",28),2&o){const o=v.oxw(2);v.Q6J("user",o.evaluateByProfile)("courseId",o.courseId)("userId",o.evaluateByProfile.id)}}const _c1=o=>({$a:o});function AddonModWorkshopSubmissionPage_ion_list_15_h2_4_Template(o,e){if(1&o&&(v.TgZ(0,"h2"),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&o){const o=v.oxw(2);v.xp6(),v.hij(" ",v.xi3(2,1,"addon.mod_workshop.feedbackby",v.VKq(4,_c1,o.evaluateByProfile.fullname))," ")}}function AddonModWorkshopSubmissionPage_ion_list_15_Template(o,e){if(1&o&&(v.TgZ(0,"ion-list")(1,"ion-item",17),v.YNc(2,AddonModWorkshopSubmissionPage_ion_list_15_core_user_avatar_2_Template,1,3,"core-user-avatar",27),v.TgZ(3,"ion-label"),v.YNc(4,AddonModWorkshopSubmissionPage_ion_list_15_h2_4_Template,3,6,"h2",8),v._UZ(5,"core-format-text",11),v.qZA()()()),2&o){const o=v.oxw();v.xp6(2),v.Q6J("ngIf",o.evaluateByProfile),v.xp6(2),v.Q6J("ngIf",o.evaluateByProfile&&o.evaluateByProfile.fullname),v.xp6(),v.Q6J("text",null==o.evaluate?null:o.evaluate.text)("contextInstanceId",o.module.id)("courseId",o.courseId)}}function AddonModWorkshopSubmissionPage_ion_list_16_Template(o,e){if(1&o&&(v.TgZ(0,"ion-list")(1,"ion-item",17)(2,"ion-label")(3,"h2"),v._uU(4),v.ALo(5,"translate"),v.qZA()()(),v._UZ(6,"addon-mod-workshop-assessment",29),v.qZA()),2&o){const o=v.oxw();v.xp6(4),v.Oqu(v.lcZ(5,7,"addon.mod_workshop.yourassessment")),v.xp6(2),v.Q6J("submission",o.submission)("assessment",o.ownAssessment)("courseId",o.courseId)("access",o.access)("module",o.module)("workshop",o.workshop)}}function AddonModWorkshopSubmissionPage_ion_list_17_ng_container_6_addon_mod_workshop_assessment_1_Template(o,e){if(1&o&&v._UZ(0,"addon-mod-workshop-assessment",29),2&o){const o=v.oxw().$implicit,e=v.oxw(2);v.Q6J("submission",e.submission)("assessment",o)("courseId",e.courseId)("access",e.access)("module",e.module)("workshop",e.workshop)}}function AddonModWorkshopSubmissionPage_ion_list_17_ng_container_6_Template(o,e){if(1&o&&(v.ynx(0),v.YNc(1,AddonModWorkshopSubmissionPage_ion_list_17_ng_container_6_addon_mod_workshop_assessment_1_Template,1,6,"addon-mod-workshop-assessment",32),v.BQk()),2&o){const o=e.$implicit;v.xp6(),v.Q6J("ngIf",!o.ownAssessment)}}function AddonModWorkshopSubmissionPage_ion_list_17_Template(o,e){if(1&o&&(v.TgZ(0,"ion-list")(1,"ion-item",17)(2,"ion-label")(3,"h3",30),v._uU(4),v.ALo(5,"translate"),v.qZA()()(),v.YNc(6,AddonModWorkshopSubmissionPage_ion_list_17_ng_container_6_Template,2,1,"ng-container",31),v.qZA()),2&o){const o=v.oxw();v.xp6(4),v.Oqu(v.lcZ(5,2,"addon.mod_workshop.receivedgrades")),v.xp6(2),v.Q6J("ngForOf",o.submissionInfo.reviewedby)}}function AddonModWorkshopSubmissionPage_ion_list_18_addon_mod_workshop_assessment_6_Template(o,e){if(1&o&&v._UZ(0,"addon-mod-workshop-assessment",34),2&o){const o=e.$implicit,n=v.oxw(2);v.Q6J("assessment",o)("courseId",n.courseId)("module",n.module)("workshop",n.workshop)("access",n.access)}}function AddonModWorkshopSubmissionPage_ion_list_18_Template(o,e){if(1&o&&(v.TgZ(0,"ion-list")(1,"ion-item",17)(2,"ion-label")(3,"h3",30),v._uU(4),v.ALo(5,"translate"),v.qZA()()(),v.YNc(6,AddonModWorkshopSubmissionPage_ion_list_18_addon_mod_workshop_assessment_6_Template,1,5,"addon-mod-workshop-assessment",33),v.qZA()),2&o){const o=v.oxw();v.xp6(4),v.Oqu(v.lcZ(5,2,"addon.mod_workshop.givengrades")),v.xp6(2),v.Q6J("ngForOf",o.submissionInfo.reviewerof)}}function AddonModWorkshopSubmissionPage_form_19_ion_item_7_Template(o,e){1&o&&(v.TgZ(0,"ion-item",17)(1,"ion-toggle",41)(2,"p",30),v._uU(3),v.ALo(4,"translate"),v.qZA(),v.TgZ(5,"p"),v._uU(6),v.ALo(7,"translate"),v.qZA()()()),2&o&&(v.xp6(3),v.Oqu(v.lcZ(4,2,"addon.mod_workshop.publishsubmission")),v.xp6(3),v.Oqu(v.lcZ(7,4,"addon.mod_workshop.publishsubmission_help")))}function AddonModWorkshopSubmissionPage_form_19_ion_select_option_20_Template(o,e){if(1&o&&(v.TgZ(0,"ion-select-option",42),v._uU(1),v.qZA()),2&o){const o=e.$implicit;v.Q6J("value",o.value),v.xp6(),v.hij(" ",o.label," ")}}const _c2=o=>({header:o}),_c3=o=>({id:o});function AddonModWorkshopSubmissionPage_form_19_Template(o,e){if(1&o&&(v.TgZ(0,"form",35,36)(2,"ion-item",17)(3,"ion-label")(4,"h3",30),v._uU(5),v.ALo(6,"translate"),v.qZA()()(),v.YNc(7,AddonModWorkshopSubmissionPage_form_19_ion_item_7_Template,8,6,"ion-item",16),v.TgZ(8,"ion-item",17)(9,"ion-label")(10,"h3",30),v._uU(11),v.ALo(12,"translate"),v.qZA(),v.TgZ(13,"p"),v._uU(14),v.qZA()()(),v.TgZ(15,"ion-item",17)(16,"ion-select",37),v.ALo(17,"translate"),v.ALo(18,"translate"),v.ALo(19,"translate"),v.YNc(20,AddonModWorkshopSubmissionPage_form_19_ion_select_option_20_Template,2,2,"ion-select-option",38),v.qZA()(),v.TgZ(21,"ion-item")(22,"ion-label",39),v._uU(23),v.ALo(24,"translate"),v.qZA(),v._UZ(25,"core-rich-text-editor",40),v.qZA()()),2&o){const o=v.oxw();v.Q6J("formGroup",o.feedbackForm),v.xp6(5),v.Oqu(v.lcZ(6,14,"addon.mod_workshop.feedbackauthor")),v.xp6(2),v.Q6J("ngIf",o.access.canpublishsubmissions),v.xp6(4),v.Oqu(v.lcZ(12,16,"addon.mod_workshop.gradecalculated")),v.xp6(3),v.Oqu(o.submission.grade),v.xp6(2),v.Q6J("cancelText",v.lcZ(17,18,"core.cancel"))("interfaceOptions",v.VKq(26,_c2,v.lcZ(18,20,"addon.mod_workshop.gradeover")))("label",v.lcZ(19,22,"addon.mod_workshop.gradeover")),v.xp6(4),v.Q6J("ngForOf",o.evaluationGrades),v.xp6(3),v.Oqu(v.lcZ(24,24,"addon.mod_workshop.feedbackauthor")),v.xp6(2),v.Q6J("control",o.feedbackForm.controls.text)("autoSave",!0)("contextInstanceId",o.module.id)("draftExtraParams",v.VKq(28,_c3,o.submissionId))}}function AddonModWorkshopSubmissionPage_addon_mod_workshop_assessment_strategy_20_Template(o,e){if(1&o&&v._UZ(0,"addon-mod-workshop-assessment-strategy",43),2&o){const o=v.oxw();v.Q6J("workshop",o.workshop)("access",o.access)("assessmentId",o.assessmentId)("userId",o.assessmentUserId)("strategy",o.strategy)("edit",o.access.assessingallowed)}}function AddonModWorkshopSubmissionPage_ion_list_21_core_user_avatar_2_Template(o,e){if(1&o&&v._UZ(0,"core-user-avatar",28),2&o){const o=v.oxw(2);v.Q6J("user",o.evaluateGradingByProfile)("courseId",o.courseId)("userId",o.evaluateGradingByProfile.id)}}function AddonModWorkshopSubmissionPage_ion_list_21_h3_4_Template(o,e){if(1&o&&(v.TgZ(0,"h3",30),v._uU(1),v.ALo(2,"translate"),v.qZA()),2&o){const o=v.oxw(2);v.xp6(),v.hij(" ",v.xi3(2,1,"addon.mod_workshop.feedbackby",v.VKq(4,_c1,o.evaluateGradingByProfile.fullname))," ")}}function AddonModWorkshopSubmissionPage_ion_list_21_Template(o,e){if(1&o&&(v.TgZ(0,"ion-list")(1,"ion-item",17),v.YNc(2,AddonModWorkshopSubmissionPage_ion_list_21_core_user_avatar_2_Template,1,3,"core-user-avatar",27),v.TgZ(3,"ion-label"),v.YNc(4,AddonModWorkshopSubmissionPage_ion_list_21_h3_4_Template,3,6,"h3",44),v._UZ(5,"core-format-text",11),v.qZA()()()),2&o){const o=v.oxw();v.xp6(2),v.Q6J("ngIf",o.evaluateGradingByProfile),v.xp6(2),v.Q6J("ngIf",o.evaluateGradingByProfile&&o.evaluateGradingByProfile.fullname),v.xp6(),v.Q6J("text",o.assessment.feedbackreviewer)("contextInstanceId",o.module.id)("courseId",o.courseId)}}let S=(()=>{var e;class AddonModWorkshopSubmissionPage{constructor(o,e){this.fb=o,this.content=e,this.loaded=!1,this.canAddFeedback=!1,this.canEdit=!1,this.canDelete=!1,this.evaluationGrades=[],this.originalEvaluation={published:!1,text:"",grade:""},this.hasOffline=!1,this.component=w.qR,this.forceLeave=!1,this.isDestroyed=!1,this.currentUserId=_.m9.getCurrentSiteUserId(),this.siteId=_.m9.getCurrentSiteId(),this.feedbackForm=new i.cw({}),this.feedbackForm.addControl("published",this.fb.control("")),this.feedbackForm.addControl("grade",this.fb.control("")),this.feedbackForm.addControl("text",this.fb.control("")),this.obsAssessmentSaved=u.R.on(g.AddonModWorkshopProvider.ASSESSMENT_SAVED,(o=>{this.eventReceived(o)}),this.siteId),this.syncObserver=u.R.on(A.AddonModWorkshopSyncProvider.AUTO_SYNCED,(o=>{this.eventReceived(o)}),this.siteId),this.logView=x.V.once((()=>this.performLogView()))}ngOnInit(){var o=this;return(0,s.Z)((function*(){var e,n,s;try{o.submissionId=r.b.getRequiredRouteNumberParam("submissionId"),o.module=r.b.getRequiredRouteParam("module"),o.workshop=r.b.getRequiredRouteParam("workshop"),o.access=r.b.getRequiredRouteParam("access"),o.courseId=r.b.getRequiredRouteNumberParam("courseId"),o.profile=r.b.getRouteParam("profile"),o.submissionInfo=r.b.getRequiredRouteParam("submission"),o.assessment=r.b.getRouteParam("assessment")}catch(o){return l.OQ.showErrorModal(o),r.b.back(),void 0}o.title=o.module.name,o.workshopId=o.module.instance||o.workshop.id,o.userId=null===(e=o.submissionInfo)||void 0===e?void 0:e.authorid,o.strategy=o.assessment&&o.assessment.strategy||o.workshop&&o.workshop.strategy,o.assessmentId=null===(n=o.assessment)||void 0===n?void 0:n.id,o.assessmentUserId=null===(s=o.assessment)||void 0===s?void 0:s.reviewerid,yield o.fetchSubmissionData(),o.logView()}))()}canLeave(){var o=this;return(0,s.Z)((function*(){var e;const n=null===(e=o.assessmentStrategy)||void 0===e?void 0:e.hasDataChanged();return o.forceLeave||!o.hasEvaluationChanged()&&!n||(yield l.OQ.showConfirm(m.vN.instant("core.confirmcanceledit")),h.o.triggerFormCancelledEvent(o.formElement,o.siteId)),!0}))()}editSubmission(){const e={module:o,access:this.access};r.b.navigate(String(this.submissionId)+"/edit",e)}eventReceived(o){var e;this.workshopId===o.workshopId&&(null===(e=this.content)||void 0===e||e.scrollToTop(),this.loaded=!1,this.refreshAllData())}fetchSubmissionData(){var o=this;return(0,s.Z)((function*(){try{var e,n,s;o.submission=yield k.AddonModWorkshopHelper.getSubmissionById(o.workshopId,o.submissionId,{cmId:o.module.id});const i=[];if(o.submission.grade=null===(e=o.submissionInfo)||void 0===e?void 0:e.grade,o.submission.gradinggrade=null===(n=o.submissionInfo)||void 0===n?void 0:n.gradinggrade,o.submission.gradeover=null===(s=o.submissionInfo)||void 0===s?void 0:s.gradeover,o.userId=o.submission.authorid||o.userId,o.canEdit=o.currentUserId==o.userId&&o.access.cansubmit&&o.access.modifyingsubmissionallowed,o.canDelete=o.access.candeletesubmissions,o.canAddFeedback=!o.assessmentId&&o.workshop.phase>g.AddonModWorkshopPhase.PHASE_ASSESSMENT&&o.workshop.phase<g.AddonModWorkshopPhase.PHASE_CLOSED&&o.access.canoverridegrades,o.ownAssessment=void 0,o.access.canviewallassessments)i.push(g.AddonModWorkshop.getSubmissionAssessments(o.workshopId,o.submissionId,{cmId:o.module.id}).then((e=>{o.canDelete&&(o.canDelete=!e.length),o.submissionInfo.reviewedby=e,o.submissionInfo.reviewedby.forEach((e=>{e=k.AddonModWorkshopHelper.realGradeValue(o.workshop,e),o.currentUserId==e.reviewerid&&(o.ownAssessment=e,e.ownAssessment=!0)}))})));else if(o.currentUserId===o.userId&&o.assessmentId)i.push(g.AddonModWorkshop.getAssessment(o.workshopId,o.assessmentId,{cmId:o.module.id}).then((e=>{o.canDelete&&(o.canDelete=!e),o.submissionInfo.reviewedby=[o.parseAssessment(e)]})));else if(o.workshop.phase===g.AddonModWorkshopPhase.PHASE_CLOSED&&o.userId===o.currentUserId){const e=yield g.AddonModWorkshop.getSubmissionAssessments(o.workshopId,o.submissionId,{cmId:o.module.id});o.submissionInfo.reviewedby=e.map((e=>o.parseAssessment(e)))}(o.canAddFeedback||o.workshop.phase===g.AddonModWorkshopPhase.PHASE_CLOSED)&&(o.evaluate={published:o.submission.published,text:o.submission.feedbackauthor||""}),o.canAddFeedback?(o.isDestroyed||c.d.blockOperation(o.component,o.workshopId),i.push(o.fillEvaluationsGrades())):o.workshop.phase===g.AddonModWorkshopPhase.PHASE_CLOSED&&o.submission.gradeoverby&&o.evaluate&&o.evaluate.text&&i.push(a.My.getProfile(o.submission.gradeoverby,o.courseId,!0).then((e=>{o.evaluateByProfile=e}))),o.assessment&&!o.access.assessingallowed&&o.assessment.feedbackreviewer&&o.assessment.gradinggradeoverby&&i.push(a.My.getProfile(o.assessment.gradinggradeoverby,o.courseId,!0).then((e=>{o.evaluateGradingByProfile=e}))),yield Promise.all(i);const t=yield b.AddonModWorkshopOffline.getSubmissions(o.workshopId);o.submission=yield k.AddonModWorkshopHelper.applyOfflineData(o.submission,t)}catch(o){l.OQ.showErrorModalDefault(o,"core.course.errorgetmodule",!0)}finally{o.loaded=!0}}))()}fillEvaluationsGrades(){var o=this;return(0,s.Z)((function*(){const e=m.vN.instant("addon.mod_workshop.notoverridden");if(o.evaluationGrades=yield d.b$.makeGradesMenu(o.workshop.grade||0,void 0,e,-1),o.evaluate){o.evaluate.grade={label:d.b$.getGradeLabelFromValue(o.evaluationGrades,o.submissionInfo.gradeover)||e,value:o.submissionInfo.gradeover||-1};try{const n=yield b.AddonModWorkshopOffline.getEvaluateSubmission(o.workshopId,o.submissionId);o.hasOffline=!0,o.evaluate.published=n.published,o.evaluate.text=n.feedbacktext,o.evaluate.grade={label:d.b$.getGradeLabelFromValue(o.evaluationGrades,parseInt(n.gradeover,10))||e,value:n.gradeover||-1}}catch{o.hasOffline=!1}finally{o.originalEvaluation.published=o.evaluate.published,o.originalEvaluation.text=o.evaluate.text,o.originalEvaluation.grade=o.evaluate.grade.value,o.feedbackForm.controls.published.setValue(o.evaluate.published),o.feedbackForm.controls.grade.setValue(o.evaluate.grade.value),o.feedbackForm.controls.text.setValue(o.evaluate.text)}}}))()}parseAssessment(o){return o=k.AddonModWorkshopHelper.realGradeValue(this.workshop,o),this.currentUserId==o.reviewerid&&(this.ownAssessment=o,o.ownAssessment=!0),o}forceLeavePage(){this.forceLeave=!0,r.b.back()}hasEvaluationChanged(){if(!this.loaded||!this.access.canoverridegrades)return!1;const o=this.feedbackForm.value;return this.originalEvaluation.published!=o.published||(this.originalEvaluation.text!=o.text||this.originalEvaluation.grade!=o.grade)}refreshAllData(){var o=this;return(0,s.Z)((function*(){const e=[];e.push(g.AddonModWorkshop.invalidateSubmissionData(o.workshopId,o.submissionId)),e.push(g.AddonModWorkshop.invalidateSubmissionsData(o.workshopId)),e.push(g.AddonModWorkshop.invalidateSubmissionAssesmentsData(o.workshopId,o.submissionId)),o.assessmentId&&(e.push(g.AddonModWorkshop.invalidateAssessmentFormData(o.workshopId,o.assessmentId)),e.push(g.AddonModWorkshop.invalidateAssessmentData(o.workshopId,o.assessmentId))),o.assessmentUserId&&e.push(g.AddonModWorkshop.invalidateReviewerAssesmentsData(o.workshopId,o.assessmentId));try{yield Promise.all(e)}finally{u.R.trigger(g.AddonModWorkshopProvider.ASSESSMENT_INVALIDATED,null,o.siteId),yield o.fetchSubmissionData(),o.logView()}}))()}refreshSubmission(o){this.loaded&&this.refreshAllData().finally((()=>{null==o||o.complete()}))}saveAssessment(){var o=this;return(0,s.Z)((function*(){var e;if(null!==(e=o.assessmentStrategy)&&void 0!==e&&e.hasDataChanged())try{yield o.assessmentStrategy.saveAssessment(),o.forceLeavePage()}catch{}else o.forceLeavePage()}))()}saveEvaluation(){var o=this;return(0,s.Z)((function*(){o.hasEvaluationChanged()?(yield o.sendEvaluation(),o.forceLeavePage()):o.forceLeavePage()}))()}sendEvaluation(){var o=this;return(0,s.Z)((function*(){const e=yield l.OQ.showModalLoading("core.sending",!0),n=o.feedbackForm.value;n.grade=Number(n.grade)>=0?n.grade:"",n.text=p._1.formatHtmlLines(n.text);try{const e=yield g.AddonModWorkshop.evaluateSubmission(o.workshopId,o.submissionId,o.courseId,n.text,n.published,String(n.grade));h.o.triggerFormSubmittedEvent(o.formElement,!!e,o.siteId),yield g.AddonModWorkshop.invalidateSubmissionData(o.workshopId,o.submissionId).finally((()=>{u.R.trigger(g.AddonModWorkshopProvider.SUBMISSION_CHANGED,{workshopId:o.workshopId,submissionId:o.submissionId},o.siteId)}))}catch(o){l.OQ.showErrorModalDefault(o,"Cannot save submission evaluation")}finally{e.dismiss()}}))()}deleteSubmission(){var o=this;return(0,s.Z)((function*(){try{yield l.OQ.showDeleteConfirm("addon.mod_workshop.submissiondeleteconfirm")}catch{return}const e=yield l.OQ.showModalLoading("core.deleting",!0);let n=!1;try{yield g.AddonModWorkshop.deleteSubmission(o.workshopId,o.submissionId,o.courseId),n=!0,yield g.AddonModWorkshop.invalidateSubmissionData(o.workshopId,o.submissionId)}catch(o){l.OQ.showErrorModalDefault(o,"Cannot delete submission")}finally{if(e.dismiss(),n){u.R.trigger(g.AddonModWorkshopProvider.SUBMISSION_CHANGED,{workshopId:o.workshopId,submissionId:o.submissionId},o.siteId),o.forceLeavePage()}}}))()}undoDeleteSubmission(){var o=this;return(0,s.Z)((function*(){yield b.AddonModWorkshopOffline.deleteSubmissionAction(o.workshopId,g.AddonModWorkshopAction.DELETE).finally((0,s.Z)((function*(){u.R.trigger(g.AddonModWorkshopProvider.SUBMISSION_CHANGED,{workshopId:o.workshopId,submissionId:o.submissionId},o.siteId),yield o.refreshAllData()})))}))()}performLogView(){var o=this;return(0,s.Z)((function*(){try{yield g.AddonModWorkshop.logViewSubmission(o.submissionId,o.workshopId),t.FO.checkModuleCompletion(o.courseId,o.module.completiondata)}catch{}I.ke.logEvent({type:I.gM.VIEW_ITEM,ws:"mod_workshop_view_submission",name:o.workshop.name,data:{id:o.workshop.id,submissionid:o.submissionId,category:"workshop"},url:`/mod/workshop/submission.php?cmid=${o.module.id}&id=${o.submissionId}`})}))()}ngOnDestroy(){var o,e;this.isDestroyed=!0,null===(o=this.syncObserver)||void 0===o||o.off(),null===(e=this.obsAssessmentSaved)||void 0===e||e.off(),c.d.unblockOperation(this.component,this.workshopId)}}return(e=AddonModWorkshopSubmissionPage).ɵfac=function AddonModWorkshopSubmissionPage_Factory(o){return new(o||e)(v.Y36(i.qu),v.Y36(M.W2,8))},e.ɵcmp=v.Xpm({type:e,selectors:[["page-addon-mod-workshop-submission-page"]],viewQuery:function AddonModWorkshopSubmissionPage_Query(o,e){if(1&o&&(v.Gf(f.W,5),v.Gf(T,5)),2&o){let o;v.iGM(o=v.CRH())&&(e.assessmentStrategy=o.first),v.iGM(o=v.CRH())&&(e.formElement=o.first)}},decls:22,vars:17,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId",4,"ngIf"],["slot","end",3,"hidden"],["fill","clear",3,"click",4,"ngIf"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh",4,"ngIf"],[3,"hideUntil"],[4,"ngIf"],[3,"formGroup",4,"ngIf"],[3,"workshop","access","assessmentId","userId","strategy","edit",4,"ngIf"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["fill","clear",3,"click"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"submission","courseId","module","workshop","access"],["class","ion-text-wrap",4,"ngIf"],[1,"ion-text-wrap"],["expand","block",3,"click",4,"ngIf"],["expand","block","color","danger",3,"click",4,"ngIf"],["expand","block","fill","outline","color","danger",3,"click",4,"ngIf"],["expand","block",3,"click"],["name","fas-pen","slot","start","aria-hidden","true"],["expand","block","color","danger",3,"click"],["name","fas-trash","slot","start","aria-hidden","true"],["expand","block","fill","outline","color","danger",3,"click"],["name","fas-rotate-left","slot","start","aria-hidden","true"],["slot","start",3,"user","courseId","userId",4,"ngIf"],["slot","start",3,"user","courseId","userId"],[3,"submission","assessment","courseId","access","module","workshop"],[1,"item-heading"],[4,"ngFor","ngForOf"],[3,"submission","assessment","courseId","access","module","workshop",4,"ngIf"],[3,"assessment","courseId","module","workshop","access",4,"ngFor","ngForOf"],[3,"assessment","courseId","module","workshop","access"],[3,"formGroup"],["feedbackFormEl",""],["labelPlacement","stacked","formControlName","grade","interface","action-sheet",3,"cancelText","interfaceOptions","label"],[3,"value",4,"ngFor","ngForOf"],["position","stacked"],["name","text","contextLevel","module","elementId","feedbackauthor_editor",3,"control","autoSave","contextInstanceId","draftExtraParams"],["formControlName","published"],[3,"value"],[3,"workshop","access","assessmentId","userId","strategy","edit"],["class","item-heading",4,"ngIf"]],template:function AddonModWorkshopSubmissionPage_Template(o,e){1&o&&(v.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),v._UZ(3,"ion-back-button",1),v.ALo(4,"translate"),v.qZA(),v.TgZ(5,"ion-title")(6,"h1"),v.YNc(7,AddonModWorkshopSubmissionPage_core_format_text_7_Template,1,3,"core-format-text",2),v.qZA()(),v.TgZ(8,"ion-buttons",3),v.YNc(9,AddonModWorkshopSubmissionPage_ion_button_9_Template,4,6,"ion-button",4)(10,AddonModWorkshopSubmissionPage_ion_button_10_Template,3,3,"ion-button",4),v.qZA()()(),v.TgZ(11,"ion-content",5),v.YNc(12,AddonModWorkshopSubmissionPage_ion_refresher_12_Template,3,4,"ion-refresher",6),v.TgZ(13,"core-loading",7),v.YNc(14,AddonModWorkshopSubmissionPage_ion_list_14_Template,3,6,"ion-list",8)(15,AddonModWorkshopSubmissionPage_ion_list_15_Template,6,5,"ion-list",8)(16,AddonModWorkshopSubmissionPage_ion_list_16_Template,7,9,"ion-list",8)(17,AddonModWorkshopSubmissionPage_ion_list_17_Template,7,4,"ion-list",8)(18,AddonModWorkshopSubmissionPage_ion_list_18_Template,7,4,"ion-list",8)(19,AddonModWorkshopSubmissionPage_form_19_Template,26,30,"form",9)(20,AddonModWorkshopSubmissionPage_addon_mod_workshop_assessment_strategy_20_Template,1,6,"addon-mod-workshop-assessment-strategy",10)(21,AddonModWorkshopSubmissionPage_ion_list_21_Template,6,5,"ion-list",8),v.qZA()()),2&o&&(v.xp6(3),v.Q6J("text",v.lcZ(4,15,"core.back")),v.xp6(4),v.Q6J("ngIf",e.title),v.xp6(),v.Q6J("hidden",!e.loaded),v.xp6(),v.Q6J("ngIf",e.assessmentId&&e.access.assessingallowed),v.xp6(),v.Q6J("ngIf",e.canAddFeedback),v.xp6(2),v.Q6J("ngIf",!(e.assessmentId&&e.access.assessingallowed||e.canAddFeedback)),v.xp6(),v.Q6J("hideUntil",e.loaded),v.xp6(),v.Q6J("ngIf",e.submission),v.xp6(),v.Q6J("ngIf",!e.canAddFeedback&&(null==e.evaluate?null:e.evaluate.text)),v.xp6(),v.Q6J("ngIf",e.ownAssessment&&!e.assessment),v.xp6(),v.Q6J("ngIf",e.submissionInfo&&e.submissionInfo.reviewedby&&e.submissionInfo.reviewedby.length&&!e.assessment),v.xp6(),v.Q6J("ngIf",e.submissionInfo&&e.submissionInfo.reviewerof&&e.submissionInfo.reviewerof.length&&!e.assessment),v.xp6(),v.Q6J("ngIf",e.canAddFeedback&&e.submission),v.xp6(),v.Q6J("ngIf",e.assessmentId),v.xp6(),v.Q6J("ngIf",e.assessmentId&&!e.access.assessingallowed&&(null==e.assessment?null:e.assessment.feedbackreviewer)))},encapsulation:2}),AddonModWorkshopSubmissionPage})()}}]);