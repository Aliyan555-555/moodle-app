"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3508],{3508:(e,n,o)=>{o.r(n),o.d(n,{CoreLoginLazyModule:()=>ye});var t=o(67643),i=o(13386),r=o(49671),a=o(53564),l=o(75803),s=o(10727),c=o(69956);const g=function(){var e=(0,r.Z)((function*(){if((yield l.Tr.ignoreErrors(a.m9.getSites(),[])).length>0)return!0;const[e,n]=yield c.s.getAddSiteRouteInfo(),o=s.F0.parseUrl(e);return o.queryParams=n,o}));return function hasSitesGuard(){return e.apply(this,arguments)}}();var _=o(21161),u=o(56223),p=o(13010),d=o(43555),m=o(40067),f=o(43571),h=o(76295),C=o(63174),P=o(19212),x=o(96814),b=o(15390),O=o(29657),Z=o(22068),L=o(31903),y=o(17761),M=o(89515);const S=["resetPasswordForm"];function CoreLoginForgottenPasswordPage_core_login_exceeded_attempts_11_Template(e,n){if(1&e&&(P.TgZ(0,"core-login-exceeded-attempts",14),P.ALo(1,"translate"),P._uU(2),P.ALo(3,"translate"),P.qZA()),2&e){const e=P.oxw();P.Q6J("supportConfig",e.supportConfig)("supportSubject",P.lcZ(1,3,"core.login.exceededpasswordresetattemptssupportsubject")),P.xp6(2),P.hij(" ",P.lcZ(3,5,"core.login.exceededpasswordresetattempts")," ")}}let v=(()=>{var e;class CoreLoginForgottenPasswordPage{constructor(e){this.formBuilder=e,this.wasPasswordResetRequestedRecently=!1}ngOnInit(){var e=this;return(0,r.Z)((function*(){var n;const o=d.b.getRouteParam("siteUrl");if(!o)return p.OQ.showErrorModal("Site URL not supplied."),d.b.back(),void 0;const t=d.b.getRouteParam("siteConfig");e.site=C.C.makeUnauthenticatedSite(o,t),e.autoFocus=f.n.is("tablet"),e.myForm=e.formBuilder.group({field:["username",u.kI.required],value:[d.b.getRouteParam("username")||"",u.kI.required]}),e.supportConfig=t&&new h.W(e.site,t),e.canContactSupport=null===(n=e.supportConfig)||void 0===n?void 0:n.canContactSupport(),e.wasPasswordResetRequestedRecently=yield c.s.wasPasswordResetRequestedRecently(o)}))()}resetPassword(e){var n=this;return(0,r.Z)((function*(){e.preventDefault(),e.stopPropagation();const o=n.myForm.value.field,t=n.myForm.value.value;if(!t)return p.OQ.showErrorModal("core.login.usernameoremail",!0),void 0;const i=yield p.OQ.showModalLoading("core.sending",!0),r="email"===o;try{const e=yield c.s.requestPasswordReset(n.site.getURL(),r?"":t,r?t:"");if("dataerror"===e.status){var a;const n=null===(a=e.warnings)||void 0===a?void 0:a.find((e=>"email"===e.item&&r||"username"===e.item&&!r));n&&p.OQ.showErrorModal(n.message)}else"emailpasswordconfirmnotsent"===e.status||"emailpasswordconfirmnoemail"===e.status?p.OQ.showErrorModal(e.notice):(m.o.triggerFormSubmittedEvent(n.formElement,!0),yield p.OQ.showAlert(s.vN.instant("core.success"),e.notice),yield d.b.back(),yield c.s.passwordResetRequested(n.site.getURL()))}catch(e){p.OQ.showErrorModal(e)}finally{i.dismiss()}}))()}}return(e=CoreLoginForgottenPasswordPage).ɵfac=function CoreLoginForgottenPasswordPage_Factory(n){return new(n||e)(P.Y36(u.qu))},e.ɵcmp=P.Xpm({type:e,selectors:[["page-core-login-forgotten-password"]],viewQuery:function CoreLoginForgottenPasswordPage_Query(e,n){if(1&e&&P.Gf(S,5),2&e){let e;P.iGM(e=P.CRH())&&(n.formElement=e.first)}},decls:41,vars:31,consts:[["slot","start"],[3,"text"],[1,"list-item-limited-width"],[3,"supportConfig","supportSubject",4,"ngIf"],[1,"ion-text-wrap"],[3,"formGroup","ngSubmit"],["resetPasswordForm",""],[1,"item-heading"],["formControlName","field"],["value","username"],["value","email"],["lines","full"],["type","text","name","value","formControlName","value","autocapitalize","none","autocorrect","off",3,"placeholder","core-auto-focus"],["type","submit","expand","block",1,"ion-margin",3,"disabled"],[3,"supportConfig","supportSubject"]],template:function CoreLoginForgottenPasswordPage_Template(e,n){1&e&&(P.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),P._UZ(3,"ion-back-button",1),P.ALo(4,"translate"),P.qZA(),P.TgZ(5,"ion-title")(6,"h1"),P._uU(7),P.ALo(8,"translate"),P.qZA()()()(),P.TgZ(9,"ion-content")(10,"div",2),P.YNc(11,CoreLoginForgottenPasswordPage_core_login_exceeded_attempts_11_Template,4,7,"core-login-exceeded-attempts",3),P.TgZ(12,"ion-list")(13,"ion-item",4)(14,"ion-label"),P._uU(15),P.ALo(16,"translate"),P.qZA()()(),P.TgZ(17,"ion-card")(18,"form",5,6),P.NdJ("ngSubmit",(function CoreLoginForgottenPasswordPage_Template_form_ngSubmit_18_listener(e){return n.resetPassword(e)})),P.TgZ(20,"ion-item-divider",4)(21,"ion-label")(22,"p",7),P._uU(23),P.ALo(24,"translate"),P.qZA()()(),P.TgZ(25,"ion-radio-group",8)(26,"ion-item")(27,"ion-radio",9),P._uU(28),P.ALo(29,"translate"),P.qZA()(),P.TgZ(30,"ion-item")(31,"ion-radio",10),P._uU(32),P.ALo(33,"translate"),P.qZA()()(),P.TgZ(34,"ion-item",11),P._UZ(35,"ion-input",12),P.ALo(36,"translate"),P.ALo(37,"translate"),P.qZA(),P.TgZ(38,"ion-button",13),P._uU(39),P.ALo(40,"translate"),P.qZA()()()()()),2&e&&(P.xp6(3),P.Q6J("text",P.lcZ(4,13,"core.back")),P.xp6(4),P.Oqu(P.lcZ(8,15,"core.login.passwordforgotten")),P.xp6(4),P.Q6J("ngIf",n.canContactSupport&&n.wasPasswordResetRequestedRecently),P.xp6(4),P.Oqu(P.lcZ(16,17,"core.login.passwordforgotteninstructions2")),P.xp6(3),P.Q6J("formGroup",n.myForm),P.xp6(5),P.Oqu(P.lcZ(24,19,"core.login.searchby")),P.xp6(5),P.Oqu(P.lcZ(29,21,"core.login.username")),P.xp6(4),P.Oqu(P.lcZ(33,23,"core.user.email")),P.xp6(3),P.s9C("placeholder",P.lcZ(36,25,"core.login.usernameoremail")),P.Q6J("core-auto-focus",n.autoFocus),P.uIk("aria-label",P.lcZ(37,27,"core.login.usernameoremail")),P.xp6(3),P.Q6J("disabled",!n.myForm.valid),P.xp6(),P.hij(" ",P.lcZ(40,29,"core.courses.search")," "))},dependencies:[x.O5,b.W,O.t,Z.O,u._Y,u.JJ,u.JL,L.YG,L.Sm,L.PM,L.W2,L.Gu,L.pK,L.Ie,L.rH,L.Q$,L.q_,L.B7,L.se,L.wd,L.sr,L.U5,L.QI,L.j9,L.oU,u.sg,u.u,y.u,M.X$],encapsulation:2}),CoreLoginForgottenPasswordPage})();var w=o(63749),T=o(98370),A=o(43468),q=o(11294),k=o(66931),U=o(21525);function CoreLoginSitePolicyPage_ion_list_11_ion_card_12_Template(e,n){if(1&e&&(P.TgZ(0,"ion-card",9),P._UZ(1,"core-iframe",10),P.qZA()),2&e){const e=P.oxw(2);P.xp6(),P.Q6J("src",e.sitePolicy)}}function CoreLoginSitePolicyPage_ion_list_11_Template(e,n){if(1&e){const e=P.EpF();P.TgZ(0,"ion-list")(1,"ion-item",4)(2,"ion-label")(3,"p"),P._uU(4),P.ALo(5,"translate"),P.qZA()()(),P.TgZ(6,"ion-item",4)(7,"ion-label")(8,"p")(9,"a",5),P._uU(10),P.ALo(11,"translate"),P.qZA()()()(),P.YNc(12,CoreLoginSitePolicyPage_ion_list_11_ion_card_12_Template,2,1,"ion-card",6),P.TgZ(13,"ion-button",7),P.NdJ("click",(function CoreLoginSitePolicyPage_ion_list_11_Template_ion_button_click_13_listener(){P.CHM(e);const n=P.oxw();return P.KtG(n.accept())})),P._uU(14),P.ALo(15,"translate"),P.qZA(),P.TgZ(16,"ion-button",8),P.NdJ("click",(function CoreLoginSitePolicyPage_ion_list_11_Template_ion_button_click_16_listener(){P.CHM(e);const n=P.oxw();return P.KtG(n.cancel())})),P._uU(17),P.ALo(18,"translate"),P.qZA()()}if(2&e){const e=P.oxw();P.xp6(4),P.Oqu(P.lcZ(5,7,"core.login.policyagree")),P.xp6(5),P.Q6J("href",e.sitePolicy,P.LSH)("capture",!1),P.xp6(),P.Oqu(P.lcZ(11,9,"core.login.policyagreementclick")),P.xp6(2),P.Q6J("ngIf",e.showInline),P.xp6(2),P.hij(" ",P.lcZ(15,11,"core.login.policyacceptmandatory")," "),P.xp6(3),P.hij(" ",P.lcZ(18,13,"core.login.cancel")," ")}}let I=(()=>{var e;class CoreLoginSitePolicyPage{ngOnInit(){this.siteId=d.b.getRouteParam("siteId");try{this.currentSite=a.m9.getRequiredCurrentSite()}catch{return this.cancel(),void 0}const e=this.currentSite.id;if(this.siteId=this.siteId||e,this.siteId!=e)return this.cancel(),void 0;this.fetchSitePolicy()}fetchSitePolicy(){var e=this;return(0,r.Z)((function*(){try{e.sitePolicy=yield c.s.getSitePolicy(e.siteId)}catch(n){return p.OQ.showErrorModalDefault(n,"Error getting site policy."),e.cancel(),void 0}try{const n=yield l.Tr.getMimeTypeFromUrl(e.sitePolicy),o=w.I.getExtension(n,e.sitePolicy);e.showInline="html"==o||"htm"==o}catch{e.showInline=!1}finally{e.policyLoaded=!0}A.ke.logEvent({type:A.gM.VIEW_ITEM,ws:"auth_email_get_signup_settings",name:s.vN.instant("core.login.policyagreement"),data:{category:"policy"},url:"/user/policy.php"})}))()}cancel(){return(0,r.Z)((function*(){yield l.Tr.ignoreErrors(a.m9.logout()),yield d.b.navigate("/login/sites",{reset:!0})}))()}accept(){var e=this;return(0,r.Z)((function*(){const n=yield p.OQ.showModalLoading("core.sending",!0);try{yield c.s.acceptSitePolicy(e.siteId),yield l.Tr.ignoreErrors(e.currentSite.invalidateWsCache()),T.R.trigger(T.R.SITE_POLICY_AGREED,{},e.siteId),yield d.b.navigateToSiteHome()}catch(e){p.OQ.showErrorModalDefault(e,"Error accepting site policy.")}finally{n.dismiss()}}))()}}return(e=CoreLoginSitePolicyPage).ɵfac=function CoreLoginSitePolicyPage_Factory(n){return new(n||e)},e.ɵcmp=P.Xpm({type:e,selectors:[["page-core-login-site-policy"]],decls:12,vars:8,consts:[["slot","start"],[3,"text"],[3,"hideUntil"],[4,"ngIf"],[1,"ion-text-wrap"],["core-link","",3,"href","capture"],["class","core-site-policy-iframe-container",4,"ngIf"],["expand","block",1,"ion-text-wrap","ion-margin-horizontal",3,"click"],["expand","block","fill","outline",1,"ion-text-wrap","ion-margin-horizontal","ion-margin-bottom",3,"click"],[1,"core-site-policy-iframe-container"],[3,"src"]],template:function CoreLoginSitePolicyPage_Template(e,n){1&e&&(P.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),P._UZ(3,"ion-back-button",1),P.ALo(4,"translate"),P.qZA(),P.TgZ(5,"ion-title")(6,"h1"),P._uU(7),P.ALo(8,"translate"),P.qZA()()()(),P.TgZ(9,"ion-content")(10,"core-loading",2),P.YNc(11,CoreLoginSitePolicyPage_ion_list_11_Template,19,15,"ion-list",3),P.qZA()()),2&e&&(P.xp6(3),P.Q6J("text",P.lcZ(4,4,"core.back")),P.xp6(4),P.Oqu(P.lcZ(8,6,"core.login.policyagreement")),P.xp6(3),P.Q6J("hideUntil",n.policyLoaded),P.xp6(),P.Q6J("ngIf",n.sitePolicy))},dependencies:[x.O5,q.X,k.r,U.y,O.t,Z.O,L.YG,L.Sm,L.PM,L.W2,L.Gu,L.Ie,L.Q$,L.q_,L.wd,L.sr,L.oU,M.X$],styles:["[_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}[_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{flex-shrink:0}[_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]   .core-site-policy-iframe-container[_ngcontent-%COMP%]{height:100%}[_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]   .core-site-policy-iframe-container[_ngcontent-%COMP%]   core-iframe[_ngcontent-%COMP%]{height:100%;width:100%}"]}),CoreLoginSitePolicyPage})();var Q=o(67900),E=o(34749),J=o(35247),F=o(21365),N=o(35832),R=o(21499),G=o(93988),Y=o(34369),D=o(55544),H=o(80571),j=o(44887),B=o(86700),z=o(8947),K=o(89777);const V=["ageForm"],$=["signupFormEl"];function CoreLoginEmailSignupPage_ion_button_10_Template(e,n){if(1&e){const e=P.EpF();P.TgZ(0,"ion-button",7),P.NdJ("click",(function CoreLoginEmailSignupPage_ion_button_10_Template_ion_button_click_0_listener(){P.CHM(e);const n=P.oxw();return P.KtG(n.showAuthInstructions())})),P.ALo(1,"translate"),P._UZ(2,"ion-icon",8),P.qZA()}2&e&&P.uIk("aria-label",P.lcZ(1,1,"core.login.instructions"))}function CoreLoginEmailSignupPage_core_loading_12_ion_list_2_Template(e,n){if(1&e&&(P.TgZ(0,"ion-list",11)(1,"ion-item",12)(2,"ion-label"),P._uU(3),P.ALo(4,"translate"),P.qZA()(),P.TgZ(5,"ion-button",13),P._uU(6),P.ALo(7,"translate"),P.qZA()()),2&e){const e=P.oxw(2);P.xp6(3),P.hij(" ",P.lcZ(4,4,"core.login.signuprequiredfieldnotsupported")," "),P.xp6(2),P.Q6J("href",e.signupUrl)("showBrowserWarning",!1),P.xp6(),P.hij(" ",P.lcZ(7,6,"core.openinbrowser")," ")}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_ion_select_option_23_Template(e,n){if(1&e&&(P.TgZ(0,"ion-select-option",24),P._uU(1),P.qZA()),2&e){const e=n.$implicit;P.Q6J("value",e.code),P.xp6(),P.Oqu(e.name)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_Template(e,n){if(1&e){const e=P.EpF();P.TgZ(0,"form",15,16),P.NdJ("ngSubmit",(function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_Template_form_ngSubmit_0_listener(n){P.CHM(e);const o=P.oxw(3);return P.KtG(o.verifyAge(n))})),P.TgZ(2,"ion-item-divider",12)(3,"ion-label")(4,"h2"),P._uU(5),P.ALo(6,"translate"),P.qZA()()(),P.TgZ(7,"ion-item",12)(8,"ion-input",17)(9,"div",18),P._uU(10),P.ALo(11,"translate"),P.qZA()()(),P.TgZ(12,"ion-item",12)(13,"ion-select",19),P.ALo(14,"translate"),P.ALo(15,"translate"),P.ALo(16,"translate"),P.TgZ(17,"div",18),P._uU(18),P.ALo(19,"translate"),P.qZA(),P.TgZ(20,"ion-select-option",20),P._uU(21),P.ALo(22,"translate"),P.qZA(),P.YNc(23,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_ion_select_option_23_Template,2,2,"ion-select-option",21),P.qZA()(),P.TgZ(24,"div",11)(25,"ion-button",22),P._uU(26),P.ALo(27,"translate"),P.qZA()(),P.TgZ(28,"ion-item",12)(29,"ion-label")(30,"p",23),P._uU(31),P.ALo(32,"translate"),P.qZA(),P.TgZ(33,"p"),P._uU(34),P.ALo(35,"translate"),P.qZA()()()()}if(2&e){const e=P.oxw(3);P.Q6J("formGroup",e.ageVerificationForm),P.xp6(5),P.Oqu(P.lcZ(6,15,"core.agelocationverification")),P.xp6(4),P.Q6J("core-mark-required",!0),P.xp6(),P.Oqu(P.lcZ(11,17,"core.whatisyourage")),P.xp6(3),P.Q6J("cancelText",P.lcZ(14,19,"core.cancel"))("okText",P.lcZ(15,21,"core.ok"))("placeholder",P.lcZ(16,23,"core.login.selectacountry")),P.xp6(4),P.Q6J("core-mark-required",!0),P.xp6(),P.Oqu(P.lcZ(19,25,"core.wheredoyoulive")),P.xp6(3),P.Oqu(P.lcZ(22,27,"core.login.selectacountry")),P.xp6(2),P.Q6J("ngForOf",e.countries),P.xp6(2),P.Q6J("disabled",!e.ageVerificationForm.valid),P.xp6(),P.hij(" ",P.lcZ(27,29,"core.proceed")," "),P.xp6(5),P.Oqu(P.lcZ(32,31,"core.whyisthisrequired")),P.xp6(3),P.Oqu(P.lcZ(35,33,"core.explanationdigitalminor"))}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_4_Template(e,n){if(1&e&&(P.TgZ(0,"p",40),P._uU(1),P.qZA()),2&e){const e=P.oxw(4);P.xp6(),P.Oqu(e.site.siteUrl)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_5_Template(e,n){if(1&e&&(P.TgZ(0,"p",40),P._UZ(1,"core-format-text",41),P.qZA()),2&e){const e=P.oxw(4);P.xp6(),P.Q6J("text",e.siteName)("filter",!1)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_6_Template(e,n){if(1&e&&(P.TgZ(0,"p"),P._uU(1),P.qZA()),2&e){const e=P.oxw(4);P.xp6(),P.Oqu(e.site.siteUrl)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_26_Template(e,n){if(1&e&&(P.TgZ(0,"p",42),P._uU(1),P.qZA()),2&e){const e=P.oxw(4);P.xp6(),P.hij(" ",e.settings.passwordpolicy," ")}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ion_item_47_Template(e,n){if(1&e&&(P.TgZ(0,"ion-item",12)(1,"ion-input",43),P.ALo(2,"translate"),P.TgZ(3,"div",18),P._uU(4),P.ALo(5,"translate"),P.qZA()(),P._UZ(6,"core-input-errors",29),P.qZA()),2&e){const e=n.$implicit,o=P.oxw(4);P.xp6(),P.s9C("formControlName",e),P.Q6J("name",e)("placeholder",P.lcZ(2,7,"core.user."+e)),P.xp6(2),P.Q6J("core-mark-required",!0),P.xp6(),P.Oqu(P.lcZ(5,9,"core.user."+e)),P.xp6(2),P.Q6J("control",o.signupForm.controls[e])("errorMessages",o.namefieldsErrors[e])}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ion_select_option_61_Template(e,n){if(1&e&&(P.TgZ(0,"ion-select-option",24),P._uU(1),P.qZA()),2&e){const e=n.$implicit;P.Q6J("value",e.code),P.xp6(),P.Oqu(e.name)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_62_core_user_profile_field_5_Template(e,n){if(1&e&&P._UZ(0,"core-user-profile-field",45),2&e){const e=n.$implicit,o=P.oxw(5);P.Q6J("field",e)("edit",!0)("signup",!0)("form",o.signupForm)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_62_Template(e,n){if(1&e&&(P.ynx(0),P.TgZ(1,"ion-item-divider",12)(2,"ion-label")(3,"p",23),P._uU(4),P.qZA()()(),P.YNc(5,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_62_core_user_profile_field_5_Template,1,4,"core-user-profile-field",44),P.BQk()),2&e){const e=n.$implicit;P.xp6(4),P.Oqu(e.name),P.xp6(),P.Q6J("ngForOf",e.fields)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_63_Template(e,n){if(1&e&&(P.ynx(0),P.TgZ(1,"ion-item-divider",12)(2,"ion-label")(3,"h2",46),P._uU(4),P.ALo(5,"translate"),P.qZA()()(),P._UZ(6,"core-recaptcha",47),P.BQk()),2&e){const e=P.oxw(4);P.xp6(3),P.Q6J("core-mark-required",!0),P.xp6(),P.Oqu(P.lcZ(5,6,"core.login.security_question")),P.xp6(2),P.Q6J("publicKey",e.settings.recaptchapublickey)("model",e.captcha)("siteUrl",e.site.siteUrl)("showRequiredError",e.formSubmitClicked)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_64_Template(e,n){if(1&e&&(P.ynx(0),P.TgZ(1,"ion-item-divider",12)(2,"ion-label")(3,"h2"),P._uU(4),P.ALo(5,"translate"),P.qZA()()(),P.TgZ(6,"ion-item",12)(7,"ion-label")(8,"a",48),P._uU(9),P.ALo(10,"translate"),P.qZA()()(),P.TgZ(11,"ion-item",12)(12,"ion-checkbox",49)(13,"p",46),P._uU(14),P.ALo(15,"translate"),P.qZA()(),P._UZ(16,"core-input-errors",29),P.qZA(),P.BQk()),2&e){const e=P.oxw(4);P.xp6(4),P.Oqu(P.lcZ(5,7,"core.login.policyagreement")),P.xp6(4),P.Q6J("href",e.settings.sitepolicy,P.LSH),P.xp6(),P.hij(" ",P.lcZ(10,9,"core.login.policyagreementclick")," "),P.xp6(4),P.Q6J("core-mark-required",!0),P.xp6(),P.Oqu(P.lcZ(15,11,"core.login.policyacceptmandatory")),P.xp6(2),P.Q6J("control",e.signupForm.controls.policyagreed)("errorMessages",e.policyErrors)}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_Template(e,n){if(1&e){const e=P.EpF();P.TgZ(0,"form",15,25),P.NdJ("ngSubmit",(function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_Template_form_ngSubmit_0_listener(n){P.CHM(e);const o=P.oxw(3);return P.KtG(o.create(n))})),P.TgZ(2,"ion-item",26)(3,"ion-label"),P.YNc(4,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_4_Template,2,1,"p",27)(5,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_5_Template,2,2,"p",27)(6,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_6_Template,2,1,"p",6),P.qZA()(),P.TgZ(7,"ion-item-divider",12)(8,"ion-label")(9,"h2"),P._uU(10),P.ALo(11,"translate"),P.qZA()()(),P.TgZ(12,"ion-item",12)(13,"ion-input",28),P.ALo(14,"translate"),P.TgZ(15,"div",18),P._uU(16),P.ALo(17,"translate"),P.qZA()(),P._UZ(18,"core-input-errors",29),P.qZA(),P.TgZ(19,"ion-item",12)(20,"ion-input",30),P.ALo(21,"translate"),P.TgZ(22,"div",18),P._uU(23),P.ALo(24,"translate"),P.qZA(),P._UZ(25,"core-show-password",2),P.qZA(),P.YNc(26,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_p_26_Template,2,1,"p",31),P._UZ(27,"core-input-errors",29),P.qZA(),P.TgZ(28,"ion-item-divider",12)(29,"ion-label")(30,"h2"),P._uU(31),P.ALo(32,"translate"),P.qZA()()(),P.TgZ(33,"ion-item",12)(34,"ion-input",32),P.ALo(35,"translate"),P.TgZ(36,"div",18),P._uU(37),P.ALo(38,"translate"),P.qZA()(),P._UZ(39,"core-input-errors",29),P.qZA(),P.TgZ(40,"ion-item",12)(41,"ion-input",33),P.ALo(42,"translate"),P.TgZ(43,"div",18),P._uU(44),P.ALo(45,"translate"),P.qZA()(),P._UZ(46,"core-input-errors",29),P.qZA(),P.YNc(47,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ion_item_47_Template,7,11,"ion-item",34),P.TgZ(48,"ion-item",12),P._UZ(49,"ion-input",35),P.ALo(50,"translate"),P.ALo(51,"translate"),P.qZA(),P.TgZ(52,"ion-item",12)(53,"ion-select",36),P.ALo(54,"translate"),P.ALo(55,"translate"),P.ALo(56,"translate"),P.ALo(57,"translate"),P.TgZ(58,"ion-select-option",20),P._uU(59),P.ALo(60,"translate"),P.qZA(),P.YNc(61,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ion_select_option_61_Template,2,2,"ion-select-option",21),P.qZA()(),P.YNc(62,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_62_Template,6,2,"ng-container",37)(63,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_63_Template,7,8,"ng-container",6)(64,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_ng_container_64_Template,17,13,"ng-container",6),P.TgZ(65,"div",11)(66,"ion-button",38),P._uU(67),P.ALo(68,"translate"),P.qZA(),P._UZ(69,"input",39),P.qZA()()}if(2&e){const e=P.oxw(3);P.Q6J("formGroup",e.signupForm),P.xp6(4),P.Q6J("ngIf",!e.siteName&&e.displaySiteUrl),P.xp6(),P.Q6J("ngIf",e.siteName),P.xp6(),P.Q6J("ngIf",e.siteName&&e.displaySiteUrl),P.xp6(4),P.Oqu(P.lcZ(11,42,"core.login.createuserandpass")),P.xp6(3),P.s9C("placeholder",P.lcZ(14,44,"core.login.username")),P.xp6(2),P.Q6J("core-mark-required",!0),P.xp6(),P.Oqu(P.lcZ(17,46,"core.login.username")),P.xp6(2),P.Q6J("control",e.signupForm.controls.username)("errorMessages",e.usernameErrors),P.xp6(2),P.s9C("placeholder",P.lcZ(21,48,"core.login.password")),P.Q6J("clearOnEdit",!1),P.xp6(2),P.Q6J("core-mark-required",!0),P.xp6(),P.Oqu(P.lcZ(24,50,"core.login.password")),P.xp6(3),P.Q6J("ngIf",e.settings.passwordpolicy),P.xp6(),P.Q6J("control",e.signupForm.controls.password)("errorMessages",e.passwordErrors),P.xp6(4),P.Oqu(P.lcZ(32,52,"core.login.supplyinfo")),P.xp6(3),P.s9C("placeholder",P.lcZ(35,54,"core.user.email")),P.xp6(2),P.Q6J("core-mark-required",!0),P.xp6(),P.Oqu(P.lcZ(38,56,"core.user.email")),P.xp6(2),P.Q6J("control",e.signupForm.controls.email)("errorMessages",e.emailErrors),P.xp6(2),P.s9C("placeholder",P.lcZ(42,58,"core.user.emailagain")),P.Q6J("pattern",e.escapeMail(e.signupForm.controls.email.value)),P.xp6(2),P.Q6J("core-mark-required",!0),P.xp6(),P.Oqu(P.lcZ(45,60,"core.user.emailagain")),P.xp6(2),P.Q6J("control",e.signupForm.controls.email2)("errorMessages",e.email2Errors),P.xp6(),P.Q6J("ngForOf",e.settings.namefields),P.xp6(2),P.s9C("placeholder",P.lcZ(50,62,"core.user.city")),P.Q6J("label",P.lcZ(51,64,"core.user.city")),P.xp6(4),P.Q6J("placeholder",P.lcZ(54,66,"core.login.selectacountry"))("cancelText",P.lcZ(55,68,"core.cancel"))("okText",P.lcZ(56,70,"core.ok"))("label",P.lcZ(57,72,"core.user.country")),P.xp6(6),P.Oqu(P.lcZ(60,74,"core.login.selectacountry")),P.xp6(2),P.Q6J("ngForOf",e.countries),P.xp6(),P.Q6J("ngForOf",e.categories),P.xp6(),P.Q6J("ngIf",e.settings.recaptchapublickey),P.xp6(),P.Q6J("ngIf",e.settings.sitepolicy),P.xp6(3),P.Oqu(P.lcZ(68,76,"core.login.createaccount"))}}function CoreLoginEmailSignupPage_core_loading_12_ng_container_3_Template(e,n){if(1&e&&(P.ynx(0),P.YNc(1,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_1_Template,36,35,"form",14)(2,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_form_2_Template,70,78,"form",14),P.BQk()),2&e){const e=P.oxw(2);P.xp6(),P.Q6J("ngIf",e.ageDigitalConsentVerification),P.xp6(),P.Q6J("ngIf",!e.ageDigitalConsentVerification&&e.site)}}function CoreLoginEmailSignupPage_core_loading_12_Template(e,n){if(1&e&&(P.TgZ(0,"core-loading",9)(1,"div",5),P.YNc(2,CoreLoginEmailSignupPage_core_loading_12_ion_list_2_Template,8,8,"ion-list",10)(3,CoreLoginEmailSignupPage_core_loading_12_ng_container_3_Template,3,2,"ng-container",6),P.qZA()()),2&e){const e=P.oxw();P.Q6J("hideUntil",e.settingsLoaded),P.xp6(2),P.Q6J("ngIf",!e.allRequiredSupported),P.xp6(),P.Q6J("ngIf",e.allRequiredSupported&&e.settingsLoaded&&e.settings)}}function CoreLoginEmailSignupPage_ion_list_14_h2_3_Template(e,n){if(1&e&&(P.TgZ(0,"h2",52),P._UZ(1,"core-format-text",41),P.qZA()),2&e){const e=P.oxw(2);P.xp6(),P.Q6J("text",e.siteName)("filter",!1)}}function CoreLoginEmailSignupPage_ion_list_14_p_12_Template(e,n){if(1&e&&(P.TgZ(0,"p"),P._uU(1),P.qZA()),2&e){const e=P.oxw(2);P.xp6(),P.Oqu(e.supportName)}}function CoreLoginEmailSignupPage_ion_list_14_p_13_Template(e,n){if(1&e&&(P.TgZ(0,"p"),P._uU(1),P.qZA()),2&e){const e=P.oxw(2);P.xp6(),P.Oqu(e.supportEmail)}}function CoreLoginEmailSignupPage_ion_list_14_ion_button_15_Template(e,n){if(1&e){const e=P.EpF();P.TgZ(0,"ion-button",53),P.NdJ("click",(function CoreLoginEmailSignupPage_ion_list_14_ion_button_15_Template_ion_button_click_0_listener(){P.CHM(e);const n=P.oxw(2);return P.KtG(n.showContactOnSite())})),P._uU(1),P.ALo(2,"translate"),P.qZA()}2&e&&(P.xp6(),P.hij(" ",P.lcZ(2,1,"core.openinbrowser")," "))}function CoreLoginEmailSignupPage_ion_list_14_Template(e,n){if(1&e&&(P.TgZ(0,"ion-list")(1,"ion-item-divider",12)(2,"ion-label"),P.YNc(3,CoreLoginEmailSignupPage_ion_list_14_h2_3_Template,2,2,"h2",50),P.qZA()(),P.TgZ(4,"ion-item",12)(5,"ion-label")(6,"p",23),P._uU(7),P.ALo(8,"translate"),P.qZA(),P.TgZ(9,"p"),P._uU(10),P.ALo(11,"translate"),P.qZA(),P.YNc(12,CoreLoginEmailSignupPage_ion_list_14_p_12_Template,2,1,"p",6)(13,CoreLoginEmailSignupPage_ion_list_14_p_13_Template,2,1,"p",6),P.qZA()(),P.TgZ(14,"div",11),P.YNc(15,CoreLoginEmailSignupPage_ion_list_14_ion_button_15_Template,3,3,"ion-button",51),P.qZA()()),2&e){const e=P.oxw();P.xp6(3),P.Q6J("ngIf",e.siteName),P.xp6(4),P.Oqu(P.lcZ(8,6,"core.considereddigitalminor")),P.xp6(3),P.Oqu(P.lcZ(11,8,"core.digitalminor_desc")),P.xp6(2),P.Q6J("ngIf",e.supportName),P.xp6(),P.Q6J("ngIf",e.supportEmail),P.xp6(2),P.Q6J("ngIf",!e.supportName&&!e.supportEmail)}}let W=(()=>{var e;class CoreLoginEmailSignupPage{constructor(e,n,o){this.fb=e,this.elementRef=n,this.changeDetector=o,this.displaySiteUrl=!1,this.authInstructions="",this.settingsLoaded=!1,this.allRequiredSupported=!0,this.formSubmitClicked=!1,this.captcha={recaptcharesponse:""},this.isMinor=!1,this.ageVerificationForm=this.fb.group({age:["",u.kI.required]}),this.countryControl=this.fb.control("",{validators:u.kI.required,nonNullable:!0}),this.ageVerificationForm.addControl("country",this.countryControl),this.signupForm=this.fb.group({username:["",u.kI.required],password:["",u.kI.required],email:["",u.kI.compose([u.kI.required,u.kI.email])],email2:["",u.kI.compose([u.kI.required,u.kI.email])]}),this.usernameErrors={required:"core.login.usernamerequired"},this.passwordErrors={required:"core.login.passwordrequired"},this.emailErrors={required:"core.login.missingemail"},this.policyErrors={required:"core.login.policyagree"},this.email2Errors={required:"core.login.missingemail",pattern:"core.login.emailnotmatch"}}ngOnInit(){const e=d.b.getRouteParam("siteUrl");if(!e)return p.OQ.showErrorModal("Site URL not supplied."),d.b.back(),void 0;this.site=C.C.makeUnauthenticatedSite(e),this.displaySiteUrl=this.site.shouldDisplayInformativeLinks(),this.fetchData().finally((()=>{this.settingsLoaded=!0}))}completeFormGroup(){var e,n,o;this.signupForm.addControl("city",this.fb.control((null===(e=this.settings)||void 0===e?void 0:e.defaultcity)||"")),this.signUpCountryControl=this.fb.control((null===(n=this.settings)||void 0===n?void 0:n.country)||"",{nonNullable:!0}),this.signupForm.addControl("country",this.signUpCountryControl);for(const e in null===(t=this.settings)||void 0===t?void 0:t.namefields){var t,i;this.signupForm.addControl(null===(i=this.settings)||void 0===i?void 0:i.namefields[e],this.fb.control("",u.kI.required))}null!==(o=this.settings)&&void 0!==o&&o.sitepolicy&&this.signupForm.addControl("policyagreed",this.fb.control(!1,u.kI.requiredTrue))}fetchData(){var e=this;return(0,r.Z)((function*(){try{e.siteConfig=yield e.site.getPublicConfig(),e.signupUrl=R.O.concatenatePaths(e.siteConfig.httpswwwroot,"login/signup.php");if(yield e.treatSiteConfig()){if(void 0===e.ageDigitalConsentVerification){const n=yield l.Tr.ignoreErrors(J.Z.callAjax("core_auth_is_age_digital_consent_verification_enabled",{},{siteUrl:e.site.getURL()}));e.ageDigitalConsentVerification=!(null==n||!n.status)}yield e.getSignupSettings()}e.completeFormGroup()}catch(n){e.allRequiredSupported&&p.OQ.showErrorModal(n)}}))()}getSignupSettings(){var e=this;return(0,r.Z)((function*(){if(e.settings=yield J.Z.callAjax("auth_email_get_signup_settings",{},{siteUrl:e.site.getURL()}),F.N.hasRequiredUnsupportedField(e.settings.profilefields))throw e.allRequiredSupported=!1,new Error(s.vN.instant("core.login.signuprequiredfieldnotsupported"));e.categories=c.s.formatProfileFieldsForSignup(e.settings.profilefields),e.settings.recaptchapublickey&&(e.captcha.recaptcharesponse=""),e.countryControl.value||e.countryControl.setValue(e.settings.country||"");const n={};e.settings.namefields&&e.settings.namefields.forEach((e=>{n[e]={required:"core.login.missing"+e}})),e.namefieldsErrors=n,e.countries=yield l.Tr.getCountryListSorted()}))()}treatSiteConfig(){var e=this;return(0,r.Z)((function*(){var n;return"email"!=(null===(n=e.siteConfig)||void 0===n?void 0:n.registerauth)||e.site.isFeatureDisabled(Y.u0)?(p.OQ.showErrorModal(s.vN.instant("core.login.signupplugindisabled",{$a:s.vN.instant("core.login.auth_email")})),d.b.back(),!1):(e.siteName=yield e.site.getSiteName(),e.authInstructions=e.siteConfig.authinstructions,e.ageDigitalConsentVerification=e.siteConfig.agedigitalconsentverification,e.supportName=e.siteConfig.supportname,e.supportEmail=e.siteConfig.supportemail,e.countryControl.setValue(e.siteConfig.country||""),!0)}))()}create(e){var n=this;return(0,r.Z)((function*(){var o,t,i;if(e.preventDefault(),e.stopPropagation(),n.formSubmitClicked=!0,!n.signupForm.valid||null!==(o=n.settings)&&void 0!==o&&o.recaptchapublickey&&!n.captcha.recaptcharesponse){for(const e in n.signupForm.controls)n.signupForm.controls[e].markAsDirty();n.changeDetector.detectChanges();return(yield G.V.scrollToInputError(n.elementRef.nativeElement))||p.OQ.showErrorModal("core.errorinvalidform",!0),void 0}const r=yield p.OQ.showModalLoading("core.sending",!0),a={username:n.signupForm.value.username.trim().toLowerCase(),password:n.signupForm.value.password,firstname:E._1.cleanTags(n.signupForm.value.firstname),lastname:E._1.cleanTags(n.signupForm.value.lastname),email:n.signupForm.value.email.trim(),city:E._1.cleanTags(n.signupForm.value.city),country:n.signupForm.value.country};null!==(t=n.siteConfig)&&void 0!==t&&t.launchurl&&(a.redirect=c.s.prepareForSSOLogin(n.site.getURL(),void 0,n.siteConfig.launchurl)),null!==(i=n.settings)&&void 0!==i&&i.recaptchapublickey&&n.captcha.recaptcharesponse&&(a.recaptcharesponse=n.captcha.recaptcharesponse);try{var l;a.customprofilefields=yield F.N.getDataForFields(null===(l=n.settings)||void 0===l?void 0:l.profilefields,!0,"email",n.signupForm.value);const e=yield J.Z.callAjax("auth_email_signup_user",a,{siteUrl:n.site.getURL()});if(e.success){m.o.triggerFormSubmittedEvent(n.signupFormElement,!0);const e=s.vN.instant("core.login.emailconfirmsent",{$a:a.email});p.OQ.showAlert(s.vN.instant("core.success"),e),d.b.back()}else{var g,_;null===(g=n.recaptchaComponent)||void 0===g||g.expireRecaptchaAnswer();const o=null===(_=e.warnings)||void 0===_?void 0:_[0];if(o){let e=o.message;("incorrect-captcha-sol"==e||!e&&"recaptcharesponse"==o.item)&&(e=s.vN.instant("core.login.recaptchaincorrect")),p.OQ.showErrorModal(e)}else p.OQ.showErrorModal("core.login.usernotaddederror",!0)}}catch(e){p.OQ.showErrorModalDefault(e,"core.login.usernotaddederror",!0)}finally{r.dismiss()}}))()}escapeMail(e){return E._1.escapeForRegex(e)}showAuthInstructions(){E._1.viewText(s.vN.instant("core.login.instructions"),this.authInstructions)}showContactOnSite(){l.Tr.openInBrowser(R.O.concatenatePaths(this.site.getURL(),"/login/verify_age_location.php"),{showBrowserWarning:!1})}verifyAge(e){var n=this;return(0,r.Z)((function*(){if(e.preventDefault(),e.stopPropagation(),!n.ageVerificationForm.valid)return p.OQ.showErrorModal("core.errorinvalidform",!0),void 0;const o=yield p.OQ.showModalLoading("core.sending",!0),t=n.ageVerificationForm.value;t.age=parseInt(t.age,10);try{const e=yield J.Z.callAjax("core_auth_is_minor",t,{siteUrl:n.site.getURL()});if(m.o.triggerFormSubmittedEvent(n.ageFormElement,!0),e.status)n.isMinor=!0;else{var i;if(n.countryControl.value)null===(i=n.signUpCountryControl)||void 0===i||i.setValue(n.countryControl.value);n.ageDigitalConsentVerification=!1}}catch{p.OQ.showErrorModal("There was an error verifying your age, please try again using the browser.")}finally{o.dismiss()}}))()}}return(e=CoreLoginEmailSignupPage).ɵfac=function CoreLoginEmailSignupPage_Factory(n){return new(n||e)(P.Y36(u.qu),P.Y36(P.SBq),P.Y36(P.sBO))},e.ɵcmp=P.Xpm({type:e,selectors:[["page-core-login-email-signup"]],viewQuery:function CoreLoginEmailSignupPage_Query(e,n){if(1&e&&(P.Gf(N.u,5),P.Gf(V,5),P.Gf($,5)),2&e){let e;P.iGM(e=P.CRH())&&(n.recaptchaComponent=e.first),P.iGM(e=P.CRH())&&(n.ageFormElement=e.first),P.iGM(e=P.CRH())&&(n.signupFormElement=e.first)}},decls:15,vars:9,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click",4,"ngIf"],[3,"hideUntil",4,"ngIf"],[1,"list-item-limited-width"],[4,"ngIf"],["fill","clear",3,"click"],["slot","icon-only","name","far-circle-question","aria-hidden","true"],[3,"hideUntil"],["class","ion-padding",4,"ngIf"],[1,"ion-padding"],[1,"ion-text-wrap"],["expand","block","core-link","","autoLogin","no",3,"href","showBrowserWarning"],[3,"formGroup","ngSubmit",4,"ngIf"],[3,"formGroup","ngSubmit"],["ageForm",""],["labelPlacement","stacked","type","number","name","age","placeholder","0","formControlName","age","autocapitalize","none","autocorrect","off"],["slot","label",3,"core-mark-required"],["labelPlacement","stacked","name","country","formControlName","country",3,"cancelText","okText","placeholder"],["value",""],[3,"value",4,"ngFor","ngForOf"],["expand","block","type","submit",3,"disabled"],[1,"item-heading"],[3,"value"],["signupFormEl",""],[1,"ion-text-wrap","ion-text-center"],["class","ion-padding item-heading",4,"ngIf"],["labelPlacement","stacked","type","text","name","username","formControlName","username","autocapitalize","none","autocorrect","off",3,"placeholder"],[3,"control","errorMessages"],["labelPlacement","stacked","name","password","type","password","formControlName","password","autocomplete","new-password","required","true",3,"placeholder","clearOnEdit"],["class","core-input-footnote",4,"ngIf"],["labelPlacement","stacked","type","email","name","email","formControlName","email","autocapitalize","none","autocorrect","off",3,"placeholder"],["labelPlacement","stacked","type","email","name","email2","autocapitalize","none","formControlName","email2","autocorrect","off",3,"placeholder","pattern"],["class","ion-text-wrap",4,"ngFor","ngForOf"],["labelPlacement","stacked","type","text","name","city","formControlName","city","autocorrect","off",3,"placeholder","label"],["labelPlacement","stacked","name","country","formControlName","country",3,"placeholder","cancelText","okText","label"],[4,"ngFor","ngForOf"],["expand","block","type","submit"],["type","submit",1,"core-submit-hidden-enter"],[1,"ion-padding","item-heading"],[3,"text","filter"],[1,"core-input-footnote"],["labelPlacement","stacked","type","text","autocorrect","off",3,"name","formControlName","placeholder"],["registerAuth","email",3,"field","edit","signup","form",4,"ngFor","ngForOf"],["registerAuth","email",3,"field","edit","signup","form"],[3,"core-mark-required"],[3,"publicKey","model","siteUrl","showRequiredError"],["core-link","","capture","false",3,"href"],["labelPlacement","start","justify","space-between","name","policyagreed","formControlName","policyagreed"],["class","item-heading ion-padding",4,"ngIf"],["expand","block",3,"click",4,"ngIf"],[1,"item-heading","ion-padding"],["expand","block",3,"click"]],template:function CoreLoginEmailSignupPage_Template(e,n){1&e&&(P.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),P._UZ(3,"ion-back-button",1),P.ALo(4,"translate"),P.qZA(),P.TgZ(5,"ion-title")(6,"h1"),P._uU(7),P.ALo(8,"translate"),P.qZA()(),P.TgZ(9,"ion-buttons",2),P.YNc(10,CoreLoginEmailSignupPage_ion_button_10_Template,3,3,"ion-button",3),P.qZA()()(),P.TgZ(11,"ion-content"),P.YNc(12,CoreLoginEmailSignupPage_core_loading_12_Template,4,3,"core-loading",4),P.TgZ(13,"div",5),P.YNc(14,CoreLoginEmailSignupPage_ion_list_14_Template,16,10,"ion-list",6),P.qZA()()),2&e&&(P.xp6(3),P.Q6J("text",P.lcZ(4,5,"core.back")),P.xp6(4),P.Oqu(P.lcZ(8,7,"core.login.newaccount")),P.xp6(3),P.Q6J("ngIf",n.authInstructions),P.xp6(2),P.Q6J("ngIf",!n.isMinor),P.xp6(2),P.Q6J("ngIf",n.allRequiredSupported&&n.isMinor))},dependencies:[x.sg,x.O5,D.v,k.r,H.O,N.u,j.K,B.I,z.r,U.y,O.t,Z.O,u._Y,u.JJ,u.JL,u.Q7,u.c5,L.YG,L.Sm,L.nz,L.W2,L.Gu,L.gu,L.pK,L.Ie,L.rH,L.Q$,L.q_,L.t9,L.n0,L.wd,L.sr,L.w,L.as,L.QI,L.j9,L.oU,u.sg,u.u,K.Q,M.X$],styles:['[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]{--background: var(--core-login-background);--ion-item-background: var(--core-login-background);--color: var(--core-login-text-color)}[_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{--color: var(--core-login-text-color)}[_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   .core-oauth-icon[_ngcontent-%COMP%]{color:var(--color)}[_nghost-%COMP%]   ion-button.core-button-as-link[_ngcontent-%COMP%]{--color: var(--core-login-text-color);text-decoration-color:var(--color)}[_nghost-%COMP%]   .core-login-reconnect-warning[_ngcontent-%COMP%]{margin:0 0 32px}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]{margin-bottom:32px}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%]   .core-login-site-logo[_ngcontent-%COMP%]{width:90%;max-width:300px;margin:0 auto}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%]   .core-login-site-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:104px}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%]   .core-sitename[_ngcontent-%COMP%]{font-size:1.2rem;margin-bottom:8px}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%]   .core-siteurl[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:0}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%] + .core-login-user[_ngcontent-%COMP%]{margin-top:24px}[_nghost-%COMP%]   core-user-avatar.large-avatar[_ngcontent-%COMP%]{--core-avatar-size: var(--core-large-avatar-size)}[_nghost-%COMP%]   .core-login-fullname[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:0}[_nghost-%COMP%]   .core-login-methods[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%], [_nghost-%COMP%]   .core-login-methods[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{--background: var(--core-login-input-background);--color: var(--core-login-input-color)}[_nghost-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-left:0;margin-right:0}[_nghost-%COMP%]   .core-login-forgotten-password[_ngcontent-%COMP%]{text-decoration:underline}[_nghost-%COMP%]   .core-login-methods-separator[_ngcontent-%COMP%]{position:relative;padding:8px 0}[_nghost-%COMP%]   .core-login-methods-separator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:var(--core-login-background);padding:0 8px}[_nghost-%COMP%]   .core-login-methods-separator[_ngcontent-%COMP%]:before{height:1px;position:absolute;top:50%;left:0;right:0;border-bottom:1px solid var(--gray-300);content:"";z-index:-1}[_nghost-%COMP%]   .core-login-login-button[_ngcontent-%COMP%]{margin-top:32px}[_nghost-%COMP%]   .core-login-login-inbrowser-button[_ngcontent-%COMP%]{margin-bottom:8px}[_nghost-%COMP%]   p.core-login-inbrowser[_ngcontent-%COMP%]{font-size:12px;margin-top:8px;margin-bottom:8px}[_nghost-%COMP%]   .core-login-sign-up[_ngcontent-%COMP%]{margin-top:8px;border-top:1px solid var(--gray-300)}[_nghost-%COMP%]   .core-login-identity-providers[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], [_nghost-%COMP%]   .core-login-sign-up[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:8px;font-size:16px}html.dark[_nghost-%COMP%]   core-loading[_ngcontent-%COMP%], html.dark   [_nghost-%COMP%]   core-loading[_ngcontent-%COMP%]{--loading-background: var(--core-login-background-dark);--loading-text-color: #ffffff;--loading-spinner: #ffffff}']}),CoreLoginEmailSignupPage})();var X=o(29540),ee=o(81370),ne=o(5973),oe=o(31381),te=o(18005),ie=o(46411),re=o(857),ae=o(22416),le=o(51071),se=o(64310),ce=o(54151),ge=o(70955),_e=o(88411),ue=o(89231),pe=o(55951);let de=(()=>{var e;class CoreReferrerService{consumeInstallReferrerUrl(){return(0,r.Z)((function*(){const e=pe.Y.plugin("installReferrer");if(!e)return;if(!(yield ne.b.get(CoreReferrerService.INSTALL_REFERRER_CONSUMED,0)))try{var n;const o=(null!==(n=(yield e.getReferrer()).referrer)&&void 0!==n?n:"").match(/siteurl=([^&]+)/);return null==o?void 0:o[1]}catch{}finally{yield ne.b.set(CoreReferrerService.INSTALL_REFERRER_CONSUMED,1)}}))()}}return(e=CoreReferrerService).INSTALL_REFERRER_CONSUMED="install_referrer_consumed",e.ɵfac=function CoreReferrerService_Factory(n){return new(n||e)},e.ɵprov=P.Yz7({token:e,factory:e.ɵfac,providedIn:"root"}),CoreReferrerService})();const me=(0,s.Es)(de),fe=["siteFormEl"];function CoreLoginSitePage_form_17_ng_container_2_Template(e,n){if(1&e&&(P.ynx(0),P.TgZ(1,"ion-item",15),P._UZ(2,"ion-input",16),P.ALo(3,"translate"),P.ALo(4,"translate"),P.qZA(),P.BQk()),2&e){const e=P.oxw(2);P.xp6(2),P.s9C("placeholder",P.lcZ(3,4,"core.login.siteaddressplaceholder")),P.Q6J("core-auto-focus",e.showKeyboard&&!e.showScanQR)("label",P.lcZ(4,6,"core.login.siteaddress"))("clearInput",!0)}}function CoreLoginSitePage_form_17_ng_container_3_ion_item_11_Template(e,n){if(1&e){const e=P.EpF();P.TgZ(0,"ion-item",26),P.NdJ("click",(function CoreLoginSitePage_form_17_ng_container_3_ion_item_11_Template_ion_item_click_0_listener(n){P.CHM(e);const o=P.oxw(3);return P.KtG(o.connect(o.enteredSiteUrl.url,n))})),P.ALo(1,"translate"),P.TgZ(2,"ion-thumbnail",27),P._UZ(3,"ion-icon",28),P.qZA(),P.TgZ(4,"ion-label")(5,"h2",29),P._uU(6),P.ALo(7,"translate"),P.qZA(),P.TgZ(8,"p"),P._uU(9),P.qZA()()()}if(2&e){const e=P.oxw(3);P.Q6J("detail",!0),P.uIk("aria-label",P.lcZ(1,4,"core.login.connect")),P.xp6(6),P.Oqu(P.lcZ(7,6,"core.login.yourenteredsite")),P.xp6(3),P.Oqu(e.enteredSiteUrl.noProtocolUrl)}}function CoreLoginSitePage_form_17_ng_container_3_div_13_Template(e,n){1&e&&(P.TgZ(0,"div",30),P._UZ(1,"ion-spinner"),P.ALo(2,"translate"),P.qZA()),2&e&&(P.xp6(),P.uIk("aria-label",P.lcZ(2,1,"core.loading")))}function CoreLoginSitePage_form_17_ng_container_3_ng_container_14_ng_container_1_Template(e,n){1&e&&P.GkF(0)}const site_c1=e=>({site:e});function CoreLoginSitePage_form_17_ng_container_3_ng_container_14_Template(e,n){if(1&e&&(P.ynx(0),P.YNc(1,CoreLoginSitePage_form_17_ng_container_3_ng_container_14_ng_container_1_Template,1,0,"ng-container",31),P.BQk()),2&e){const e=n.$implicit;P.oxw(3);const o=P.MAs(24);P.xp6(),P.Q6J("ngTemplateOutlet",o)("ngTemplateOutletContext",P.VKq(2,site_c1,e))}}function CoreLoginSitePage_form_17_ng_container_3_div_15_Template(e,n){1&e&&(P.TgZ(0,"div",32),P._UZ(1,"ion-spinner"),P.ALo(2,"translate"),P.qZA()),2&e&&(P.xp6(),P.uIk("aria-label",P.lcZ(2,1,"core.loading")))}function CoreLoginSitePage_form_17_ng_container_3_Template(e,n){if(1&e){const e=P.EpF();P.ynx(0),P.TgZ(1,"ion-item",15)(2,"ion-input",17),P.NdJ("ionInput",(function CoreLoginSitePage_form_17_ng_container_3_Template_ion_input_ionInput_2_listener(n){P.CHM(e);const o=P.oxw(2);return P.KtG(o.searchSite(n,o.siteForm.value.siteUrl))})),P.ALo(3,"translate"),P.ALo(4,"translate"),P.qZA()(),P.TgZ(5,"ion-list",18)(6,"ion-item",19)(7,"ion-label")(8,"h2",20),P._uU(9),P.ALo(10,"translate"),P.qZA()()(),P.YNc(11,CoreLoginSitePage_form_17_ng_container_3_ion_item_11_Template,10,8,"ion-item",21),P.TgZ(12,"div",22),P.YNc(13,CoreLoginSitePage_form_17_ng_container_3_div_13_Template,3,3,"div",23)(14,CoreLoginSitePage_form_17_ng_container_3_ng_container_14_Template,2,4,"ng-container",24),P.qZA()(),P.YNc(15,CoreLoginSitePage_form_17_ng_container_3_div_15_Template,3,3,"div",25),P.BQk()}if(2&e){const e=P.oxw(2);P.xp6(2),P.s9C("placeholder",P.lcZ(3,15,"core.login.siteaddressplaceholder")),P.Q6J("core-auto-focus",e.showKeyboard&&!e.showScanQR)("label",P.lcZ(4,17,"core.login.siteaddress"))("clearInput",!0),P.xp6(3),P.ekj("hidden",!e.hasSites&&!e.enteredSiteUrl),P.xp6(4),P.Oqu(P.lcZ(10,19,"core.login.selectsite")),P.xp6(2),P.Q6J("ngIf",e.enteredSiteUrl),P.xp6(),P.ekj("hidden",!e.hasSites)("dimmed",e.loadingSites),P.xp6(),P.Q6J("ngIf",e.loadingSites),P.xp6(),P.Q6J("ngForOf",e.sites),P.xp6(),P.Q6J("ngIf",!e.hasSites&&e.loadingSites)}}function CoreLoginSitePage_form_17_ion_item_4_Template(e,n){if(1&e&&(P.TgZ(0,"ion-item")(1,"ion-label")(2,"ion-button",33),P._uU(3),P.ALo(4,"translate"),P.qZA()()()),2&e){const e=P.oxw(2);P.xp6(2),P.Q6J("disabled",!e.siteForm.valid),P.xp6(),P.hij(" ",P.lcZ(4,2,"core.login.connect")," ")}}function CoreLoginSitePage_form_17_Template(e,n){if(1&e){const e=P.EpF();P.TgZ(0,"form",13,14),P.NdJ("ngSubmit",(function CoreLoginSitePage_form_17_Template_form_ngSubmit_0_listener(n){P.CHM(e);const o=P.oxw();return P.KtG(o.connect(o.siteForm.value.siteUrl,n))})),P.YNc(2,CoreLoginSitePage_form_17_ng_container_2_Template,5,8,"ng-container",10)(3,CoreLoginSitePage_form_17_ng_container_3_Template,16,21,"ng-container",10)(4,CoreLoginSitePage_form_17_ion_item_4_Template,5,4,"ion-item",10),P.qZA()}if(2&e){const e=P.oxw();P.Q6J("formGroup",e.siteForm),P.xp6(2),P.Q6J("ngIf","url"===e.siteSelector),P.xp6(),P.Q6J("ngIf","url"!==e.siteSelector),P.xp6(),P.Q6J("ngIf","url"===e.siteSelector)}}function CoreLoginSitePage_ng_container_18_ion_list_1_ion_searchbar_6_Template(e,n){if(1&e){const e=P.EpF();P.TgZ(0,"ion-searchbar",35),P.NdJ("ngModelChange",(function CoreLoginSitePage_ng_container_18_ion_list_1_ion_searchbar_6_Template_ion_searchbar_ngModelChange_0_listener(n){P.CHM(e);const o=P.oxw(3);return P.KtG(o.filter=n)}))("ionInput",(function CoreLoginSitePage_ng_container_18_ion_list_1_ion_searchbar_6_Template_ion_searchbar_ionInput_0_listener(n){P.CHM(e);const o=P.oxw(3);return P.KtG(o.filterChanged(n))}))("ionCancel",(function CoreLoginSitePage_ng_container_18_ion_list_1_ion_searchbar_6_Template_ion_searchbar_ionCancel_0_listener(){P.CHM(e);const n=P.oxw(3);return P.KtG(n.filterChanged())})),P.ALo(1,"translate"),P.qZA()}if(2&e){const e=P.oxw(3);P.Q6J("ngModel",e.filter)("placeholder",P.lcZ(1,2,"core.login.findyoursite"))}}function CoreLoginSitePage_ng_container_18_ion_list_1_ng_container_7_ng_container_1_Template(e,n){1&e&&P.GkF(0)}function CoreLoginSitePage_ng_container_18_ion_list_1_ng_container_7_Template(e,n){if(1&e&&(P.ynx(0),P.YNc(1,CoreLoginSitePage_ng_container_18_ion_list_1_ng_container_7_ng_container_1_Template,1,0,"ng-container",31),P.BQk()),2&e){const e=n.$implicit;P.oxw(3);const o=P.MAs(24);P.xp6(),P.Q6J("ngTemplateOutlet",o)("ngTemplateOutletContext",P.VKq(2,site_c1,e))}}function CoreLoginSitePage_ng_container_18_ion_list_1_Template(e,n){if(1&e&&(P.TgZ(0,"ion-list")(1,"ion-item")(2,"ion-label")(3,"h2",20),P._uU(4),P.ALo(5,"translate"),P.qZA()()(),P.YNc(6,CoreLoginSitePage_ng_container_18_ion_list_1_ion_searchbar_6_Template,2,4,"ion-searchbar",34)(7,CoreLoginSitePage_ng_container_18_ion_list_1_ng_container_7_Template,2,4,"ng-container",24),P.qZA()),2&e){const e=P.oxw(2);P.xp6(4),P.Oqu(P.lcZ(5,3,"core.login.selectsite")),P.xp6(2),P.Q6J("ngIf",e.fixedSites.length>4),P.xp6(),P.Q6J("ngForOf",e.filteredSites)}}function CoreLoginSitePage_ng_container_18_Template(e,n){if(1&e&&(P.ynx(0),P.YNc(1,CoreLoginSitePage_ng_container_18_ion_list_1_Template,8,5,"ion-list",10),P.BQk()),2&e){const e=P.oxw();P.xp6(),P.Q6J("ngIf","list"===e.siteSelector)}}function CoreLoginSitePage_ng_container_19_Template(e,n){if(1&e){const e=P.EpF();P.ynx(0),P.TgZ(1,"div",36),P._uU(2),P.ALo(3,"translate"),P.qZA(),P.TgZ(4,"ion-button",37),P.NdJ("click",(function CoreLoginSitePage_ng_container_19_Template_ion_button_click_4_listener(){P.CHM(e);const n=P.oxw();return P.KtG(n.showInstructionsAndScanQR())})),P._UZ(5,"ion-icon",38),P._uU(6),P.ALo(7,"translate"),P.qZA(),P.BQk()}2&e&&(P.xp6(2),P.hij("",P.lcZ(3,2,"core.login.or")," "),P.xp6(4),P.hij(" ",P.lcZ(7,4,"core.scanqr")," "))}function CoreLoginSitePage_ng_template_23_ion_thumbnail_1_img_1_Template(e,n){if(1&e&&P._UZ(0,"img",44),2&e){const e=P.oxw(2).site;P.Q6J("src",e.imageurl,P.LSH)}}function CoreLoginSitePage_ng_template_23_ion_thumbnail_1_img_2_Template(e,n){1&e&&P._UZ(0,"img",45)}function CoreLoginSitePage_ng_template_23_ion_thumbnail_1_Template(e,n){if(1&e&&(P.TgZ(0,"ion-thumbnail",0),P.YNc(1,CoreLoginSitePage_ng_template_23_ion_thumbnail_1_img_1_Template,1,1,"img",42)(2,CoreLoginSitePage_ng_template_23_ion_thumbnail_1_img_2_Template,1,0,"img",43),P.qZA()),2&e){const e=P.oxw().site;P.xp6(),P.Q6J("ngIf",e.imageurl),P.xp6(),P.Q6J("ngIf",!e.imageurl)}}function CoreLoginSitePage_ng_template_23_p_3_Template(e,n){if(1&e&&(P.TgZ(0,"p",46),P._uU(1),P.qZA()),2&e){const e=P.oxw().site;P.xp6(),P.Oqu(e.title)}}function CoreLoginSitePage_ng_template_23_p_4_Template(e,n){if(1&e&&(P.TgZ(0,"p"),P._uU(1),P.qZA()),2&e){const e=P.oxw().site;P.xp6(),P.Oqu(e.noProtocolUrl)}}function CoreLoginSitePage_ng_template_23_p_5_Template(e,n){if(1&e&&(P.TgZ(0,"p"),P._uU(1),P.qZA()),2&e){const e=P.oxw().site;P.xp6(),P.Oqu(e.location)}}function CoreLoginSitePage_ng_template_23_Template(e,n){if(1&e){const e=P.EpF();P.TgZ(0,"ion-item",39),P.NdJ("click",(function CoreLoginSitePage_ng_template_23_Template_ion_item_click_0_listener(n){const o=P.CHM(e).site,t=P.oxw();return P.KtG(t.connect(o.url,n))})),P.YNc(1,CoreLoginSitePage_ng_template_23_ion_thumbnail_1_Template,3,2,"ion-thumbnail",40),P.TgZ(2,"ion-label"),P.YNc(3,CoreLoginSitePage_ng_template_23_p_3_Template,2,1,"p",41)(4,CoreLoginSitePage_ng_template_23_p_4_Template,2,1,"p",10)(5,CoreLoginSitePage_ng_template_23_p_5_Template,2,1,"p",10),P.qZA()()}if(2&e){const e=n.site,o=P.oxw();P.Q6J("ngClass",e.className)("detail",!0),P.uIk("aria-label",e.name),P.xp6(),P.Q6J("ngIf",o.siteFinderSettings.displayimage),P.xp6(2),P.Q6J("ngIf",e.title),P.xp6(),P.Q6J("ngIf",o.displaySiteUrl(e.siteUrl)),P.xp6(),P.Q6J("ngIf",e.location)}}let he=(()=>{var e;class CoreLoginSitePage{constructor(e){this.formBuilder=e,this.siteSelector="sitefinder",this.showKeyboard=!1,this.filter="",this.sites=[],this.hasSites=!1,this.loadingSites=!1}ngOnInit(){var e=this;return(0,r.Z)((function*(){let n="";e.siteSelector=te.i.CONFIG.multisitesdisplay;e.siteFinderSettings={displaysitename:!0,displayimage:!0,displayalias:!0,displaycity:!0,displaycountry:!0,displayurl:!0,...te.i.CONFIG.sitefindersettings||{}};if((yield c.s.getAvailableSites()).length)n=yield e.initSiteSelector();else{var o;n=null!==(o=yield e.consumeInstallReferrerUrl())&&void 0!==o?o:"";const t=te.i.CONFIG.enableonboarding&&!f.n.isIOS();n?(e.connect(n),t&&ne.b.set(Y.Jx,1)):t&&e.initOnboarding()}e.showScanQR=c.s.displayQRInSiteScreen(),e.siteForm=e.formBuilder.group({siteUrl:[n,e.moodleUrlValidator()]}),e.searchFunction=l.Tr.debounce(function(){var n=(0,r.Z)((function*(n){if((n=n.trim()).length>=3){const o=yield a.m9.findSites(n);e.sites=e.extendCoreLoginSiteInfo(o),e.hasSites=!!e.sites.length}else e.hasSites=!1;e.loadingSites=!1}));return function(e){return n.apply(this,arguments)}}(),1e3),e.showKeyboard=!!d.b.getRouteBooleanParam("showKeyboard")}))()}initSiteSelector(){var e=this;return(0,r.Z)((function*(){const n=yield c.s.getAvailableSites();return e.fixedSites=e.extendCoreLoginSiteInfo(n),e.siteSelector="list",e.fixedSites.some((e=>!!e.imageurl))||(e.siteFinderSettings.displayimage=!1),e.filteredSites=e.fixedSites,e.fixedSites[0].url}))()}consumeInstallReferrerUrl(){return(0,r.Z)((function*(){const e=yield l.Tr.ignoreErrors(l.Tr.timeoutPromise(me.consumeInstallReferrerUrl(),1e3));if(!e)return;return(yield l.Tr.ignoreErrors(a.m9.getSites(),[])).length>0?void 0:e}))()}initOnboarding(){var e=this;return(0,r.Z)((function*(){(yield ne.b.get(Y.Jx,!1))||e.showOnboarding()}))()}extendCoreLoginSiteInfo(e){return e.map((e=>{e.noProtocolUrl=this.siteFinderSettings.displayurl&&e.url?ie.u.removeProtocol(e.url):"";const n=this.siteFinderSettings.displaysitename?e.name:"",o=this.siteFinderSettings.displayalias&&e.alias?e.alias:"";e.title=n&&o?n+" ("+o+")":n+o;const t=this.siteFinderSettings.displaycountry&&e.countrycode?l.Tr.getCountryName(e.countrycode):"",i=this.siteFinderSettings.displaycity&&e.city?e.city:"";return e.location=i&&t?i+" - "+t:i+t,a.m9.hasDefaultImage(e)&&this.siteFinderSettings.defaultimageurl&&(e.imageurl=this.siteFinderSettings.defaultimageurl),e}))}moodleUrlValidator(){return e=>{const n=e.value.trim();let o=n.length>=3&&ie.u.isValidMoodleUrl(n);if(!o){!!a.m9.getDemoSiteData(n)&&(o=!0)}return o?null:{siteUrl:{value:e.value}}}}showHelp(){return(0,r.Z)((function*(){yield p.OQ.openModal({component:ae.Y,cssClass:"core-modal-fullscreen"})}))()}showOnboarding(){return(0,r.Z)((function*(){yield p.OQ.openModal({component:le.z,cssClass:"core-modal-fullscreen"})}))()}connect(e,n){var o=this;return(0,r.Z)((function*(){if(null==n||n.preventDefault(),null==n||n.stopPropagation(),X.z.closeKeyboard(),!e)return p.OQ.showErrorModal("core.login.siteurlrequired",!0),void 0;if(!ee.AS.isOnline())return p.OQ.showErrorModal("core.networkerrormsg",!0),void 0;if((e=e.trim()).match(/^(https?:\/\/)?campus\.example\.edu/))return o.showLoginIssue(null,new oe.G(s.vN.instant("core.login.errorexampleurl"))),void 0;const t=a.m9.getDemoSiteData(e);if(t)yield o.loginDemoSite(t);else{const n=yield p.OQ.showModalLoading();let t;try{t=yield a.m9.checkSite(e)}catch(i){const r=ie.u.guessMoodleDomain(e);if(!r||r==e)return n.dismiss(),o.showLoginIssue(e,i);try{t=yield a.m9.checkSite(r)}catch(t){return n.dismiss(),o.showLoginIssue(e,i||t)}}yield o.login(t),n.dismiss()}}))()}loginDemoSite(e){var n=this;return(0,r.Z)((function*(){const o=yield p.OQ.showModalLoading();try{const o=yield a.m9.getUserToken(e.url,e.username,e.password);return yield a.m9.newSite(o.siteUrl,o.token,o.privateToken),m.o.triggerFormSubmittedEvent(n.formElement,!0),yield d.b.navigateToSiteHome(),void 0}catch(n){c.s.treatUserTokenError(e.url,n,e.username,e.password),n.loggedout&&d.b.navigate("/login/sites",{reset:!0})}finally{o.dismiss()}}))()}login(e){var n=this;return(0,r.Z)((function*(){try{yield a.m9.checkApplication(e.config),m.o.triggerFormSubmittedEvent(n.formElement,!0),d.b.navigate("/login/credentials",{params:{siteCheck:e}})}catch{}}))()}showLoginIssue(e,n){var o=this;return(0,r.Z)((function*(){var e,t;let i,r,a,l,c=p.OQ.getErrorMessage(n),g=!1;n instanceof ce.P&&(i=n.supportConfig,a=n.errorDetails,l=n.errorcode,g=i instanceof h.W),n instanceof ue.o&&(r=n.title),a&&(c=`<p>${c}</p><div class="core-error-info-container"></div>`);const _=i,u=[{text:s.vN.instant("core.tryagain"),role:"cancel"},null!=_&&_.canContactSupport()?{text:s.vN.instant("core.contactsupport"),handler:()=>ge.O.contact({supportConfig:_,subject:s.vN.instant("core.cannotconnect"),message:`Error: ${l}\n\n${a}`})}:g?null:{text:s.vN.instant("core.needhelp"),cssClass:"core-login-need-help",handler:()=>o.showHelp()}].filter((e=>!!e)),d=yield p.OQ.showAlertWithOptions({header:null!==(e=r)&&void 0!==e?e:s.vN.instant("core.cannotconnect"),message:null!==(t=c)&&void 0!==t?t:s.vN.instant("core.sitenotfoundhelp"),buttons:u});if(a){const e=d.querySelector(".core-error-info-container");e&&(e.innerHTML=_e.B.render(a,l))}}))()}filterChanged(e){var n;const o=null==e||null===(n=e.target.value)||void 0===n?void 0:n.trim().toLowerCase();this.filteredSites=o&&this.fixedSites?this.fixedSites.filter((e=>e.title.toLowerCase().indexOf(o)>-1||e.noProtocolUrl.toLowerCase().indexOf(o)>-1||e.location.toLowerCase().indexOf(o)>-1)):this.fixedSites}searchSite(e,n){this.loadingSites=!0,n=n.trim(),this.enteredSiteUrl=this.siteForm.valid&&n.length>=3?{url:n,name:"connect",title:"",location:"",noProtocolUrl:ie.u.removeProtocol(n)}:void 0,this.searchFunction(n.trim())}showInstructionsAndScanQR(){var e=this;return(0,r.Z)((function*(){try{yield c.s.showScanQRInstructions(),yield e.scanQR()}catch{}}))()}scanQR(){var e=this;return(0,r.Z)((function*(){const n=yield l.Tr.scanQR();if(!n)return;if(se.us.isCustomURL(n)){try{yield se.us.handleCustomURL(n)}catch(o){o&&o.data&&o.data.isAuthenticationURL&&o.data.siteUrl?e.treatErrorInAuthenticationCustomURL(n,o):se.us.treatHandleCustomURLError(o)}return}const o=re.T.getUrlProtocol(n);if(o&&"http"!=o&&"https"!=o)return p.OQ.showErrorModal(s.vN.instant("core.errorurlschemeinvalidscheme",{$a:n})),void 0;(yield c.s.isSiteUrlAllowed(n))?(e.siteForm.controls.siteUrl.setValue(n),e.connect(n)):p.OQ.showErrorModal("core.errorurlschemeinvalidsite",!0)}))()}treatErrorInAuthenticationCustomURL(e,n){var o=this;return(0,r.Z)((function*(){var e;const t=(null===(e=n.data)||void 0===e?void 0:e.siteUrl)||"",i=yield p.OQ.showModalLoading();o.siteForm.controls.siteUrl.setValue(t);try{const e=yield a.m9.checkSite(t);yield a.m9.checkApplication(e.config),c.s.isSSOLoginNeeded(e.code)||(yield d.b.navigate("/login/credentials",{params:{siteCheck:e}}))}catch{}finally{i.dismiss()}n.error=E._1.addTextToError(n.error,"<br><br>"+s.vN.instant("core.login.youcanstillconnectwithcredentials")),se.us.treatHandleCustomURLError(n)}))()}openSettings(){d.b.navigate("/settings")}displaySiteUrl(e){return C.C.makeUnauthenticatedSite(e).shouldDisplayInformativeLinks()}}return(e=CoreLoginSitePage).ɵfac=function CoreLoginSitePage_Factory(n){return new(n||e)(P.Y36(u.qu))},e.ɵcmp=P.Xpm({type:e,selectors:[["page-core-login-site"]],viewQuery:function CoreLoginSitePage_Query(e,n){if(1&e&&P.Gf(fe,5),2&e){let e;P.iGM(e=P.CRH())&&(n.formElement=e.first)}},decls:25,vars:17,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click"],["slot","icon-only","name","fas-gear","aria-hidden","true"],[1,"ion-padding"],[1,"list-item-limited-width"],[1,"ion-text-center","ion-padding","ion-margin-bottom","core-login-site-logo"],["src","assets/img/login_logo.png","role","presentation","alt","",1,"avatar-full","login-logo"],[3,"formGroup","ngSubmit",4,"ngIf"],[4,"ngIf"],["aria-haspopup","dialog","expand","block","fill","clear",1,"ion-margin-top","core-login-need-help","core-button-as-link","ion-text-wrap",3,"click"],["sitelisting",""],[3,"formGroup","ngSubmit"],["siteFormEl",""],["lines","inset"],["name","url","type","url","formControlName","siteUrl","labelPlacement","stacked",3,"placeholder","core-auto-focus","label","clearInput"],["name","url","formControlName","siteUrl","labelPlacement","stacked",3,"placeholder","core-auto-focus","label","clearInput","ionInput"],[1,"core-login-site-list"],[1,"core-login-site-list-title"],[1,"item-heading"],["button","","class","core-login-entered-site",3,"detail","click",4,"ngIf"],[1,"core-login-site-list-found"],["class","core-login-site-list-loading",4,"ngIf"],[4,"ngFor","ngForOf"],["class","core-login-site-nolist-loading",4,"ngIf"],["button","",1,"core-login-entered-site",3,"detail","click"],["slot","start","aria-hidden","true"],["name","fas-pen","aria-hidden","true"],[1,"ion-text-wrap"],[1,"core-login-site-list-loading"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"core-login-site-nolist-loading"],["expand","block","type","submit",1,"ion-text-wrap",3,"disabled"],[3,"ngModel","placeholder","ngModelChange","ionInput","ionCancel",4,"ngIf"],[3,"ngModel","placeholder","ngModelChange","ionInput","ionCancel"],[1,"ion-text-center","ion-padding","ion-margin-top","core-login-site-qrcode-separator"],["expand","block","fill","outline","aria-haspopup","dialog",1,"ion-margin","core-login-site-qrcode",3,"click"],["slot","start","name","fas-qrcode","aria-hidden","true"],["button","",3,"ngClass","detail","click"],["slot","start",4,"ngIf"],["class","item-heading ion-text-wrap",4,"ngIf"],["onError","this.src='assets/icon/icon.png'","alt","","role","presentation",3,"src",4,"ngIf"],["src","assets/icon/icon.png","class","core-login-default-icon","alt","","role","presentation",4,"ngIf"],["onError","this.src='assets/icon/icon.png'","alt","","role","presentation",3,"src"],["src","assets/icon/icon.png","alt","","role","presentation",1,"core-login-default-icon"],[1,"item-heading","ion-text-wrap"]],template:function CoreLoginSitePage_Template(e,n){1&e&&(P.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),P._UZ(3,"ion-back-button",1),P.ALo(4,"translate"),P.qZA(),P.TgZ(5,"ion-title")(6,"h1"),P._uU(7),P.ALo(8,"translate"),P.qZA()(),P.TgZ(9,"ion-buttons",2)(10,"ion-button",3),P.NdJ("click",(function CoreLoginSitePage_Template_ion_button_click_10_listener(){return n.openSettings()})),P.ALo(11,"translate"),P._UZ(12,"ion-icon",4),P.qZA()()()(),P.TgZ(13,"ion-content",5)(14,"div",6)(15,"div",7),P._UZ(16,"img",8),P.qZA(),P.YNc(17,CoreLoginSitePage_form_17_Template,5,4,"form",9)(18,CoreLoginSitePage_ng_container_18_Template,2,1,"ng-container",10)(19,CoreLoginSitePage_ng_container_19_Template,8,6,"ng-container",10),P.TgZ(20,"ion-button",11),P.NdJ("click",(function CoreLoginSitePage_Template_ion_button_click_20_listener(){return n.showHelp()})),P._uU(21),P.ALo(22,"translate"),P.qZA()()(),P.YNc(23,CoreLoginSitePage_ng_template_23_Template,6,7,"ng-template",null,12,P.W1O)),2&e&&(P.xp6(3),P.Q6J("text",P.lcZ(4,9,"core.back")),P.xp6(4),P.Oqu(P.lcZ(8,11,"core.login.connecttomoodle")),P.xp6(3),P.uIk("aria-label",P.lcZ(11,13,"core.settings.appsettings")),P.xp6(5),P.ekj("hidden",n.hasSites||n.enteredSiteUrl),P.xp6(2),P.Q6J("ngIf",!n.fixedSites&&n.siteForm),P.xp6(),P.Q6J("ngIf",n.fixedSites),P.xp6(),P.Q6J("ngIf",n.showScanQR&&!n.hasSites&&!n.enteredSiteUrl),P.xp6(2),P.hij(" ",P.lcZ(22,15,"core.needhelp")," "))},dependencies:[x.mk,x.sg,x.O5,x.tP,b.W,B.I,O.t,Z.O,u._Y,u.JJ,u.JL,u.On,L.YG,L.Sm,L.W2,L.Gu,L.gu,L.pK,L.Ie,L.Q$,L.q_,L.VI,L.PQ,L.Bs,L.wd,L.sr,L.j9,L.oU,u.sg,u.u,M.X$],styles:["[_nghost-%COMP%]{--list-item-max-width: 600px}.item-input[_ngcontent-%COMP%]:last-child{margin-bottom:20px}.core-login-site-connect[_ngcontent-%COMP%]{margin-top:1.4rem}.item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]{min-width:50px;min-height:50px;width:50px;height:50px;border-radius:20%;box-shadow:0 0 4px var(--gray-200);text-align:center;overflow:hidden}.item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:50px;max-width:fit-content;width:auto;height:auto;margin:0 auto 0 50%;transform:translate3d(-50%,0,0);object-fit:cover;object-position:50% 50%}[dir=rtl][_nghost-%COMP%]   .item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   .item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{transform:translate3d(50%,0,0)}[dir=rtl][_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{transform:translate3d(50%,0,0)}@supports selector(:dir(rtl)){.item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]:dir(rtl){transform:translate3d(50%,0,0)}}.item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin:0 auto;font-size:35px;height:50px}[dir=rtl][_nghost-%COMP%]   .item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   .item[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin-left:0;margin-right:50%}.core-login-site-logo[_ngcontent-%COMP%], .core-login-site-list[_ngcontent-%COMP%], .core-login-site-list-found[_ngcontent-%COMP%]{transition-delay:0s;visibility:visible;opacity:1;transition:all .7s ease-in-out;max-height:9999px}.core-login-site-logo.hidden[_ngcontent-%COMP%], .core-login-site-list.hidden[_ngcontent-%COMP%], .core-login-site-list-found.hidden[_ngcontent-%COMP%]{opacity:0;visibility:hidden;margin-top:0;margin-bottom:0;padding:0;max-height:0}.core-login-site-list-found.dimmed[_ngcontent-%COMP%]{pointer-events:none;position:relative}.core-login-site-list-loading[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;left:0;right:0;width:100%;height:100%;display:flex;align-content:center;align-items:center;background-color:#ffffff80;z-index:1}.core-login-site-list-loading[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{margin:0 auto}.core-login-site-nolist-loading[_ngcontent-%COMP%]{margin-top:16px;text-align:center}.item.core-login-site-list-title[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], .item.core-login-site-list-title[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2.item-heading[_ngcontent-%COMP%]{margin-top:0}@media (min-width: 768px){ion-content[_ngcontent-%COMP%]   .core-login-site-logo[_ngcontent-%COMP%]{margin-top:20%}ion-content[_ngcontent-%COMP%]   .core-login-site-logo.hidden[_ngcontent-%COMP%]{margin-top:0}}.core-login-entered-site[_ngcontent-%COMP%]{background-color:var(--light)}.core-login-entered-site[_ngcontent-%COMP%]   ion-thumbnail[_ngcontent-%COMP%]{box-shadow:0 0 4px var(--gray-300)}.core-login-default-icon[_ngcontent-%COMP%]{filter:grayscale(100%)}",'[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-list[_ngcontent-%COMP%]{--background: var(--core-login-background);--ion-item-background: var(--core-login-background);--color: var(--core-login-text-color)}[_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{--color: var(--core-login-text-color)}[_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], [_nghost-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   .core-oauth-icon[_ngcontent-%COMP%]{color:var(--color)}[_nghost-%COMP%]   ion-button.core-button-as-link[_ngcontent-%COMP%]{--color: var(--core-login-text-color);text-decoration-color:var(--color)}[_nghost-%COMP%]   .core-login-reconnect-warning[_ngcontent-%COMP%]{margin:0 0 32px}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]{margin-bottom:32px}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%]   .core-login-site-logo[_ngcontent-%COMP%]{width:90%;max-width:300px;margin:0 auto}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%]   .core-login-site-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:104px}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%]   .core-sitename[_ngcontent-%COMP%]{font-size:1.2rem;margin-bottom:8px}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%]   .core-siteurl[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:0}[_nghost-%COMP%]   .core-login-info-box[_ngcontent-%COMP%]   .core-login-site[_ngcontent-%COMP%] + .core-login-user[_ngcontent-%COMP%]{margin-top:24px}[_nghost-%COMP%]   core-user-avatar.large-avatar[_ngcontent-%COMP%]{--core-avatar-size: var(--core-large-avatar-size)}[_nghost-%COMP%]   .core-login-fullname[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:0}[_nghost-%COMP%]   .core-login-methods[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%], [_nghost-%COMP%]   .core-login-methods[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{--background: var(--core-login-input-background);--color: var(--core-login-input-color)}[_nghost-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-left:0;margin-right:0}[_nghost-%COMP%]   .core-login-forgotten-password[_ngcontent-%COMP%]{text-decoration:underline}[_nghost-%COMP%]   .core-login-methods-separator[_ngcontent-%COMP%]{position:relative;padding:8px 0}[_nghost-%COMP%]   .core-login-methods-separator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:var(--core-login-background);padding:0 8px}[_nghost-%COMP%]   .core-login-methods-separator[_ngcontent-%COMP%]:before{height:1px;position:absolute;top:50%;left:0;right:0;border-bottom:1px solid var(--gray-300);content:"";z-index:-1}[_nghost-%COMP%]   .core-login-login-button[_ngcontent-%COMP%]{margin-top:32px}[_nghost-%COMP%]   .core-login-login-inbrowser-button[_ngcontent-%COMP%]{margin-bottom:8px}[_nghost-%COMP%]   p.core-login-inbrowser[_ngcontent-%COMP%]{font-size:12px;margin-top:8px;margin-bottom:8px}[_nghost-%COMP%]   .core-login-sign-up[_ngcontent-%COMP%]{margin-top:8px;border-top:1px solid var(--gray-300)}[_nghost-%COMP%]   .core-login-identity-providers[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], [_nghost-%COMP%]   .core-login-sign-up[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:16px;margin-bottom:8px;font-size:16px}html.dark[_nghost-%COMP%]   core-loading[_ngcontent-%COMP%], html.dark   [_nghost-%COMP%]   core-loading[_ngcontent-%COMP%]{--loading-background: var(--core-login-background-dark);--loading-text-color: #ffffff;--loading-spinner: #ffffff}']}),CoreLoginSitePage})();var Ce=o(48959),Pe=o(7351),xe=o(65931),be=o(73946);function CoreLoginSitesPage_ion_button_10_Template(e,n){if(1&e){const e=P.EpF();P.TgZ(0,"ion-button",13),P.NdJ("click",(function CoreLoginSitesPage_ion_button_10_Template_ion_button_click_0_listener(){P.CHM(e);const n=P.oxw();return P.KtG(n.toggleDelete())})),P.ALo(1,"translate"),P._UZ(2,"ion-icon",14),P.qZA()}2&e&&P.uIk("aria-label",P.lcZ(1,1,"core.login.toggleremove"))}const sites_c0=e=>({count:e});function CoreLoginSitesPage_ng_template_17_ion_badge_0_Template(e,n){if(1&e&&(P.TgZ(0,"ion-badge",2)(1,"span",17),P._uU(2),P.qZA(),P.TgZ(3,"span",12),P._uU(4),P.ALo(5,"translate"),P.qZA()()),2&e){const e=P.oxw().site;P.Q6J("@coreShowHideAnimation",void 0),P.xp6(2),P.Oqu(e.badge),P.xp6(2),P.Oqu(P.xi3(5,3,"core.login.sitebadgedescription",P.VKq(6,sites_c0,e.badge)))}}function CoreLoginSitesPage_ng_template_17_ion_button_1_Template(e,n){if(1&e){const e=P.EpF();P.TgZ(0,"ion-button",18),P.NdJ("click",(function CoreLoginSitesPage_ng_template_17_ion_button_1_Template_ion_button_click_0_listener(n){P.CHM(e);const o=P.oxw().site,t=P.oxw();return P.KtG(t.deleteSite(n,o))})),P.ALo(1,"translate"),P._UZ(2,"ion-icon",19),P.qZA()}2&e&&(P.Q6J("@coreSlideInOut","fromRight"),P.uIk("aria-label",P.lcZ(1,2,"core.login.removeaccount")))}function CoreLoginSitesPage_ng_template_17_Template(e,n){if(1&e&&P.YNc(0,CoreLoginSitesPage_ng_template_17_ion_badge_0_Template,6,8,"ion-badge",15)(1,CoreLoginSitesPage_ng_template_17_ion_button_1_Template,3,4,"ion-button",16),2&e){const e=n.site,o=P.oxw();P.Q6J("ngIf",!o.showDelete&&e.badge),P.xp6(),P.Q6J("ngIf",o.showDelete)}}let Oe=(()=>{var e;class CoreLoginSitesPage{constructor(){this.accountsList={sameSite:[],otherSites:[],count:0},this.showDelete=!1,this.loaded=!1}ngOnInit(){var e=this;return(0,r.Z)((function*(){d.b.getRouteBooleanParam("openAddSite")&&e.add(),e.accountsList=yield c.s.getAccountsList(),e.loaded=!0,0!=e.accountsList.count||d.b.getRouteBooleanParam("openAddSite")||e.add()}))()}add(){c.s.goToAddSite(!1,!0)}deleteSite(e,n){var o=this;return(0,r.Z)((function*(){e.stopPropagation();let t=n.siteName||"";t=yield Ce.G.formatText(t,{clean:!0,singleLine:!0,filter:!1},[],n.id);try{yield p.OQ.showDeleteConfirm("core.login.confirmdeletesite",{sitename:t})}catch(e){return}try{yield c.s.deleteAccountFromList(o.accountsList,n),o.showDelete=!1,0==o.accountsList.count&&c.s.goToAddSite(!0,!0)}catch(e){p.OQ.showErrorModalDefault(e,"core.login.errordeletesite",!0)}}))()}login(e){return(0,r.Z)((function*(){const n=yield p.OQ.showModalLoading();try{if(yield a.m9.loadSite(e.id))return yield d.b.navigateToSiteHome(),void 0}catch(e){p.OQ.showErrorModalDefault(e,"Error loading site.")}finally{n.dismiss()}}))()}toggleDelete(){this.showDelete=!this.showDelete}openSettings(){d.b.navigate("/settings")}}return(e=CoreLoginSitesPage).ɵfac=function CoreLoginSitesPage_Factory(n){return new(n||e)},e.ɵcmp=P.Xpm({type:e,selectors:[["page-core-login-sites"]],decls:26,vars:19,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click",4,"ngIf"],[3,"click"],["slot","icon-only","name","fas-gear","aria-hidden","true"],[1,"limited-width"],[3,"hideUntil"],[3,"accountsList","sitesClickable","onSiteClicked"],["siteItem",""],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],["name","fas-plus","aria-hidden","true"],[1,"sr-only"],["fill","clear",3,"click"],["slot","icon-only","name","fas-pen","aria-hidden","true"],["slot","end",4,"ngIf"],["slot","end","fill","clear","color","danger",3,"click",4,"ngIf"],["aria-hidden","true"],["slot","end","fill","clear","color","danger",3,"click"],["name","fas-trash","slot","icon-only","aria-hidden","true"]],template:function CoreLoginSitesPage_Template(e,n){1&e&&(P.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),P._UZ(3,"ion-back-button",1),P.ALo(4,"translate"),P.qZA(),P.TgZ(5,"ion-title")(6,"h1"),P._uU(7),P.ALo(8,"translate"),P.qZA()(),P.TgZ(9,"ion-buttons",2),P.YNc(10,CoreLoginSitesPage_ion_button_10_Template,3,3,"ion-button",3),P.TgZ(11,"ion-button",4),P.NdJ("click",(function CoreLoginSitesPage_Template_ion_button_click_11_listener(){return n.openSettings()})),P.ALo(12,"translate"),P._UZ(13,"ion-icon",5),P.qZA()()()(),P.TgZ(14,"ion-content",6)(15,"core-loading",7)(16,"core-sites-list",8),P.NdJ("onSiteClicked",(function CoreLoginSitesPage_Template_core_sites_list_onSiteClicked_16_listener(e){return n.login(e)})),P.YNc(17,CoreLoginSitesPage_ng_template_17_Template,2,2,"ng-template",null,9,P.W1O),P.qZA()(),P.TgZ(19,"ion-fab",10)(20,"ion-fab-button",4),P.NdJ("click",(function CoreLoginSitesPage_Template_ion_fab_button_click_20_listener(){return n.add()})),P.ALo(21,"translate"),P._UZ(22,"ion-icon",11),P.TgZ(23,"span",12),P._uU(24),P.ALo(25,"translate"),P.qZA()()()()),2&e&&(P.xp6(3),P.Q6J("text",P.lcZ(4,9,"core.back")),P.xp6(4),P.Oqu(P.lcZ(8,11,"core.login.accounts")),P.xp6(3),P.Q6J("ngIf",n.accountsList.count>0),P.xp6(),P.uIk("aria-label",P.lcZ(12,13,"core.settings.appsettings")),P.xp6(4),P.Q6J("hideUntil",n.loaded),P.xp6(),P.Q6J("accountsList",n.accountsList)("sitesClickable",!0),P.xp6(4),P.uIk("aria-label",P.lcZ(21,15,"core.login.add")),P.xp6(4),P.Oqu(P.lcZ(25,17,"core.login.add")))},dependencies:[x.O5,k.r,xe.Z,be.U,B.I,O.t,Z.O,L.yp,L.YG,L.Sm,L.W2,L.IJ,L.W4,L.Gu,L.gu,L.wd,L.sr,L.oU,M.X$],encapsulation:2,data:{animation:[Pe.j.SLIDE_IN_OUT,Pe.j.SHOW_HIDE]}}),CoreLoginSitesPage})();function CoreLoginChangePasswordPage_h1_6_Template(e,n){1&e&&(P.TgZ(0,"h1"),P._uU(1),P.ALo(2,"translate"),P.qZA()),2&e&&(P.xp6(),P.Oqu(P.lcZ(2,1,"core.login.changepassword")))}function CoreLoginChangePasswordPage_h1_7_Template(e,n){1&e&&(P.TgZ(0,"h1"),P._uU(1),P.ALo(2,"translate"),P.qZA()),2&e&&(P.xp6(),P.Oqu(P.lcZ(2,1,"core.login.reconnecttosite")))}function CoreLoginChangePasswordPage_ng_container_14_Template(e,n){if(1&e){const e=P.EpF();P.ynx(0),P.TgZ(1,"ion-item",7)(2,"ion-label")(3,"h2"),P._uU(4),P.ALo(5,"translate"),P.qZA()()(),P.TgZ(6,"ion-button",9),P.NdJ("click",(function CoreLoginChangePasswordPage_ng_container_14_Template_ion_button_click_6_listener(){P.CHM(e);const n=P.oxw();return P.KtG(n.openChangePasswordPage())})),P._uU(7),P.ALo(8,"translate"),P.qZA(),P.BQk()}2&e&&(P.xp6(4),P.Oqu(P.lcZ(5,2,"core.login.forcepasswordchangenotice")),P.xp6(3),P.hij(" ",P.lcZ(8,4,"core.login.changepasswordbutton")," "))}function CoreLoginChangePasswordPage_ng_container_15_Template(e,n){if(1&e){const e=P.EpF();P.ynx(0),P.TgZ(1,"ion-item",7)(2,"ion-label")(3,"p"),P._uU(4),P.ALo(5,"translate"),P.qZA()()(),P.TgZ(6,"ion-button",9),P.NdJ("click",(function CoreLoginChangePasswordPage_ng_container_15_Template_ion_button_click_6_listener(){P.CHM(e);const n=P.oxw();return P.KtG(n.login())})),P._uU(7),P.ALo(8,"translate"),P.qZA(),P.BQk()}2&e&&(P.xp6(4),P.Oqu(P.lcZ(5,2,"core.login.changepasswordreconnectinstructions")),P.xp6(3),P.hij(" ",P.lcZ(8,4,"core.login.reconnect")," "))}let Ze=(()=>{var e;class CoreLoginChangePasswordPage{constructor(){this.changingPassword=!1,this.logoutLabel=c.s.getLogoutLabel()}showHelp(){ge.O.showHelp(s.vN.instant("core.login.changepasswordhelp"),s.vN.instant("core.login.changepasswordsupportsubject"))}openChangePasswordPage(){c.s.openInAppForEdit(a.m9.getCurrentSiteId(),"/login/change_password.php",void 0,!0),this.changingPassword=!0,this.detectPasswordChanged()}login(){d.b.navigateToSiteHome(),this.changingPassword=!1}logout(){a.m9.logout(),this.changingPassword=!1}detectPasswordChanged(){this.urlLoadedObserver||(this.urlLoadedObserver=T.R.on(T.R.IAB_LOAD_STOP,(e=>{var n;if(e.url.match(/\/login\/change_password\.php.*return=1/))return l.Tr.closeInAppBrowser(),this.login(),void 0;e.url.match(/\/login\/change_password\.php/)&&(null===(n=l.Tr.getInAppBrowserInstance())||void 0===n||n.executeScript({code:"\n                    if (\n                        document.querySelector('input[type=\"password\"]') === null &&\n                        document.querySelector('button[type=\"submit\"]') !== null\n                    ) {\n                        webkit.messageHandlers.cordova_iab.postMessage(JSON.stringify({ passwordChanged: true }));\n                    }\n                "}))})),this.messageObserver=T.R.on(T.R.IAB_MESSAGE,(e=>{e.passwordChanged&&(l.Tr.closeInAppBrowser(),this.login())})),this.browserClosedObserver=T.R.on(T.R.IAB_EXIT,(()=>{var e,n,o;null===(e=this.urlLoadedObserver)||void 0===e||e.off(),null===(n=this.messageObserver)||void 0===n||n.off(),null===(o=this.browserClosedObserver)||void 0===o||o.off(),delete this.urlLoadedObserver,delete this.messageObserver,delete this.browserClosedObserver})))}ngOnDestroy(){var e,n,o;null===(e=this.urlLoadedObserver)||void 0===e||e.off(),null===(n=this.messageObserver)||void 0===n||n.off(),null===(o=this.browserClosedObserver)||void 0===o||o.off()}}return(e=CoreLoginChangePasswordPage).ɵfac=function CoreLoginChangePasswordPage_Factory(n){return new(n||e)},e.ɵcmp=P.Xpm({type:e,selectors:[["page-core-login-change-password"]],decls:24,vars:16,consts:[["slot","start"],[3,"text"],[4,"ngIf"],["slot","end"],["fill","clear",3,"click"],["slot","icon-only","name","far-circle-question","aria-hidden","true"],[1,"list-item-limited-width"],[1,"ion-text-wrap"],["expand","block","fill","outline",1,"ion-text-wrap","ion-margin",3,"click"],["expand","block",1,"ion-text-wrap","ion-margin",3,"click"]],template:function CoreLoginChangePasswordPage_Template(e,n){1&e&&(P.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),P._UZ(3,"ion-back-button",1),P.ALo(4,"translate"),P.qZA(),P.TgZ(5,"ion-title"),P.YNc(6,CoreLoginChangePasswordPage_h1_6_Template,3,3,"h1",2)(7,CoreLoginChangePasswordPage_h1_7_Template,3,3,"h1",2),P.qZA(),P.TgZ(8,"ion-buttons",3)(9,"ion-button",4),P.NdJ("click",(function CoreLoginChangePasswordPage_Template_ion_button_click_9_listener(){return n.showHelp()})),P.ALo(10,"translate"),P._UZ(11,"ion-icon",5),P.qZA()()()(),P.TgZ(12,"ion-content")(13,"ion-list",6),P.YNc(14,CoreLoginChangePasswordPage_ng_container_14_Template,9,6,"ng-container",2)(15,CoreLoginChangePasswordPage_ng_container_15_Template,9,6,"ng-container",2),P.TgZ(16,"ion-item",7)(17,"ion-label")(18,"p"),P._uU(19),P.ALo(20,"translate"),P.qZA()()(),P.TgZ(21,"ion-button",8),P.NdJ("click",(function CoreLoginChangePasswordPage_Template_ion_button_click_21_listener(){return n.logout()})),P._uU(22),P.ALo(23,"translate"),P.qZA()()()),2&e&&(P.xp6(3),P.Q6J("text",P.lcZ(4,8,"core.back")),P.xp6(3),P.Q6J("ngIf",!n.changingPassword),P.xp6(),P.Q6J("ngIf",n.changingPassword),P.xp6(2),P.uIk("aria-label",P.lcZ(10,10,"core.help")),P.xp6(5),P.Q6J("ngIf",!n.changingPassword),P.xp6(),P.Q6J("ngIf",n.changingPassword),P.xp6(4),P.Oqu(P.lcZ(20,12,"core.wanttochangesite")),P.xp6(3),P.hij(" ",P.lcZ(23,14,n.logoutLabel)," "))},dependencies:[x.O5,B.I,O.t,Z.O,L.YG,L.Sm,L.W2,L.Gu,L.gu,L.Ie,L.Q$,L.q_,L.wd,L.sr,L.oU,M.X$],encapsulation:2}),CoreLoginChangePasswordPage})();const Le=[{path:"",pathMatch:"full",redirectTo:"sites"},{path:"site",component:he},{path:"credentials",loadChildren:()=>c.s.getCredentialsRouteModule()},{path:"sites",component:Oe,canActivate:[g]},{path:"forgottenpassword",component:v},{path:"changepassword",component:Ze},{path:"sitepolicy",component:I},{path:"emailsignup",component:W},{path:"reconnect",loadChildren:()=>c.s.getReconnectRouteModule()}];let ye=(()=>{var e;class CoreLoginLazyModule{}return(e=CoreLoginLazyModule).ɵfac=function CoreLoginLazyModule_Factory(n){return new(n||e)},e.ɵmod=P.oAB({type:e}),e.ɵinj=P.cJS({imports:[i.L,_.i,Q.F,t.Bz.forChild(Le)]}),CoreLoginLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&P.kYT(ye,{declarations:[v,I,he,Oe,Ze,W],imports:[i.L,_.i,Q.F,t.Bz]}))}}]);