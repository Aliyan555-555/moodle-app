"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[209],{50209:(e,n,s)=>{s.r(n),s.d(n,{AddonMessagesLazyModule:()=>pe});var t=s(23966),o=s(13386),a=s(49671),i=s(53564),r=s(11509),c=s(13010),d=s(29540),l=s(98370),g=s(10727),_=s(38049),u=s(43555),m=s(30242),h=s(19212),p=s(67643),f=s(96814),M=s(11771),v=s(55126),C=s(66931),P=s(80070),x=s(29657),b=s(31903),O=s(93268),A=s(89515);function AddonMessagesContacts35Page_core_empty_box_19_Template(e,n){1&e&&(h._UZ(0,"core-empty-box",9),h.ALo(1,"translate")),2&e&&h.Q6J("message",h.lcZ(1,1,"addon.messages.contactlistempty"))}function AddonMessagesContacts35Page_core_empty_box_20_Template(e,n){1&e&&(h._UZ(0,"core-empty-box",9),h.ALo(1,"translate")),2&e&&h.Q6J("message",h.lcZ(1,1,"addon.messages.nousersfound"))}function AddonMessagesContacts35Page_ion_list_21_ng_container_1_ng_container_9_ion_item_1_Template(e,n){if(1&e){const e=h.EpF();h.TgZ(0,"ion-item",16),h.NdJ("click",(function AddonMessagesContacts35Page_ion_list_21_ng_container_1_ng_container_9_ion_item_1_Template_ion_item_click_0_listener(){h.CHM(e);const n=h.oxw().$implicit,s=h.oxw(3);return h.KtG(s.gotoDiscussion(n.id))})),h._UZ(1,"core-user-avatar",17),h.TgZ(2,"ion-label")(3,"p",12),h._uU(4),h.qZA()()()}if(2&e){const e=h.oxw().$implicit,n=h.oxw(3);h.Q6J("detail",!0),h.uIk("aria-label",e.fullname)("aria-current",e.id===n.discussionUserId?"page":"false"),h.xp6(),h.Q6J("user",e)("checkOnline",e.showonlinestatus),h.xp6(3),h.Oqu(e.fullname)}}function AddonMessagesContacts35Page_ion_list_21_ng_container_1_ng_container_9_Template(e,n){if(1&e&&(h.ynx(0),h.YNc(1,AddonMessagesContacts35Page_ion_list_21_ng_container_1_ng_container_9_ion_item_1_Template,5,6,"ion-item",15),h.BQk()),2&e){const e=n.$implicit;h.xp6(),h.Q6J("ngIf",e.profileimageurl||e.profileimageurlsmall)}}function AddonMessagesContacts35Page_ion_list_21_ng_container_1_Template(e,n){if(1&e&&(h.ynx(0),h.TgZ(1,"ion-item-divider")(2,"ion-label")(3,"p",12),h._uU(4),h.ALo(5,"translate"),h.qZA()(),h.TgZ(6,"ion-note",13)(7,"ion-badge"),h._uU(8),h.qZA()()(),h.YNc(9,AddonMessagesContacts35Page_ion_list_21_ng_container_1_ng_container_9_Template,2,1,"ng-container",14),h.BQk()),2&e){const e=h.oxw().$implicit,n=h.oxw();h.xp6(4),h.Oqu(h.lcZ(5,3,"addon.messages.type_"+e)),h.xp6(4),h.Oqu(n.contacts[e].length),h.xp6(),h.Q6J("ngForOf",n.contacts[e])}}function AddonMessagesContacts35Page_ion_list_21_Template(e,n){if(1&e&&(h.TgZ(0,"ion-list",10),h.YNc(1,AddonMessagesContacts35Page_ion_list_21_ng_container_1_Template,10,5,"ng-container",11),h.qZA()),2&e){const e=n.$implicit,s=h.oxw();h.xp6(),h.Q6J("ngIf",s.contacts[e]&&(s.contacts[e].length>0||e===s.searchType))}}let T=(()=>{var e;class AddonMessagesContacts35Page{constructor(e){this.route=e,this.noSearchTypes=["online","offline","blocked","strangers"],this.loaded=!1,this.contactTypes=["online","offline","blocked","strangers"],this.searchType="search",this.loadingMessage="",this.hasContacts=!1,this.contacts={online:[],offline:[],strangers:[],search:[]},this.searchString="",this.siteId=i.m9.getCurrentSiteId(),this.searchingMessages=g.vN.instant("core.searching"),this.loadingMessages=g.vN.instant("core.loading"),this.loadingMessage=this.loadingMessages,this.memberInfoObserver=l.R.on(r.v.MEMBER_INFO_CHANGED_EVENT,(e=>{e.contactRequestConfirmed&&this.refreshData()}),i.m9.getCurrentSiteId())}ngOnInit(){var e=this;return(0,a.Z)((function*(){const n=u.b.getRouteNumberParam("discussionUserId")||u.b.getRouteNumberParam("userId")||void 0;if(!e.loaded||e.discussionUserId!=n){e.discussionUserId=n,e.discussionUserId&&e.gotoDiscussion(e.discussionUserId);try{if(yield e.fetchData(),!e.discussionUserId&&e.hasContacts&&_.X4.isTablet){let n;for(const s in e.contacts)if(e.contacts[s].length>0){n=e.contacts[s][0];break}n&&e.gotoDiscussion(n.id)}}finally{e.loaded=!0}}}))()}refreshData(e){var n=this;return(0,a.Z)((function*(){try{n.searchString?yield n.performSearch(n.searchString):(yield r.r.invalidateAllContactsCache(),yield n.fetchData())}finally{null==e||e.complete()}}))()}fetchData(){var e=this;return(0,a.Z)((function*(){e.loadingMessage=e.loadingMessages;try{const n=yield r.r.getAllContacts();for(const s in n)e.contacts[s]=n[s].length>0?e.sortUsers(n[s]):[];e.clearSearch()}catch(e){c.OQ.showErrorModalDefault(e,"addon.messages.errorwhileretrievingcontacts",!0)}}))()}sortUsers(e){return e.sort(((e,n)=>{const s=e.fullname.toLowerCase(),t=n.fullname.toLowerCase();return s.localeCompare(t)}))}clearSearch(){this.searchString="",this.contactTypes=this.noSearchTypes,this.hasContacts=!1;for(const e in this.contacts)if(this.contacts[e].length>0)return this.hasContacts=!0,void 0}search(e){return d.z.closeKeyboard(),this.loaded=!1,this.loadingMessage=this.searchingMessages,this.performSearch(e).finally((()=>{this.loaded=!0}))}performSearch(e){var n=this;return(0,a.Z)((function*(){try{const s=yield r.r.searchContacts(e);n.hasContacts=s.length>0,n.searchString=e,n.contactTypes=["search"],n.contacts.search=n.sortUsers(s)}catch(e){c.OQ.showErrorModalDefault(e,"addon.messages.errorwhileretrievingcontacts",!0)}}))()}gotoDiscussion(e){this.discussionUserId=e;const n=u.b.getRelativePathToParent("/messages/contacts-35")+`discussion/user/${e}`;u.b.navigate(n,{reset:_.X4.isTablet&&!!this.splitView&&!this.splitView.isNested})}ngOnDestroy(){var e;null===(e=this.memberInfoObserver)||void 0===e||e.off()}}return(e=AddonMessagesContacts35Page).ɵfac=function AddonMessagesContacts35Page_Factory(n){return new(n||e)(h.Y36(p.gz))},e.ɵcmp=h.Xpm({type:e,selectors:[["addon-messages-contacts"]],viewQuery:function AddonMessagesContacts35Page_Query(e,n){if(1&e&&h.Gf(m.A,5),2&e){let e;h.iGM(e=h.CRH())&&(n.splitView=e.first)}},decls:22,vars:19,consts:[["slot","start"],[3,"text"],["slot","end"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],["autocorrect","off","spellcheck","false","lengthCheck","2","searchArea","AddonMessagesContacts",3,"placeholder","disabled","onSubmit","onClear"],[3,"hideUntil","message"],["icon","fas-address-book",3,"message",4,"ngIf"],["class","ion-no-margin",4,"ngFor","ngForOf"],["icon","fas-address-book",3,"message"],[1,"ion-no-margin"],[4,"ngIf"],[1,"item-heading"],["slot","end",1,"ion-padding-end"],[4,"ngFor","ngForOf"],["class","ion-text-wrap addon-messages-conversation-item","button","",3,"detail","click",4,"ngIf"],["button","",1,"ion-text-wrap","addon-messages-conversation-item",3,"detail","click"],["slot","start",3,"user","checkOnline"]],template:function AddonMessagesContacts35Page_Template(e,n){1&e&&(h.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),h._UZ(3,"ion-back-button",1),h.ALo(4,"translate"),h.qZA(),h.TgZ(5,"ion-title")(6,"h1"),h._uU(7),h.ALo(8,"translate"),h.qZA()(),h.TgZ(9,"ion-buttons",2),h._UZ(10,"core-context-menu"),h.qZA()()(),h.TgZ(11,"ion-content")(12,"core-split-view")(13,"ion-refresher",3),h.NdJ("ionRefresh",(function AddonMessagesContacts35Page_Template_ion_refresher_ionRefresh_13_listener(e){return n.refreshData(e.target)})),h._UZ(14,"ion-refresher-content",4),h.ALo(15,"translate"),h.qZA(),h.TgZ(16,"core-search-box",5),h.NdJ("onSubmit",(function AddonMessagesContacts35Page_Template_core_search_box_onSubmit_16_listener(e){return n.search(e)}))("onClear",(function AddonMessagesContacts35Page_Template_core_search_box_onClear_16_listener(){return n.clearSearch()})),h.ALo(17,"translate"),h.qZA(),h.TgZ(18,"core-loading",6),h.YNc(19,AddonMessagesContacts35Page_core_empty_box_19_Template,2,3,"core-empty-box",7)(20,AddonMessagesContacts35Page_core_empty_box_20_Template,2,3,"core-empty-box",7)(21,AddonMessagesContacts35Page_ion_list_21_Template,2,1,"ion-list",8),h.qZA()()()),2&e&&(h.xp6(3),h.Q6J("text",h.lcZ(4,11,"core.back")),h.xp6(4),h.Oqu(h.lcZ(8,13,"addon.messages.contacts")),h.xp6(6),h.Q6J("disabled",!n.loaded),h.xp6(),h.s9C("pullingText",h.lcZ(15,15,"core.pulltorefresh")),h.xp6(2),h.Q6J("placeholder",h.lcZ(17,17,"addon.messages.contactname"))("disabled",!n.loaded),h.xp6(2),h.Q6J("hideUntil",n.loaded)("message",n.loadingMessage),h.xp6(),h.Q6J("ngIf",!n.hasContacts&&""===n.searchString),h.xp6(),h.Q6J("ngIf",!n.hasContacts&&""!==n.searchString),h.xp6(),h.Q6J("ngForOf",n.contactTypes))},dependencies:[f.sg,f.O5,M.P,v.z,C.r,m.A,P.X,x.t,b.yp,b.Sm,b.W2,b.Gu,b.Ie,b.rH,b.Q$,b.q_,b.uN,b.nJ,b.Wo,b.wd,b.sr,b.oU,O.L,A.X$],styles:["[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-right:0;margin-left:0}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-inline-start:2px}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-self:flex-start;margin-inline-start:2px}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-top:3px;align-self:flex-end}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%]{white-space:nowrap;font-size:11px}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{white-space:nowrap;color:var(--ion-text-color);margin-inline-end:2px}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex-shrink:1}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]{margin-top:10px}[_nghost-%COMP%]   ion-item-divider[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{margin-left:16px;margin-right:16px}"]}),AddonMessagesContacts35Page})();var I=s(52133),Z=s(94062),y=s(28571),w=s(86700),q=s(8947),k=s(22068);function AddonMessagesContactsPage_ng_template_19_ion_list_4_ion_item_1_ion_icon_5_Template(e,n){1&e&&(h._UZ(0,"ion-icon",20),h.ALo(1,"translate")),2&e&&h.uIk("aria-label",h.lcZ(1,1,"addon.messages.contactblocked"))}function AddonMessagesContactsPage_ng_template_19_ion_list_4_ion_item_1_Template(e,n){if(1&e){const e=h.EpF();h.TgZ(0,"ion-item",15),h.NdJ("click",(function AddonMessagesContactsPage_ng_template_19_ion_list_4_ion_item_1_Template_ion_item_click_0_listener(){const n=h.CHM(e).$implicit,s=h.oxw(3);return h.KtG(s.selectUser(n.id))})),h._UZ(1,"core-user-avatar",16),h.TgZ(2,"ion-label")(3,"p",17),h._UZ(4,"core-format-text",18),h.YNc(5,AddonMessagesContactsPage_ng_template_19_ion_list_4_ion_item_1_ion_icon_5_Template,2,3,"ion-icon",19),h.qZA()()()}if(2&e){const e=n.$implicit,s=h.oxw(3);h.Q6J("detail",!0),h.uIk("aria-label",e.fullname)("aria-current",e.id===s.selectedUserId?"page":"false"),h.xp6(),h.Q6J("user",e)("checkOnline",e.showonlinestatus)("linkProfile",!1),h.xp6(3),h.Q6J("text",e.fullname)("contextInstanceId",0),h.xp6(),h.Q6J("ngIf",e.isblocked)}}function AddonMessagesContactsPage_ng_template_19_ion_list_4_Template(e,n){if(1&e&&(h.TgZ(0,"ion-list",13),h.YNc(1,AddonMessagesContactsPage_ng_template_19_ion_list_4_ion_item_1_Template,6,9,"ion-item",14),h.qZA()),2&e){const e=h.oxw(2);h.xp6(),h.Q6J("ngForOf",e.confirmedContacts)}}function AddonMessagesContactsPage_ng_template_19_core_empty_box_5_Template(e,n){1&e&&(h._UZ(0,"core-empty-box",21),h.ALo(1,"translate")),2&e&&h.Q6J("message",h.lcZ(1,1,"addon.messages.nocontactsgetstarted"))}function AddonMessagesContactsPage_ng_template_19_Template(e,n){if(1&e){const e=h.EpF();h.TgZ(0,"ion-refresher",8),h.NdJ("ionRefresh",(function AddonMessagesContactsPage_ng_template_19_Template_ion_refresher_ionRefresh_0_listener(n){h.CHM(e);const s=h.oxw();return h.KtG(s.refreshData(n.target))})),h._UZ(1,"ion-refresher-content",9),h.ALo(2,"translate"),h.qZA(),h.TgZ(3,"core-loading",5),h.YNc(4,AddonMessagesContactsPage_ng_template_19_ion_list_4_Template,2,1,"ion-list",10)(5,AddonMessagesContactsPage_ng_template_19_core_empty_box_5_Template,2,3,"core-empty-box",11),h.TgZ(6,"core-infinite-loading",12),h.NdJ("action",(function AddonMessagesContactsPage_ng_template_19_Template_core_infinite_loading_action_6_listener(n){h.CHM(e);const s=h.oxw();return h.KtG(s.loadMore(n))})),h.qZA()()}if(2&e){const e=h.oxw();h.Q6J("disabled",!e.confirmedLoaded),h.xp6(),h.s9C("pullingText",h.lcZ(2,7,"core.pulltorefresh")),h.xp6(2),h.Q6J("hideUntil",e.confirmedLoaded),h.xp6(),h.Q6J("ngIf",e.confirmedContacts.length),h.xp6(),h.Q6J("ngIf",!e.confirmedContacts.length),h.xp6(),h.Q6J("enabled",e.confirmedCanLoadMore)("error",e.confirmedLoadMoreError)}}function AddonMessagesContactsPage_ng_template_22_ion_list_4_ion_item_1_p_4_Template(e,n){1&e&&(h.TgZ(0,"p"),h._uU(1),h.ALo(2,"translate"),h.qZA()),2&e&&(h.xp6(),h.hij(" ",h.lcZ(2,1,"addon.messages.wouldliketocontactyou")," "))}function AddonMessagesContactsPage_ng_template_22_ion_list_4_ion_item_1_Template(e,n){if(1&e){const e=h.EpF();h.TgZ(0,"ion-item",15),h.NdJ("click",(function AddonMessagesContactsPage_ng_template_22_ion_list_4_ion_item_1_Template_ion_item_click_0_listener(){const n=h.CHM(e).$implicit,s=h.oxw(3);return h.KtG(s.selectUser(n.id))})),h._UZ(1,"core-user-avatar",22),h.TgZ(2,"ion-label"),h._UZ(3,"core-format-text",18),h.YNc(4,AddonMessagesContactsPage_ng_template_22_ion_list_4_ion_item_1_p_4_Template,3,3,"p",23),h.qZA()()}if(2&e){const e=n.$implicit,s=h.oxw(3);h.Q6J("detail",!0),h.uIk("aria-label",e.fullname)("aria-current",e.id===s.selectedUserId?"page":"false"),h.xp6(),h.Q6J("user",e)("linkProfile",!1),h.xp6(2),h.Q6J("text",e.fullname)("contextInstanceId",0),h.xp6(),h.Q6J("ngIf",!e.iscontact)}}function AddonMessagesContactsPage_ng_template_22_ion_list_4_Template(e,n){if(1&e&&(h.TgZ(0,"ion-list",13),h.YNc(1,AddonMessagesContactsPage_ng_template_22_ion_list_4_ion_item_1_Template,5,8,"ion-item",14),h.qZA()),2&e){const e=h.oxw(2);h.xp6(),h.Q6J("ngForOf",e.requests)}}function AddonMessagesContactsPage_ng_template_22_core_empty_box_5_Template(e,n){1&e&&(h._UZ(0,"core-empty-box",21),h.ALo(1,"translate")),2&e&&h.Q6J("message",h.lcZ(1,1,"addon.messages.nocontactrequests"))}function AddonMessagesContactsPage_ng_template_22_Template(e,n){if(1&e){const e=h.EpF();h.TgZ(0,"ion-refresher",8),h.NdJ("ionRefresh",(function AddonMessagesContactsPage_ng_template_22_Template_ion_refresher_ionRefresh_0_listener(n){h.CHM(e);const s=h.oxw();return h.KtG(s.refreshData(n.target))})),h._UZ(1,"ion-refresher-content",9),h.ALo(2,"translate"),h.qZA(),h.TgZ(3,"core-loading",5),h.YNc(4,AddonMessagesContactsPage_ng_template_22_ion_list_4_Template,2,1,"ion-list",10)(5,AddonMessagesContactsPage_ng_template_22_core_empty_box_5_Template,2,3,"core-empty-box",11),h.TgZ(6,"core-infinite-loading",12),h.NdJ("action",(function AddonMessagesContactsPage_ng_template_22_Template_core_infinite_loading_action_6_listener(n){h.CHM(e);const s=h.oxw();return h.KtG(s.loadMore(n))})),h.qZA()()}if(2&e){const e=h.oxw();h.Q6J("disabled",!e.requestsLoaded),h.xp6(),h.s9C("pullingText",h.lcZ(2,7,"core.pulltorefresh")),h.xp6(2),h.Q6J("hideUntil",e.requestsLoaded),h.xp6(),h.Q6J("ngIf",e.requests.length),h.xp6(),h.Q6J("ngIf",!e.requests.length),h.xp6(),h.Q6J("enabled",e.requestsCanLoadMore)("error",e.requestsLoadMoreError)}}let E=(()=>{var e;class AddonMessagesContactsPage{constructor(){this.selected="confirmed",this.requestsBadge="",this.confirmedLoaded=!1,this.confirmedInitialising=!1,this.confirmedCanLoadMore=!1,this.confirmedLoadMoreError=!1,this.confirmedContacts=[],this.requestsLoaded=!1,this.requestsInitialising=!1,this.requestsCanLoadMore=!1,this.requestsLoadMoreError=!1,this.requests=[],this.siteId=i.m9.getCurrentSiteId(),this.contactRequestsCountObserver=l.R.on(r.v.CONTACT_REQUESTS_COUNT_EVENT,(e=>{this.requestsBadge=e.count>0?String(e.count):""}),this.siteId),this.memberInfoObserver=l.R.on(r.v.MEMBER_INFO_CHANGED_EVENT,(e=>{if(e.userBlocked||e.userUnblocked){const n=this.confirmedContacts.find((n=>n.id==e.userId));n&&(n.isblocked=!!e.userBlocked)}else if(e.contactRemoved){const n=this.confirmedContacts.findIndex((n=>n.id==e.userId));n>=0&&this.confirmedContacts.splice(n,1)}else e.contactRequestConfirmed&&this.confirmedFetchData(!0);if(e.contactRequestConfirmed||e.contactRequestDeclined){const n=this.requests.findIndex((n=>n.id==e.userId));n>=0&&this.requests.splice(n,1)}}),i.m9.getCurrentSiteId())}ngOnInit(){var e=this;return(0,a.Z)((function*(){r.r.getContactRequestsCount(e.siteId),"confirmed"===e.selected?yield e.initConfirmed():yield e.initRequests()}))()}initConfirmed(){var e=this;return(0,a.Z)((function*(){if(!e.confirmedInitialising)try{e.confirmedInitialising=!0,yield e.confirmedFetchData(),e.confirmedContacts.length&&_.X4.isTablet&&e.selectUser(e.confirmedContacts[0].id,!0)}finally{e.confirmedInitialising=!1,e.confirmedLoaded=!0}}))()}initRequests(){var e=this;return(0,a.Z)((function*(){if(!e.requestsInitialising)try{e.requestsInitialising=!0,yield e.requestsFetchData(),e.requests.length&&_.X4.isTablet&&e.selectUser(e.requests[0].id,!0)}finally{e.requestsInitialising=!1,e.requestsLoaded=!0}}))()}confirmedFetchData(e=!1){var n=this;return(0,a.Z)((function*(){n.confirmedLoadMoreError=!1;const s=e?0:n.confirmedContacts.length;0===s&&(yield r.r.invalidateUserContacts());try{const t=yield r.r.getUserContacts(s);n.confirmedContacts=e?t.contacts:n.confirmedContacts.concat(t.contacts),n.confirmedCanLoadMore=t.canLoadMore}catch(e){n.confirmedLoadMoreError=!0,c.OQ.showErrorModalDefault(e,"addon.messages.errorwhileretrievingcontacts",!0)}}))()}requestsFetchData(e=!1){var n=this;return(0,a.Z)((function*(){n.requestsLoadMoreError=!1;const s=e?0:n.requests.length;0===s&&(yield r.r.invalidateContactRequestsCache());try{const t=yield r.r.getContactRequests(s);n.requests=e?t.requests:n.requests.concat(t.requests),n.requestsCanLoadMore=t.canLoadMore}catch(e){n.requestsLoadMoreError=!0,c.OQ.showErrorModalDefault(e,"addon.messages.errorwhileretrievingcontacts",!0)}}))()}refreshData(e){var n=this;return(0,a.Z)((function*(){try{"confirmed"==n.selected?yield n.confirmedFetchData(!0):(r.r.refreshContactRequestsCount(),yield n.requestsFetchData(!0))}finally{null==e||e.complete()}}))()}loadMore(e){var n=this;return(0,a.Z)((function*(){try{"confirmed"==n.selected?yield n.confirmedFetchData():yield n.requestsFetchData()}finally{e&&e()}}))()}gotoSearch(){u.b.navigateToSitePath("search")}selectTab(e){"confirmed"!==e&&"requests"!==e||(this.selected=e,"confirmed"!=this.selected||this.confirmedLoaded||this.initConfirmed(),"requests"!=this.selected||this.requestsLoaded||this.initRequests())}selectUser(e,n=!1){if(e==this.selectedUserId&&_.X4.isTablet)return;if(n&&_.X4.isMobile)return;this.selectedUserId=e;const s=u.b.getRelativePathToParent("/messages/contacts")+`discussion/user/${e}`;u.b.navigate(s,{reset:_.X4.isTablet&&!!this.splitView&&!this.splitView.isNested})}ngOnDestroy(){var e;null===(e=this.contactRequestsCountObserver)||void 0===e||e.off()}}return(e=AddonMessagesContactsPage).ɵfac=function AddonMessagesContactsPage_Factory(n){return new(n||e)},e.ɵcmp=h.Xpm({type:e,selectors:[["page-addon-messages-contacts"]],viewQuery:function AddonMessagesContactsPage_Query(e,n){if(1&e&&h.Gf(m.A,5),2&e){let e;h.iGM(e=h.CRH())&&(n.splitView=e.first)}},decls:23,vars:17,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click"],["name","fas-magnifying-glass","slot","icon-only","aria-hidden","true"],[3,"hideUntil"],[3,"title","ionSelect"],["badgeA11yText","addon.messages.pendingcontactrequests",3,"title","badge","ionSelect"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],["class","ion-no-margin",4,"ngIf"],["icon","far-address-book",3,"message",4,"ngIf"],["position","bottom",3,"enabled","error","action"],[1,"ion-no-margin"],["class","ion-text-wrap addon-messages-conversation-item","button","",3,"detail","click",4,"ngFor","ngForOf"],["button","",1,"ion-text-wrap","addon-messages-conversation-item",3,"detail","click"],["slot","start",3,"user","checkOnline","linkProfile"],[1,"item-heading"],["contextLevel","system",3,"text","contextInstanceId"],["name","fas-user-slash","slot","end",4,"ngIf"],["name","fas-user-slash","slot","end"],["icon","far-address-book",3,"message"],["slot","start",3,"user","linkProfile"],[4,"ngIf"]],template:function AddonMessagesContactsPage_Template(e,n){1&e&&(h.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),h._UZ(3,"ion-back-button",1),h.ALo(4,"translate"),h.qZA(),h.TgZ(5,"ion-title")(6,"h1"),h._uU(7),h.ALo(8,"translate"),h.qZA()(),h.TgZ(9,"ion-buttons",2)(10,"ion-button",3),h.NdJ("click",(function AddonMessagesContactsPage_Template_ion_button_click_10_listener(){return n.gotoSearch()})),h.ALo(11,"translate"),h._UZ(12,"ion-icon",4),h.qZA(),h._UZ(13,"core-context-menu"),h.qZA()()(),h.TgZ(14,"ion-content")(15,"core-split-view")(16,"core-tabs",5)(17,"core-tab",6),h.NdJ("ionSelect",(function AddonMessagesContactsPage_Template_core_tab_ionSelect_17_listener(){return n.selectTab("confirmed")})),h.ALo(18,"translate"),h.YNc(19,AddonMessagesContactsPage_ng_template_19_Template,7,9,"ng-template"),h.qZA(),h.TgZ(20,"core-tab",7),h.NdJ("ionSelect",(function AddonMessagesContactsPage_Template_core_tab_ionSelect_20_listener(){return n.selectTab("requests")})),h.ALo(21,"translate"),h.YNc(22,AddonMessagesContactsPage_ng_template_22_Template,7,9,"ng-template"),h.qZA()()()()),2&e&&(h.xp6(3),h.Q6J("text",h.lcZ(4,7,"core.back")),h.xp6(4),h.Oqu(h.lcZ(8,9,"addon.messages.contacts")),h.xp6(3),h.uIk("aria-label",h.lcZ(11,11,"addon.messages.searchcombined")),h.xp6(6),h.Q6J("hideUntil",!0),h.xp6(),h.Q6J("title",h.lcZ(18,13,"addon.messages.contacts")),h.xp6(3),h.Q6J("title",h.lcZ(21,15,"addon.messages.requests"))("badge",n.requestsBadge))},dependencies:[f.sg,f.O5,M.P,v.z,I.n,C.r,m.A,Z.u,y.R,P.X,w.I,q.r,x.t,k.O,b.YG,b.Sm,b.W2,b.Gu,b.gu,b.Ie,b.Q$,b.q_,b.nJ,b.Wo,b.wd,b.sr,b.oU,A.X$],styles:["[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-right:0;margin-left:0}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-inline-start:2px}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-self:flex-start;margin-inline-start:2px}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-top:3px;align-self:flex-end}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%]{white-space:nowrap;font-size:11px}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{white-space:nowrap;color:var(--ion-text-color);margin-inline-end:2px}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex-shrink:1}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]{margin-top:10px}[_nghost-%COMP%]   ion-item-divider[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{margin-left:16px;margin-right:16px}"]}),AddonMessagesContactsPage})();var N=s(45155),D=s(32097),L=s(45151),U=s(75803),Q=s(34749),S=s(77730),J=s(2864),G=s(69930),R=s.n(G),F=s(31381),V=s(18005),Y=s(93988),$=s(17418),B=s(61968),H=s(78308),K=s(30300),z=s(50668),j=s(73946),X=s(83369);function AddonMessagesDiscussionPage_img_7_Template(e,n){if(1&e&&h._UZ(0,"img",25),2&e){const e=h.oxw();h.Q6J("src",e.conversationImage,h.LSH)("siteId",e.siteId)}}function AddonMessagesDiscussionPage_core_user_avatar_8_Template(e,n){if(1&e&&h._UZ(0,"core-user-avatar",26),2&e){const e=h.oxw();h.Q6J("user",e.otherMember)("linkProfile",!1)("checkOnline",e.otherMember.showonlinestatus)}}function AddonMessagesDiscussionPage_ion_icon_10_Template(e,n){1&e&&(h._UZ(0,"ion-icon",27),h.ALo(1,"translate")),2&e&&h.uIk("aria-label",h.lcZ(1,1,"core.favourites"))}function AddonMessagesDiscussionPage_ion_icon_11_Template(e,n){1&e&&(h._UZ(0,"ion-icon",28),h.ALo(1,"translate")),2&e&&h.uIk("aria-label",h.lcZ(1,1,"addon.messages.mutedconversation"))}function AddonMessagesDiscussionPage_ng_container_39_Template(e,n){1&e&&(h.ynx(0),h.TgZ(1,"p",29),h._uU(2),h.ALo(3,"translate"),h.qZA(),h.TgZ(4,"p",29)(5,"em"),h._uU(6),h.ALo(7,"translate"),h.qZA()(),h.BQk()),2&e&&(h.xp6(2),h.Oqu(h.lcZ(3,2,"addon.messages.selfconversation")),h.xp6(4),h.Oqu(h.lcZ(7,4,"addon.messages.selfconversationdefaultmessage")))}function AddonMessagesDiscussionPage_ng_container_43_h3_1_Template(e,n){if(1&e&&(h.TgZ(0,"h3",33),h._uU(1),h.ALo(2,"coreFormatDate"),h.qZA()),2&e){const e=h.oxw().$implicit;h.xp6(),h.hij(" ",h.xi3(2,1,e.timecreated,"strftimedayshort")," ")}}function AddonMessagesDiscussionPage_ng_container_43_ion_chip_2_Template(e,n){1&e&&(h.TgZ(0,"ion-chip",34)(1,"ion-label"),h._uU(2),h.ALo(3,"translate"),h.qZA(),h._UZ(4,"ion-icon",35),h.qZA()),2&e&&(h.xp6(2),h.Oqu(h.lcZ(3,1,"addon.messages.newmessages")))}function AddonMessagesDiscussionPage_ng_container_43_Template(e,n){if(1&e){const e=h.EpF();h.ynx(0),h.YNc(1,AddonMessagesDiscussionPage_ng_container_43_h3_1_Template,3,4,"h3",30)(2,AddonMessagesDiscussionPage_ng_container_43_ion_chip_2_Template,5,3,"ion-chip",31),h.TgZ(3,"core-message",32),h.NdJ("afterRender",(function AddonMessagesDiscussionPage_ng_container_43_Template_core_message_afterRender_3_listener(){const n=h.CHM(e).last,s=h.oxw();return h.KtG(n&&s.scrollToBottom())}))("onDeleteMessage",(function AddonMessagesDiscussionPage_ng_container_43_Template_core_message_onDeleteMessage_3_listener(){const n=h.CHM(e),s=n.$implicit,t=n.index,o=h.oxw();return h.KtG(o.deleteMessage(s,t))})),h.qZA(),h.BQk()}if(2&e){const e=n.$implicit,s=h.oxw();h.xp6(),h.Q6J("ngIf",e.showDate),h.xp6(),h.Q6J("ngIf",s.unreadMessageFrom>0&&e.id===s.unreadMessageFrom),h.xp6(),h.Q6J("message",e)("user",s.members[e.useridfrom])("text",e.text)("showDelete",s.showDelete)("time",e.timecreated)}}function AddonMessagesDiscussionPage_core_empty_box_44_Template(e,n){1&e&&(h._UZ(0,"core-empty-box",36),h.ALo(1,"translate")),2&e&&h.Q6J("message",h.lcZ(1,1,"addon.messages.nomessagesfound"))}function AddonMessagesDiscussionPage_ion_fab_45_Template(e,n){if(1&e){const e=h.EpF();h.TgZ(0,"ion-fab",37)(1,"ion-fab-button",38),h.NdJ("click",(function AddonMessagesDiscussionPage_ion_fab_45_Template_ion_fab_button_click_1_listener(){h.CHM(e);const n=h.oxw();return h.KtG(n.scrollToFirstUnreadMessage())})),h.ALo(2,"translate"),h._UZ(3,"ion-icon",35),h.TgZ(4,"span",19),h._uU(5),h.ALo(6,"translate"),h.qZA()(),h.TgZ(7,"ion-badge",39),h._uU(8),h.qZA()()}if(2&e){const e=h.oxw();h.xp6(),h.uIk("aria-label",h.lcZ(2,3,"addon.messages.newmessages")),h.xp6(4),h.Oqu(h.lcZ(6,5,"addon.messages.newmessages")),h.xp6(3),h.Oqu(e.newMessages)}}function AddonMessagesDiscussionPage_ion_footer_46_p_2_Template(e,n){1&e&&(h.TgZ(0,"p",45),h._uU(1),h.ALo(2,"translate"),h.qZA()),2&e&&(h.xp6(),h.hij(" ",h.lcZ(2,1,"addon.messages.unabletomessage")," "))}function AddonMessagesDiscussionPage_ion_footer_46_div_3_Template(e,n){if(1&e){const e=h.EpF();h.TgZ(0,"div",46)(1,"p",29),h._uU(2),h.ALo(3,"translate"),h.qZA(),h.TgZ(4,"ion-button",47),h.NdJ("click",(function AddonMessagesDiscussionPage_ion_footer_46_div_3_Template_ion_button_click_4_listener(){h.CHM(e);const n=h.oxw(2);return h.KtG(n.unblockUser())})),h._uU(5),h.ALo(6,"translate"),h.qZA()()}2&e&&(h.xp6(2),h.Oqu(h.lcZ(3,2,"addon.messages.youhaveblockeduser")),h.xp6(3),h.hij(" ",h.lcZ(6,4,"addon.messages.unblockuser")," "))}const _c0=e=>({$a:e});function AddonMessagesDiscussionPage_ion_footer_46_div_4_Template(e,n){if(1&e){const e=h.EpF();h.TgZ(0,"div",46)(1,"p",29)(2,"strong"),h._uU(3),h.ALo(4,"translate"),h.qZA()(),h.TgZ(5,"p",29),h._uU(6),h.ALo(7,"translate"),h.qZA(),h.TgZ(8,"ion-button",47),h.NdJ("click",(function AddonMessagesDiscussionPage_ion_footer_46_div_4_Template_ion_button_click_8_listener(){h.CHM(e);const n=h.oxw(2);return h.KtG(n.createContactRequest())})),h._uU(9),h.ALo(10,"translate"),h.qZA()()}if(2&e){const e=h.oxw(2);h.xp6(3),h.Oqu(h.xi3(4,3,"addon.messages.isnotinyourcontacts",h.VKq(11,_c0,e.otherMember.fullname))),h.xp6(3),h.Oqu(h.xi3(7,6,"addon.messages.requirecontacttomessage",h.VKq(13,_c0,e.otherMember.fullname))),h.xp6(3),h.hij(" ",h.lcZ(10,9,"addon.messages.sendcontactrequest")," ")}}function AddonMessagesDiscussionPage_ion_footer_46_div_5_Template(e,n){if(1&e){const e=h.EpF();h.TgZ(0,"div",46)(1,"p",29),h._uU(2),h.ALo(3,"translate"),h.qZA(),h.TgZ(4,"ion-button",47),h.NdJ("click",(function AddonMessagesDiscussionPage_ion_footer_46_div_5_Template_ion_button_click_4_listener(){h.CHM(e);const n=h.oxw(2);return h.KtG(n.confirmContactRequest())})),h._uU(5),h.ALo(6,"translate"),h.qZA(),h.TgZ(7,"ion-button",48),h.NdJ("click",(function AddonMessagesDiscussionPage_ion_footer_46_div_5_Template_ion_button_click_7_listener(){h.CHM(e);const n=h.oxw(2);return h.KtG(n.declineContactRequest())})),h._uU(8),h.ALo(9,"translate"),h.qZA()()}if(2&e){const e=h.oxw(2);h.xp6(2),h.Oqu(h.xi3(3,3,"addon.messages.userwouldliketocontactyou",h.VKq(10,_c0,e.otherMember.fullname))),h.xp6(3),h.hij(" ",h.lcZ(6,6,"addon.messages.acceptandaddcontact")," "),h.xp6(3),h.hij(" ",h.lcZ(9,8,"addon.messages.decline")," ")}}function AddonMessagesDiscussionPage_ion_footer_46_div_6_p_5_Template(e,n){if(1&e&&(h.TgZ(0,"p",29),h._uU(1),h.ALo(2,"translate"),h.qZA()),2&e){const e=h.oxw(3);h.xp6(),h.hij(" ",h.xi3(2,1,"addon.messages.yourcontactrequestpending",h.VKq(4,_c0,e.otherMember.fullname))," ")}}function AddonMessagesDiscussionPage_ion_footer_46_div_6_Template(e,n){if(1&e&&(h.TgZ(0,"div",46)(1,"p",29)(2,"strong"),h._uU(3),h.ALo(4,"translate"),h.qZA()(),h.YNc(5,AddonMessagesDiscussionPage_ion_footer_46_div_6_p_5_Template,3,6,"p",49),h.qZA()),2&e){const e=h.oxw(2);h.xp6(3),h.Oqu(h.lcZ(4,2,"addon.messages.contactrequestsent")),h.xp6(2),h.Q6J("ngIf",e.otherMember)}}function AddonMessagesDiscussionPage_ion_footer_46_core_send_message_form_7_Template(e,n){if(1&e){const e=h.EpF();h.TgZ(0,"core-send-message-form",50),h.NdJ("onSubmit",(function AddonMessagesDiscussionPage_ion_footer_46_core_send_message_form_7_Template_core_send_message_form_onSubmit_0_listener(n){h.CHM(e);const s=h.oxw(2);return h.KtG(s.sendMessage(n))})),h.ALo(1,"translate"),h.qZA()}if(2&e){const e=h.oxw(2);h.Q6J("showKeyboard",e.showKeyboard)("placeholder",h.lcZ(1,2,"addon.messages.newmessage"))}}function AddonMessagesDiscussionPage_ion_footer_46_Template(e,n){if(1&e&&(h.TgZ(0,"ion-footer",40)(1,"ion-toolbar",41),h.YNc(2,AddonMessagesDiscussionPage_ion_footer_46_p_2_Template,3,3,"p",42)(3,AddonMessagesDiscussionPage_ion_footer_46_div_3_Template,7,6,"div",43)(4,AddonMessagesDiscussionPage_ion_footer_46_div_4_Template,11,15,"div",43)(5,AddonMessagesDiscussionPage_ion_footer_46_div_5_Template,10,12,"div",43)(6,AddonMessagesDiscussionPage_ion_footer_46_div_6_Template,6,4,"div",43)(7,AddonMessagesDiscussionPage_ion_footer_46_core_send_message_form_7_Template,2,4,"core-send-message-form",44),h.qZA()()),2&e){const e=h.oxw();h.xp6(),h.Q6J("color","message"===e.footerType?null:"light"),h.xp6(),h.Q6J("ngIf","unable"===e.footerType),h.xp6(),h.Q6J("ngIf","blocked"===e.footerType),h.xp6(),h.Q6J("ngIf","requiresContact"===e.footerType&&e.otherMember),h.xp6(),h.Q6J("ngIf","requestReceived"===e.footerType&&e.otherMember),h.xp6(),h.Q6J("ngIf","requestSent"===e.footerType||"message"===e.footerType&&e.requestContactSent),h.xp6(),h.Q6J("ngIf","message"===e.footerType)}}let W=(()=>{var e;class AddonMessagesDiscussionPage{constructor(e,n){this.route=e,this.elementRef=n,this.fetching=!1,this.messagesBeingSent=0,this.pagesLoaded=1,this.keepMessageMap={},this.oldContentHeight=0,this.scrollBottom=!0,this.viewDestroyed=!1,this.showLoadingModal=!1,this.showInfo=!1,this.loaded=!1,this.showKeyboard=!1,this.canLoadMore=!1,this.loadMoreError=!1,this.messages=[],this.showDelete=!1,this.canDelete=!1,this.isGroup=!1,this.members={},this.favouriteIcon="fa-star",this.deleteIcon="fas-trash",this.blockIcon="fas-user-lock",this.addRemoveIcon="fas-user-plus",this.muteIcon="fas-bell-slash",this.favouriteIconSlash=!1,this.muteEnabled=!1,this.footerType="unable",this.requestContactSent=!1,this.requestContactReceived=!1,this.isSelf=!1,this.newMessages=0,this.unreadMessageFrom=0,this.initialized=!1,this.hostElement=n.nativeElement,this.siteId=i.m9.getCurrentSiteId(),this.currentUserId=i.m9.getCurrentSiteUserId(),this.groupMessagingEnabled=r.r.isGroupMessagingEnabled(),this.muteEnabled=r.r.isMuteConversationEnabled(),this.logger=S.d.getInstance("AddonMessagesDiscussionPage"),this.syncObserver=l.R.on(D.L.AUTO_SYNCED,(e=>{(e.userId&&e.userId==this.userId||e.conversationId&&e.conversationId==this.conversationId)&&(this.fetchMessages(),e.warnings&&e.warnings[0]&&c.OQ.showAlert(void 0,e.warnings[0]))}),this.siteId),this.memberInfoObserver=l.R.on(r.v.MEMBER_INFO_CHANGED_EVENT,(e=>{e.userId&&(this.members[e.userId]||this.otherMember&&e.userId==this.otherMember.id)&&this.fetchData()}),this.siteId)}ngOnInit(){var e=this;return(0,a.Z)((function*(){e.conversationId=u.b.getRouteNumberParam("conversationId"),e.userId=u.b.getRouteNumberParam("userId"),e.showInfo=!u.b.getRouteBooleanParam("hideInfo"),e.showKeyboard=!!u.b.getRouteBooleanParam("showKeyboard"),yield e.fetchData(),e.scrollToBottom(!0)}))()}ngAfterViewInit(){var e=this;return(0,a.Z)((function*(){var n;e.scrollElement=yield null===(n=e.content)||void 0===n?void 0:n.getScrollElement()}))()}addMessage(e,n=!0){e.hash=J.V.hashAsciiStr(String(("id"in e?e.id:"")||e.text||""))+"#"+e.timecreated+"#"+e.useridfrom;let s=!1;return void 0===this.keepMessageMap[e.hash]&&(this.messages.push(e),s=e.useridfrom!=this.currentUserId),this.keepMessageMap[e.hash]=n,s}removeMessage(e){if(this.keepMessageMap[e])return this.keepMessageMap[e]=!1,void 0;delete this.keepMessageMap[e];const n=this.messages.findIndex((n=>n.hash==e));n>=0&&this.messages.splice(n,1)}fetchData(){var e=this;return(0,a.Z)((function*(){let n;e.showLoadingModal&&(n=yield c.OQ.showModalLoading()),!e.groupMessagingEnabled&&e.userId&&L.My.getProfile(e.userId,void 0,!0).then((n=>{e.title||(e.title=n.fullname),e.conversationImage=n.profileimageurl,e.members[n.id]=n})).catch((()=>{}));try{const n=yield D.j.syncDiscussion(e.conversationId,e.userId);n.warnings&&n.warnings[0]&&c.OQ.showAlert(void 0,n.warnings[0])}catch{}try{const n=[];if(e.groupMessagingEnabled){const s=yield e.getConversation(e.conversationId,e.userId);if(s&&n.push(e.fetchMessages()),e.userId){const t=e.userId;n.push(r.r.invalidateMemberInfo(e.userId).then((0,a.Z)((function*(){e.otherMember=yield r.r.getMemberInfo(t),!s&&e.otherMember&&(e.conversationImage=e.otherMember.profileimageurl,e.title=e.otherMember.fullname),e.blockIcon=e.otherMember.isblocked?"fas-user-check":"fas-user-lock"}))))}else e.otherMember=void 0}else{if(e.userId){const s=e.userId;n.push(L.My.getProfile(e.userId).then(function(){var n=(0,a.Z)((function*(n){e.otherMember={id:n.id,fullname:n.fullname,profileurl:"",profileimageurl:n.profileimageurl||"",profileimageurlsmall:n.profileimageurlsmall||"",isonline:!1,showonlinestatus:!1,isblocked:!1,iscontact:!1,isdeleted:!1,canmessageevenifblocked:!0,canmessage:!0,requirescontact:!1},e.otherMember.isblocked=yield r.r.isBlocked(s),e.otherMember.iscontact=yield r.r.isContact(s),e.blockIcon=e.otherMember.isblocked?"fas-user-check":"fas-user-lock"}));return function(e){return n.apply(this,arguments)}}()))}n.push(e.fetchMessages().then((()=>{if(!e.title&&e.messages.length){const n=e.messages[0];"usertofullname"in n&&(e.title=n.useridto!=e.currentUserId?n.usertofullname||"":n.userfromfullname||"")}})))}yield Promise.all(n)}catch(e){c.OQ.showErrorModalDefault(e,"addon.messages.errorwhileretrievingmessages",!0)}finally{e.checkCanDelete(),e.loaded=!0,e.setPolling(),e.setContactRequestInfo(),e.setFooterType(),n&&n.dismiss()}}))()}ionViewDidEnter(){this.setPolling()}ionViewWillLeave(){this.unsetPolling()}fetchMessages(e=!0){var n=this;return(0,a.Z)((function*(){if(n.loadMoreError=!1,!(n.messagesBeingSent>0||n.fetching)){if(n.groupMessagingEnabled&&!n.conversationId)throw new F.G("No enough data provided to fetch messages");if(n.conversationId)n.logger.debug(`Polling new messages for conversation '${n.conversationId}'`);else{if(!n.userId)throw new F.G("No enough data provided to fetch messages");n.logger.debug(`Polling new messages for discussion with user '${n.userId}'`)}n.fetching=!0;try{yield D.j.waitForSyncConversation(n.conversationId,n.userId);let s=[];n.groupMessagingEnabled?(yield r.r.invalidateConversationMessages(n.conversationId),s=yield n.getConversationMessages(n.pagesLoaded)):(yield r.r.invalidateDiscussionCache(n.userId),s=yield n.getDiscussionMessages(n.pagesLoaded)),n.loadMessages(s,e)}finally{n.fetching=!1}}}))()}loadMessages(e,n=!0){if(this.viewDestroyed)return;if(this.scrollBottom=Y.V.scrollIsBottom(this.scrollElement,5),this.messagesBeingSent>0)return;const s=e.reduce(((e,n)=>e+(this.addMessage(n)?1:0)),0);n&&this.setNewMessagesBadge(this.newMessages+s);for(const e in this.keepMessageMap)this.removeMessage(e);r.r.sortMessages(this.messages),this.messages.forEach(((e,n)=>{e.showDate=this.showDate(e,this.messages[n-1]),e.showUserData=this.showUserData(e,this.messages[n-1]),e.showTail=this.showTail(e,this.messages[n+1])}));const t=this.messages[this.messages.length-1],o=this.groupMessagingEnabled&&t&&t.useridfrom!==this.currentUserId&&!!this.lastMessage&&(t.text!==this.lastMessage.text||t.timecreated!==this.lastMessage.timecreated);this.notifyNewMessage(),this.markMessagesAsRead(o)}setNewMessagesBadge(e){0==this.newMessages&&e>0&&this.scrollFunction(),this.newMessages=e}scrollFunction(){var e;if(0==this.newMessages)return;if(Y.V.scrollIsBottom(this.scrollElement,40))return this.setNewMessagesBadge(0),void 0;const n=null===(e=this.scrollElement)||void 0===e?void 0:e.getBoundingClientRect(),s=n&&n.bottom||0;if(0==s)return;const t=Array.from(this.hostElement.querySelectorAll("core-message:not(.is-mine)")).slice(-this.newMessages).reverse().findIndex((e=>{const n=e.getBoundingClientRect();return!!n&&n.bottom<=s}));t>0&&t<this.newMessages&&this.setNewMessagesBadge(t)}getConversation(e,n){var s=this;return(0,a.Z)((function*(){let t;if(!e&&n)try{t=n===s.currentUserId&&r.r.isSelfConversationEnabled()?yield r.r.getSelfConversation():yield r.r.getConversationBetweenUsers(n,void 0,!0),e=t.id}catch(e){s.isSelf=n===s.currentUserId;const t=yield N.M.getMessages(n);if(t&&t.length)t.forEach((e=>{e.pending=!0,e.text=e.smallmessage})),s.loadMessages(t);else if("errorconversationdoesnotexist"!=e.errorcode)throw e;return!1}if(!e)return!1;yield r.r.invalidateConversation(e);try{s.conversation=yield r.r.getConversation(e,void 0,!0)}catch(e){if(!t)throw e;s.conversation=t}return!!s.conversation&&(s.conversationId=s.conversation.id,s.title=s.conversation.name,s.conversationImage=s.conversation.imageurl,s.isGroup=s.conversation.type==r.v.MESSAGE_CONVERSATION_TYPE_GROUP,s.favouriteIcon="fas-star",s.favouriteIconSlash=s.conversation.isfavourite,s.muteIcon=s.conversation.ismuted?"fas-bell":"fas-bell-slash",s.isGroup||(s.userId=s.conversation.userid),s.isSelf=s.conversation.type==r.v.MESSAGE_CONVERSATION_TYPE_SELF,!0)}))()}getConversationMessages(e,n=0){var s=this;return(0,a.Z)((function*(){if(!s.conversationId)return[];const t=n>0,o=yield r.r.getConversationMessages(s.conversationId,{excludePending:t,limitFrom:n});e--,o.members&&o.members.forEach((e=>{s.members[e.id]=e}));const a=o.messages;if(e>0&&o.canLoadMore){n+=r.v.LIMIT_MESSAGES;const t=yield s.getConversationMessages(e,n);return a.concat(t)}return s.canLoadMore=!!o.canLoadMore,a}))()}getDiscussionMessages(e,n=0,s=0,t=0,o=0){var i=this;return(0,a.Z)((function*(){const a=n>0||s>0||t>0||o>0,c=yield r.r.getDiscussion(i.userId,a,n,s,t,o);if(--e>0&&c.canLoadMore){c.messages.forEach((e=>{!e.pending&&"read"in e&&(e.useridfrom==i.userId?e.read?s++:n++:e.read?o++:t++)}));const a=yield i.getDiscussionMessages(e,n,s,t,o);return c.messages.concat(a)}return i.canLoadMore=c.canLoadMore,c.messages}))()}markMessagesAsRead(e){var n=this;return(0,a.Z)((function*(){let s=!1,t=!1;if(e)t=!0;else if(n.groupMessagingEnabled){var o,a;t=!!(null!==(o=n.conversation)&&void 0!==o&&o.unreadcount&&(null===(a=n.conversation)||void 0===a?void 0:a.unreadcount)>0&&n.conversationId&&n.conversationId>0)}else t=n.messages.some((e=>e.useridfrom!=n.currentUserId&&"read"in e&&!e.read));t&&(n.setUnreadLabelPosition(),n.groupMessagingEnabled?yield r.r.markAllConversationMessagesRead(n.conversationId):(yield r.r.markAllMessagesRead(n.userId),n.messages.forEach((e=>{"read"in e&&(e.read=!0)}))),s=!0),s&&l.R.trigger(r.v.READ_CHANGED_EVENT,{conversationId:n.conversationId,userId:n.userId},n.siteId)}))()}notifyNewMessage(){var e,n;const s=this.messages[this.messages.length-1];let t=!1;if(s?s.text===(null===(e=this.lastMessage)||void 0===e?void 0:e.text)&&s.timecreated===(null===(n=this.lastMessage)||void 0===n?void 0:n.timecreated)||(this.lastMessage={text:s.text||"",timecreated:s.timecreated},t=!0):(this.lastMessage=void 0,t=!0),t){var o,a,i,c,d;l.R.trigger(r.v.NEW_MESSAGE_EVENT,{conversationId:this.conversationId,userId:this.userId,message:null===(o=this.lastMessage)||void 0===o?void 0:o.text,timecreated:null!==(a=null===(i=this.lastMessage)||void 0===i?void 0:i.timecreated)&&void 0!==a?a:0,userFrom:null!=s&&s.useridfrom?this.members[s.useridfrom]:void 0,isfavourite:!(null===(c=this.conversation)||void 0===c||!c.isfavourite),type:null===(d=this.conversation)||void 0===d?void 0:d.type},this.siteId);this.canDelete!=(s&&"id"in s&&s.id&&1==this.messages.length||this.messages.length>1)&&this.checkCanDelete()}}setUnreadLabelPosition(){if(0==this.unreadMessageFrom){if(this.groupMessagingEnabled){var e,n;if(this.conversation&&null!==(e=this.conversation)&&void 0!==e&&e.unreadcount&&(null===(n=this.conversation)||void 0===n?void 0:n.unreadcount)>0&&this.messages){let e=0;for(let n=this.messages.length-1;n>=0;n--){const s=this.messages[n];if(!s.pending&&s.useridfrom!=this.currentUserId&&"id"in s&&(e++,e==this.conversation.unreadcount)){this.unreadMessageFrom=Number(s.id);break}}}}else{let e=!1;for(const n in this.messages){const s=this.messages[n];if(s.useridfrom!=this.currentUserId&&"read"in s){if(!s.read&&e){this.unreadMessageFrom=Number(s.id);break}e=!!s.read}}}0==this.unreadMessageFrom&&(this.unreadMessageFrom=-1)}}checkCanDelete(){const e=this.messages[0];this.canDelete=e&&!e.sending}hideUnreadLabel(){this.unreadMessageFrom>0&&(this.unreadMessageFrom=-1)}waitForFetch(){var e=this;return(0,a.Z)((function*(){e.fetching&&(yield U.Tr.wait(400),yield U.Tr.ignoreErrors(e.waitForFetch()))}))()}setPolling(){this.groupMessagingEnabled&&!this.conversationId||this.polling||(this.polling=window.setInterval((()=>{this.fetchMessages().catch((()=>{}))}),r.v.POLL_INTERVAL))}unsetPolling(){this.polling&&(this.logger.debug(`Cancelling polling for conversation with user '${this.userId}'`),clearInterval(this.polling),this.polling=void 0)}copyMessage(e){U.Tr.copyToClipboard(Q._1.decodeHTMLEntities("smallmessage"in e?e.smallmessage||e.text||"":e.text||""))}deleteMessage(e,n){var s=this;return(0,a.Z)((function*(){const t=s.conversation&&s.conversation.candeletemessagesforallusers,o=e.pending||t||s.isSelf?"core.areyousure":"addon.messages.deletemessageconfirmation",a={};t&&!e.pending&&(a.inputs=[{type:"checkbox",name:"deleteforall",checked:!1,value:!0,label:g.vN.instant("addon.messages.deleteforeveryone")}]);try{const t=yield c.OQ.showConfirm(g.vN.instant(o),void 0,void 0,void 0,a),i=yield c.OQ.showModalLoading("core.deleting",!0);try{yield r.r.deleteMessage(e,t&&t[0]),s.messages.splice(n,1),s.removeMessage(e.hash),s.notifyNewMessage(),s.fetchMessages()}finally{i.dismiss()}}catch(e){c.OQ.showErrorModalDefault(e,"addon.messages.errordeletemessage",!0)}}))()}loadPrevious(e){var n=this;return(0,a.Z)((function*(){var s,t;if(!n.initialized)return e&&e(),void 0;let o=(null===(s=n.infinite)||void 0===s?void 0:s.hostElement.getBoundingClientRect().height)||0;const a=(null===(t=n.scrollElement)||void 0===t?void 0:t.scrollHeight)||0;try{yield n.waitForFetch()}finally{n.pagesLoaded++;try{var i,r;yield n.fetchMessages(!1);const e=a-((null===(i=n.scrollElement)||void 0===i?void 0:i.scrollTop)||0),s=(null===(r=n.infinite)||void 0===r?void 0:r.hostElement.getBoundingClientRect().height)||0;n.canLoadMore&&o&&n.infinite?o-=s:n.canLoadMore||(o=o||s),n.keepScroll(a,e,o)}catch(e){n.loadMoreError=!0,n.pagesLoaded--,c.OQ.showErrorModalDefault(e,"addon.messages.errorwhileretrievingmessages",!0)}finally{e&&e()}}}))()}keepScroll(e,n,s,t=0){setTimeout((()=>{var o;if(((null===(o=this.scrollElement)||void 0===o?void 0:o.scrollHeight)||0)==e)return t<=10&&this.keepScroll(e,n,s,t+1),void 0;setTimeout((()=>{var e;const t=(null===(e=this.scrollElement)||void 0===e?void 0:e.scrollHeight)||0;this.content.scrollToPoint(0,t-n+s,0)}),30)}),30)}scrollToBottom(e=!1){var n=this;return(0,a.Z)((function*(){(n.scrollBottom||e)&&(n.scrollBottom=!1,n.setNewMessagesBadge(0),yield U.Tr.nextTicks(5),!n.viewDestroyed&&n.content&&n.content.scrollToBottom(0),e&&(n.initialized=!0))}))()}scrollToFirstUnreadMessage(){if(this.newMessages>0){const e=Array.from(this.hostElement.querySelectorAll("core-message:not(.is-mine)"));Y.V.scrollToElement(e[e.length-this.newMessages])}}sendMessage(e){var n=this;return(0,a.Z)((function*(){n.hideUnreadLabel(),n.showDelete=!1,n.scrollBottom=!0,n.setNewMessagesBadge(0);const s={id:-1,pending:!0,sending:!0,useridfrom:n.currentUserId,smallmessage:e,text:e,timecreated:Date.now()};s.showDate=n.showDate(s,n.messages[n.messages.length-1]),n.addMessage(s,!1),n.messagesBeingSent++;try{yield n.waitForFetch()}finally{try{let t;t=n.conversationId?yield r.r.sendMessageToConversation(n.conversation,e):yield r.r.sendMessage(n.userId,e),n.messagesBeingSent--;let o=!1;if(t.sent)try{if(!n.conversationId&&t.message&&"conversationid"in t.message){yield n.getConversation(t.message.conversationid,n.userId);try{yield n.fetchMessages()}finally{n.setPolling()}}else yield n.fetchMessages()}catch{o=!0}!o&&t.sent||(s.sending=!1,t.sent?s.pending=!1:t.message&&(s.timecreated=t.message.timecreated||0),n.notifyNewMessage())}catch(e){n.messagesBeingSent--,d.z.closeKeyboard(),c.OQ.showErrorModalDefault(e,"addon.messages.messagenotsent",!0),n.removeMessage(s.hash)}}}))()}showDate(e,n){return!n||!R()(e.timecreated).isSame(n.timecreated,"day")}showUserData(e,n){return this.isGroup&&e.useridfrom!=this.currentUserId&&this.members[e.useridfrom||0]&&(!n||n.useridfrom!=e.useridfrom||!!e.showDate)}showTail(e,n){return!n||n.useridfrom!=e.useridfrom||!!n.showDate}viewInfo(){var e=this;return(0,a.Z)((function*(){if(e.isGroup){const{AddonMessagesConversationInfoComponent:n}=yield s.e(7664).then(s.bind(s,27664)),t=yield c.OQ.openSideModal({component:n,componentProps:{conversationId:e.conversationId}});if(void 0!==t){u.b.isCurrentPathInTablet("**/messages/**/discussion/**")?l.R.trigger(r.v.OPEN_CONVERSATION_EVENT,{userId:t},e.siteId):u.b.navigateToSitePath(`/messages/discussion/user/${t}`)}}else u.b.navigateToSitePath("/user/profile",{params:{userId:e.userId}})}))()}changeFavourite(e){var n=this;return(0,a.Z)((function*(){if(n.conversation){n.favouriteIcon=V.i.ICON_LOADING;try{yield r.r.setFavouriteConversation(n.conversation.id,!n.conversation.isfavourite),n.conversation.isfavourite=!n.conversation.isfavourite,r.r.getConversation(n.conversation.id,void 0,!0),l.R.trigger(r.v.UPDATE_CONVERSATION_LIST_EVENT,{conversationId:n.conversation.id,action:"favourite",value:n.conversation.isfavourite},n.siteId)}catch(e){c.OQ.showErrorModalDefault(e,"Error changing favourite state.")}finally{n.favouriteIcon="fas-star",n.favouriteIconSlash=n.conversation.isfavourite,e&&e()}}}))()}changeMute(e){var n=this;return(0,a.Z)((function*(){if(n.conversation){n.muteIcon=V.i.ICON_LOADING;try{yield r.r.muteConversation(n.conversation.id,!n.conversation.ismuted),n.conversation.ismuted=!n.conversation.ismuted,r.r.getConversation(n.conversation.id,void 0,!0),l.R.trigger(r.v.UPDATE_CONVERSATION_LIST_EVENT,{conversationId:n.conversation.id,action:"mute",value:n.conversation.ismuted},n.siteId)}catch(e){c.OQ.showErrorModalDefault(e,"Error changing muted state.")}finally{n.muteIcon=n.conversation.ismuted?"fas-bell":"fas-bell-slash",e&&e()}}}))()}setContactRequestInfo(){var e,n;(this.requestContactSent=!1,this.requestContactReceived=!1,this.otherMember&&!this.otherMember.iscontact)&&(this.requestContactSent=!(null===(e=this.otherMember.contactrequests)||void 0===e||!e.some((e=>e.userid==this.currentUserId&&e.requesteduserid==this.otherMember.id))),this.requestContactReceived=!(null===(n=this.otherMember.contactrequests)||void 0===n||!n.some((e=>e.userid==this.otherMember.id&&e.requesteduserid==this.currentUserId))))}setFooterType(){this.footerType=this.otherMember?this.otherMember.isblocked?"blocked":this.requestContactReceived?"requestReceived":this.otherMember.canmessage?"message":this.requestContactSent?"requestSent":this.otherMember.requirescontact?"requiresContact":"unable":"message"}blockUser(){var e=this;return(0,a.Z)((function*(){if(!e.otherMember)throw new F.G("No member selected to be blocked.");if(e.otherMember.canmessageevenifblocked)return c.OQ.showErrorModal(g.vN.instant("addon.messages.cantblockuser",{$a:e.otherMember.fullname})),void 0;const n=g.vN.instant("addon.messages.blockuserconfirm",{$a:e.otherMember.fullname}),s=g.vN.instant("addon.messages.blockuser");try{yield c.OQ.showConfirm(n,void 0,s),e.blockIcon=V.i.ICON_LOADING;const t=yield c.OQ.showModalLoading("core.sending",!0);e.showLoadingModal=!0;try{try{yield r.r.blockContact(e.otherMember.id)}finally{t.dismiss(),e.showLoadingModal=!1}}catch(e){c.OQ.showErrorModalDefault(e,"core.error",!0)}finally{e.blockIcon=e.otherMember.isblocked?"fas-user-check":"fas-user-lock"}}catch{}}))()}deleteConversation(e){var n=this;return(0,a.Z)((function*(){if(!n.conversation)return;const s="addon.messages."+(n.isSelf?"deleteallselfconfirm":"deleteallconfirm");try{yield c.OQ.showDeleteConfirm(s),n.deleteIcon=V.i.ICON_LOADING;try{try{yield r.r.deleteConversation(n.conversation.id),l.R.trigger(r.v.UPDATE_CONVERSATION_LIST_EVENT,{conversationId:n.conversation.id,action:"delete"},n.siteId),n.messages=[]}finally{e&&e()}}catch(e){c.OQ.showErrorModalDefault(e,"Error deleting conversation.")}finally{n.deleteIcon="fas-trash"}}catch{}}))()}unblockUser(){var e=this;return(0,a.Z)((function*(){if(!e.otherMember)throw new F.G("No member selected to be unblocked.");const n=g.vN.instant("addon.messages.unblockuserconfirm",{$a:e.otherMember.fullname}),s=g.vN.instant("addon.messages.unblockuser");try{yield c.OQ.showConfirm(n,void 0,s),e.blockIcon=V.i.ICON_LOADING;const t=yield c.OQ.showModalLoading("core.sending",!0);e.showLoadingModal=!0;try{try{yield r.r.unblockContact(e.otherMember.id)}finally{t.dismiss(),e.showLoadingModal=!1}}catch(e){c.OQ.showErrorModalDefault(e,"core.error",!0)}finally{e.blockIcon=e.otherMember.isblocked?"fas-user-check":"fas-user-lock"}}catch{}}))()}createContactRequest(){var e=this;return(0,a.Z)((function*(){if(!e.otherMember)throw new F.G("No member selected to be requested.");const n=g.vN.instant("addon.messages.addcontactconfirm",{$a:e.otherMember.fullname}),s=g.vN.instant("core.add");try{yield c.OQ.showConfirm(n,void 0,s),e.addRemoveIcon=V.i.ICON_LOADING;const t=yield c.OQ.showModalLoading("core.sending",!0);e.showLoadingModal=!0;try{try{yield r.r.createContactRequest(e.otherMember.id)}finally{t.dismiss(),e.showLoadingModal=!1}}catch(e){c.OQ.showErrorModalDefault(e,"core.error",!0)}finally{e.addRemoveIcon="fas-user-plus"}}catch{}}))()}confirmContactRequest(){var e=this;return(0,a.Z)((function*(){if(!e.otherMember)throw new F.G("No member selected to be confirmed.");const n=yield c.OQ.showModalLoading("core.sending",!0);e.showLoadingModal=!0;try{try{yield r.r.confirmContactRequest(e.otherMember.id)}finally{n.dismiss(),e.showLoadingModal=!1}}catch(e){c.OQ.showErrorModalDefault(e,"core.error",!0)}}))()}declineContactRequest(){var e=this;return(0,a.Z)((function*(){if(!e.otherMember)throw new F.G("No member selected to be declined.");const n=yield c.OQ.showModalLoading("core.sending",!0);e.showLoadingModal=!0;try{try{yield r.r.declineContactRequest(e.otherMember.id)}finally{n.dismiss(),e.showLoadingModal=!1}}catch(e){c.OQ.showErrorModalDefault(e,"core.error",!0)}}))()}removeContact(){var e=this;return(0,a.Z)((function*(){if(!e.otherMember)throw new F.G("No member selected to be removed.");const n=g.vN.instant("addon.messages.removecontactconfirm",{$a:e.otherMember.fullname}),s=g.vN.instant("core.remove");try{yield c.OQ.showConfirm(n,void 0,s),e.addRemoveIcon=V.i.ICON_LOADING;const t=yield c.OQ.showModalLoading("core.sending",!0);e.showLoadingModal=!0;try{try{yield r.r.removeContact(e.otherMember.id)}finally{t.dismiss(),e.showLoadingModal=!1}}catch(e){c.OQ.showErrorModalDefault(e,"core.error",!0)}finally{e.addRemoveIcon="fas-user-plus"}}catch{}}))()}ngOnDestroy(){var e,n;this.unsetPolling(),null===(e=this.syncObserver)||void 0===e||e.off(),null===(n=this.memberInfoObserver)||void 0===n||n.off(),this.viewDestroyed=!0}}return(e=AddonMessagesDiscussionPage).ɵfac=function AddonMessagesDiscussionPage_Factory(n){return new(n||e)(h.Y36(p.gz),h.Y36(h.SBq))},e.ɵcmp=h.Xpm({type:e,selectors:[["page-addon-messages-discussion"]],viewQuery:function AddonMessagesDiscussionPage_Query(e,n){if(1&e&&(h.Gf(b.W2,5),h.Gf(I.n,5)),2&e){let e;h.iGM(e=h.CRH())&&(n.content=e.first),h.iGM(e=h.CRH())&&(n.infinite=e.first)}},decls:47,vars:87,consts:[["slot","start"],[3,"text"],["class","core-bar-button-image","alt","","onError","this.src='assets/img/group-avatar.svg'","core-external-content","","role","presentation",3,"src","siteId",4,"ngIf"],["class","core-bar-button-image",3,"user","linkProfile","checkOnline",4,"ngIf"],["contextLevel","system",3,"text","contextInstanceId"],["name","fas-star",4,"ngIf"],["name","fas-bell-slash",4,"ngIf"],["slot","end"],["iconAction","fas-circle-info",3,"hidden","priority","content","action"],[3,"hidden","priority","closeOnClick","content","iconAction","iconSlash","action"],[3,"hidden","priority","content","iconAction","action"],[3,"hidden","priority","closeOnClick","content","iconAction","action"],["iconAction","toggle",3,"hidden","priority","content","toggle","toggleChange"],[3,"hidden","priority","content","closeOnClick","iconAction","action"],[3,"hidden","priority","content","iconAction","iconSlash","action"],[3,"ionScroll"],[3,"hideUntil"],["position","top",3,"enabled","error","action"],[4,"ngIf"],[1,"sr-only"],[1,"addon-messages-discussion-container"],[4,"ngFor","ngForOf"],["icon","far-comments",3,"message",4,"ngIf"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end",4,"ngIf"],["class","footer-adjustable",4,"ngIf"],["alt","","onError","this.src='assets/img/group-avatar.svg'","core-external-content","","role","presentation",1,"core-bar-button-image",3,"src","siteId"],[1,"core-bar-button-image",3,"user","linkProfile","checkOnline"],["name","fas-star"],["name","fas-bell-slash"],[1,"ion-text-center"],["class","ion-text-center addon-messages-date",4,"ngIf"],["class","addon-messages-unreadfrom","color","light",4,"ngIf"],[3,"message","user","text","showDelete","time","afterRender","onDeleteMessage"],[1,"ion-text-center","addon-messages-date"],["color","light",1,"addon-messages-unreadfrom"],["name","fas-arrow-down","aria-hidden","true"],["icon","far-comments",3,"message"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],["size","small","color","light",3,"click"],[1,"core-discussion-messages-badge"],[1,"footer-adjustable"],[3,"color"],["class","ion-text-center ion-margin-horizontal",4,"ngIf"],["class","ion-padding-horizontal",4,"ngIf"],[3,"showKeyboard","placeholder","onSubmit",4,"ngIf"],[1,"ion-text-center","ion-margin-horizontal"],[1,"ion-padding-horizontal"],["expand","block",1,"ion-text-wrap","ion-margin-bottom",3,"click"],["expand","block","fill","outline",1,"ion-text-wrap","ion-margin-bottom",3,"click"],["class","ion-text-center",4,"ngIf"],[3,"showKeyboard","placeholder","onSubmit"]],template:function AddonMessagesDiscussionPage_Template(e,n){1&e&&(h.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),h._UZ(3,"ion-back-button",1),h.ALo(4,"translate"),h.qZA(),h.TgZ(5,"ion-title")(6,"h1"),h.YNc(7,AddonMessagesDiscussionPage_img_7_Template,1,2,"img",2)(8,AddonMessagesDiscussionPage_core_user_avatar_8_Template,1,3,"core-user-avatar",3),h._UZ(9,"core-format-text",4),h.YNc(10,AddonMessagesDiscussionPage_ion_icon_10_Template,2,3,"ion-icon",5)(11,AddonMessagesDiscussionPage_ion_icon_11_Template,2,3,"ion-icon",6),h.qZA()(),h._UZ(12,"ion-buttons",7),h.qZA(),h.TgZ(13,"core-navbar-buttons",7)(14,"core-context-menu"),h.ALo(15,"translate"),h.TgZ(16,"core-context-menu-item",8),h.NdJ("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_16_listener(){return n.viewInfo()})),h.ALo(17,"translate"),h.qZA(),h.TgZ(18,"core-context-menu-item",8),h.NdJ("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_18_listener(){return n.viewInfo()})),h.ALo(19,"translate"),h.qZA(),h.TgZ(20,"core-context-menu-item",9),h.NdJ("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_20_listener(e){return n.changeFavourite(e)})),h.ALo(21,"translate"),h.qZA(),h.TgZ(22,"core-context-menu-item",10),h.NdJ("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_22_listener(){return n.blockUser()})),h.ALo(23,"translate"),h.qZA(),h.TgZ(24,"core-context-menu-item",10),h.NdJ("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_24_listener(){return n.unblockUser()})),h.ALo(25,"translate"),h.qZA(),h.TgZ(26,"core-context-menu-item",11),h.NdJ("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_26_listener(e){return n.changeMute(e)})),h.ALo(27,"translate"),h.qZA(),h.TgZ(28,"core-context-menu-item",12),h.NdJ("toggleChange",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_toggleChange_28_listener(e){return n.showDelete=e})),h.ALo(29,"translate"),h.qZA(),h.TgZ(30,"core-context-menu-item",13),h.NdJ("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_30_listener(e){return n.deleteConversation(e)})),h.ALo(31,"translate"),h.qZA(),h.TgZ(32,"core-context-menu-item",10),h.NdJ("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_32_listener(){return n.createContactRequest()})),h.ALo(33,"translate"),h.qZA(),h.TgZ(34,"core-context-menu-item",14),h.NdJ("action",(function AddonMessagesDiscussionPage_Template_core_context_menu_item_action_34_listener(){return n.removeContact()})),h.ALo(35,"translate"),h.qZA()()()(),h.TgZ(36,"ion-content",15),h.NdJ("ionScroll",(function AddonMessagesDiscussionPage_Template_ion_content_ionScroll_36_listener(){return n.scrollFunction()})),h.TgZ(37,"core-loading",16)(38,"core-infinite-loading",17),h.NdJ("action",(function AddonMessagesDiscussionPage_Template_core_infinite_loading_action_38_listener(e){return n.loadPrevious(e)})),h.qZA(),h.YNc(39,AddonMessagesDiscussionPage_ng_container_39_Template,8,6,"ng-container",18),h.TgZ(40,"h2",19),h._uU(41),h.qZA(),h.TgZ(42,"ion-list",20),h.YNc(43,AddonMessagesDiscussionPage_ng_container_43_Template,4,7,"ng-container",21),h.qZA(),h.YNc(44,AddonMessagesDiscussionPage_core_empty_box_44_Template,2,3,"core-empty-box",22),h.qZA(),h.YNc(45,AddonMessagesDiscussionPage_ion_fab_45_Template,9,7,"ion-fab",23),h.qZA(),h.YNc(46,AddonMessagesDiscussionPage_ion_footer_46_Template,8,7,"ion-footer",24)),2&e&&(h.xp6(3),h.Q6J("text",h.lcZ(4,63,"core.back")),h.xp6(4),h.Q6J("ngIf",n.loaded&&!n.otherMember&&n.conversationImage),h.xp6(),h.Q6J("ngIf",n.loaded&&n.otherMember),h.xp6(),h.Q6J("text",n.title)("contextInstanceId",0),h.xp6(),h.Q6J("ngIf",n.conversation&&n.conversation.isfavourite),h.xp6(),h.Q6J("ngIf",n.conversation&&n.conversation.ismuted),h.xp6(3),h.uIk("aria-label",h.lcZ(15,65,"addon.messages.conversationactions")),h.xp6(2),h.Q6J("hidden",n.isSelf||!n.showInfo||n.isGroup)("priority",1e3)("content",h.lcZ(17,67,"addon.messages.info")),h.xp6(2),h.Q6J("hidden",n.isSelf||!n.showInfo||!n.isGroup)("priority",1e3)("content",h.lcZ(19,69,"addon.messages.groupinfo")),h.xp6(2),h.Q6J("hidden",!n.groupMessagingEnabled||!n.conversation)("priority",800)("closeOnClick",!1)("content",h.lcZ(21,71,n.conversation&&n.conversation.isfavourite?"addon.messages.removefromfavourites":"addon.messages.addtofavourites"))("iconAction",n.favouriteIcon)("iconSlash",n.favouriteIconSlash),h.xp6(2),h.Q6J("hidden",n.isSelf||!n.otherMember||n.otherMember.isblocked)("priority",700)("content",h.lcZ(23,73,"addon.messages.blockuser"))("iconAction",n.blockIcon),h.xp6(2),h.Q6J("hidden",n.isSelf||!n.otherMember||!n.otherMember.isblocked)("priority",700)("content",h.lcZ(25,75,"addon.messages.unblockuser"))("iconAction",n.blockIcon),h.xp6(2),h.Q6J("hidden",n.isSelf||!n.muteEnabled||!n.conversation)("priority",600)("closeOnClick",!1)("content",h.lcZ(27,77,n.conversation&&n.conversation.ismuted?"addon.messages.unmuteconversation":"addon.messages.muteconversation"))("iconAction",n.muteIcon),h.xp6(2),h.Q6J("hidden",!n.canDelete||!n.messages||!n.messages.length)("priority",400)("content",h.lcZ(29,79,"addon.messages.showdeletemessages"))("toggle",n.showDelete),h.xp6(2),h.Q6J("hidden",!n.groupMessagingEnabled||!n.conversationId||n.isGroup||!n.messages||!n.messages.length)("priority",200)("content",h.lcZ(31,81,"addon.messages.deleteconversation"))("closeOnClick",!1)("iconAction",n.deleteIcon),h.xp6(2),h.Q6J("hidden",n.isSelf||!n.otherMember||n.otherMember.iscontact||n.requestContactSent||n.requestContactReceived)("priority",100)("content",h.lcZ(33,83,"addon.messages.addtoyourcontacts"))("iconAction",n.addRemoveIcon),h.xp6(2),h.Q6J("hidden",n.isSelf||!n.otherMember||!n.otherMember.iscontact)("priority",100)("content",h.lcZ(35,85,"addon.messages.removefromyourcontacts"))("iconAction",n.addRemoveIcon)("iconSlash",!0),h.xp6(3),h.Q6J("hideUntil",n.loaded),h.xp6(),h.Q6J("enabled",n.canLoadMore)("error",n.loadMoreError),h.xp6(),h.Q6J("ngIf",n.isSelf&&!n.canLoadMore),h.xp6(2),h.Oqu(n.title),h.xp6(),h.ekj("addon-messages-discussion-group",n.isGroup),h.uIk("aria-live","polite"),h.xp6(),h.Q6J("ngForOf",n.messages),h.xp6(),h.Q6J("ngIf",!n.messages||n.messages.length<=0),h.xp6(),h.Q6J("ngIf",n.loaded&&n.newMessages>0),h.xp6(),h.Q6J("ngIf",n.loaded&&(!n.conversationId||n.conversation)))},dependencies:[f.sg,f.O5,M.P,$.l,v.z,I.n,C.r,B.F,H.J,K.j,P.X,z.l,j.U,w.I,q.r,x.t,k.O,b.yp,b.YG,b.Sm,b.hM,b.W2,b.IJ,b.W4,b.fr,b.Gu,b.gu,b.Q$,b.q_,b.wd,b.sr,b.oU,X.o,A.X$],styles:[".ios[_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child, .ios   [_nghost-%COMP%]   ion-footer[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%]:last-child{padding-bottom:4px;min-height:0}ion-content[_ngcontent-%COMP%]{--content-background: var(--background-alternative);--background: var(--content-background)}ion-content[_ngcontent-%COMP%]::part(scroll){padding-bottom:0!important}.addon-messages-discussion-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:16px!important;background:var(--content-background)}.addon-messages-date[_ngcontent-%COMP%]{font-weight:400;font-size:.9rem}","[_nghost-%COMP%]   .addon-messages-unreadfrom[_ngcontent-%COMP%]{color:var(--primary);background-color:transparent;margin-top:6px;margin-left:auto;margin-right:auto}[_nghost-%COMP%]   .addon-messages-unreadfrom[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--primary);background-color:transparent}[_nghost-%COMP%]   .has-fab[_ngcontent-%COMP%]   .scroll-content[_ngcontent-%COMP%]{padding-bottom:0}[_nghost-%COMP%]   ion-fab[_ngcontent-%COMP%]   .core-discussion-messages-badge[_ngcontent-%COMP%]{position:absolute;color:var(--addon-messages-discussion-badge-text);background-color:var(--addon-messages-discussion-badge);display:block;top:0}@supports (inset-inline-start: 0){[_nghost-%COMP%]   ion-fab[_ngcontent-%COMP%]   .core-discussion-messages-badge[_ngcontent-%COMP%]{inset-inline-end:0}}@supports not (inset-inline-start: 0){[_nghost-%COMP%]   ion-fab[_ngcontent-%COMP%]   .core-discussion-messages-badge[_ngcontent-%COMP%]{right:0}[dir=rtl][_nghost-%COMP%]   ion-fab[_ngcontent-%COMP%]   .core-discussion-messages-badge[_ngcontent-%COMP%], [dir=rtl]   [_nghost-%COMP%]   ion-fab[_ngcontent-%COMP%]   .core-discussion-messages-badge[_ngcontent-%COMP%]{left:unset;right:unset;left:0}@supports selector(:dir(rtl)){[_nghost-%COMP%]:dir(rtl)   ion-fab[_ngcontent-%COMP%]   .core-discussion-messages-badge[_ngcontent-%COMP%]{left:unset;right:unset;left:0}}}[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{padding:0}[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{display:flex;align-items:center;padding:0}[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]   .core-bar-button-image[_ngcontent-%COMP%]{margin-inline-end:6px}[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex-shrink:1;display:block}[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-inline-start:6px}.ios[_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%], .ios   [_nghost-%COMP%]   ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{justify-content:center}"]}),AddonMessagesDiscussionPage})();var ee=s(62369),ne=s(52467),se=s(43571),te=s(83431),oe=s(5385);function AddonMessagesDiscussions35Page_ng_container_28_ion_item_9_Template(e,n){if(1&e){const e=h.EpF();h.TgZ(0,"ion-item",8),h.NdJ("click",(function AddonMessagesDiscussions35Page_ng_container_28_ion_item_9_Template_ion_item_click_0_listener(){const n=h.CHM(e).$implicit,s=h.oxw(2);return h.KtG(s.gotoDiscussion(n.userid,n.messageid))})),h._UZ(1,"core-user-avatar",16),h.TgZ(2,"ion-label")(3,"p",10),h._uU(4),h.qZA(),h.TgZ(5,"p"),h._UZ(6,"core-format-text",17),h.qZA()()()}if(2&e){const e=n.$implicit,s=h.oxw(2);h.Q6J("detail",!1),h.uIk("aria-label",e.fullname)("aria-current",e.userid===s.discussionUserId?"page":"false"),h.xp6(),h.Q6J("user",e)("checkOnline",e.showonlinestatus),h.xp6(3),h.Oqu(e.fullname),h.xp6(2),h.Q6J("text",e.lastmessage)("contextInstanceId",0)}}function AddonMessagesDiscussions35Page_ng_container_28_Template(e,n){if(1&e&&(h.ynx(0),h.TgZ(1,"ion-item-divider")(2,"ion-label")(3,"h2"),h._uU(4),h.ALo(5,"translate"),h.qZA()(),h.TgZ(6,"ion-note",14)(7,"ion-badge"),h._uU(8),h.qZA()()(),h.YNc(9,AddonMessagesDiscussions35Page_ng_container_28_ion_item_9_Template,7,8,"ion-item",15),h.BQk()),2&e){const e=h.oxw();h.xp6(4),h.Oqu(h.lcZ(5,3,"core.searchresults")),h.xp6(4),h.Oqu(e.search.results.length),h.xp6(),h.Q6J("ngForOf",e.search.results)}}function AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_span_1_Template(e,n){if(1&e&&(h.TgZ(0,"span",23),h._uU(1),h.ALo(2,"coreDateDayOrTime"),h.qZA()),2&e){const e=h.oxw(2).$implicit;h.xp6(),h.hij(" ",h.lcZ(2,1,e.message.timecreated/1e3)," ")}}function AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_ion_icon_2_Template(e,n){1&e&&h._UZ(0,"ion-icon",24)}function AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_span_3_Template(e,n){1&e&&(h.TgZ(0,"span",25),h._uU(1),h.ALo(2,"translate"),h.qZA()),2&e&&(h.xp6(),h.hij(" ",h.lcZ(2,1,"addon.messages.unreadmessages")," "))}function AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_Template(e,n){if(1&e&&(h.TgZ(0,"ion-note"),h.YNc(1,AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_span_1_Template,3,3,"span",20)(2,AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_ion_icon_2_Template,1,0,"ion-icon",21)(3,AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_span_3_Template,3,3,"span",22),h.qZA()),2&e){const e=h.oxw().$implicit;h.xp6(),h.Q6J("ngIf",e.message.timecreated>0),h.xp6(),h.Q6J("ngIf",e.unread),h.xp6(),h.Q6J("ngIf",e.unread)}}function AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_Template(e,n){if(1&e){const e=h.EpF();h.TgZ(0,"ion-item",8),h.NdJ("click",(function AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_Template_ion_item_click_0_listener(){const n=h.CHM(e).$implicit,s=h.oxw(2);return h.KtG(s.gotoDiscussion(n.message.user))})),h._UZ(1,"core-user-avatar",18),h.TgZ(2,"ion-label")(3,"div",19)(4,"p",10),h._uU(5),h.qZA(),h.YNc(6,AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_ion_note_6_Template,4,3,"ion-note",11),h.qZA(),h.TgZ(7,"p"),h._UZ(8,"core-format-text",17),h.qZA()()()}if(2&e){const e=n.$implicit,s=h.oxw(2);h.Q6J("detail",!1),h.uIk("aria-label",e.fullname)("aria-current",e.message.user===s.discussionUserId?"page":"false"),h.xp6(),h.Q6J("user",e),h.xp6(4),h.Oqu(e.fullname),h.xp6(),h.Q6J("ngIf",e.message.timecreated>0||e.unread),h.xp6(2),h.Q6J("text",e.message.message)("contextInstanceId",0)}}function AddonMessagesDiscussions35Page_ng_container_29_Template(e,n){if(1&e&&(h.ynx(0),h.YNc(1,AddonMessagesDiscussions35Page_ng_container_29_ion_item_1_Template,9,8,"ion-item",15),h.BQk()),2&e){const e=h.oxw();h.xp6(),h.Q6J("ngForOf",e.discussions)}}function AddonMessagesDiscussions35Page_core_empty_box_30_Template(e,n){1&e&&(h._UZ(0,"core-empty-box",26),h.ALo(1,"translate")),2&e&&h.Q6J("message",h.lcZ(1,1,"addon.messages.nomessagesfound"))}function AddonMessagesDiscussions35Page_core_empty_box_31_Template(e,n){1&e&&(h._UZ(0,"core-empty-box",27),h.ALo(1,"translate")),2&e&&h.Q6J("message",h.lcZ(1,1,"core.noresults"))}let ae=(()=>{var e;class AddonMessagesDiscussions35Page{constructor(e){this.route=e,this.loaded=!1,this.loadingMessage="",this.discussions=[],this.search={showResults:!1,results:[],loading:"",text:""},this.search.loading=g.vN.instant("core.searching"),this.loadingMessages=g.vN.instant("core.loading"),this.siteId=i.m9.getCurrentSiteId(),this.newMessagesObserver=l.R.on(r.v.NEW_MESSAGE_EVENT,(e=>{if(e.userId&&this.discussions){const s=this.discussions.find((n=>{var s;return(null===(s=n.message)||void 0===s?void 0:s.user)===e.userId}));if(void 0===s)this.loaded=!1,this.refreshData().finally((()=>{this.loaded=!0}));else if(s.message){var n;s.message.message=null!==(n=e.message)&&void 0!==n?n:"",s.message.timecreated=e.timecreated}}}),this.siteId),this.readChangedObserver=l.R.on(r.v.READ_CHANGED_EVENT,(e=>{if(e.userId&&this.discussions){const n=this.discussions.find((n=>{var s;return(null===(s=n.message)||void 0===s?void 0:s.user)===e.userId}));void 0!==n&&(n.unread=!1,r.r.invalidateConversations(this.siteId),r.r.refreshUnreadConversationCounts(this.siteId))}}),this.siteId),this.appResumeSubscription=se.n.resume.subscribe((()=>{this.loaded&&(this.loaded=!1,this.refreshData())})),this.pushObserver=ee.F.on("receive").subscribe((e=>{U.Tr.isFalseOrZero(e.notif)&&e.site==this.siteId&&this.refreshData(void 0,!1)}))}ngOnInit(){var e=this;return(0,a.Z)((function*(){e.route.queryParams.subscribe(function(){var n=(0,a.Z)((function*(n){var s;e.discussionUserId=null!==(s=u.b.getRouteNumberParam("userId",{params:n}))&&void 0!==s?s:e.discussionUserId}));return function(e){return n.apply(this,arguments)}}());const n=new ne.L;yield e.fetchData(),!e.discussionUserId&&e.discussions.length>0&&_.X4.isTablet&&e.discussions[0].message&&(yield e.gotoDiscussion(e.discussions[0].message.user)),n.treatLink()}))()}refreshData(e,n=!0){var s=this;return(0,a.Z)((function*(){const t=[];t.push(r.r.invalidateDiscussionsCache(s.siteId)),n&&t.push(r.r.invalidateUnreadConversationCounts(s.siteId)),yield U.Tr.allPromises(t).finally((()=>s.fetchData().finally((()=>{e&&(null==e||e.complete())}))))}))()}fetchData(){var e=this;return(0,a.Z)((function*(){e.loadingMessage=e.loadingMessages;const n=[];n.push(r.r.getDiscussions(e.siteId).then((n=>{const s=[];for(const e in n)n[e].unread=!!n[e].unread,s.push(n[e]);e.discussions=s.sort(((e,n)=>{var s,t;return((null===(s=n.message)||void 0===s?void 0:s.timecreated)||0)-((null===(t=e.message)||void 0===t?void 0:t.timecreated)||0)}))}))),n.push(r.r.getUnreadConversationCounts(e.siteId));try{yield Promise.all(n)}catch(e){c.OQ.showErrorModalDefault(e,"addon.messages.errorwhileretrievingdiscussions",!0)}e.loaded=!0}))()}clearSearch(){this.loaded=!1,this.search.showResults=!1,this.search.text="",this.fetchData().finally((()=>{this.loaded=!0}))}searchMessage(e){var n=this;return(0,a.Z)((function*(){d.z.closeKeyboard(),n.loaded=!1,n.loadingMessage=n.search.loading;try{const s=yield r.r.searchMessages(e,void 0,void 0,void 0,n.siteId);n.search.showResults=!0,n.search.results=s.messages}catch(e){c.OQ.showErrorModalDefault(e,"addon.messages.errorwhileretrievingmessages",!0)}n.loaded=!0}))()}gotoDiscussion(e,n){var s=this;return(0,a.Z)((function*(){s.discussionUserId=e;const t={};n&&(t.message=n);const o=u.b.getRelativePathToParent("/messages/index")+`discussion/user/${e}`;yield u.b.navigate(o,{params:t,reset:_.X4.isTablet&&!!s.splitView&&!s.splitView.isNested})}))()}gotoContacts(){const e={};_.X4.isTablet&&this.discussionUserId&&(e.discussionUserId=this.discussionUserId),u.b.navigateToSitePath("contacts-35",{params:e})}ngOnDestroy(){var e,n,s,t;null===(e=this.newMessagesObserver)||void 0===e||e.off(),null===(n=this.readChangedObserver)||void 0===n||n.off(),null===(s=this.appResumeSubscription)||void 0===s||s.unsubscribe(),null===(t=this.pushObserver)||void 0===t||t.unsubscribe()}}return(e=AddonMessagesDiscussions35Page).ɵfac=function AddonMessagesDiscussions35Page_Factory(n){return new(n||e)(h.Y36(p.gz))},e.ɵcmp=h.Xpm({type:e,selectors:[["addon-messages-discussions"]],viewQuery:function AddonMessagesDiscussions35Page_Query(e,n){if(1&e&&h.Gf(m.A,5),2&e){let e;h.iGM(e=h.CRH())&&(n.splitView=e.first)}},decls:32,vars:28,consts:[["slot","start"],[3,"text"],["slot","end"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],["autocorrect","off","spellcheck","false","lengthCheck","2","searchArea","AddonMessagesDiscussions",3,"placeholder","disabled","autoFocus","onSubmit","onClear"],[3,"hideUntil","message"],[1,"ion-no-margin"],["button","",1,"ion-text-wrap","addon-message-discussion",3,"detail","click"],["name","fas-address-book","slot","start","aria-hidden","true"],[1,"item-heading"],[4,"ngIf"],["icon","far-comments",3,"message",4,"ngIf"],["icon","fas-magnifying-glass",3,"message",4,"ngIf"],["slot","end",1,"ion-padding-end"],["class","ion-text-wrap addon-message-discussion","button","",3,"detail","click",4,"ngFor","ngForOf"],["slot","start",3,"user","checkOnline"],["clean","true","singleLine","true","contextLevel","system",3,"text","contextInstanceId"],["slot","start","checkOnline","false",3,"user"],[1,"flex-row","ion-justify-content-between"],["class","addon-message-last-message-date",4,"ngIf"],["name","fas-circle","color","primary","aria-hidden","true",4,"ngIf"],["class","sr-only",4,"ngIf"],[1,"addon-message-last-message-date"],["name","fas-circle","color","primary","aria-hidden","true"],[1,"sr-only"],["icon","far-comments",3,"message"],["icon","fas-magnifying-glass",3,"message"]],template:function AddonMessagesDiscussions35Page_Template(e,n){1&e&&(h.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),h._UZ(3,"ion-back-button",1),h.ALo(4,"translate"),h.qZA(),h.TgZ(5,"ion-title")(6,"h1"),h._uU(7),h.ALo(8,"translate"),h.qZA()(),h.TgZ(9,"ion-buttons",2),h._UZ(10,"core-context-menu")(11,"core-user-menu-button"),h.qZA()()(),h.TgZ(12,"ion-content")(13,"core-split-view")(14,"ion-refresher",3),h.NdJ("ionRefresh",(function AddonMessagesDiscussions35Page_Template_ion_refresher_ionRefresh_14_listener(e){return n.refreshData(e.target)})),h._UZ(15,"ion-refresher-content",4),h.ALo(16,"translate"),h.qZA(),h.TgZ(17,"core-search-box",5),h.NdJ("onSubmit",(function AddonMessagesDiscussions35Page_Template_core_search_box_onSubmit_17_listener(e){return n.searchMessage(e)}))("onClear",(function AddonMessagesDiscussions35Page_Template_core_search_box_onClear_17_listener(){return n.clearSearch()})),h.ALo(18,"translate"),h.qZA(),h.TgZ(19,"core-loading",6)(20,"ion-list",7)(21,"ion-item",8),h.NdJ("click",(function AddonMessagesDiscussions35Page_Template_ion_item_click_21_listener(){return n.gotoContacts()})),h.ALo(22,"translate"),h._UZ(23,"ion-icon",9),h.TgZ(24,"ion-label")(25,"p",10),h._uU(26),h.ALo(27,"translate"),h.qZA()()(),h.YNc(28,AddonMessagesDiscussions35Page_ng_container_28_Template,10,5,"ng-container",11)(29,AddonMessagesDiscussions35Page_ng_container_29_Template,2,1,"ng-container",11),h.qZA(),h.YNc(30,AddonMessagesDiscussions35Page_core_empty_box_30_Template,2,3,"core-empty-box",12)(31,AddonMessagesDiscussions35Page_core_empty_box_31_Template,2,3,"core-empty-box",13),h.qZA()()()),2&e&&(h.xp6(3),h.Q6J("text",h.lcZ(4,16,"core.back")),h.xp6(4),h.Oqu(h.lcZ(8,18,"addon.messages.messages")),h.xp6(7),h.Q6J("disabled",!n.loaded),h.xp6(),h.s9C("pullingText",h.lcZ(16,20,"core.pulltorefresh")),h.xp6(2),h.Q6J("placeholder",h.lcZ(18,22,"addon.messages.message"))("disabled",!n.loaded)("autoFocus",!1),h.xp6(2),h.Q6J("hideUntil",n.loaded)("message",n.loadingMessage),h.xp6(2),h.Q6J("detail",!0),h.uIk("aria-label",h.lcZ(22,24,"addon.messages.contacts")),h.xp6(5),h.Oqu(h.lcZ(27,26,"addon.messages.contacts")),h.xp6(2),h.Q6J("ngIf",n.search.showResults),h.xp6(),h.Q6J("ngIf",!n.search.showResults),h.xp6(),h.Q6J("ngIf",(!n.discussions||n.discussions.length<=0)&&!n.search.showResults),h.xp6(),h.Q6J("ngIf",(!n.search.results||n.search.results.length<=0)&&n.search.showResults))},dependencies:[f.sg,f.O5,M.P,v.z,C.r,m.A,P.X,w.I,q.r,x.t,b.yp,b.Sm,b.W2,b.Gu,b.gu,b.Ie,b.rH,b.Q$,b.q_,b.uN,b.nJ,b.Wo,b.wd,b.sr,b.oU,O.L,te.o,oe.c,A.X$],styles:["[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-right:0;margin-left:0}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-inline-start:2px}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-self:flex-start;margin-inline-start:2px}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-top:3px;align-self:flex-end}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%]{white-space:nowrap;font-size:11px}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{white-space:nowrap;color:var(--ion-text-color);margin-inline-end:2px}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex-shrink:1}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]{margin-top:10px}[_nghost-%COMP%]   ion-item-divider[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{margin-left:16px;margin-right:16px}"]}),AddonMessagesDiscussions35Page})();const ie=["favlist"],re=["grouplist"],ce=["indlist"];function AddonMessagesGroupConversationsPage_ion_badge_31_Template(e,n){if(1&e&&(h.TgZ(0,"ion-badge",29),h._uU(1),h.qZA()),2&e){const e=h.oxw();h.xp6(),h.Oqu(e.contactRequestsCount)}}const _c3=e=>({$a:e});function AddonMessagesGroupConversationsPage_span_32_Template(e,n){if(1&e&&(h.TgZ(0,"span",30),h._uU(1),h.ALo(2,"translate"),h.qZA()),2&e){const e=h.oxw();h.xp6(),h.hij(" ",h.xi3(2,1,"addon.messages.pendingcontactrequests",h.VKq(4,_c3,e.contactRequestsCount))," ")}}function AddonMessagesGroupConversationsPage_ion_badge_40_Template(e,n){if(1&e&&(h.TgZ(0,"ion-badge",29),h._uU(1),h.qZA()),2&e){const e=h.oxw();h.xp6(),h.Oqu(e.favourites.unread)}}function AddonMessagesGroupConversationsPage_span_41_Template(e,n){if(1&e&&(h.TgZ(0,"span",30),h._uU(1),h.ALo(2,"translate"),h.qZA()),2&e){const e=h.oxw();h.xp6(),h.hij(" ",h.xi3(2,1,"addon.messages.unreadconversations",h.VKq(4,_c3,e.favourites.unread))," ")}}function AddonMessagesGroupConversationsPage_ng_container_44_Template(e,n){1&e&&h.GkF(0)}function AddonMessagesGroupConversationsPage_ion_item_46_Template(e,n){1&e&&(h.TgZ(0,"ion-item",31)(1,"ion-label")(2,"p"),h._uU(3),h.ALo(4,"translate"),h.qZA()()()),2&e&&(h.xp6(3),h.Oqu(h.lcZ(4,1,"addon.messages.nofavourites")))}function AddonMessagesGroupConversationsPage_ion_item_47_Template(e,n){1&e&&(h.TgZ(0,"ion-item",32)(1,"ion-label"),h._UZ(2,"ion-spinner"),h.ALo(3,"translate"),h.qZA()()),2&e&&(h.xp6(2),h.uIk("aria-label",h.lcZ(3,1,"core.loading")))}function AddonMessagesGroupConversationsPage_ion_badge_55_Template(e,n){if(1&e&&(h.TgZ(0,"ion-badge",29),h._uU(1),h.qZA()),2&e){const e=h.oxw();h.xp6(),h.Oqu(e.group.unread)}}function AddonMessagesGroupConversationsPage_span_56_Template(e,n){if(1&e&&(h.TgZ(0,"span",30),h._uU(1),h.ALo(2,"translate"),h.qZA()),2&e){const e=h.oxw();h.xp6(),h.hij(" ",h.xi3(2,1,"addon.messages.unreadconversations",h.VKq(4,_c3,e.group.unread))," ")}}function AddonMessagesGroupConversationsPage_ng_container_59_Template(e,n){1&e&&h.GkF(0)}function AddonMessagesGroupConversationsPage_ion_item_61_Template(e,n){1&e&&(h.TgZ(0,"ion-item",31)(1,"ion-label")(2,"p"),h._uU(3),h.ALo(4,"translate"),h.qZA()()()),2&e&&(h.xp6(3),h.Oqu(h.lcZ(4,1,"addon.messages.nogroupconversations")))}function AddonMessagesGroupConversationsPage_ion_item_62_Template(e,n){1&e&&(h.TgZ(0,"ion-item",32)(1,"ion-label"),h._UZ(2,"ion-spinner"),h.ALo(3,"translate"),h.qZA()()),2&e&&(h.xp6(2),h.uIk("aria-label",h.lcZ(3,1,"core.loading")))}function AddonMessagesGroupConversationsPage_ion_badge_70_Template(e,n){if(1&e&&(h.TgZ(0,"ion-badge",29),h._uU(1),h.qZA()),2&e){const e=h.oxw();h.xp6(),h.Oqu(e.individual.unread)}}function AddonMessagesGroupConversationsPage_span_71_Template(e,n){if(1&e&&(h.TgZ(0,"span",30),h._uU(1),h.ALo(2,"translate"),h.qZA()),2&e){const e=h.oxw();h.xp6(),h.hij(" ",h.xi3(2,1,"addon.messages.unreadconversations",h.VKq(4,_c3,e.individual.unread))," ")}}function AddonMessagesGroupConversationsPage_ng_container_74_Template(e,n){1&e&&h.GkF(0)}function AddonMessagesGroupConversationsPage_ion_item_76_Template(e,n){1&e&&(h.TgZ(0,"ion-item",31)(1,"ion-label")(2,"p"),h._uU(3),h.ALo(4,"translate"),h.qZA()()()),2&e&&(h.xp6(3),h.Oqu(h.lcZ(4,1,"addon.messages.noindividualconversations")))}function AddonMessagesGroupConversationsPage_ion_item_77_Template(e,n){1&e&&(h.TgZ(0,"ion-item",32)(1,"ion-label"),h._UZ(2,"ion-spinner"),h.ALo(3,"translate"),h.qZA()()),2&e&&(h.xp6(2),h.uIk("aria-label",h.lcZ(3,1,"core.loading")))}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_avatar_1_Template(e,n){if(1&e&&(h.TgZ(0,"ion-avatar",0),h._UZ(1,"img",44),h.qZA()),2&e){const e=h.oxw().$implicit;h.xp6(),h.Q6J("src",e.imageurl,h.LSH)("alt",e.name)}}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_core_user_avatar_2_Template(e,n){if(1&e&&h._UZ(0,"core-user-avatar",45),2&e){const e=h.oxw().$implicit;h.Q6J("user",e.otherUser)("linkProfile",!1)("checkOnline",e.showonlinestatus)}}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_icon_7_Template(e,n){1&e&&(h._UZ(0,"ion-icon",46),h.ALo(1,"translate")),2&e&&h.uIk("aria-label",h.lcZ(1,1,"addon.messages.contactblocked"))}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_icon_8_Template(e,n){1&e&&(h._UZ(0,"ion-icon",47),h.ALo(1,"translate")),2&e&&h.Q6J("title",h.lcZ(1,1,"addon.messages.mutedconversation"))}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_note_9_span_1_Template(e,n){if(1&e&&(h.TgZ(0,"span",50),h._uU(1),h.ALo(2,"coreDateDayOrTime"),h.qZA()),2&e){const e=h.oxw(2).$implicit;h.xp6(),h.hij(" ",h.lcZ(2,1,e.lastmessagedate)," ")}}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_note_9_ion_badge_2_Template(e,n){if(1&e&&(h.TgZ(0,"ion-badge",51),h._uU(1),h.qZA()),2&e){const e=h.oxw(2).$implicit;h.xp6(),h.Oqu(e.unreadcount)}}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_note_9_span_3_Template(e,n){if(1&e&&(h.TgZ(0,"span",30),h._uU(1),h.ALo(2,"translate"),h.qZA()),2&e){const e=h.oxw(2).$implicit;h.xp6(),h.hij(" ",h.xi3(2,1,"addon.messages.unreadmessages",h.VKq(4,_c3,e.unreadcount))," ")}}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_note_9_Template(e,n){if(1&e&&(h.TgZ(0,"ion-note"),h.YNc(1,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_note_9_span_1_Template,3,3,"span",48)(2,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_note_9_ion_badge_2_Template,2,1,"ion-badge",49)(3,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_note_9_span_3_Template,3,6,"span",13),h.qZA()),2&e){const e=h.oxw().$implicit;h.xp6(),h.Q6J("ngIf",e.lastmessagedate>0),h.xp6(),h.Q6J("ngIf",e.unreadcount>0),h.xp6(),h.Q6J("ngIf",e.unreadcount>0)}}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_p_10_Template(e,n){if(1&e&&(h.TgZ(0,"p"),h._UZ(1,"core-format-text",39),h.qZA()),2&e){const e=h.oxw().$implicit;h.xp6(),h.Q6J("text",e.subname)("contextInstanceId",0)}}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_p_11_span_1_Template(e,n){1&e&&(h.TgZ(0,"span",55),h._uU(1),h.ALo(2,"translate"),h.qZA()),2&e&&(h.xp6(),h.hij(" ",h.lcZ(2,1,"addon.messages.you")," "))}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_p_11_span_2_Template(e,n){if(1&e&&(h.TgZ(0,"span",55),h._uU(1),h.qZA()),2&e){const e=h.oxw(2).$implicit;h.xp6(),h.Oqu(e.members[0].fullname+":")}}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_p_11_Template(e,n){if(1&e&&(h.TgZ(0,"p",52),h.YNc(1,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_p_11_span_1_Template,3,3,"span",53)(2,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_p_11_span_2_Template,2,1,"span",53),h._UZ(3,"core-format-text",54),h.qZA()),2&e){const e=h.oxw().$implicit,n=h.oxw(2);h.xp6(),h.Q6J("ngIf",e.sentfromcurrentuser),h.xp6(),h.Q6J("ngIf",!e.sentfromcurrentuser&&e.type===n.typeGroup&&e.members[0]),h.xp6(),h.Q6J("text",e.lastmessage)("contextInstanceId",0)}}function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_Template(e,n){if(1&e){const e=h.EpF();h.TgZ(0,"ion-item",34),h.NdJ("click",(function AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_Template_ion_item_click_0_listener(){const n=h.CHM(e).$implicit,s=h.oxw(2);return h.KtG(s.gotoConversation(n.id,n.userid))})),h.YNc(1,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_avatar_1_Template,2,2,"ion-avatar",35)(2,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_core_user_avatar_2_Template,1,3,"core-user-avatar",36),h.TgZ(3,"ion-label")(4,"div",37)(5,"p",38),h._UZ(6,"core-format-text",39),h.YNc(7,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_icon_7_Template,2,3,"ion-icon",40)(8,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_icon_8_Template,2,3,"ion-icon",41),h.qZA(),h.YNc(9,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_ion_note_9_Template,4,3,"ion-note",42),h.qZA(),h.YNc(10,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_p_10_Template,2,2,"p",42)(11,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_p_11_Template,4,4,"p",43),h.qZA()()}if(2&e){const e=n.$implicit,s=h.oxw(2);h.MGl("id","addon-message-conversation-",e.id?e.id:"user-"+e.userid,""),h.Q6J("detail",!1),h.uIk("aria-current",e.id&&e.id===s.selectedConversationId||e.userid&&e.userid===s.selectedUserId?"page":"false")("aria-label",e.name),h.xp6(),h.Q6J("ngIf",e.type===s.typeGroup),h.xp6(),h.Q6J("ngIf",e.type!==s.typeGroup),h.xp6(4),h.Q6J("text",e.name)("contextInstanceId",0),h.xp6(),h.Q6J("ngIf",e.isblocked),h.xp6(),h.Q6J("ngIf",e.ismuted),h.xp6(),h.Q6J("ngIf",e.lastmessagedate>0||e.unreadcount),h.xp6(),h.Q6J("ngIf",e.subname),h.xp6(),h.Q6J("ngIf",void 0!==e.lastmessage)}}function AddonMessagesGroupConversationsPage_ng_template_78_Template(e,n){if(1&e&&h.YNc(0,AddonMessagesGroupConversationsPage_ng_template_78_ion_item_0_Template,12,13,"ion-item",33),2&e){h.Q6J("ngForOf",n.conversations)}}const _c4=e=>({conversations:e});let de=(()=>{var e;class AddonMessagesGroupConversationsPage{constructor(e){this.route=e,this.loaded=!1,this.contactRequestsCount=0,this.favourites={type:void 0,favourites:!0,count:0,unread:0,conversations:[]},this.group={type:r.v.MESSAGE_CONVERSATION_TYPE_GROUP,favourites:!1,count:0,unread:0,conversations:[]},this.individual={type:r.v.MESSAGE_CONVERSATION_TYPE_INDIVIDUAL,favourites:!1,count:0,unread:0,conversations:[]},this.typeGroup=r.v.MESSAGE_CONVERSATION_TYPE_GROUP,this.loadingMessage=g.vN.instant("core.loading"),this.siteId=i.m9.getCurrentSiteId(),this.currentUserId=i.m9.getCurrentSiteUserId(),this.newMessagesObserver=l.R.on(r.v.NEW_MESSAGE_EVENT,(e=>{const n=this.getExpandedOption();if(n!=this.getConversationOption(e))return;const s=this.findConversation(e.conversationId,e.userId,n);if(void 0===s)return this.loaded=!1,this.refreshData().finally((()=>{this.loaded=!0})),void 0;if(void 0===e.message)return s.lastmessage=void 0,s.lastmessagedate=void 0,s.sentfromcurrentuser=void 0,void 0;if(s.lastmessage!==e.message||s.lastmessagedate!==e.timecreated/1e3){const n=e.timecreated/1e3>(s.lastmessagedate||0);s.lastmessage=e.message,s.lastmessagedate=e.timecreated/1e3,e.userFrom&&(s.sentfromcurrentuser=e.userFrom.id===this.currentUserId,s.type===r.v.MESSAGE_CONVERSATION_TYPE_GROUP&&(s.members[0]=e.userFrom));const o=this.getConversationOption(s);var t;if(o.conversations=r.r.sortConversations(o.conversations||[]),n)null===(t=this.content)||void 0===t||t.scrollToTop()}}),this.siteId),this.readChangedObserver=l.R.on(r.v.READ_CHANGED_EVENT,(e=>{if(e.conversationId){const n=this.findConversation(e.conversationId);void 0!==n&&(n.unreadcount=0,r.r.invalidateConversations(this.siteId),r.r.refreshUnreadConversationCounts(this.siteId))}}),this.siteId),this.openConversationObserver=l.R.on(r.v.OPEN_CONVERSATION_EVENT,(e=>{(e.conversationId||e.userId)&&this.gotoConversation(e.conversationId,e.userId)}),this.siteId),this.appResumeSubscription=se.n.resume.subscribe((()=>{this.loaded&&(this.loaded=!1,this.refreshData().finally((()=>{this.loaded=!0})))})),this.updateConversationListObserver=l.R.on(r.v.UPDATE_CONVERSATION_LIST_EVENT,(e=>{if(e&&"mute"==e.action){const n=this.getExpandedOption();if(n&&n.conversations){const s=this.findConversation(e.conversationId,void 0,n);s&&(s.ismuted=!!e.value)}}else this.refreshData()}),this.siteId),this.pushObserver=ee.F.on("receive").subscribe((e=>{U.Tr.isFalseOrZero(e.notif)&&e.site==this.siteId&&this.refreshData(void 0,!1)})),this.cronObserver=l.R.on(r.v.UNREAD_CONVERSATION_COUNTS_EVENT,(e=>{this.favourites.unread=e.favourites,this.individual.unread=e.individual+e.self,this.group.unread=e.group}),this.siteId),this.contactRequestsCountObserver=l.R.on(r.v.CONTACT_REQUESTS_COUNT_EVENT,(e=>{this.contactRequestsCount=e.count}),this.siteId),this.memberInfoObserver=l.R.on(r.v.MEMBER_INFO_CHANGED_EVENT,(e=>{if(!e.userBlocked&&!e.userUnblocked)return;const n=this.getExpandedOption();if(n==this.individual||n==this.favourites){if(!n.conversations||n.conversations.length<=0)return;const s=this.findConversation(void 0,e.userId,n);s&&(s.isblocked=e.userBlocked)}}),this.siteId)}ngOnInit(){var e=this;return(0,a.Z)((function*(){e.route.queryParams.subscribe(function(){var n=(0,a.Z)((function*(n){const s=u.b.getRouteNumberParam("conversationId",{params:n}),t=u.b.getRouteNumberParam("userId",{params:n});(s||t)&&(e.selectedConversationId=s,e.selectedUserId=t)}));return function(e){return n.apply(this,arguments)}}());const n=new ne.L;if(yield e.fetchData(),!e.selectedConversationId&&!e.selectedUserId&&_.X4.isTablet){let n;const s=e.getExpandedOption();s&&s.conversations.length&&(n=s.conversations[0],n&&(yield e.gotoConversation(n.id)))}n.treatLink()}))()}fetchData(e=!0){var n=this;return(0,a.Z)((function*(){const s=[];s.push(n.fetchConversationCounts()),s.push(r.r.getContactRequestsCount(n.siteId)),e&&s.push(r.r.refreshUnreadConversationCounts(n.siteId));try{if(yield Promise.all(s),void 0===n.favourites.expanded&&(n.selectedConversationId||n.selectedUserId)){const e=[];e.push(n.fetchDataForOption(n.favourites,!1)),e.push(n.fetchDataForOption(n.group,!1)),e.push(n.fetchDataForOption(n.individual,!1)),yield Promise.all(e);const s=n.findConversation(n.selectedConversationId,n.selectedUserId);if(s){const e=n.getConversationOption(s);return yield n.expandOption(e),n.loaded=!0,void 0}}yield n.fetchDataForExpandedOption()}catch(e){c.OQ.showErrorModalDefault(e,"addon.messages.errorwhileretrievingdiscussions",!0)}n.loaded=!0}))()}fetchDataForExpandedOption(){var e=this;return(0,a.Z)((function*(){void 0===e.favourites.expanded&&(e.favourites.expanded=0!=e.favourites.count&&!e.group.unread&&!e.individual.unread,e.group.expanded=!e.favourites.expanded&&0!=e.group.count&&!e.individual.unread,e.individual.expanded=!e.favourites.expanded&&!e.group.expanded),e.loadCurrentListElement();const n=e.getExpandedOption();n&&(yield e.fetchDataForOption(n,!1))}))()}fetchDataForOption(e,n=!1,s=!1){var t=this;return(0,a.Z)((function*(){e.loadMoreError=!1;const o=n?e.conversations.length:0,i=[];let c={conversations:[],canLoadMore:!1},d=[];i.push(r.r.invalidateConversations(t.siteId).then((0,a.Z)((function*(){c=yield r.r.getConversations(e.type,e.favourites,o,t.siteId)})))),n||i.push(N.M.getAllMessages().then((e=>{d=e}))),s&&(i.push(t.fetchConversationCounts()),i.push(r.r.refreshUnreadConversationCounts(t.siteId))),yield Promise.all(i),n?(e.conversations=e.conversations.concat(c.conversations),e.canLoadMore=c.canLoadMore):(e.conversations=c.conversations,e.canLoadMore=c.canLoadMore,d&&d.length&&(yield t.loadOfflineMessages(e,d),e.conversations=r.r.sortConversations(e.conversations)))}))()}fetchConversationCounts(){var e=this;return(0,a.Z)((function*(){yield r.r.invalidateConversationCounts(e.siteId);const n=yield r.r.getConversationCounts(e.siteId);e.favourites.count=n.favourites,e.individual.count=n.individual+n.self,e.group.count=n.group}))()}findConversation(e,n,s){if(e){return(s?s.conversations:this.favourites.conversations.concat(this.group.conversations).concat(this.individual.conversations)).find((n=>n.id==e))}return(s?s.conversations:this.favourites.conversations.concat(this.individual.conversations)).find((e=>e.userid==n))}getExpandedOption(){return this.favourites.expanded?this.favourites:this.group.expanded?this.group:this.individual.expanded?this.individual:void 0}gotoContacts(){u.b.navigateToSitePath("contacts")}gotoConversation(e,n,s){var t=this;return(0,a.Z)((function*(){t.selectedConversationId=e,t.selectedUserId=n;const o={};s&&(o.message=s);const a=u.b.getRelativePathToParent("/messages/group-conversations")+"discussion/"+(e||`user/${n}`);yield u.b.navigate(a,{params:o,reset:_.X4.isTablet&&!!t.splitView&&!t.splitView.isNested})}))()}gotoSettings(){u.b.navigateToSitePath("message-settings")}loadMoreConversations(e,n){var s=this;return(0,a.Z)((function*(){try{yield s.fetchDataForOption(e,!0)}catch(n){c.OQ.showErrorModalDefault(n,"addon.messages.errorwhileretrievingdiscussions",!0),e.loadMoreError=!0}n&&n()}))()}loadOfflineMessages(e,n){var s=this;return(0,a.Z)((function*(){const t=[];n.forEach((n=>{if("conversationid"in n){let t=s.findConversation(n.conversationid,void 0,e);var o,a,i,c,d,l,g,_,u,m;if(t)(null==t.lastmessage||!t.lastmessagepending||(t.lastmessagedate||0)<=n.timecreated/1e3)&&s.addLastOfflineMessage(t,n);else t={id:n.conversationid,type:(null===(o=n.conversation)||void 0===o?void 0:o.type)||r.v.MESSAGE_CONVERSATION_TYPE_INDIVIDUAL,membercount:(null===(a=n.conversation)||void 0===a?void 0:a.membercount)||0,ismuted:(null===(i=n.conversation)||void 0===i?void 0:i.ismuted)||!1,isfavourite:(null===(c=n.conversation)||void 0===c?void 0:c.isfavourite)||!1,isread:(null===(d=n.conversation)||void 0===d?void 0:d.isread)||!1,members:(null===(l=n.conversation)||void 0===l?void 0:l.members)||[],messages:(null===(g=n.conversation)||void 0===g?void 0:g.messages)||[],candeletemessagesforallusers:(null===(_=n.conversation)||void 0===_?void 0:_.candeletemessagesforallusers)||!1,userid:0,name:null===(u=n.conversation)||void 0===u?void 0:u.name,imageurl:(null===(m=n.conversation)||void 0===m?void 0:m.imageurl)||""},s.getConversationOption(t)==e&&(s.addLastOfflineMessage(t,n),s.addOfflineConversation(t))}else if(e.type==r.v.MESSAGE_CONVERSATION_TYPE_INDIVIDUAL){const o=s.findConversation(void 0,n.touserid,e);n.text=n.smallmessage,o?(o.lastmessagedate||0)<=n.timecreated/1e3&&s.addLastOfflineMessage(o,n):t.push(L.My.getProfile(n.touserid,void 0,!0).catch((()=>{})).then((e=>{const t={id:0,type:r.v.MESSAGE_CONVERSATION_TYPE_INDIVIDUAL,membercount:0,ismuted:!1,isfavourite:!1,isread:!1,members:[],messages:[],candeletemessagesforallusers:!1,userid:n.touserid,name:e?e.fullname:String(n.touserid),imageurl:e?e.profileimageurl:""};s.addLastOfflineMessage(t,n),s.addOfflineConversation(t)})))}})),yield Promise.all(t)}))()}addOfflineConversation(e){this.getConversationOption(e).conversations.unshift(e)}addLastOfflineMessage(e,n){e.lastmessage=n.text,e.lastmessagedate=n.timecreated/1e3,e.lastmessagepending=!0,e.sentfromcurrentuser=!0}getConversationOption(e){return e.isfavourite?this.favourites:e.type==r.v.MESSAGE_CONVERSATION_TYPE_GROUP?this.group:this.individual}refreshData(e,n=!0){var s=this;return(0,a.Z)((function*(){try{yield r.r.invalidateContactRequestsCountCache(s.siteId)}finally{try{yield s.fetchData(n)}finally{e&&(null==e||e.complete())}}}))()}toggle(e){e.expanded?(e.expanded=!1,this.loadCurrentListElement()):this.expandOption(e,!0).catch((e=>{c.OQ.showErrorModalDefault(e,"addon.messages.errorwhileretrievingdiscussions",!0)}))}expandOption(e,n=!1){var s=this;return(0,a.Z)((function*(){s.favourites.expanded=!1,s.group.expanded=!1,s.individual.expanded=!1,e.expanded=!0,e.loading=!0;try{yield s.fetchDataForOption(e,!1,n),s.loadCurrentListElement()}catch(n){throw e.expanded=!1,n}finally{e.loading=!1}}))()}loadCurrentListElement(){this.currentListEl=this.favourites.expanded?this.favListEl&&this.favListEl.nativeElement:this.group.expanded?this.groupListEl&&this.groupListEl.nativeElement:this.individual.expanded?this.indListEl&&this.indListEl.nativeElement:void 0}gotoSearch(){u.b.navigateToSitePath("search")}ngOnDestroy(){var e,n,s,t,o,a,i,r,c;null===(e=this.newMessagesObserver)||void 0===e||e.off(),null===(n=this.appResumeSubscription)||void 0===n||n.unsubscribe(),null===(s=this.pushObserver)||void 0===s||s.unsubscribe(),null===(t=this.readChangedObserver)||void 0===t||t.off(),null===(o=this.cronObserver)||void 0===o||o.off(),null===(a=this.openConversationObserver)||void 0===a||a.off(),null===(i=this.updateConversationListObserver)||void 0===i||i.off(),null===(r=this.contactRequestsCountObserver)||void 0===r||r.off(),null===(c=this.memberInfoObserver)||void 0===c||c.off()}}return(e=AddonMessagesGroupConversationsPage).ɵfac=function AddonMessagesGroupConversationsPage_Factory(n){return new(n||e)(h.Y36(p.gz))},e.ɵcmp=h.Xpm({type:e,selectors:[["page-addon-messages-group-conversations"]],viewQuery:function AddonMessagesGroupConversationsPage_Query(e,n){if(1&e&&(h.Gf(m.A,5),h.Gf(b.W2,5),h.Gf(ie,5),h.Gf(re,5),h.Gf(ce,5)),2&e){let e;h.iGM(e=h.CRH())&&(n.splitView=e.first),h.iGM(e=h.CRH())&&(n.content=e.first),h.iGM(e=h.CRH())&&(n.favListEl=e.first),h.iGM(e=h.CRH())&&(n.groupListEl=e.first),h.iGM(e=h.CRH())&&(n.indListEl=e.first)}},decls:80,vars:90,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click"],["name","fas-magnifying-glass","slot","icon-only","aria-hidden","true"],[3,"click"],["name","fas-gear","slot","icon-only","aria-hidden","true"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil","message"],["button","",1,"ion-text-wrap","addon-message-discussion",3,"detail","click"],["name","fas-address-book","slot","start","aria-hidden","true"],["slot","end","aria-hidden","true",4,"ngIf"],["class","sr-only",4,"ngIf"],["button","","aria-controls","addon-messages-groupconversations-favourite","role","heading",1,"ion-text-wrap","divider",3,"detail","click"],["name","fas-chevron-right","flip-rtl","","slot","start","aria-hidden","true",1,"expandable-status-icon"],["id","addon-messages-groupconversations-favourite",3,"hidden"],["favlist",""],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"enabled","error","action"],["class","ion-text-wrap",4,"ngIf"],["class","ion-text-center",4,"ngIf"],["button","","aria-controls","addon-messages-groupconversations-group","role","heading",1,"divider","ion-text-wrap",3,"detail","click"],["id","addon-messages-groupconversations-group",3,"hidden"],["grouplist",""],["button","","aria-controls","addon-messages-groupconversations-individual","role","heading",1,"divider","ion-text-wrap",3,"detail","click"],["id","addon-messages-groupconversations-individual",3,"hidden"],["indlist",""],["conversationsTemplate",""],["slot","end","aria-hidden","true"],[1,"sr-only"],[1,"ion-text-wrap"],[1,"ion-text-center"],["class","ion-text-wrap addon-message-discussion","button","",3,"detail","id","click",4,"ngFor","ngForOf"],["button","",1,"ion-text-wrap","addon-message-discussion",3,"detail","id","click"],["slot","start",4,"ngIf"],["core-user-avatar","","slot","start",3,"user","linkProfile","checkOnline",4,"ngIf"],[1,"flex-row","ion-justify-content-between"],[1,"item-heading"],["contextLevel","system",3,"text","contextInstanceId"],["name","fas-user-slash",4,"ngIf"],["name","fas-volume-xmark",3,"title",4,"ngIf"],[4,"ngIf"],["class","addon-message-last-message",4,"ngIf"],["core-external-content","","onError","this.src='assets/img/group-avatar.svg'",3,"src","alt"],["core-user-avatar","","slot","start",3,"user","linkProfile","checkOnline"],["name","fas-user-slash"],["name","fas-volume-xmark",3,"title"],["class","addon-message-last-message-date",4,"ngIf"],["aria-label","true",4,"ngIf"],[1,"addon-message-last-message-date"],["aria-label","true"],[1,"addon-message-last-message"],["class","addon-message-last-message-user",4,"ngIf"],["clean","true","singleLine","true","contextLevel","system",1,"addon-message-last-message-text",3,"text","contextInstanceId"],[1,"addon-message-last-message-user"]],template:function AddonMessagesGroupConversationsPage_Template(e,n){if(1&e&&(h.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),h._UZ(3,"ion-back-button",1),h.ALo(4,"translate"),h.qZA(),h.TgZ(5,"ion-title")(6,"h1"),h._uU(7),h.ALo(8,"translate"),h.qZA()(),h.TgZ(9,"ion-buttons",2)(10,"ion-button",3),h.NdJ("click",(function AddonMessagesGroupConversationsPage_Template_ion_button_click_10_listener(){return n.gotoSearch()})),h.ALo(11,"translate"),h._UZ(12,"ion-icon",4),h.qZA(),h.TgZ(13,"ion-button",5),h.NdJ("click",(function AddonMessagesGroupConversationsPage_Template_ion_button_click_13_listener(){return n.gotoSettings()})),h.ALo(14,"translate"),h._UZ(15,"ion-icon",6),h.qZA(),h._UZ(16,"core-context-menu")(17,"core-user-menu-button"),h.qZA()()(),h.TgZ(18,"ion-content")(19,"core-split-view")(20,"ion-refresher",7),h.NdJ("ionRefresh",(function AddonMessagesGroupConversationsPage_Template_ion_refresher_ionRefresh_20_listener(e){return n.refreshData(e.target)})),h._UZ(21,"ion-refresher-content",8),h.ALo(22,"translate"),h.qZA(),h.TgZ(23,"core-loading",9)(24,"ion-list")(25,"ion-item",10),h.NdJ("click",(function AddonMessagesGroupConversationsPage_Template_ion_item_click_25_listener(){return n.gotoContacts()})),h._UZ(26,"ion-icon",11),h.TgZ(27,"ion-label")(28,"h2"),h._uU(29),h.ALo(30,"translate"),h.qZA()(),h.YNc(31,AddonMessagesGroupConversationsPage_ion_badge_31_Template,2,1,"ion-badge",12)(32,AddonMessagesGroupConversationsPage_span_32_Template,3,6,"span",13),h.qZA(),h.TgZ(33,"ion-item",14),h.NdJ("click",(function AddonMessagesGroupConversationsPage_Template_ion_item_click_33_listener(){return n.toggle(n.favourites)})),h.ALo(34,"translate"),h._UZ(35,"ion-icon",15),h.TgZ(36,"ion-label")(37,"h2"),h._uU(38),h.ALo(39,"translate"),h.qZA()(),h.YNc(40,AddonMessagesGroupConversationsPage_ion_badge_40_Template,2,1,"ion-badge",12)(41,AddonMessagesGroupConversationsPage_span_41_Template,3,6,"span",13),h.qZA(),h.TgZ(42,"div",16,17),h.YNc(44,AddonMessagesGroupConversationsPage_ng_container_44_Template,1,0,"ng-container",18),h.TgZ(45,"core-infinite-loading",19),h.NdJ("action",(function AddonMessagesGroupConversationsPage_Template_core_infinite_loading_action_45_listener(e){return n.loadMoreConversations(n.favourites,e)})),h.qZA(),h.YNc(46,AddonMessagesGroupConversationsPage_ion_item_46_Template,5,3,"ion-item",20),h.qZA(),h.YNc(47,AddonMessagesGroupConversationsPage_ion_item_47_Template,4,3,"ion-item",21),h.TgZ(48,"ion-item",22),h.NdJ("click",(function AddonMessagesGroupConversationsPage_Template_ion_item_click_48_listener(){return n.toggle(n.group)})),h.ALo(49,"translate"),h._UZ(50,"ion-icon",15),h.TgZ(51,"ion-label")(52,"h2"),h._uU(53),h.ALo(54,"translate"),h.qZA()(),h.YNc(55,AddonMessagesGroupConversationsPage_ion_badge_55_Template,2,1,"ion-badge",12)(56,AddonMessagesGroupConversationsPage_span_56_Template,3,6,"span",13),h.qZA(),h.TgZ(57,"div",23,24),h.YNc(59,AddonMessagesGroupConversationsPage_ng_container_59_Template,1,0,"ng-container",18),h.TgZ(60,"core-infinite-loading",19),h.NdJ("action",(function AddonMessagesGroupConversationsPage_Template_core_infinite_loading_action_60_listener(e){return n.loadMoreConversations(n.group,e)})),h.qZA(),h.YNc(61,AddonMessagesGroupConversationsPage_ion_item_61_Template,5,3,"ion-item",20),h.qZA(),h.YNc(62,AddonMessagesGroupConversationsPage_ion_item_62_Template,4,3,"ion-item",21),h.TgZ(63,"ion-item",25),h.NdJ("click",(function AddonMessagesGroupConversationsPage_Template_ion_item_click_63_listener(){return n.toggle(n.individual)})),h.ALo(64,"translate"),h._UZ(65,"ion-icon",15),h.TgZ(66,"ion-label")(67,"h2"),h._uU(68),h.ALo(69,"translate"),h.qZA()(),h.YNc(70,AddonMessagesGroupConversationsPage_ion_badge_70_Template,2,1,"ion-badge",12)(71,AddonMessagesGroupConversationsPage_span_71_Template,3,6,"span",13),h.qZA(),h.TgZ(72,"div",26,27),h.YNc(74,AddonMessagesGroupConversationsPage_ng_container_74_Template,1,0,"ng-container",18),h.TgZ(75,"core-infinite-loading",19),h.NdJ("action",(function AddonMessagesGroupConversationsPage_Template_core_infinite_loading_action_75_listener(e){return n.loadMoreConversations(n.individual,e)})),h.qZA(),h.YNc(76,AddonMessagesGroupConversationsPage_ion_item_76_Template,5,3,"ion-item",20),h.qZA(),h.YNc(77,AddonMessagesGroupConversationsPage_ion_item_77_Template,4,3,"ion-item",21),h.qZA()()()(),h.YNc(78,AddonMessagesGroupConversationsPage_ng_template_78_Template,1,1,"ng-template",null,28,h.W1O)),2&e){const e=h.MAs(79);h.xp6(3),h.Q6J("text",h.lcZ(4,60,"core.back")),h.xp6(4),h.Oqu(h.lcZ(8,62,"addon.messages.messages")),h.xp6(3),h.uIk("aria-label",h.lcZ(11,64,"addon.messages.searchcombined")),h.xp6(3),h.uIk("aria-label",h.lcZ(14,66,"addon.messages.messagepreferences")),h.xp6(7),h.Q6J("disabled",!n.loaded||!n.currentListEl),h.xp6(),h.s9C("pullingText",h.lcZ(22,68,"core.pulltorefresh")),h.xp6(2),h.Q6J("hideUntil",n.loaded)("message",n.loadingMessage),h.xp6(2),h.Q6J("detail",!0),h.xp6(4),h.Oqu(h.lcZ(30,70,"addon.messages.contacts")),h.xp6(2),h.Q6J("ngIf",n.contactRequestsCount>0),h.xp6(),h.Q6J("ngIf",n.contactRequestsCount>0),h.xp6(),h.Q6J("detail",!1),h.uIk("aria-label",h.lcZ(34,72,n.favourites.expanded?"core.collapse":"core.expand"))("aria-expanded",n.favourites.expanded),h.xp6(2),h.ekj("expandable-status-icon-expanded",n.favourites.expanded),h.xp6(3),h.AsE("",h.lcZ(39,74,"core.favourites")," (",n.favourites.count,")"),h.xp6(2),h.Q6J("ngIf",n.favourites.unread),h.xp6(),h.Q6J("ngIf",n.favourites.unread),h.xp6(),h.Q6J("hidden",!n.favourites.conversations||!n.favourites.expanded||n.favourites.loading),h.xp6(2),h.Q6J("ngTemplateOutlet",e)("ngTemplateOutletContext",h.VKq(84,_c4,n.favourites.conversations)),h.xp6(),h.Q6J("enabled",n.favourites.canLoadMore)("error",n.favourites.loadMoreError),h.xp6(),h.Q6J("ngIf",n.favourites.conversations&&0===n.favourites.conversations.length),h.xp6(),h.Q6J("ngIf",n.favourites.loading),h.xp6(),h.Q6J("detail",!1),h.uIk("aria-label",h.lcZ(49,76,n.group.expanded?"core.collapse":"core.expand"))("aria-expanded",n.group.expanded),h.xp6(2),h.ekj("expandable-status-icon-expanded",n.group.expanded),h.xp6(3),h.AsE("",h.lcZ(54,78,"addon.messages.groupconversations")," (",n.group.count,")"),h.xp6(2),h.Q6J("ngIf",n.group.unread),h.xp6(),h.Q6J("ngIf",n.group.unread),h.xp6(),h.Q6J("hidden",!n.group.conversations||!n.group.expanded||n.group.loading),h.xp6(2),h.Q6J("ngTemplateOutlet",e)("ngTemplateOutletContext",h.VKq(86,_c4,n.group.conversations)),h.xp6(),h.Q6J("enabled",n.group.canLoadMore)("error",n.group.loadMoreError),h.xp6(),h.Q6J("ngIf",n.group.conversations&&0===n.group.conversations.length),h.xp6(),h.Q6J("ngIf",n.group.loading),h.xp6(),h.Q6J("detail",!1),h.uIk("aria-label",h.lcZ(64,80,n.individual.expanded?"core.collapse":"core.expand"))("aria-expanded",n.individual.expanded),h.xp6(2),h.ekj("expandable-status-icon-expanded",n.individual.expanded),h.xp6(3),h.AsE("",h.lcZ(69,82,"addon.messages.individualconversations")," (",n.individual.count,")"),h.xp6(2),h.Q6J("ngIf",n.individual.unread),h.xp6(),h.Q6J("ngIf",n.individual.unread),h.xp6(),h.Q6J("hidden",!n.individual.conversations||!n.individual.expanded||n.individual.loading),h.xp6(2),h.Q6J("ngTemplateOutlet",e)("ngTemplateOutletContext",h.VKq(88,_c4,n.individual.conversations)),h.xp6(),h.Q6J("enabled",n.individual.canLoadMore)("error",n.individual.loadMoreError),h.xp6(),h.Q6J("ngIf",n.individual.conversations&&0===n.individual.conversations.length),h.xp6(),h.Q6J("ngIf",n.individual.loading)}},dependencies:[f.sg,f.O5,f.tP,M.P,I.n,C.r,m.A,P.X,z.l,w.I,q.r,x.t,k.O,b.BJ,b.yp,b.YG,b.Sm,b.W2,b.Gu,b.gu,b.Ie,b.Q$,b.q_,b.uN,b.nJ,b.Wo,b.PQ,b.wd,b.sr,b.oU,te.o,oe.c,A.X$],styles:["[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-right:0;margin-left:0}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-inline-start:2px}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-self:flex-start;margin-inline-start:2px}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-top:3px;align-self:flex-end}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   .addon-message-last-message-date[_ngcontent-%COMP%]{white-space:nowrap;font-size:11px}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-user[_ngcontent-%COMP%]{white-space:nowrap;color:var(--ion-text-color);margin-inline-end:2px}[_nghost-%COMP%]   .addon-messages-conversation-item[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .addon-message-last-message-text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex-shrink:1}[_nghost-%COMP%]   .addon-message-discussion[_ngcontent-%COMP%]   .item-heading[_ngcontent-%COMP%]{margin-top:10px}[_nghost-%COMP%]   ion-item-divider[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{margin-left:16px;margin-right:16px}"]}),AddonMessagesGroupConversationsPage})();function AddonMessagesSearchPage_ion_list_16_ng_container_1_Template(e,n){1&e&&h.GkF(0)}function AddonMessagesSearchPage_ion_list_16_ng_container_2_Template(e,n){1&e&&h.GkF(0)}function AddonMessagesSearchPage_ion_list_16_ng_container_3_Template(e,n){1&e&&h.GkF(0)}const search_c0=e=>({item:e});function AddonMessagesSearchPage_ion_list_16_Template(e,n){if(1&e){const e=h.EpF();h.TgZ(0,"ion-list"),h.YNc(1,AddonMessagesSearchPage_ion_list_16_ng_container_1_Template,1,0,"ng-container",8)(2,AddonMessagesSearchPage_ion_list_16_ng_container_2_Template,1,0,"ng-container",8)(3,AddonMessagesSearchPage_ion_list_16_ng_container_3_Template,1,0,"ng-container",8),h.TgZ(4,"core-infinite-loading",9),h.NdJ("action",(function AddonMessagesSearchPage_ion_list_16_Template_core_infinite_loading_action_4_listener(n){h.CHM(e);const s=h.oxw();return h.KtG(s.search(s.query,"messages",n))})),h.qZA()()}if(2&e){const e=h.oxw(),n=h.MAs(19);h.xp6(),h.Q6J("ngTemplateOutlet",n)("ngTemplateOutletContext",h.VKq(8,search_c0,e.contacts)),h.xp6(),h.Q6J("ngTemplateOutlet",n)("ngTemplateOutletContext",h.VKq(10,search_c0,e.nonContacts)),h.xp6(),h.Q6J("ngTemplateOutlet",n)("ngTemplateOutletContext",h.VKq(12,search_c0,e.messages)),h.xp6(),h.Q6J("enabled",e.messages.canLoadMore)("error",e.messages.loadMoreError)}}function AddonMessagesSearchPage_core_empty_box_17_Template(e,n){1&e&&(h._UZ(0,"core-empty-box",10),h.ALo(1,"translate")),2&e&&h.Q6J("message",h.lcZ(1,1,"core.noresults"))}function AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_ion_icon_5_Template(e,n){1&e&&(h._UZ(0,"ion-icon",21),h.ALo(1,"translate")),2&e&&h.uIk("aria-label",h.lcZ(1,1,"addon.messages.contactblocked"))}function AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_ion_note_6_Template(e,n){if(1&e&&(h.TgZ(0,"ion-note"),h._uU(1),h.ALo(2,"coreDateDayOrTime"),h.qZA()),2&e){const e=h.oxw().$implicit;h.xp6(),h.hij(" ",h.lcZ(2,1,e.lastmessagedate)," ")}}function AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_span_8_Template(e,n){1&e&&(h.TgZ(0,"span",22),h._uU(1),h.ALo(2,"translate"),h.qZA()),2&e&&(h.xp6(),h.hij(" ",h.lcZ(2,1,"addon.messages.you")," "))}function AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_Template(e,n){if(1&e){const e=h.EpF();h.TgZ(0,"ion-item",13),h.NdJ("click",(function AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_Template_ion_item_click_0_listener(){const n=h.CHM(e).$implicit,s=h.oxw(3);return h.KtG(s.openConversation(n))})),h._UZ(1,"core-user-avatar",14),h.TgZ(2,"ion-label")(3,"p",15),h._UZ(4,"core-format-text",16),h.YNc(5,AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_ion_icon_5_Template,2,3,"ion-icon",17),h.qZA(),h.YNc(6,AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_ion_note_6_Template,3,3,"ion-note",5),h.TgZ(7,"p",18),h.YNc(8,AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_span_8_Template,3,3,"span",19),h._UZ(9,"core-format-text",20),h.qZA()()()}if(2&e){const e=n.$implicit,s=h.oxw(3);h.Q6J("detail",!0),h.uIk("aria-label",e.fullname)("aria-current",e===s.selectedResult?"page":"false"),h.xp6(),h.Q6J("user",e)("checkOnline",!0)("linkProfile",!1),h.xp6(3),h.Q6J("text",e.fullname)("highlight",e.highlightName)("filter",!1),h.xp6(),h.Q6J("ngIf",e.isblocked),h.xp6(),h.Q6J("ngIf",e.lastmessagedate>0),h.xp6(2),h.Q6J("ngIf",e.sentfromcurrentuser),h.xp6(),h.Q6J("text",e.lastmessage)("highlight",e.highlightMessage)("contextInstanceId",0)}}function AddonMessagesSearchPage_ng_template_18_ng_container_0_ng_container_7_div_1_Template(e,n){if(1&e){const e=h.EpF();h.TgZ(0,"div",25)(1,"ion-button",26),h.NdJ("click",(function AddonMessagesSearchPage_ng_template_18_ng_container_0_ng_container_7_div_1_Template_ion_button_click_1_listener(){h.CHM(e);const n=h.oxw(3).item,s=h.oxw();return h.KtG(s.search(s.query,n.type))})),h._uU(2),h.ALo(3,"translate"),h.qZA()()}2&e&&(h.xp6(2),h.hij(" ",h.lcZ(3,1,"core.loadmore")," "))}function AddonMessagesSearchPage_ng_template_18_ng_container_0_ng_container_7_div_2_Template(e,n){1&e&&(h.TgZ(0,"div",27),h._UZ(1,"ion-spinner"),h.ALo(2,"translate"),h.qZA()),2&e&&(h.xp6(),h.uIk("aria-label",h.lcZ(2,1,"core.loading")))}function AddonMessagesSearchPage_ng_template_18_ng_container_0_ng_container_7_Template(e,n){if(1&e&&(h.ynx(0),h.YNc(1,AddonMessagesSearchPage_ng_template_18_ng_container_0_ng_container_7_div_1_Template,4,3,"div",23)(2,AddonMessagesSearchPage_ng_template_18_ng_container_0_ng_container_7_div_2_Template,3,3,"div",24),h.BQk()),2&e){const e=h.oxw(2).item;h.xp6(),h.Q6J("ngIf",e.canLoadMore&&!e.loadingMore),h.xp6(),h.Q6J("ngIf",e.loadingMore)}}function AddonMessagesSearchPage_ng_template_18_ng_container_0_Template(e,n){if(1&e&&(h.ynx(0),h.TgZ(1,"ion-item-divider",11)(2,"ion-label")(3,"h2"),h._uU(4),h.ALo(5,"translate"),h.qZA()()(),h.YNc(6,AddonMessagesSearchPage_ng_template_18_ng_container_0_ion_item_6_Template,10,15,"ion-item",12)(7,AddonMessagesSearchPage_ng_template_18_ng_container_0_ng_container_7_Template,3,2,"ng-container",5),h.BQk()),2&e){const e=h.oxw().item;h.xp6(4),h.Oqu(h.lcZ(5,3,e.titleString)),h.xp6(2),h.Q6J("ngForOf",e.results),h.xp6(),h.Q6J("ngIf","messages"!==e.type)}}function AddonMessagesSearchPage_ng_template_18_Template(e,n){if(1&e&&h.YNc(0,AddonMessagesSearchPage_ng_template_18_ng_container_0_Template,8,5,"ng-container",5),2&e){h.Q6J("ngIf",n.item.results.length>0)}}let le=(()=>{var e;class AddonMessagesSearchPage{constructor(){this.disableSearch=!1,this.displaySearching=!1,this.displayResults=!1,this.query="",this.contacts={type:"contacts",titleString:"addon.messages.contacts",results:[],canLoadMore:!1,loadingMore:!1},this.nonContacts={type:"noncontacts",titleString:"addon.messages.noncontacts",results:[],canLoadMore:!1,loadingMore:!1},this.messages={type:"messages",titleString:"addon.messages.messages",results:[],canLoadMore:!1,loadingMore:!1,loadMoreError:!1},this.memberInfoObserver=l.R.on(r.v.MEMBER_INFO_CHANGED_EVENT,(e=>{if(!e.userBlocked&&!e.userUnblocked)return;const n=this.contacts.results.find((n=>n.id==e.userId));if(n)n.isblocked=!!e.userBlocked;else{const n=this.nonContacts.results.find((n=>n.id==e.userId));n&&(n.isblocked=!!e.userBlocked)}this.messages.results.forEach((n=>{n.userid==e.userId&&(n.isblocked=!!e.userBlocked)}))}),i.m9.getCurrentSiteId())}clearSearch(){this.query="",this.displayResults=!1;const e=u.b.getRelativePathToParent("/messages/search");e&&u.b.navigate(e)}search(e,n,s){var t=this;return(0,a.Z)((function*(){d.z.closeKeyboard(),t.query=e,t.disableSearch=!0,t.displaySearching=!n;const o=[];let a=[],i=[],l=[],g=!1,_=!1,u=!1;if(!n||"contacts"==n||"noncontacts"==n){const s=n?r.v.LIMIT_SEARCH:r.v.LIMIT_INITIAL_USER_SEARCH;let c=0;"contacts"==n?(c=t.contacts.results.length,t.contacts.loadingMore=!0):"noncontacts"==n&&(c=t.nonContacts.results.length,t.nonContacts.loadingMore=!0),o.push(r.r.searchUsers(e,c,s).then((e=>{n&&"contacts"!=n||(a=e.contacts,g=e.canLoadMoreContacts),n&&"noncontacts"!=n||(i=e.nonContacts,_=e.canLoadMoreNonContacts)})))}if(!n||"messages"==n){let s=0;"messages"==n&&(s=t.messages.results.length,t.messages.loadingMore=!0),o.push(r.r.searchMessages(e,void 0,s).then((e=>{l=e.messages,u=e.canLoadMore})))}try{yield Promise.all(o),n||(t.contacts.results=[],t.nonContacts.results=[],t.messages.results=[]),t.displayResults=!0,n&&"contacts"!=n||(t.contacts.results.push(...a),t.contacts.canLoadMore=g,t.setHighlight(a,!0)),n&&"noncontacts"!=n||(t.nonContacts.results.push(...i),t.nonContacts.canLoadMore=_,t.setHighlight(i,!0)),n&&"messages"!=n||(t.messages.results.push(...l),t.messages.canLoadMore=u,t.messages.loadMoreError=!1,t.setHighlight(l,!1)),n||(t.contacts.results.length>0?t.openConversation(t.contacts.results[0],!0):t.nonContacts.results.length>0?t.openConversation(t.nonContacts.results[0],!0):t.messages.results.length>0&&t.openConversation(t.messages.results[0],!0))}catch(e){c.OQ.showErrorModalDefault(e,"addon.messages.errorwhileretrievingusers",!0),"messages"==n&&(t.messages.loadMoreError=!0)}finally{t.disableSearch=!1,t.displaySearching=!1,"contacts"==n?t.contacts.loadingMore=!1:"noncontacts"==n?t.nonContacts.loadingMore=!1:"messages"==n&&(t.messages.loadingMore=!1),s&&s()}}))()}openConversation(e,n=!1){if(!n||_.X4.isTablet){let n,s;this.selectedResult=e,"conversationid"in e?n=e.conversationid:s=e.id;const t=u.b.getRelativePathToParent("/messages/search")+"discussion/"+(n||`user/${s}`);u.b.navigate(t,{reset:_.X4.isTablet&&!!this.splitView&&!this.splitView.isNested})}}setHighlight(e,n=!1){e.forEach((e=>{e.highlightName=n?this.query:void 0,e.highlightMessage=n?void 0:this.query}))}ngOnDestroy(){var e;null===(e=this.memberInfoObserver)||void 0===e||e.off()}}return(e=AddonMessagesSearchPage).ɵfac=function AddonMessagesSearchPage_Factory(n){return new(n||e)},e.ɵcmp=h.Xpm({type:e,selectors:[["page-addon-messages-search"]],viewQuery:function AddonMessagesSearchPage_Query(e,n){if(1&e&&h.Gf(m.A,5),2&e){let e;h.iGM(e=h.CRH())&&(n.splitView=e.first)}},decls:20,vars:16,consts:[["slot","start"],[3,"text"],["slot","end"],["autocorrect","off","searchArea","AddonMessagesSearch",3,"disabled","spellcheck","autoFocus","lengthCheck","onSubmit","onClear"],[3,"hideUntil","message"],[4,"ngIf"],["icon","fas-magnifying-glass",3,"message",4,"ngIf"],["resultsTemplate",""],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"enabled","error","action"],["icon","fas-magnifying-glass",3,"message"],[1,"ion-text-wrap"],["class","addon-message-discussion ion-text-wrap","button","",3,"detail","click",4,"ngFor","ngForOf"],["button","",1,"addon-message-discussion","ion-text-wrap",3,"detail","click"],["slot","start",3,"user","checkOnline","linkProfile"],[1,"item-heading"],[3,"text","highlight","filter"],["name","fas-ban",4,"ngIf"],[1,"addon-message-last-message"],["class","addon-message-last-message-user",4,"ngIf"],["clean","true","singleLine","true","contextLevel","system",1,"addon-message-last-message-text",3,"text","highlight","contextInstanceId"],["name","fas-ban"],[1,"addon-message-last-message-user"],["class","ion-padding-horizontal",4,"ngIf"],["class","ion-padding ion-text-center",4,"ngIf"],[1,"ion-padding-horizontal"],["expand","block","fill","outline",3,"click"],[1,"ion-padding","ion-text-center"]],template:function AddonMessagesSearchPage_Template(e,n){1&e&&(h.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),h._UZ(3,"ion-back-button",1),h.ALo(4,"translate"),h.qZA(),h.TgZ(5,"ion-title")(6,"h1"),h._uU(7),h.ALo(8,"translate"),h.qZA()(),h.TgZ(9,"ion-buttons",2),h._UZ(10,"core-context-menu"),h.qZA()()(),h.TgZ(11,"ion-content")(12,"core-split-view")(13,"core-search-box",3),h.NdJ("onSubmit",(function AddonMessagesSearchPage_Template_core_search_box_onSubmit_13_listener(e){return n.search(e)}))("onClear",(function AddonMessagesSearchPage_Template_core_search_box_onClear_13_listener(){return n.clearSearch()})),h.qZA(),h.TgZ(14,"core-loading",4),h.ALo(15,"translate"),h.YNc(16,AddonMessagesSearchPage_ion_list_16_Template,5,14,"ion-list",5)(17,AddonMessagesSearchPage_core_empty_box_17_Template,2,3,"core-empty-box",6),h.qZA()()(),h.YNc(18,AddonMessagesSearchPage_ng_template_18_Template,1,1,"ng-template",null,7,h.W1O)),2&e&&(h.xp6(3),h.Q6J("text",h.lcZ(4,10,"core.back")),h.xp6(4),h.Oqu(h.lcZ(8,12,"addon.messages.searchcombined")),h.xp6(6),h.Q6J("disabled",n.disableSearch)("spellcheck",!1)("autoFocus",!0)("lengthCheck",1),h.xp6(),h.Q6J("hideUntil",!n.displaySearching)("message",h.lcZ(15,14,"core.searching")),h.xp6(2),h.Q6J("ngIf",n.displayResults),h.xp6(),h.Q6J("ngIf",n.displayResults&&!n.contacts.results.length&&!n.nonContacts.results.length&&!n.messages.results.length))},dependencies:[f.sg,f.O5,f.tP,M.P,v.z,I.n,C.r,m.A,P.X,w.I,q.r,x.t,k.O,b.YG,b.Sm,b.W2,b.Gu,b.gu,b.Ie,b.rH,b.Q$,b.q_,b.uN,b.PQ,b.wd,b.sr,b.oU,O.L,oe.c,A.X$],encapsulation:2}),AddonMessagesSearchPage})();var ge=s(24756),_e=s(56283),ue=s(39716),me=s(74744);const he=function(){var e=(0,a.Z)((function*(e){const n=r.r.isGroupMessagingEnabled(),s=g.F0.parseUrl(`/main/${ge.J.PAGE_NAME}/`+(n?"group-conversations":"index"));return s.queryParams=e.queryParams,s}));return function messagesIndexGuard(n){return e.apply(this,arguments)}}();function buildRoutes(e){const n=[{path:"discussion/user/:userId",component:W},{path:"discussion/:conversationId",component:W}],o=[{path:"contacts",component:E},{path:"index",data:{mainMenuTabRoot:ge.J.PAGE_NAME},component:ae},{path:"contacts-35",component:T},{path:"group-conversations",data:{mainMenuTabRoot:ge.J.PAGE_NAME},component:de},{path:"search",component:le}].reduce(((e,s)=>[...e,s,...n.map((e=>({...e,path:`${s.path}/${e.path}`})))]),[]),a=[{path:"contacts",component:E,children:n},{path:"index",data:{mainMenuTabRoot:ge.J.PAGE_NAME},component:ae,children:n},{path:"contacts-35",component:T,children:n},{path:"group-conversations",data:{mainMenuTabRoot:ge.J.PAGE_NAME},component:de,children:n},{path:"search",component:le,children:n}];return[...(0,t.Vr)(o,(()=>_.X4.isMobile)),...(0,t.Vr)(a,(()=>_.X4.isTablet)),...n,{path:"message-settings",loadChildren:()=>s.e(2137).then(s.bind(s,42137)).then((e=>e.AddonMessagesSettingsLazyModule))},...(0,ue.o)(e,{canActivate:[he]})]}let pe=(()=>{var e;class AddonMessagesLazyModule{}return(e=AddonMessagesLazyModule).ɵfac=function AddonMessagesLazyModule_Factory(n){return new(n||e)},e.ɵmod=h.oAB({type:e}),e.ɵinj=h.cJS({providers:[{provide:p.Z6,multi:!0,deps:[h.zs3],useFactory:buildRoutes}],imports:[o.L,me.w,_e.g,p.Bz]}),AddonMessagesLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&h.kYT(pe,{declarations:[T,E,W,ae,de,le],imports:[o.L,me.w,_e.g],exports:[p.Bz]}))}}]);