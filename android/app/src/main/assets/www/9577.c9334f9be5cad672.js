"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9577],{29577:(e,s,i)=>{i.r(s),i.d(s,{AddonModAssignLazyModule:()=>re});var n=i(23966),t=i(13386),o=i(67643),a=i(84095),d=i(38049),r=i(73581),u=i(49671),l=i(31381),m=i(53776),g=i(43555),c=i(53564),_=i(12265),p=i(13010),b=i(40067),f=i(10727),h=i(98370),A=i(94516),I=i(63924),v=i(41343),S=i(12917),x=i(75803),T=i(43468),M=i(19212),y=i(96814),Z=i(9693),w=i(66931),P=i(33813),L=i(8947),E=i(29657),C=i(22068),O=i(56223),R=i(31903),Q=i(23754),J=i(89515);const N=["editSubmissionForm"],_c1=()=>[300,900];function AddonModAssignEditPage_ion_list_14_core_timer_1_Template(e,s){if(1&e){const e=M.EpF();M.TgZ(0,"core-timer",12),M.NdJ("finished",(function AddonModAssignEditPage_ion_list_14_core_timer_1_Template_core_timer_finished_0_listener(){M.CHM(e);const s=M.oxw(2);return M.KtG(s.timeUp())})),M.ALo(1,"translate"),M.qZA()}if(2&e){const e=M.oxw(2);M.Q6J("endTime",e.timeLimitEndTime)("timerText",M.lcZ(1,5,"addon.mod_assign.assigntimeleft"))("align","center")("timeLeftClassThreshold",-1)("underTimeClassThresholds",M.DdM(7,_c1))}}function AddonModAssignEditPage_ion_list_14_ion_item_2_Template(e,s){if(1&e&&(M.TgZ(0,"ion-item",13)(1,"ion-label"),M._UZ(2,"core-format-text",14),M.qZA()()),2&e){const e=M.oxw(2);M.xp6(2),M.Q6J("text",e.activityInstructions)("component",e.component)("componentId",e.moduleId)("contextInstanceId",e.moduleId)("courseId",e.courseId)}}function AddonModAssignEditPage_ion_list_14_ng_container_3_core_file_1_Template(e,s){if(1&e&&M._UZ(0,"core-file",16),2&e){const e=s.$implicit,i=M.oxw(3);M.Q6J("file",e)("component",i.component)("componentId",i.moduleId)}}function AddonModAssignEditPage_ion_list_14_ng_container_3_Template(e,s){if(1&e&&(M.ynx(0),M.YNc(1,AddonModAssignEditPage_ion_list_14_ng_container_3_core_file_1_Template,1,3,"core-file",15),M.BQk()),2&e){const e=M.oxw(2);M.xp6(),M.Q6J("ngForOf",e.introAttachments)}}function AddonModAssignEditPage_ion_list_14_ion_item_6_Template(e,s){if(1&e){const e=M.EpF();M.TgZ(0,"ion-item",13)(1,"ion-checkbox",17),M.NdJ("ngModelChange",(function AddonModAssignEditPage_ion_list_14_ion_item_6_Template_ion_checkbox_ngModelChange_1_listener(s){M.CHM(e);const i=M.oxw(2);return M.KtG(i.submissionStatementAccepted=s)})),M._UZ(2,"core-format-text",18),M.qZA(),M._UZ(3,"input",19),M.qZA()}if(2&e){const e=M.oxw(2);M.xp6(),M.Q6J("ngModel",e.submissionStatementAccepted),M.xp6(),M.Q6J("text",e.submissionStatement)("filter",!1),M.xp6(),M.Q6J("ngModel",e.submissionStatementAccepted)}}function AddonModAssignEditPage_ion_list_14_addon_mod_assign_submission_plugin_7_Template(e,s){if(1&e&&M._UZ(0,"addon-mod-assign-submission-plugin",20),2&e){const e=s.$implicit,i=M.oxw(2);M.Q6J("assign",i.assign)("submission",i.userSubmission)("plugin",e)("edit",!0)("allowOffline",i.allowOffline)}}function AddonModAssignEditPage_ion_list_14_Template(e,s){if(1&e&&(M.TgZ(0,"ion-list"),M.YNc(1,AddonModAssignEditPage_ion_list_14_core_timer_1_Template,2,8,"core-timer",7)(2,AddonModAssignEditPage_ion_list_14_ion_item_2_Template,3,5,"ion-item",8)(3,AddonModAssignEditPage_ion_list_14_ng_container_3_Template,2,1,"ng-container",6),M.TgZ(4,"form",9,10),M.YNc(6,AddonModAssignEditPage_ion_list_14_ion_item_6_Template,4,4,"ion-item",8)(7,AddonModAssignEditPage_ion_list_14_addon_mod_assign_submission_plugin_7_Template,1,5,"addon-mod-assign-submission-plugin",11),M.qZA()()),2&e){const e=M.oxw();M.xp6(),M.Q6J("ngIf",e.timeLimitEndTime>0),M.xp6(),M.Q6J("ngIf",e.activityInstructions),M.xp6(),M.Q6J("ngIf",null==e.assign?null:e.assign.submissionattachments),M.xp6(3),M.Q6J("ngIf",e.submissionStatement),M.xp6(),M.Q6J("ngForOf",e.userSubmission.plugins)}}let k=(()=>{var e;class AddonModAssignEditPage{constructor(e){this.route=e,this.allowOffline=!1,this.submissionStatementAccepted=!1,this.loaded=!1,this.timeLimitEndTime=0,this.component=A.kq.COMPONENT,this.isBlind=!1,this.saveOffline=!1,this.hasOffline=!1,this.isDestroyed=!1,this.forceLeave=!1,this.userId=c.m9.getCurrentSiteUserId(),this.editText=f.vN.instant("addon.mod_assign.editsubmission"),this.title=this.editText}ngOnInit(){try{this.moduleId=g.b.getRequiredRouteNumberParam("cmId"),this.courseId=g.b.getRequiredRouteNumberParam("courseId"),this.isBlind=!!g.b.getRouteNumberParam("blindId")}catch(e){return p.OQ.showErrorModal(e),g.b.back(),void 0}this.fetchAssignment().finally((()=>{this.loaded=!0}))}canLeave(){var e=this;return(0,u.Z)((function*(){if(e.forceLeave)return!0;return(yield e.hasDataChanged())&&(yield p.OQ.showConfirm(f.vN.instant("core.confirmcanceledit"))),I.m.clearSubmissionPluginTmpData(e.assign,e.userSubmission,e.getInputData()),b.o.triggerFormCancelledEvent(e.formElement,c.m9.getCurrentSiteId()),!0}))()}fetchAssignment(){var e=this;return(0,u.Z)((function*(){const s=c.m9.getCurrentSiteUserId();try{var i,n,t,o,a;e.assign=yield A.Rv.getAssignment(e.courseId,e.moduleId),e.title=e.assign.name||e.title,e.isDestroyed||_.d.blockOperation(A.kq.COMPONENT,e.assign.id),yield S.C.waitForSync(e.assign.id);const r={userId:e.userId,isBlind:e.isBlind,cmId:e.assign.cmid,filter:!1,readingStrategy:2};let u;try{u=yield A.Rv.getSubmissionStatus(e.assign.id,r),e.userSubmission=A.Rv.getSubmissionObjectFromAttempt(e.assign,u.lastattempt)}catch(s){r.filter=!0,r.readingStrategy=1,u=yield A.Rv.getSubmissionStatus(e.assign.id,r),e.userSubmission=A.Rv.getSubmissionObjectFromAttempt(e.assign,u.lastattempt);if(!(yield I.m.canEditSubmissionOffline(e.assign,e.userSubmission)))throw e.allowOffline=!1,s}if(null===(i=u.lastattempt)||void 0===i||!i.canedit)throw new l.G(f.vN.instant("core.nopermissions",{$a:e.editText}));if(u=yield e.startSubmissionIfNeeded(u,r),null!==(n=u.assignmentdata)&&void 0!==n&&n.activity){var d;const s=r.filter?u:yield A.Rv.getSubmissionStatus(e.assign.id,{...r,filter:!0});e.activityInstructions=null===(d=s.assignmentdata)||void 0===d?void 0:d.activity}e.introAttachments=null!==(t=null===(o=u.assignmentdata)||void 0===o||null===(o=o.attachments)||void 0===o?void 0:o.intro)&&void 0!==t?t:e.assign.introattachments,e.allowOffline=!0,e.assign.submissionstatement||void 0===e.assign.submissionstatement||(e.assign.requiresubmissionstatement=0),e.submissionStatement=e.assign.requiresubmissionstatement&&!e.assign.submissiondrafts&&e.userId==s?e.assign.submissionstatement:void 0,e.timeLimitEndTime=e.assign.timelimit&&null!==(a=e.userSubmission)&&void 0!==a&&a.timestarted?I.m.calculateEndTime(e.assign,e.userSubmission):0;try{const s=yield v.f.getSubmission(e.assign.id,e.userId);e.hasOffline=(null==s?void 0:s.plugindata)&&Object.keys(s.plugindata).length>0}catch{e.hasOffline=!1}T.ke.logEvent({type:T.gM.VIEW_ITEM,ws:"mod_assign_save_submission",name:f.vN.instant("addon.mod_assign.subpagetitle",{contextname:e.assign.name,subpage:f.vN.instant("addon.mod_assign.editsubmission")}),data:{id:e.assign.id,category:"assign"},url:`/mod/assign/view.php?action=editsubmission&id=${e.moduleId}`})}catch(s){p.OQ.showErrorModalDefault(s,"Error getting assigment data."),e.leaveWithoutCheck()}}))()}startSubmissionIfNeeded(e,s){var i=this;return(0,u.Z)((function*(){if(!i.assign||!i.assign.timelimit)return e;if(i.userSubmission&&i.userSubmission.status!==A.YI.NEW&&i.userSubmission.status!==A.YI.REOPENED)return e;yield A.Rv.startSubmission(i.assign.id),h.R.trigger(A.kq.STARTED_EVENT,{assignmentId:i.assign.id},c.m9.getCurrentSiteId());const n=yield A.Rv.getSubmissionStatus(i.assign.id,{...s,readingStrategy:2});return i.userSubmission=A.Rv.getSubmissionObjectFromAttempt(i.assign,n.lastattempt),n}))()}getInputData(){return b.o.getDataFromForm(document.forms["addon-mod_assign-edit-form"])}hasDataChanged(){var e=this;return(0,u.Z)((function*(){const s=yield p.OQ.showModalLoading(),i=e.getInputData();return I.m.hasSubmissionDataChanged(e.assign,e.userSubmission,i).finally((()=>{s.dismiss()}))}))()}leaveWithoutCheck(){this.forceLeave=!0,g.b.back()}prepareSubmissionData(e){var s=this;return(0,u.Z)((function*(){s.saveOffline=s.hasOffline;try{return yield I.m.prepareSubmissionPluginData(s.assign,s.userSubmission,e,s.hasOffline)}catch(i){if(s.allowOffline&&!s.saveOffline&&!x.Tr.isWebServiceError(i))return s.saveOffline=!0,I.m.prepareSubmissionPluginData(s.assign,s.userSubmission,e,!0);throw i}}))()}save(){var e=this;return(0,u.Z)((function*(){if(!(yield e.hasDataChanged()))return e.leaveWithoutCheck(),void 0;try{yield e.saveSubmission(),e.leaveWithoutCheck()}catch(e){p.OQ.showErrorModalDefault(e,"Error saving submission.")}}))()}saveSubmission(){var e=this;return(0,u.Z)((function*(){const s=e.getInputData();if(e.submissionStatement&&(!s.submissionstatement||"false"===s.submissionstatement))throw f.vN.instant("addon.mod_assign.acceptsubmissionstatement");let i=yield p.OQ.showModalLoading(),n=-1;try{n=yield I.m.getSubmissionSizeForEdit(e.assign,e.userSubmission,s)}catch(e){n=-1}i.dismiss();try{yield m.X.confirmUploadFile(n,!0,e.allowOffline),i=yield p.OQ.showModalLoading("core.sending",!0);const t=yield e.prepareSubmissionData(s);if(!Object.keys(t).length)return;let o;e.saveOffline?(o=!1,yield v.f.saveSubmission(e.assign.id,e.courseId,t,e.userSubmission.timemodified,!e.assign.submissiondrafts,e.userId)):o=yield A.Rv.saveSubmission(e.assign.id,e.courseId,t,e.allowOffline,e.userSubmission.timemodified,!!e.assign.submissiondrafts,e.userId),I.m.clearSubmissionPluginTmpData(e.assign,e.userSubmission,s),o&&h.R.trigger(h.R.ACTIVITY_DATA_SENT,{module:"assign"}),b.o.triggerFormSubmittedEvent(e.formElement,o,c.m9.getCurrentSiteId()),h.R.trigger(A.kq.SUBMISSION_SAVED_EVENT,{assignmentId:e.assign.id,submissionId:e.userSubmission.id,userId:e.userId},c.m9.getCurrentSiteId()),e.assign.submissiondrafts||h.R.trigger(A.kq.SUBMITTED_FOR_GRADING_EVENT,{assignmentId:e.assign.id,submissionId:e.userSubmission.id,userId:e.userId},c.m9.getCurrentSiteId())}finally{i.dismiss()}}))()}timeUp(){var e=this;return(0,u.Z)((function*(){e.timeUpToast=yield p.OQ.showToastWithOptions({message:f.vN.instant("addon.mod_assign.caneditsubmission"),duration:p.O2.STICKY,buttons:[f.vN.instant("core.dismiss")],cssClass:"core-danger-toast"})}))()}ngOnDestroy(){var e;this.isDestroyed=!0,null===(e=this.timeUpToast)||void 0===e||e.dismiss(),this.assign&&_.d.unblockOperation(A.kq.COMPONENT,this.assign.id)}}return(e=AddonModAssignEditPage).ɵfac=function AddonModAssignEditPage_Factory(s){return new(s||e)(M.Y36(o.gz))},e.ɵcmp=M.Xpm({type:e,selectors:[["page-addon-mod-assign-edit"]],viewQuery:function AddonModAssignEditPage_Query(e,s){if(1&e&&M.Gf(N,5),2&e){let e;M.iGM(e=M.CRH())&&(s.formElement=e.first)}},decls:15,vars:11,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],["fill","clear",3,"click"],[3,"hideUntil"],[4,"ngIf"],["timeUpText","00:00:00",3,"endTime","timerText","align","timeLeftClassThreshold","underTimeClassThresholds","finished",4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],["name","addon-mod_assign-edit-form"],["editSubmissionForm",""],[3,"assign","submission","plugin","edit","allowOffline",4,"ngFor","ngForOf"],["timeUpText","00:00:00",3,"endTime","timerText","align","timeLeftClassThreshold","underTimeClassThresholds","finished"],[1,"ion-text-wrap"],["contextLevel","module",3,"text","component","componentId","contextInstanceId","courseId"],[3,"file","component","componentId",4,"ngFor","ngForOf"],[3,"file","component","componentId"],["name","submissionstatement",3,"ngModel","ngModelChange"],[3,"text","filter"],["type","hidden","name","submissionstatement",3,"ngModel"],[3,"assign","submission","plugin","edit","allowOffline"]],template:function AddonModAssignEditPage_Template(e,s){1&e&&(M.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),M._UZ(3,"ion-back-button",1),M.ALo(4,"translate"),M.qZA(),M.TgZ(5,"ion-title")(6,"h1"),M._UZ(7,"core-format-text",2),M.qZA()(),M.TgZ(8,"ion-buttons",3)(9,"ion-button",4),M.NdJ("click",(function AddonModAssignEditPage_Template_ion_button_click_9_listener(){return s.save()})),M._uU(10),M.ALo(11,"translate"),M.qZA()()()(),M.TgZ(12,"ion-content")(13,"core-loading",5),M.YNc(14,AddonModAssignEditPage_ion_list_14_Template,8,5,"ion-list",6),M.qZA()()),2&e&&(M.xp6(3),M.Q6J("text",M.lcZ(4,7,"core.back")),M.xp6(4),M.Q6J("text",s.title)("contextInstanceId",s.moduleId)("courseId",s.courseId),M.xp6(3),M.hij(" ",M.lcZ(11,9,"core.save")," "),M.xp6(3),M.Q6J("hideUntil",s.loaded),M.xp6(),M.Q6J("ngIf",s.userSubmission&&s.userSubmission.plugins&&s.userSubmission.plugins.length))},dependencies:[y.sg,y.O5,Z.Y,w.r,P.L,L.r,E.t,C.O,O._Y,O.Fj,O.JJ,O.JL,O.On,O.F,R.YG,R.Sm,R.nz,R.W2,R.Gu,R.Ie,R.Q$,R.q_,R.wd,R.sr,R.w,R.oU,Q.F,J.X$],styles:["[_nghost-%COMP%]   core-timer.core-timer-under-300[_ngcontent-%COMP%]{--timer-background: var(--danger-tint);--timer-text-color: var(--danger-shade)}[_nghost-%COMP%]   core-timer.core-timer-under-900[_ngcontent-%COMP%]{--timer-background: var(--warning-tint);--timer-text-color: var(--warning-shade)}"]}),AddonModAssignEditPage})();var U=i(98712),D=i(28319),q=i(60067);let F=(()=>{var e;class AddonModAssignIndexPage extends U.S{}return(e=AddonModAssignIndexPage).ɵfac=(()=>{let s;return function AddonModAssignIndexPage_Factory(i){return(s||(s=M.n5z(e)))(i||e)}})(),e.ɵcmp=M.Xpm({type:e,selectors:[["page-addon-mod-assign-index"]],viewQuery:function AddonModAssignIndexPage_Query(e,s){if(1&e&&M.Gf(D.z,5),2&e){let e;M.iGM(e=M.CRH())&&(s.activityComponent=e.first)}},features:[M.qOj],decls:14,vars:12,consts:[["collapsible",""],["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"module","courseId","dataRetrieved"]],template:function AddonModAssignIndexPage_Template(e,s){1&e&&(M.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),M._UZ(3,"ion-back-button",2),M.ALo(4,"translate"),M.qZA(),M.TgZ(5,"ion-title")(6,"h1"),M._UZ(7,"core-format-text",3),M.qZA()(),M._UZ(8,"ion-buttons",4),M.qZA()(),M.TgZ(9,"ion-content",5)(10,"ion-refresher",6),M.NdJ("ionRefresh",(function AddonModAssignIndexPage_Template_ion_refresher_ionRefresh_10_listener(e){return null==s.activityComponent?null:s.activityComponent.doRefresh(e.target)})),M._UZ(11,"ion-refresher-content",7),M.ALo(12,"translate"),M.qZA(),M.TgZ(13,"addon-mod-assign-index",8),M.NdJ("dataRetrieved",(function AddonModAssignIndexPage_Template_addon_mod_assign_index_dataRetrieved_13_listener(e){return s.updateData(e)})),M.qZA()()),2&e&&(M.xp6(3),M.Q6J("text",M.lcZ(4,8,"core.back")),M.xp6(4),M.Q6J("text",s.title)("contextInstanceId",s.module.id)("courseId",s.courseId),M.xp6(3),M.Q6J("disabled",null==s.activityComponent?null:s.activityComponent.showLoading),M.xp6(),M.s9C("pullingText",M.lcZ(12,10,"core.pulltorefresh")),M.xp6(2),M.Q6J("module",s.module)("courseId",s.courseId))},dependencies:[L.r,q.e,E.t,R.Sm,R.W2,R.Gu,R.nJ,R.Wo,R.wd,R.sr,R.oU,D.z,J.X$],encapsulation:2}),AddonModAssignIndexPage})();var G=i(1389),Y=i(25233),$=i(30242),V=i(9796),W=i(55126),B=i(72526),z=i(80070);function AddonModAssignSubmissionListPage_ng_container_17_p_4_Template(e,s){if(1&e&&(M.TgZ(0,"p",14),M._uU(1),M.qZA()),2&e){const e=M.oxw().$implicit;M.xp6(),M.Oqu(e.userfullname)}}function AddonModAssignSubmissionListPage_ng_container_17_p_5_Template(e,s){if(1&e&&(M.TgZ(0,"p",14),M._uU(1),M.ALo(2,"translate"),M.qZA()),2&e){const e=M.oxw().$implicit;M.xp6(),M.AsE(" ",M.lcZ(2,2,"addon.mod_assign.hiddenuser"),"",e.blindid," ")}}function AddonModAssignSubmissionListPage_ng_container_17_p_6_span_1_Template(e,s){if(1&e&&(M.TgZ(0,"span",17),M._UZ(1,"core-format-text",18),M.qZA()),2&e){const e=M.oxw(2).$implicit,s=M.oxw();M.xp6(),M.Q6J("text",e.groupname)("contextInstanceId",s.courseId)}}function AddonModAssignSubmissionListPage_ng_container_17_p_6_span_2_Template(e,s){1&e&&(M.TgZ(0,"span",19),M._uU(1),M.ALo(2,"translate"),M.qZA()),2&e&&(M.xp6(),M.hij(" ",M.lcZ(2,1,"addon.mod_assign.noteam")," "))}function AddonModAssignSubmissionListPage_ng_container_17_p_6_span_3_Template(e,s){1&e&&(M.TgZ(0,"span",19),M._uU(1),M.ALo(2,"translate"),M.qZA()),2&e&&(M.xp6(),M.hij(" ",M.lcZ(2,1,"addon.mod_assign.multipleteams")," "))}function AddonModAssignSubmissionListPage_ng_container_17_p_6_span_4_Template(e,s){1&e&&(M.TgZ(0,"span"),M._uU(1),M.ALo(2,"translate"),M.qZA()),2&e&&(M.xp6(),M.hij(" ",M.lcZ(2,1,"addon.mod_assign.defaultteam")," "))}function AddonModAssignSubmissionListPage_ng_container_17_p_6_Template(e,s){if(1&e&&(M.TgZ(0,"p"),M.YNc(1,AddonModAssignSubmissionListPage_ng_container_17_p_6_span_1_Template,2,2,"span",15)(2,AddonModAssignSubmissionListPage_ng_container_17_p_6_span_2_Template,3,3,"span",16)(3,AddonModAssignSubmissionListPage_ng_container_17_p_6_span_3_Template,3,3,"span",16)(4,AddonModAssignSubmissionListPage_ng_container_17_p_6_span_4_Template,3,3,"span",13),M.qZA()),2&e){const e=M.oxw().$implicit,s=M.oxw();M.xp6(),M.Q6J("ngIf",e.groupname),M.xp6(),M.Q6J("ngIf",s.assign.preventsubmissionnotingroup&&!e.groupname&&e.noGroups&&!e.blindid),M.xp6(),M.Q6J("ngIf",s.assign.preventsubmissionnotingroup&&!e.groupname&&e.manyGroups&&!e.blindid),M.xp6(),M.Q6J("ngIf",!s.assign.preventsubmissionnotingroup&&!e.groupname)}}function AddonModAssignSubmissionListPage_ng_container_17_p_7_Template(e,s){if(1&e&&(M.TgZ(0,"p")(1,"ion-badge",20),M._uU(2),M.qZA()()),2&e){const e=M.oxw().$implicit;M.xp6(),M.Q6J("color",e.statusColor),M.xp6(),M.hij(" ",e.statusTranslated," ")}}function AddonModAssignSubmissionListPage_ng_container_17_p_8_Template(e,s){if(1&e&&(M.TgZ(0,"p")(1,"ion-badge",20),M._uU(2),M.ALo(3,"translate"),M.qZA()()),2&e){const e=M.oxw().$implicit;M.xp6(),M.Q6J("color",e.gradingColor),M.xp6(),M.hij(" ",M.lcZ(3,2,e.gradingStatusTranslationId)," ")}}function AddonModAssignSubmissionListPage_ng_container_17_Template(e,s){if(1&e){const e=M.EpF();M.ynx(0),M.TgZ(1,"ion-item",10),M.NdJ("click",(function AddonModAssignSubmissionListPage_ng_container_17_Template_ion_item_click_1_listener(){const s=M.CHM(e).$implicit,i=M.oxw();return M.KtG(i.submissions.select(s))})),M._UZ(2,"core-user-avatar",11),M.TgZ(3,"ion-label"),M.YNc(4,AddonModAssignSubmissionListPage_ng_container_17_p_4_Template,2,1,"p",12)(5,AddonModAssignSubmissionListPage_ng_container_17_p_5_Template,3,4,"p",12)(6,AddonModAssignSubmissionListPage_ng_container_17_p_6_Template,5,4,"p",13)(7,AddonModAssignSubmissionListPage_ng_container_17_p_7_Template,3,2,"p",13)(8,AddonModAssignSubmissionListPage_ng_container_17_p_8_Template,4,4,"p",13),M.qZA()(),M.BQk()}if(2&e){const e=s.$implicit,i=M.oxw();M.xp6(),M.Q6J("detail",!0),M.uIk("aria-current",i.submissions.getItemAriaCurrent(e)),M.xp6(),M.Q6J("user",e)("linkProfile",!1),M.xp6(2),M.Q6J("ngIf",e.userfullname),M.xp6(),M.Q6J("ngIf",!e.userfullname),M.xp6(),M.Q6J("ngIf",i.assign&&i.assign.teamsubmission),M.xp6(),M.Q6J("ngIf",e.statusTranslated),M.xp6(),M.Q6J("ngIf",e.gradingStatusTranslationId)}}function AddonModAssignSubmissionListPage_core_empty_box_18_Template(e,s){1&e&&(M._UZ(0,"core-empty-box",21),M.ALo(1,"translate")),2&e&&M.Q6J("message",M.lcZ(1,1,"addon.mod_assign.submissionstatus_"))}let j=(()=>{var e;class AddonModAssignSubmissionListPage{constructor(){this.title="",this.gradedObserver=h.R.on(A.kq.GRADED_EVENT,(e=>{var s;this.submissions.loaded&&this.submissions.getSource().assign&&e.assignmentId==(null===(s=this.submissions.getSource().assign)||void 0===s?void 0:s.id)&&e.userId==c.m9.getCurrentSiteUserId()&&this.refreshAllData(!0)}),c.m9.getCurrentSiteId());this.syncObserver=h.R.onMultiple([S.i.AUTO_SYNCED,S.i.MANUAL_SYNCED],(e=>{!this.submissions.loaded||"context"in e&&"submission-list"==e.context||this.refreshAllData(!1)}),c.m9.getCurrentSiteId());try{const e=g.b.getRequiredRouteNumberParam("cmId"),s=g.b.getRequiredRouteNumberParam("courseId"),i=g.b.getRouteNumberParam("groupId")||0,n=g.b.getRouteParam("status"),t=Y.p.getOrCreateSource(V.W,[s,e,n]);t.groupId=i,this.sourceUnsubscribe=t.addListener({onItemsUpdated:()=>{var e;this.title=(null===(e=this.submissions.getSource().assign)||void 0===e?void 0:e.name)||this.title}}),this.submissions=new G.a(t,AddonModAssignSubmissionListPage)}catch(e){return p.OQ.showErrorModal(e),g.b.back(),void 0}}get assign(){return this.submissions.getSource().assign}get groupInfo(){return this.submissions.getSource().groupInfo}get moduleId(){return this.submissions.getSource().MODULE_ID}get courseId(){return this.submissions.getSource().COURSE_ID}get groupId(){return this.submissions.getSource().groupId}set groupId(e){this.submissions.getSource().groupId=e}ngAfterViewInit(){const e=this.submissions.getSource().SELECTED_STATUS;this.title=f.vN.instant(e?e===V.i.NEED_GRADING?"addon.mod_assign.numberofsubmissionsneedgrading":`addon.mod_assign.submissionstatus_${e}`:"addon.mod_assign.numberofparticipants"),this.fetchAssignment(!0).finally((()=>{this.submissions.start(this.splitView)}))}fetchAssignment(e=!1){var s=this;return(0,u.Z)((function*(){try{if(yield s.submissions.getSource().loadAssignment(e),!s.assign)return;T.ke.logEvent({type:T.gM.VIEW_ITEM_LIST,ws:"mod_assign_get_submissions",name:f.vN.instant("addon.mod_assign.subpagetitle",{contextname:s.assign.name,subpage:f.vN.instant("addon.mod_assign.grading")}),data:{assignid:s.assign.id,category:"assign"},url:`/mod/assign/view.php?id=${s.assign.cmid}&action=grading`})}catch(e){p.OQ.showErrorModalDefault(e,"Error getting assigment data.")}}))()}refreshAllData(e){var s=this;return(0,u.Z)((function*(){try{yield s.submissions.getSource().invalidateCache()}finally{s.fetchAssignment(e)}}))()}refreshList(e){this.refreshAllData(!0).finally((()=>{null==e||e.complete()}))}reloadSubmissions(){var e=this;return(0,u.Z)((function*(){yield e.submissions.reload()}))()}ngOnDestroy(){var e,s;null===(e=this.gradedObserver)||void 0===e||e.off(),null===(s=this.syncObserver)||void 0===s||s.off(),this.submissions.destroy(),this.sourceUnsubscribe&&this.sourceUnsubscribe()}}return(e=AddonModAssignSubmissionListPage).ɵfac=function AddonModAssignSubmissionListPage_Factory(s){return new(s||e)},e.ɵcmp=M.Xpm({type:e,selectors:[["page-addon-mod-assign-submission-list"]],viewQuery:function AddonModAssignSubmissionListPage_Query(e,s){if(1&e&&M.Gf($.A,5),2&e){let e;M.iGM(e=M.CRH())&&(s.splitView=e.first)}},decls:19,vars:16,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[3,"groupInfo","selected","courseId","selectedChange"],[4,"ngFor","ngForOf"],["icon","fas-file-signature",3,"message",4,"ngIf"],["button","",1,"ion-text-wrap",3,"detail","click"],["slot","start",3,"user","linkProfile"],["class","item-heading",4,"ngIf"],[4,"ngIf"],[1,"item-heading"],["class","core-groupname",4,"ngIf"],["class","text-danger",4,"ngIf"],[1,"core-groupname"],["contextLevel","course",3,"text","contextInstanceId"],[1,"text-danger"],[1,"ion-text-center","ion-text-wrap",3,"color"],["icon","fas-file-signature",3,"message"]],template:function AddonModAssignSubmissionListPage_Template(e,s){1&e&&(M.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),M._UZ(3,"ion-back-button",1),M.ALo(4,"translate"),M.qZA(),M.TgZ(5,"ion-title")(6,"h1"),M._UZ(7,"core-format-text",2),M.qZA()(),M._UZ(8,"ion-buttons",3),M.qZA()(),M.TgZ(9,"ion-content")(10,"core-split-view")(11,"ion-refresher",4),M.NdJ("ionRefresh",(function AddonModAssignSubmissionListPage_Template_ion_refresher_ionRefresh_11_listener(e){return s.refreshList(e.target)})),M._UZ(12,"ion-refresher-content",5),M.ALo(13,"translate"),M.qZA(),M.TgZ(14,"core-loading",6)(15,"ion-list")(16,"core-group-selector",7),M.NdJ("selectedChange",(function AddonModAssignSubmissionListPage_Template_core_group_selector_selectedChange_16_listener(e){return s.groupId=e}))("selectedChange",(function AddonModAssignSubmissionListPage_Template_core_group_selector_selectedChange_16_listener(){return s.reloadSubmissions()})),M.qZA(),M.YNc(17,AddonModAssignSubmissionListPage_ng_container_17_Template,9,9,"ng-container",8),M.qZA(),M.YNc(18,AddonModAssignSubmissionListPage_core_empty_box_18_Template,2,3,"core-empty-box",9),M.qZA()()()),2&e&&(M.xp6(3),M.Q6J("text",M.lcZ(4,12,"core.back")),M.xp6(4),M.Q6J("text",s.title)("contextInstanceId",s.moduleId)("courseId",s.courseId),M.xp6(4),M.Q6J("disabled",!s.submissions.loaded),M.xp6(),M.s9C("pullingText",M.lcZ(13,14,"core.pulltorefresh")),M.xp6(2),M.Q6J("hideUntil",s.submissions.loaded),M.xp6(2),M.Q6J("groupInfo",s.groupInfo)("selected",s.groupId)("courseId",s.courseId),M.xp6(),M.Q6J("ngForOf",s.submissions.items),M.xp6(),M.Q6J("ngIf",!s.submissions||s.submissions.empty))},dependencies:[y.sg,y.O5,W.z,B.Q,w.r,$.A,z.X,L.r,E.t,R.yp,R.Sm,R.W2,R.Gu,R.Ie,R.Q$,R.q_,R.nJ,R.Wo,R.wd,R.sr,R.oU,J.X$],encapsulation:2}),AddonModAssignSubmissionListPage})();var X=i(71460),H=i(73180),K=i(90021),ee=i(88817),se=i(78308),ie=i(5065);function AddonModAssignSubmissionReviewPage_addon_mod_assign_submission_18_Template(e,s){if(1&e&&M._UZ(0,"addon-mod-assign-submission",10),2&e){const e=M.oxw();M.Q6J("courseId",e.courseId)("moduleId",e.moduleId)("submitId",e.submitId)("blindId",e.blindId)}}let ne=(()=>{var e;class AddonModAssignSubmissionReviewPage{constructor(e){this.route=e,this.title="",this.loaded=!1,this.canSaveGrades=!1,this.blindMarking=!1,this.forceLeave=!1,this.logView=ee.V.once((()=>{if(!this.assign)return;const e=this.blindMarking?this.blindId:this.submitId,s=this.blindMarking?"blindid":"userid";T.ke.logEvent({type:T.gM.VIEW_ITEM,ws:"mod_assign_get_submission_status",name:f.vN.instant("addon.mod_assign.subpagetitle",{contextname:this.assign.name,subpage:f.vN.instant("addon.mod_assign.grading")}),data:{id:e,assignid:this.assign.id,category:"assign"},url:`/mod/assign/view.php?id=${this.assign.cmid}&action=grader&${s}=${e}`})}))}ngOnInit(){this.route.queryParams.subscribe((e=>{try{var s;this.moduleId=g.b.getRequiredRouteNumberParam("cmId"),this.courseId=g.b.getRequiredRouteNumberParam("courseId"),this.submitId=g.b.getRouteNumberParam("submitId")||0,this.blindId=g.b.getRouteNumberParam("blindId",{params:e});const i=g.b.getRequiredRouteNumberParam("groupId"),n=g.b.getRouteParam("selectedStatus"),t=Y.p.getOrCreateSource(V.W,[this.courseId,this.moduleId,n]);null===(s=this.submissions)||void 0===s||s.destroy(),t.groupId=i,this.submissions=new AddonModAssignSubmissionSwipeItemsManager(t),this.submissions.start()}catch(e){return p.OQ.showErrorModal(e),g.b.back(),void 0}this.fetchSubmission().finally((()=>{this.logView(),this.loaded=!0}))}))}ngOnDestroy(){var e;null===(e=this.submissions)||void 0===e||e.destroy()}canLeave(){var e=this;return(0,u.Z)((function*(){return!(e.submissionComponent&&!e.forceLeave)||e.submissionComponent.canLeave()}))()}ionViewDidEnter(){var e;null===(e=this.submissionComponent)||void 0===e||e.ionViewDidEnter()}ionViewDidLeave(){var e;null===(e=this.submissionComponent)||void 0===e||e.ionViewDidLeave()}fetchSubmission(){var e=this;return(0,u.Z)((function*(){e.assign=yield A.Rv.getAssignment(e.courseId,e.moduleId),e.title=e.assign.name,e.blindMarking=!!e.assign.blindmarking&&!e.assign.revealidentities;const s=yield H.FO.getModuleBasicGradeInfo(e.moduleId);if(s)if(s.advancedgrading&&s.advancedgrading[0]&&void 0!==s.advancedgrading[0].method){e.canSaveGrades="simple"==(s.advancedgrading[0].method||"simple")}else e.canSaveGrades=!0}))()}refreshAllData(){var e=this;return(0,u.Z)((function*(){const s=[];s.push(A.Rv.invalidateAssignmentData(e.courseId)),e.assign&&(s.push(A.Rv.invalidateSubmissionData(e.assign.id)),s.push(A.Rv.invalidateAssignmentUserMappingsData(e.assign.id)),s.push(A.Rv.invalidateSubmissionStatusData(e.assign.id,e.submitId,void 0,e.blindMarking)));try{yield Promise.all(s)}finally{e.submissionComponent&&e.submissionComponent.invalidateAndRefresh(!0),yield e.fetchSubmission()}}))()}refreshSubmission(e){this.refreshAllData().finally((()=>{null==e||e.complete()}))}submitGrade(){var e=this;return(0,u.Z)((function*(){if(e.submissionComponent)try{yield e.submissionComponent.submitGrade(),d.X4.isTablet||(e.forceLeave=!0,g.b.back())}catch(e){p.OQ.showErrorModalDefault(e,"core.error",!0)}}))()}}return(e=AddonModAssignSubmissionReviewPage).ɵfac=function AddonModAssignSubmissionReviewPage_Factory(s){return new(s||e)(M.Y36(o.gz))},e.ɵcmp=M.Xpm({type:e,selectors:[["page-addon-mod-assign-submission-review"]],viewQuery:function AddonModAssignSubmissionReviewPage_Query(e,s){if(1&e&&M.Gf(K.z,5),2&e){let e;M.iGM(e=M.CRH())&&(s.submissionComponent=e.first)}},decls:19,vars:17,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],["fill","clear",3,"hidden","click"],[3,"core-swipe-navigation"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[3,"courseId","moduleId","submitId","blindId",4,"ngIf"],[3,"courseId","moduleId","submitId","blindId"]],template:function AddonModAssignSubmissionReviewPage_Template(e,s){1&e&&(M.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),M._UZ(3,"ion-back-button",1),M.ALo(4,"translate"),M.qZA(),M.TgZ(5,"ion-title")(6,"h1"),M._UZ(7,"core-format-text",2),M.qZA()(),M._UZ(8,"ion-buttons",3),M.qZA(),M.TgZ(9,"core-navbar-buttons",3)(10,"ion-button",4),M.NdJ("click",(function AddonModAssignSubmissionReviewPage_Template_ion_button_click_10_listener(){return s.submitGrade()})),M._uU(11),M.ALo(12,"translate"),M.qZA()()(),M.TgZ(13,"ion-content",5)(14,"ion-refresher",6),M.NdJ("ionRefresh",(function AddonModAssignSubmissionReviewPage_Template_ion_refresher_ionRefresh_14_listener(e){return s.refreshSubmission(e.target)})),M._UZ(15,"ion-refresher-content",7),M.ALo(16,"translate"),M.qZA(),M.TgZ(17,"core-loading",8),M.YNc(18,AddonModAssignSubmissionReviewPage_addon_mod_assign_submission_18_Template,1,4,"addon-mod-assign-submission",9),M.qZA()()),2&e&&(M.xp6(3),M.Q6J("text",M.lcZ(4,11,"core.back")),M.xp6(4),M.Q6J("text",s.title)("contextInstanceId",s.moduleId)("courseId",s.courseId),M.xp6(3),M.Q6J("hidden",!s.canSaveGrades),M.xp6(),M.hij(" ",M.lcZ(12,13,"core.done")," "),M.xp6(2),M.Q6J("core-swipe-navigation",s.submissions),M.xp6(),M.Q6J("disabled",!s.loaded),M.xp6(),M.s9C("pullingText",M.lcZ(16,15,"core.pulltorefresh")),M.xp6(2),M.Q6J("hideUntil",s.loaded),M.xp6(),M.Q6J("ngIf",s.loaded))},dependencies:[y.O5,w.r,se.J,L.r,ie.g,E.t,C.O,R.YG,R.Sm,R.W2,R.Gu,R.nJ,R.Wo,R.wd,R.sr,R.oU,K.z,J.X$],encapsulation:2}),AddonModAssignSubmissionReviewPage})();class AddonModAssignSubmissionSwipeItemsManager extends X.t{getSelectedItemPathFromRoute(e){return(e instanceof o.De?e:e.snapshot).params.submitId}}const te=[{path:":courseId/:cmId",component:F},{path:":courseId/:cmId/edit",component:k,canDeactivate:[a.Y]}],oe=[...te,{path:":courseId/:cmId/submission",component:j},{path:":courseId/:cmId/submission/:submitId",component:ne,canDeactivate:[a.Y]}],ae=[...te,{path:":courseId/:cmId/submission",component:j,children:[{path:":submitId",component:ne,canDeactivate:[a.Y]}]}],de=[...(0,n.Vr)(oe,(()=>d.X4.isMobile)),...(0,n.Vr)(ae,(()=>d.X4.isTablet))];let re=(()=>{var e;class AddonModAssignLazyModule{}return(e=AddonModAssignLazyModule).ɵfac=function AddonModAssignLazyModule_Factory(s){return new(s||e)},e.ɵmod=M.oAB({type:e}),e.ɵinj=M.cJS({imports:[o.Bz.forChild(de),t.L,r.W]}),AddonModAssignLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&M.kYT(re,{declarations:[F,j,ne,k],imports:[o.Bz,t.L,r.W]}))},71460:(e,s,i)=>{i.d(s,{t:()=>CoreSwipeNavigationItemsManager});var n=i(49671),t=i(67643),o=i(43555),a=i(22594);class CoreSwipeNavigationItemsManager extends a.A{start(){var e=this;return(0,n.Z)((function*(){e.updateSelectedItem()}))()}navigateToNextItem(){var e=this;return(0,n.Z)((function*(){yield e.navigateToItemBy(1,"forward")}))()}navigateToPreviousItem(){var e=this;return(0,n.Z)((function*(){yield e.navigateToItemBy(-1,"back")}))()}hasNextItem(){var e=this;return(0,n.Z)((function*(){return!!(yield e.getItemBy(1))}))()}hasPreviousItem(){var e=this;return(0,n.Z)((function*(){return!!(yield e.getItemBy(-1))}))()}getCurrentPageRoute(){return o.b.getCurrentRoute()}getSelectedItemPathFromRoute(e){const s=[];for(;e;){if(s.push(...(e instanceof t.De?e:e.snapshot).url),!e.firstChild)break;e=e.firstChild}return s.map((e=>e.path)).join("/").replace(/\/+/,"/").trim()||null}navigateToItemBy(e,s){var i=this;return(0,n.Z)((function*(){const n=yield i.getItemBy(e);n&&(yield i.navigateToItem(n,{animationDirection:s,replace:!0}))}))()}getItemBy(e){var s=this;return(0,n.Z)((function*(){var i;const n=s.getSource().getItems(),t=null!==(i=s.selectedItem&&(null==n?void 0:n.indexOf(s.selectedItem)))&&void 0!==i?i:-1;if(-1===t||null===n)return null;const o=e>0?1:-1;let a=t,d=0;for(;d!==e;){if(a+=o,a<0)return null;if(a>=n.length)break;s.skipItemInSwipe(n[a])||(d+=o)}return d===e?n[a]:s.getSource().isCompleted()?null:(yield s.getSource().load(),s.getItemBy(e))}))()}skipItemInSwipe(e){return!1}}}}]);