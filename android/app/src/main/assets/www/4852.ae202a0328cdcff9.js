"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4852],{62838:(e,t,o)=>{o.r(t),o.d(t,{AddonModScormLazyModule:()=>B});var r=o(67643),i=o(13386),n=o(91184),a=o(98712),s=o(43555),c=o(82141),d=o(19212),l=o(8947),m=o(60067),u=o(29657),h=o(31903),f=o(89515);let _=(()=>{var e;class AddonModScormIndexPage extends a.S{ngOnInit(){super.ngOnInit(),s.b.getRouteBooleanParam("autoPlay")&&(this.autoPlayData={mode:s.b.getRouteParam("mode"),newAttempt:s.b.getRouteBooleanParam("newAttempt"),organizationId:s.b.getRouteParam("organizationId"),scoId:s.b.getRouteNumberParam("scoId")})}}return(e=AddonModScormIndexPage).ɵfac=(()=>{let t;return function AddonModScormIndexPage_Factory(o){return(t||(t=d.n5z(e)))(o||e)}})(),e.ɵcmp=d.Xpm({type:e,selectors:[["page-addon-mod-scorm-index"]],viewQuery:function AddonModScormIndexPage_Query(e,t){if(1&e&&d.Gf(c.x,5),2&e){let e;d.iGM(e=d.CRH())&&(t.activityComponent=e.first)}},features:[d.qOj],decls:14,vars:13,consts:[["collapsible",""],["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"module","courseId","autoPlayData","dataRetrieved"]],template:function AddonModScormIndexPage_Template(e,t){1&e&&(d.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),d._UZ(3,"ion-back-button",2),d.ALo(4,"translate"),d.qZA(),d.TgZ(5,"ion-title")(6,"h1"),d._UZ(7,"core-format-text",3),d.qZA()(),d._UZ(8,"ion-buttons",4),d.qZA()(),d.TgZ(9,"ion-content",5)(10,"ion-refresher",6),d.NdJ("ionRefresh",(function AddonModScormIndexPage_Template_ion_refresher_ionRefresh_10_listener(e){return null==t.activityComponent?null:t.activityComponent.doRefresh(e.target)})),d._UZ(11,"ion-refresher-content",7),d.ALo(12,"translate"),d.qZA(),d.TgZ(13,"addon-mod-scorm-index",8),d.NdJ("dataRetrieved",(function AddonModScormIndexPage_Template_addon_mod_scorm_index_dataRetrieved_13_listener(e){return t.updateData(e)})),d.qZA()()),2&e&&(d.xp6(3),d.Q6J("text",d.lcZ(4,9,"core.back")),d.xp6(4),d.Q6J("text",t.title)("contextInstanceId",t.module.id)("courseId",t.courseId),d.xp6(3),d.Q6J("disabled",null==t.activityComponent?null:t.activityComponent.showLoading),d.xp6(),d.s9C("pullingText",d.lcZ(12,11,"core.pulltorefresh")),d.xp6(2),d.Q6J("module",t.module)("courseId",t.courseId)("autoPlayData",t.autoPlayData))},dependencies:[l.r,m.e,u.t,h.Sm,h.W2,h.Gu,h.nJ,h.Wo,h.wd,h.sr,h.oU,c.x,f.X$],encapsulation:2}),AddonModScormIndexPage})();var p=o(49671),g=o(53564),v=o(12265),I=o(13010),w=o(52160),b=o(75803),S=o(98370),T=o(10406);let M="^[\\u0000-\\uFFFF]{0,255}$",y="^[\\u0000-\\uFFFF]{0,4096}$";const C="^([0-2]{1}[0-9]{1}):([0-5]{1}[0-9]{1}):([0-5]{1}[0-9]{1})(.[0-9]{1,2})?$",E="^([0-9]{2,4}):([0-9]{2}):([0-9]{2})(.[0-9]{1,2})?$",A="^-?([0-9]+)$",x="^-?([0-9]{0,3})(.[0-9]*)?$",O="^[\\u0021-\\u007E]{0,255}$",Z=M,D="[._](\\d+).",L="raw,min,max",P="0#100",N={0:"No error",101:"General exception",201:"Invalid argument error",202:"Element cannot have children",203:"Element not an array - cannot have count",301:"Not initialized",401:"Not implemented error",402:"Invalid set value, element is a keyword",403:"Element is read only",404:"Element is write only",405:"Incorrect data type"};class AddonModScormDataModel12{constructor(e,t,o,r,i,n=T.l.MODENORMAL,a=!1,s=!0){this.siteId=e,this.scorm=t,this.scoId=o,this.attempt=r,this.userData=i,this.mode=n,this.offline=a,this.canSaveTracks=s,this.currentUserData={},this.def={},this.defExtra={},this.dataModel={},this.initialized=!1,this.errorCode="0",this.init(i)}addTime(e,t){const o=e.split(":"),r=t.split(":"),i=o[2].split("."),n=r[2].split(".");let a=0,s=0;i.length>1&&(s=parseInt(i[1],10));let c=0;n.length>1&&(c=parseInt(n[1],10));let d=s+c;a=Math.floor(d/100),d-=100*a,Math.floor(d)<10&&(d="0"+d.toString());let l=parseInt(i[0],10)+parseInt(n[0],10)+a;a=Math.floor(l/60),l-=60*a,Math.floor(l)<10&&(l="0"+l.toString());let m=parseInt(o[1],10)+parseInt(r[1],10)+a;a=Math.floor(m/60),m-=60*a,m<10&&(m="0"+m.toString());let u=parseInt(o[0],10)+parseInt(r[0],10)+a;return u<10&&(u="0"+u.toString()),"0"!=d?u+":"+m+":"+l+"."+d:u+":"+m+":"+l}collectData(){if(!this.currentUserData[this.scoId])return[];const e=[];for(const t in this.currentUserData[this.scoId].userdata){if("cmi"!=t.substring(0,3)||"cmi.core.session_time"==t)continue;const o=new RegExp(D,"g"),r=t.replace(o,".n.");if(void 0===this.dataModel[this.scoId][t]&&void 0!==this.dataModel[this.scoId][r]&&(this.dataModel[this.scoId][t]=b.Tr.clone(this.dataModel[this.scoId][r])),void 0===this.dataModel[this.scoId][t]||"r"==this.dataModel[this.scoId][t].mod)continue;const i={element:t.replace(o,"_$1."),value:this.getEl(t)};void 0!==this.dataModel[this.scoId][t].defaultvalue?this.dataModel[this.scoId][t].defaultvalue!==i.value&&(e.push(i),this.dataModel[this.scoId][t].defaultvalue=i.value):(e.push(i),this.dataModel[this.scoId][t].defaultvalue=i.value)}return e}getEl(e){return this.currentUserData[this.scoId]&&void 0!==this.currentUserData[this.scoId].userdata[e]?this.currentUserData[this.scoId].userdata[e]:""}init(e){this.scorm.scormStandard||(M="^[\\u0000-\\uFFFF]{0,64000}$",y=M);for(const t in e){const o=e[t];this.def[t]=o.defaultdata,this.defExtra[t]=o.userdata}for(const e in this.def){this.dataModel[e]={"cmi._children":{defaultvalue:"core,suspend_data,launch_data,comments,objectives,student_data,student_preference,interactions",mod:"r",writeerror:"402"},"cmi._version":{defaultvalue:"3.4",mod:"r",writeerror:"402"},"cmi.core._children":{defaultvalue:"student_id,student_name,lesson_location,credit,lesson_status,entry,score,total_time,lesson_mode,exit,session_time",mod:"r",writeerror:"402"},"cmi.core.student_id":{defaultvalue:this.def[e]["cmi.core.student_id"],mod:"r",writeerror:"403"},"cmi.core.student_name":{defaultvalue:this.def[e]["cmi.core.student_name"],mod:"r",writeerror:"403"},"cmi.core.lesson_location":{defaultvalue:this.def[e]["cmi.core.lesson_location"],format:M,mod:"rw",writeerror:"405"},"cmi.core.credit":{defaultvalue:this.def[e]["cmi.core.credit"],mod:"r",writeerror:"403"},"cmi.core.lesson_status":{defaultvalue:this.def[e]["cmi.core.lesson_status"],format:"^passed$|^completed$|^failed$|^incomplete$|^browsed$",mod:"rw",writeerror:"405"},"cmi.core.entry":{defaultvalue:this.def[e]["cmi.core.entry"],mod:"r",writeerror:"403"},"cmi.core.score._children":{defaultvalue:L,mod:"r",writeerror:"402"},"cmi.core.score.raw":{defaultvalue:this.def[e]["cmi.core.score.raw"],format:x,range:P,mod:"rw",writeerror:"405"},"cmi.core.score.max":{defaultvalue:this.def[e]["cmi.core.score.max"],format:x,range:P,mod:"rw",writeerror:"405"},"cmi.core.score.min":{defaultvalue:this.def[e]["cmi.core.score.min"],format:x,range:P,mod:"rw",writeerror:"405"},"cmi.core.total_time":{defaultvalue:this.def[e]["cmi.core.total_time"],mod:"r",writeerror:"403"},"cmi.core.lesson_mode":{defaultvalue:this.def[e]["cmi.core.lesson_mode"],mod:"r",writeerror:"403"},"cmi.core.exit":{defaultvalue:this.def[e]["cmi.core.exit"],format:"^time-out$|^suspend$|^logout$|^$",mod:"w",readerror:"404",writeerror:"405"},"cmi.core.session_time":{format:E,mod:"w",defaultvalue:"00:00:00",readerror:"404",writeerror:"405"},"cmi.suspend_data":{defaultvalue:this.def[e]["cmi.suspend_data"],format:y,mod:"rw",writeerror:"405"},"cmi.launch_data":{defaultvalue:this.def[e]["cmi.launch_data"],mod:"r",writeerror:"403"},"cmi.comments":{defaultvalue:this.def[e]["cmi.comments"],format:y,mod:"rw",writeerror:"405"},"cmi.evaluation.comments._count":{defaultvalue:"0",mod:"r",writeerror:"402"},"cmi.evaluation.comments._children":{defaultvalue:"content,location,time",mod:"r",writeerror:"402"},"cmi.evaluation.comments.n.content":{defaultvalue:"",pattern:D,format:M,mod:"rw",writeerror:"405"},"cmi.evaluation.comments.n.location":{defaultvalue:"",pattern:D,format:M,mod:"rw",writeerror:"405"},"cmi.evaluation.comments.n.time":{defaultvalue:"",pattern:D,format:C,mod:"rw",writeerror:"405"},"cmi.comments_from_lms":{mod:"r",writeerror:"403"},"cmi.objectives._children":{defaultvalue:"id,score,status",mod:"r",writeerror:"402"},"cmi.objectives._count":{mod:"r",defaultvalue:"0",writeerror:"402"},"cmi.objectives.n.id":{pattern:D,format:O,mod:"rw",writeerror:"405"},"cmi.objectives.n.score._children":{pattern:D,mod:"r",writeerror:"402"},"cmi.objectives.n.score.raw":{defaultvalue:"",pattern:D,format:x,range:P,mod:"rw",writeerror:"405"},"cmi.objectives.n.score.min":{defaultvalue:"",pattern:D,format:x,range:P,mod:"rw",writeerror:"405"},"cmi.objectives.n.score.max":{defaultvalue:"",pattern:D,format:x,range:P,mod:"rw",writeerror:"405"},"cmi.objectives.n.status":{pattern:D,format:"^passed$|^completed$|^failed$|^incomplete$|^browsed$|^not attempted$",mod:"rw",writeerror:"405"},"cmi.student_data._children":{defaultvalue:"mastery_score,max_time_allowed,time_limit_action",mod:"r",writeerror:"402"},"cmi.student_data.mastery_score":{defaultvalue:this.def[e]["cmi.student_data.mastery_score"],mod:"r",writeerror:"403"},"cmi.student_data.max_time_allowed":{defaultvalue:this.def[e]["cmi.student_data.max_time_allowed"],mod:"r",writeerror:"403"},"cmi.student_data.time_limit_action":{defaultvalue:this.def[e]["cmi.student_data.time_limit_action"],mod:"r",writeerror:"403"},"cmi.student_preference._children":{defaultvalue:"audio,language,speed,text",mod:"r",writeerror:"402"},"cmi.student_preference.audio":{defaultvalue:this.def[e]["cmi.student_preference.audio"],format:A,range:"-1#100",mod:"rw",writeerror:"405"},"cmi.student_preference.language":{defaultvalue:this.def[e]["cmi.student_preference.language"],format:M,mod:"rw",writeerror:"405"},"cmi.student_preference.speed":{defaultvalue:this.def[e]["cmi.student_preference.speed"],format:A,range:"-100#100",mod:"rw",writeerror:"405"},"cmi.student_preference.text":{defaultvalue:this.def[e]["cmi.student_preference.text"],format:A,range:"-1#1",mod:"rw",writeerror:"405"},"cmi.interactions._children":{defaultvalue:"id,objectives,time,type,correct_responses,weighting,student_response,result,latency",mod:"r",writeerror:"402"},"cmi.interactions._count":{mod:"r",defaultvalue:"0",writeerror:"402"},"cmi.interactions.n.id":{pattern:D,format:O,mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.objectives._count":{pattern:D,mod:"r",defaultvalue:"0",writeerror:"402"},"cmi.interactions.n.objectives.n.id":{pattern:D,format:O,mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.time":{pattern:D,format:C,mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.type":{pattern:D,format:"^true-false$|^choice$|^fill-in$|^matching$|^performance$|^sequencing$|^likert$|^numeric$",mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.correct_responses._count":{pattern:D,mod:"r",defaultvalue:"0",writeerror:"402"},"cmi.interactions.n.correct_responses.n.pattern":{pattern:D,format:Z,mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.weighting":{pattern:D,format:x,range:"-100#100",mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.student_response":{pattern:D,format:Z,mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.result":{pattern:D,format:"^correct$|^wrong$|^unanticipated$|^neutral$|^([0-9]{0,3})?(.[0-9]*)?$",mod:"w",readerror:"404",writeerror:"405"},"cmi.interactions.n.latency":{pattern:D,format:E,mod:"w",readerror:"404",writeerror:"405"},"nav.event":{defaultvalue:"",format:"^previous$|^continue$",mod:"w",readerror:"404",writeerror:"405"}},this.currentUserData[e]={scoid:Number(e),userdata:{},defaultdata:{}};for(const t in this.dataModel[e])if(null===t.match(/\.n\./)){const o=this.dataModel[e][t].defaultvalue;void 0!==o&&(this.currentUserData[e].userdata[t]=o)}for(const t in this.def[e])if(null===t.match(/\.n\./)){const o=this.dataModel[e][t].defaultvalue;this.currentUserData[e].userdata[t]=void 0!==o?o:void 0!==this.defExtra[e][t]?this.defExtra[e][t]:""}const c=new RegExp(D,"g");for(const d in this.defExtra[e]){let l="",m="0";if(d.match(c)){const u=d.replace(c,".$1.");var t;if(this.currentUserData[e].userdata[u]=this.defExtra[e][d],0===u.indexOf("cmi.evaluation.comments"))l="cmi.evaluation.comments._count",m=(null===(t=u.match(/.(\d+)./))||void 0===t?void 0:t[1])||"0";else if(0===u.indexOf("cmi.objectives")){var o;l="cmi.objectives._count",m=(null===(o=u.match(/.(\d+)./))||void 0===o?void 0:o[1])||"0"}else if(0===u.indexOf("cmi.interactions"))if(u.indexOf(".objectives.")>0){var r,i;const e=null===(r=u.match(/cmi.interactions.(\d+)./))||void 0===r?void 0:r[1];m=(null===(i=u.match(/objectives.(\d+)./))||void 0===i?void 0:i[1])||"0",l="cmi.interactions."+e+".objectives._count"}else if(u.indexOf(".correct_responses.")>0){var n,a;const e=null===(n=u.match(/cmi.interactions.(\d+)./))||void 0===n?void 0:n[1];m=(null===(a=u.match(/correct_responses.(\d+)./))||void 0===a?void 0:a[1])||"0",l="cmi.interactions."+e+".correct_responses._count"}else{var s;l="cmi.interactions._count",m=(null===(s=u.match(/.(\d+)./))||void 0===s?void 0:s[1])||"0"}if(l){const t=this.currentUserData[e].userdata[l];void 0===t&&(this.currentUserData[e].userdata[l]=0),Number(m)==Number(t)&&(this.currentUserData[e].userdata[l]=Number(t)+1),Number(m)>Number(t)&&(this.currentUserData[e].userdata[l]=Number(m)-1)}}}""===this.currentUserData[e].userdata["cmi.core.lesson_status"]&&(this.currentUserData[e].userdata["cmi.core.lesson_status"]="not attempted"),this.currentUserData[e].userdata["cmi.core.credit"]=this.mode==T.l.MODENORMAL?"credit":"no-credit",this.currentUserData[e].userdata["cmi.core.lesson_mode"]=this.mode}}LMSCommit(e){if(this.timeout&&(clearTimeout(this.timeout),this.timeout=void 0),this.errorCode="0",""==e){if(this.initialized){const e=this.storeData(!1);return this.triggerEvent(T.l.UPDATE_TOC_EVENT),this.errorCode=e?"0":"101",e?"true":"false"}this.errorCode="301"}else this.errorCode="201";return"false"}LMSFinish(e){if(this.errorCode="0",""==e){if(this.initialized){this.initialized=!1;const e=this.storeData(!0);return""!=this.getEl("nav.event")?"continue"==this.getEl("nav.event")?this.triggerEvent(T.l.LAUNCH_NEXT_SCO_EVENT):this.triggerEvent(T.l.LAUNCH_PREV_SCO_EVENT):this.scorm.auto&&this.triggerEvent(T.l.LAUNCH_NEXT_SCO_EVENT),this.errorCode=e?"0":"101",this.triggerEvent(T.l.UPDATE_TOC_EVENT),e?"true":"false"}this.errorCode="301"}else this.errorCode="201";return"false"}LMSGetDiagnostic(e){return""==e&&(e=this.errorCode),e}LMSGetErrorString(e){return""!=e?N[e]:""}LMSGetLastError(){return this.errorCode}LMSGetValue(e){if(this.errorCode="0",this.initialized)if(""!=e){const t=new RegExp(D,"g"),o=String(e).replace(t,".n.");if(void 0!==this.dataModel[this.scoId][o]){if("w"!=this.dataModel[this.scoId][o].mod)return this.errorCode="0",this.getEl(e);this.errorCode=this.dataModel[this.scoId][o].readerror||"0"}else{const e="._children",t="._count";if(o.substring(o.length-e.length)==e){const t=o.substring(0,o.length-e.length);this.errorCode=void 0!==this.dataModel[this.scoId][t]?"202":"201"}else if(o.substring(o.length-t.length)==t){const e=o.substring(0,o.length-t.length);this.errorCode=void 0!==this.dataModel[this.scoId][e]?"203":"201"}else this.errorCode="201"}}else this.errorCode="201";else this.errorCode="301";return""}LMSInitialize(e){if(this.errorCode="0",""==e){if(!this.initialized)return this.initialized=!0,this.errorCode="0","true";this.errorCode="101"}else this.errorCode="201";return"false"}LMSSetValue(e,t){if(this.errorCode="0",this.initialized)if(""!=e){let n=new RegExp(D,"g");const a=String(e).replace(n,".n.");if(void 0!==this.dataModel[this.scoId][a])if("r"!=this.dataModel[this.scoId][a].mod){var o;n=new RegExp(null!==(o=this.dataModel[this.scoId][a].format)&&void 0!==o?o:"");if(null!=(t+="").match(n)){if(e!=a){if(0===e.indexOf("cmi.objectives")){var r;const t="cmi.objectives."+(null===(r=e.match(/cmi.objectives.(\d+)./))||void 0===r?void 0:r[1])+".score";void 0===this.currentUserData[this.scoId].userdata[t+"._children"]&&(this.setEl(this.currentUserData[this.scoId].userdata[t+"._children"],L),this.setEl(this.currentUserData[this.scoId].userdata[t+".raw"],""),this.setEl(this.currentUserData[this.scoId].userdata[t+".min"],""),this.setEl(this.currentUserData[this.scoId].userdata[t+".max"],""))}else if(0===e.indexOf("cmi.interactions")){var i;const t=null===(i=e.match(/cmi.interactions.(\d+)./))||void 0===i?void 0:i[1];let o="cmi.interactions."+t+".objectives._count";void 0===this.currentUserData[this.scoId].userdata[o]&&this.setEl(o,0),o="cmi.interactions."+t+".correct_responses._count",void 0===this.currentUserData[this.scoId].userdata[o]&&this.setEl(o,0)}const t=e.split(".");let o="cmi";for(let e=1;e<t.length-1;e++){const r=t[e];if(t[e+1].match(/^\d+$/)){const i=o+"."+r+"._count";if(void 0===this.currentUserData[this.scoId].userdata[i]&&this.setEl(i,0),t[e+1]==this.getEl(i)){const e=this.getEl(i);this.setEl(i,Number(e)+1)}t[e+1]>this.getEl(i)&&(this.errorCode="201"),o=o.concat("."+r+"."+t[e+1]),e++}else o=o.concat("."+r)}e=o.concat("."+t[t.length-1])}if("0"==this.errorCode){this.scorm.autocommit&&!this.timeout&&(this.timeout=window.setTimeout((()=>this.LMSCommit("")),6e4));const o=this.dataModel[this.scoId][a].range;if(void 0===o)return"cmi.comments"==e?this.setEl("cmi.comments",this.getEl("cmi.comments")+t):this.setEl(e,t),this.errorCode="0","true";{const r=o.split("#");if((t=Number(t))>=Number(r[0])&&t<=Number(r[1]))return this.setEl(e,Number(t)),this.errorCode="0","true";this.errorCode=this.dataModel[this.scoId][a].writeerror}}}else this.errorCode=this.dataModel[this.scoId][a].writeerror}else this.errorCode=this.dataModel[this.scoId][a].writeerror;else this.errorCode="201"}else this.errorCode="201";else this.errorCode="301";return"false"}loadSco(e){this.scoId=e}setEl(e,t){this.currentUserData[this.scoId]=this.currentUserData[this.scoId]||{scoid:this.scoId,userdata:{},defaultdata:{}},this.currentUserData[this.scoId].userdata[e]=t}setOffline(e){this.offline=e}storeData(e){if(!this.canSaveTracks)return!0;let t;e?("not attempted"==this.getEl("cmi.core.lesson_status")&&this.setEl("cmi.core.lesson_status","completed"),this.getEl("cmi.core.lesson_mode")==T.l.MODENORMAL&&"credit"==this.getEl("cmi.core.credit")&&""!==this.getEl("cmi.student_data.mastery_score")&&""!==this.getEl("cmi.core.score.raw")&&(parseFloat(this.getEl("cmi.core.score.raw"))>=parseFloat(this.getEl("cmi.student_data.mastery_score"))?this.setEl("cmi.core.lesson_status","passed"):this.setEl("cmi.core.lesson_status","failed")),this.getEl("cmi.core.lesson_mode")==T.l.MODEBROWSE&&""==this.dataModel[this.scoId]["cmi.core.lesson_status"].defaultvalue&&"not attempted"==this.getEl("cmi.core.lesson_status")&&this.setEl("cmi.core.lesson_status","browsed"),t=this.collectData(),t.push(this.totalTime())):t=this.collectData();const o=T.W.saveTracksSync(this.scoId,this.attempt,t,this.scorm,this.offline,this.currentUserData);return this.offline||o?o:(this.offline=!0,this.triggerEvent(T.l.GO_OFFLINE_EVENT),T.W.saveTracksSync(this.scoId,this.attempt,t,this.scorm,this.offline,this.currentUserData))}totalTime(){return{element:"cmi.core.total_time",value:this.addTime(this.getEl("cmi.core.total_time"),this.getEl("cmi.core.session_time"))}}triggerEvent(e){S.R.trigger(e,{scormId:this.scorm.id,scoId:this.scoId,attempt:this.attempt},this.siteId)}}var U=o(51843),k=o(97723),$=o(16032),R=o(43468),F=o(62085),J=o(96814),q=o(61341),Q=o(11294),W=o(66931),z=o(81863),j=o(86700),G=o(19289),H=o(22068);function AddonModScormPlayerPage_core_button_with_spinner_9_ion_button_1_Template(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"ion-button",11),d.NdJ("click",(function AddonModScormPlayerPage_core_button_with_spinner_9_ion_button_1_Template_ion_button_click_0_listener(){d.CHM(e);const t=d.oxw(2);return d.KtG(t.openToc())})),d.ALo(1,"translate"),d._UZ(2,"ion-icon",12),d.qZA()}2&e&&d.uIk("aria-label",d.lcZ(1,1,"addon.mod_scorm.toc"))}function AddonModScormPlayerPage_core_button_with_spinner_9_Template(e,t){if(1&e&&(d.TgZ(0,"core-button-with-spinner",9),d.YNc(1,AddonModScormPlayerPage_core_button_with_spinner_9_ion_button_1_Template,3,3,"ion-button",10),d.qZA()),2&e){const e=d.oxw();d.Q6J("loading",e.loadingToc),d.xp6(),d.Q6J("ngIf",e.toc.length)}}function AddonModScormPlayerPage_core_iframe_12_Template(e,t){if(1&e&&d._UZ(0,"core-iframe",13),2&e){const e=d.oxw();d.Q6J("src",e.src)("iframeWidth",e.scormWidth)("iframeHeight",e.scormHeight)("showFullscreenOnToolbar",!0)("autoFullscreenOnRotate",!0)}}function AddonModScormPlayerPage_p_13_Template(e,t){if(1&e&&(d.TgZ(0,"p"),d._uU(1),d.ALo(2,"translate"),d.qZA()),2&e){const e=d.oxw();d.xp6(),d.Oqu(d.lcZ(2,1,e.errorMessage))}}function AddonModScormPlayerPage_core_navigation_bar_14_Template(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"core-navigation-bar",14),d.NdJ("action",(function AddonModScormPlayerPage_core_navigation_bar_14_Template_core_navigation_bar_action_0_listener(t){d.CHM(e);const o=d.oxw();return d.KtG(o.loadSco(t))})),d.qZA()}if(2&e){const e=d.oxw();d.Q6J("items",e.navigationItems)}}let V=(()=>{var e;class AddonModScormPlayerPage{constructor(e){this.mainMenuPage=e,this.showToc=!1,this.loadingToc=!0,this.toc=[],this.loaded=!1,this.incomplete=!1,this.navigationItems=[],this.newAttempt=!1,this.attempt=0,this.offline=!1}ngOnInit(){var e=this;return(0,p.Z)((function*(){try{e.cmId=s.b.getRequiredRouteNumberParam("cmId"),e.courseId=s.b.getRequiredRouteNumberParam("courseId"),e.mode=s.b.getRouteParam("mode")||T.l.MODENORMAL,e.moduleUrl=s.b.getRouteParam("moduleUrl")||"",e.newAttempt=!!s.b.getRouteBooleanParam("newAttempt"),e.organizationId=s.b.getRouteParam("organizationId"),e.initialScoId=s.b.getRouteNumberParam("scoId"),e.siteId=g.m9.getRequiredCurrentSite().getId()}catch(e){return I.OQ.showErrorModal(e),s.b.back(),void 0}try{if(yield e.fetchData(),!e.currentSco)return s.b.back(),void 0;if(e.newAttempt)try{yield e.setStartTime(e.currentSco.id)}catch(e){I.OQ.showErrorModalDefault(e,"addon.mod_scorm.errorgetscorm",!0)}e.loadSco(e.currentSco)}finally{e.loaded=!0}}))()}get canSaveTracks(){return!this.accessInfo||!!this.accessInfo.cansavetrack}initialize(){var e=this;return(0,p.Z)((function*(){e.scorm=yield T.W.getScorm(e.courseId,e.cmId,{moduleUrl:e.moduleUrl,readingStrategy:1}),v.d.blockOperation(T.l.COMPONENT,e.scorm.id,"player"),e.title=e.scorm.name,e.showToc=T.W.displayTocInPlayer(e.scorm),e.scorm.popup&&e.scorm.width&&e.scorm.width>100&&(e.scormWidth=e.scorm.width,e.scorm.height&&e.scorm.height>100&&(e.scormHeight=e.scorm.height)),e.tocObserver=S.R.on(T.l.UPDATE_TOC_EVENT,(t=>{t.scormId===e.scorm.id&&(e.offline?setTimeout((()=>e.refreshToc()),100):e.refreshToc())}),e.siteId),e.launchNextObserver=S.R.on(T.l.LAUNCH_NEXT_SCO_EVENT,(t=>{if(t.scormId===e.scorm.id&&e.currentSco){const t=k.g.getNextScoFromToc(e.toc,e.currentSco.id);t&&e.loadSco(t)}}),e.siteId),e.launchPrevObserver=S.R.on(T.l.LAUNCH_PREV_SCO_EVENT,(t=>{if(t.scormId===e.scorm.id&&e.currentSco){const t=k.g.getPreviousScoFromToc(e.toc,e.currentSco.id);t&&e.loadSco(t)}}),e.siteId),e.goOfflineObserver=S.R.on(T.l.GO_OFFLINE_EVENT,(t=>{t.scormId!==e.scorm.id||e.offline||(e.offline=!0,setTimeout((0,p.Z)((function*(){try{k.g.convertAttemptToOffline(e.scorm,e.attempt)}catch(e){I.OQ.showErrorModalDefault(e,"core.error",!0)}e.refreshToc()})),200))}),e.siteId)}))()}calculateNavigationItems(e){this.navigationItems=this.toc.filter((e=>e.isvisible)).map((t=>({item:t,title:t.title,current:t.id==e,enabled:!(!t.prereq||!t.launch)})))}determineAttemptAndMode(e,t){var o=this;return(0,p.Z)((function*(){const r=yield k.g.determineAttemptToContinue(o.scorm,e);let i=!1;o.attempt=r.num,o.offline=r.offline,o.attempt!=e.lastAttempt.num&&(o.attemptToContinue=o.attempt),o.attempt>0&&(i=yield T.W.isAttemptIncomplete(o.scorm.id,o.attempt,{offline:o.offline,cmId:o.cmId}));const n=T.W.determineAttemptAndMode(o.scorm,o.mode,o.attempt,o.newAttempt,i,t.cansavetrack);if(n.attempt>o.attempt)if(o.offline)yield k.g.createOfflineAttempt(o.scorm,n.attempt,e.online.length);else try{yield T.W.getScormUserData(o.scorm.id,n.attempt,{cmId:o.cmId,readingStrategy:2})}catch{o.offline=!0,yield k.g.createOfflineAttempt(o.scorm,n.attempt,e.online.length)}o.mode=n.mode,o.newAttempt=n.newAttempt,o.attempt=n.attempt}))()}fetchData(){var e=this;return(0,p.Z)((function*(){e.scorm||(yield e.initialize()),yield $.j.waitForSync(e.scorm.id);try{const[t,o]=yield Promise.all([T.W.getAttemptCount(e.scorm.id,{cmId:e.cmId}),T.W.getAccessInformation(e.scorm.id,{cmId:e.cmId})]);e.accessInfo=o,yield e.determineAttemptAndMode(t,o);const[r]=yield Promise.all([T.W.getScormUserData(e.scorm.id,e.attempt,{cmId:e.cmId,offline:e.offline}),e.fetchToc()]);e.userData=r}catch(e){I.OQ.showErrorModalDefault(e,"addon.mod_scorm.errorgetscorm",!0)}}))()}fetchToc(){var e=this;return(0,p.Z)((function*(){e.loadingToc=!0;try{if(e.incomplete=yield T.W.isAttemptIncomplete(e.scorm.id,e.attempt,{offline:e.offline,cmId:e.cmId}),e.toc=yield k.g.getToc(e.scorm.id,e.attempt,e.incomplete,{organization:e.organizationId,offline:e.offline,cmId:e.cmId}),e.currentSco)return;if(e.newAttempt&&(e.initialScoId=e.scorm.launch),e.initialScoId&&e.initialScoId>0&&(e.currentSco=k.g.getScoFromToc(e.toc,e.initialScoId)),e.currentSco)return;const t=yield k.g.getFirstSco(e.scorm.id,e.attempt,{toc:e.toc,organization:e.organizationId,mode:e.mode,offline:e.offline,cmId:e.cmId});t?e.currentSco=t:e.errorMessage="addon.mod_scorm.errornovalidsco"}finally{e.loadingToc=!1}}))()}loadSco(e){var t=this;return(0,p.Z)((function*(){var o;t.dataModel?(t.src="",yield b.Tr.nextTick(),t.dataModel.loadSco(e.id)):(t.dataModel=new AddonModScormDataModel12(t.siteId,t.scorm,e.id,t.attempt,null!==(o=t.userData)&&void 0!==o?o:{},t.mode,t.offline,t.canSaveTracks),window.API=t.dataModel);t.currentSco=e,t.title=e.title||t.scorm.name,t.calculateNavigationItems(e.id),t.src=yield T.W.getScoSrc(t.scorm,e),"asset"==e.scormtype&&t.markCompleted(e),t.logEvent(e.id)}))()}markCompleted(e){var t=this;return(0,p.Z)((function*(){if(!t.canSaveTracks)return;const o=[{element:"cmi.core.lesson_status",value:"completed"}];try{T.W.saveTracks(e.id,t.attempt,o,t.scorm,t.offline)}catch{if(t.offline)return;const i=yield T.W.getScormUserData(t.scorm.id,t.attempt,{cmId:t.cmId});if(i[e.id]&&"completed"==i[e.id].userdata["cmi.core.lesson_status"])return;try{var r;yield k.g.convertAttemptToOffline(t.scorm,t.attempt),t.offline=!0,null===(r=t.dataModel)||void 0===r||r.setOffline(!0),yield T.W.saveTracks(e.id,t.attempt,o,t.scorm,!0)}catch(e){I.OQ.showErrorModalDefault(e,"core.error",!0)}}finally{t.refreshToc()}}))()}openToc(){var e=this;return(0,p.Z)((function*(){const t=yield I.OQ.openSideModal({component:U.G,componentProps:{toc:e.toc,attemptToContinue:e.attemptToContinue,selected:e.currentSco&&e.currentSco.id,moduleId:e.cmId,courseId:e.courseId,accessInfo:e.accessInfo,mode:e.mode}});t&&e.loadSco(t)}))()}refreshToc(){var e=this;return(0,p.Z)((function*(){try{yield b.Tr.ignoreErrors(T.W.invalidateAllScormData(e.scorm.id)),yield e.fetchToc()}catch(e){I.OQ.showErrorModalDefault(e,"addon.mod_scorm.errorgetscorm",!0)}}))()}setStartTime(e){var t=this;return(0,p.Z)((function*(){if(!t.canSaveTracks)return;const o=[{element:"x.start.time",value:String(w.D.timestamp())}];yield T.W.saveTracks(e,t.attempt,o,t.scorm,t.offline),t.offline||(yield b.Tr.ignoreErrors(T.W.getAttemptCount(t.scorm.id,{cmId:t.cmId,readingStrategy:2})))}))()}logEvent(e){var t=this;return(0,p.Z)((function*(){yield b.Tr.ignoreErrors(T.W.logLaunchSco(t.scorm.id,e));let o="/mod/scorm/player.php";t.scorm.popup&&(o+=`?a=${t.scorm.id}&currentorg=${t.organizationId}&scoid=${e}&display=popup&mode=${t.mode}`),R.ke.logEvent({type:R.gM.VIEW_ITEM,ws:"mod_scorm_get_scorm_user_data",name:t.scorm.name,data:{id:t.scorm.id,scoid:e,organization:t.organizationId,category:"scorm"},url:o})}))()}ngOnDestroy(){var e,t,o;this.src="",S.R.trigger(S.R.ACTIVITY_DATA_SENT,{module:"scorm"}),null===(e=this.tocObserver)||void 0===e||e.off(),null===(t=this.launchNextObserver)||void 0===t||t.off(),null===(o=this.launchPrevObserver)||void 0===o||o.off(),setTimeout((()=>{var e;null===(e=this.goOfflineObserver)||void 0===e||e.off()}),500),v.d.unblockOperation(T.l.COMPONENT,this.scorm.id,"player")}}return(e=AddonModScormPlayerPage).ɵfac=function AddonModScormPlayerPage_Factory(t){return new(t||e)(d.Y36(F.v))},e.ɵcmp=d.Xpm({type:e,selectors:[["page-addon-mod-scorm-player"]],decls:15,vars:11,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],[3,"loading",4,"ngIf"],[3,"hideUntil"],["id","scorm_object",3,"src","iframeWidth","iframeHeight","showFullscreenOnToolbar","autoFullscreenOnRotate",4,"ngIf"],[4,"ngIf"],["collapsible-footer","","appearOnBottom","","slot","fixed",3,"items","action",4,"ngIf"],[3,"loading"],["fill","clear","aria-haspopup","true",3,"click",4,"ngIf"],["fill","clear","aria-haspopup","true",3,"click"],["name","fas-bookmark","slot","icon-only","aria-hidden","true"],["id","scorm_object",3,"src","iframeWidth","iframeHeight","showFullscreenOnToolbar","autoFullscreenOnRotate"],["collapsible-footer","","appearOnBottom","","slot","fixed",3,"items","action"]],template:function AddonModScormPlayerPage_Template(e,t){1&e&&(d.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),d._UZ(3,"ion-back-button",1),d.ALo(4,"translate"),d.qZA(),d.TgZ(5,"ion-title")(6,"h1"),d._UZ(7,"core-format-text",2),d.qZA()(),d.TgZ(8,"ion-buttons",3),d.YNc(9,AddonModScormPlayerPage_core_button_with_spinner_9_Template,2,2,"core-button-with-spinner",4),d.qZA()()(),d.TgZ(10,"ion-content")(11,"core-loading",5),d.YNc(12,AddonModScormPlayerPage_core_iframe_12_Template,1,5,"core-iframe",6)(13,AddonModScormPlayerPage_p_13_Template,3,3,"p",7),d.qZA(),d.YNc(14,AddonModScormPlayerPage_core_navigation_bar_14_Template,1,1,"core-navigation-bar",8),d.qZA()),2&e&&(d.xp6(3),d.Q6J("text",d.lcZ(4,9,"core.back")),d.xp6(4),d.Q6J("text",t.title)("contextInstanceId",t.cmId)("courseId",t.courseId),d.xp6(2),d.Q6J("ngIf",t.showToc),d.xp6(2),d.Q6J("hideUntil",t.loaded),d.xp6(),d.Q6J("ngIf",t.loaded),d.xp6(),d.Q6J("ngIf",!t.src&&t.errorMessage),d.xp6(),d.Q6J("ngIf",t.loaded&&t.navigationItems.length>1))},dependencies:[J.O5,q.$,Q.X,W.r,z.J,j.I,l.r,G.u,u.t,H.O,h.YG,h.Sm,h.W2,h.Gu,h.gu,h.wd,h.sr,h.oU,f.X$],encapsulation:2}),AddonModScormPlayerPage})();const Y=[{path:":courseId/:cmId",component:_},{path:":courseId/:cmId/player",component:V}];let B=(()=>{var e;class AddonModScormLazyModule{}return(e=AddonModScormLazyModule).ɵfac=function AddonModScormLazyModule_Factory(t){return new(t||e)},e.ɵmod=d.oAB({type:e}),e.ɵinj=d.cJS({imports:[r.Bz.forChild(Y),i.L,n.w]}),AddonModScormLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&d.kYT(B,{declarations:[_,V],imports:[r.Bz,i.L,n.w]}))},61646:(e,t,o)=>{o.d(t,{b:()=>b});var r=o(49671),i=o(13010),n=o(53564),a=o(69956),s=o(43555),c=o(48959),d=o(7351),l=o(10727),m=o(19212),u=o(96814),h=o(66931),f=o(65931),_=o(73946),p=o(86700),g=o(29657),v=o(22068),I=o(31903),w=o(89515);function CoreLoginSitesModalComponent_ion_button_11_Template(e,t){if(1&e){const e=m.EpF();m.TgZ(0,"ion-button",12),m.NdJ("click",(function CoreLoginSitesModalComponent_ion_button_11_Template_ion_button_click_0_listener(){m.CHM(e);const t=m.oxw();return m.KtG(t.toggleDelete())})),m.ALo(1,"translate"),m._UZ(2,"ion-icon",13),m.qZA()}2&e&&m.uIk("aria-label",m.lcZ(1,1,"core.login.toggleremove"))}function CoreLoginSitesModalComponent_ng_template_15_ion_icon_0_Template(e,t){1&e&&m._UZ(0,"ion-icon",16)}const _c0=e=>({count:e});function CoreLoginSitesModalComponent_ng_template_15_ng_container_1_ion_badge_1_Template(e,t){if(1&e&&(m.TgZ(0,"ion-badge",3)(1,"span",19),m._uU(2),m.qZA(),m.TgZ(3,"span",11),m._uU(4),m.ALo(5,"translate"),m.qZA()()),2&e){const e=m.oxw(2).site;m.Q6J("@coreShowHideAnimation",void 0),m.xp6(2),m.Oqu(e.badge),m.xp6(2),m.Oqu(m.xi3(5,3,"core.login.sitebadgedescription",m.VKq(6,_c0,e.badge)))}}function CoreLoginSitesModalComponent_ng_template_15_ng_container_1_ion_button_2_Template(e,t){if(1&e){const e=m.EpF();m.TgZ(0,"ion-button",20),m.NdJ("click",(function CoreLoginSitesModalComponent_ng_template_15_ng_container_1_ion_button_2_Template_ion_button_click_0_listener(t){m.CHM(e);const o=m.oxw(2).site,r=m.oxw();return m.KtG(r.deleteSite(t,o))})),m.ALo(1,"translate"),m._UZ(2,"ion-icon",21),m.qZA()}2&e&&(m.Q6J("@coreSlideInOut","fromRight"),m.uIk("aria-label",m.lcZ(1,2,"core.login.removeaccount")))}function CoreLoginSitesModalComponent_ng_template_15_ng_container_1_Template(e,t){if(1&e&&(m.ynx(0),m.YNc(1,CoreLoginSitesModalComponent_ng_template_15_ng_container_1_ion_badge_1_Template,6,8,"ion-badge",17)(2,CoreLoginSitesModalComponent_ng_template_15_ng_container_1_ion_button_2_Template,3,4,"ion-button",18),m.BQk()),2&e){const e=m.oxw().site,t=m.oxw();m.xp6(),m.Q6J("ngIf",!t.showDelete&&e.badge),m.xp6(),m.Q6J("ngIf",t.showDelete)}}function CoreLoginSitesModalComponent_ng_template_15_Template(e,t){if(1&e&&m.YNc(0,CoreLoginSitesModalComponent_ng_template_15_ion_icon_0_Template,1,0,"ion-icon",14)(1,CoreLoginSitesModalComponent_ng_template_15_ng_container_1_Template,3,2,"ng-container",15),2&e){const e=t.isCurrentSite;m.Q6J("ngIf",e),m.xp6(),m.Q6J("ngIf",!e)}}let b=(()=>{var e;class CoreLoginSitesModalComponent{constructor(){this.accountsList={sameSite:[],otherSites:[],count:0},this.showDelete=!1,this.loaded=!1,this.currentSiteId=n.m9.getRequiredCurrentSite().getId()}ngOnInit(){var e=this;return(0,r.Z)((function*(){e.accountsList=yield a.s.getAccountsList(),e.loaded=!0}))()}add(e){var t=this;return(0,r.Z)((function*(){yield t.close(e,!0),yield a.s.goToAddSite(!0,!0)}))()}deleteSite(e,t){var o=this;return(0,r.Z)((function*(){e.stopPropagation();let r=t.siteName||"";r=yield c.G.formatText(r,{clean:!0,singleLine:!0,filter:!1},[],t.id);try{yield i.OQ.showDeleteConfirm("core.login.confirmdeletesite",{sitename:r})}catch{return}try{yield a.s.deleteAccountFromList(o.accountsList,t),o.showDelete=!1}catch(e){i.OQ.showErrorModalDefault(e,"core.login.errordeletesite",!0)}}))()}login(e){var t=this;return(0,r.Z)((function*(){yield t.close(void 0,!0),yield s.b.navigateToSiteHome({preferCurrentTab:!1,siteId:e.id})}))()}toggleDelete(){this.showDelete=!this.showDelete}close(e,t=!1){return(0,r.Z)((function*(){null==e||e.preventDefault(),null==e||e.stopPropagation(),yield l.IN.dismiss(t)}))()}}return(e=CoreLoginSitesModalComponent).ɵfac=function CoreLoginSitesModalComponent_Factory(t){return new(t||e)},e.ɵcmp=m.Xpm({type:e,selectors:[["core-login-sites-modal"]],decls:24,vars:17,consts:[["slot","start"],["fill","clear",1,"ion-back-button",3,"click"],["ios","chevron-back","md","arrow-back-sharp","slot","icon-only","aria-hidden","true"],["slot","end"],["fill","clear",3,"click",4,"ngIf"],[3,"hideUntil"],[3,"accountsList","sitesClickable","currentSiteClickable","onSiteClicked"],["siteItem",""],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],[3,"click"],["name","fas-plus","aria-hidden","true"],[1,"sr-only"],["fill","clear",3,"click"],["slot","icon-only","name","fas-pen","aria-hidden","true"],["color","success","name","fas-check",4,"ngIf"],[4,"ngIf"],["color","success","name","fas-check"],["slot","end",4,"ngIf"],["slot","end","fill","clear","color","danger",3,"click",4,"ngIf"],["aria-hidden","true"],["slot","end","fill","clear","color","danger",3,"click"],["name","fas-trash","slot","icon-only","aria-hidden","true"]],template:function CoreLoginSitesModalComponent_Template(e,t){1&e&&(m.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),m.NdJ("click",(function CoreLoginSitesModalComponent_Template_ion_button_click_3_listener(e){return t.close(e)})),m.ALo(4,"translate"),m._UZ(5,"ion-icon",2),m.qZA()(),m.TgZ(6,"ion-title")(7,"h1"),m._uU(8),m.ALo(9,"translate"),m.qZA()(),m.TgZ(10,"ion-buttons",3),m.YNc(11,CoreLoginSitesModalComponent_ion_button_11_Template,3,3,"ion-button",4),m.qZA()()(),m.TgZ(12,"ion-content")(13,"core-loading",5)(14,"core-sites-list",6),m.NdJ("onSiteClicked",(function CoreLoginSitesModalComponent_Template_core_sites_list_onSiteClicked_14_listener(e){return t.login(e)})),m.YNc(15,CoreLoginSitesModalComponent_ng_template_15_Template,2,2,"ng-template",null,7,m.W1O),m.qZA()(),m.TgZ(17,"ion-fab",8)(18,"ion-fab-button",9),m.NdJ("click",(function CoreLoginSitesModalComponent_Template_ion_fab_button_click_18_listener(e){return t.add(e)})),m.ALo(19,"translate"),m._UZ(20,"ion-icon",10),m.TgZ(21,"span",11),m._uU(22),m.ALo(23,"translate"),m.qZA()()()()),2&e&&(m.xp6(3),m.uIk("aria-label",m.lcZ(4,9,"core.back")),m.xp6(5),m.Oqu(m.lcZ(9,11,"core.mainmenu.switchaccount")),m.xp6(3),m.Q6J("ngIf",t.accountsList.count>1),m.xp6(2),m.Q6J("hideUntil",t.loaded),m.xp6(),m.Q6J("accountsList",t.accountsList)("sitesClickable",!0)("currentSiteClickable",!1),m.xp6(4),m.uIk("aria-label",m.lcZ(19,13,"core.login.add")),m.xp6(4),m.Oqu(m.lcZ(23,15,"core.login.add")))},dependencies:[u.O5,h.r,f.Z,_.U,p.I,g.t,v.O,I.yp,I.YG,I.Sm,I.W2,I.IJ,I.W4,I.Gu,I.gu,I.wd,I.sr,w.X$],encapsulation:2,data:{animation:[d.j.SLIDE_IN_OUT,d.j.SHOW_HIDE]}}),CoreLoginSitesModalComponent})()}}]);