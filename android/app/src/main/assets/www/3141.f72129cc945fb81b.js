"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3141],{63141:(e,t,o)=>{o.r(t),o.d(t,{AddonModQuizLazyModule:()=>oe});var i=o(67643),n=o(13386),a=o(1868),r=o(98712),d=o(90501),u=o(19212),l=o(8947),s=o(60067),c=o(29657),m=o(31903),_=o(89515);let p=(()=>{var e;class AddonModQuizIndexPage extends r.S{}return(e=AddonModQuizIndexPage).ɵfac=(()=>{let t;return function AddonModQuizIndexPage_Factory(o){return(t||(t=u.n5z(e)))(o||e)}})(),e.ɵcmp=u.Xpm({type:e,selectors:[["page-addon-mod-quiz-index"]],viewQuery:function AddonModQuizIndexPage_Query(e,t){if(1&e&&u.Gf(d.q,5),2&e){let e;u.iGM(e=u.CRH())&&(t.activityComponent=e.first)}},features:[u.qOj],decls:14,vars:12,consts:[["collapsible",""],["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"module","courseId","dataRetrieved"]],template:function AddonModQuizIndexPage_Template(e,t){1&e&&(u.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),u._UZ(3,"ion-back-button",2),u.ALo(4,"translate"),u.qZA(),u.TgZ(5,"ion-title")(6,"h1"),u._UZ(7,"core-format-text",3),u.qZA()(),u._UZ(8,"ion-buttons",4),u.qZA()(),u.TgZ(9,"ion-content",5)(10,"ion-refresher",6),u.NdJ("ionRefresh",(function AddonModQuizIndexPage_Template_ion_refresher_ionRefresh_10_listener(e){return null==t.activityComponent?null:t.activityComponent.doRefresh(e.target)})),u._UZ(11,"ion-refresher-content",7),u.ALo(12,"translate"),u.qZA(),u.TgZ(13,"addon-mod-quiz-index",8),u.NdJ("dataRetrieved",(function AddonModQuizIndexPage_Template_addon_mod_quiz_index_dataRetrieved_13_listener(e){return t.updateData(e)})),u.qZA()()),2&e&&(u.xp6(3),u.Q6J("text",u.lcZ(4,8,"core.back")),u.xp6(4),u.Q6J("text",t.title)("contextInstanceId",t.module.id)("courseId",t.courseId),u.xp6(3),u.Q6J("disabled",null==t.activityComponent?null:t.activityComponent.showLoading),u.xp6(),u.s9C("pullingText",u.lcZ(12,10,"core.pulltorefresh")),u.xp6(2),u.Q6J("module",t.module)("courseId",t.courseId))},dependencies:[l.r,s.e,c.t,m.Sm,m.W2,m.Gu,m.nJ,m.Wo,m.wd,m.sr,m.oU,d.q,_.X$],encapsulation:2}),AddonModQuizIndexPage})();var g=o(49671),f=o(81905),h=o(31381),A=o(43555),v=o(13010),q=o(75803),z=o(10727),w=o(45701),x=o(77156),P=o(96814),T=o(66931),b=o(86700),Q=o(19289),I=o(22068);function AddonModQuizAttemptPage_core_format_text_7_Template(e,t){if(1&e&&u._UZ(0,"core-format-text",9),2&e){const e=u.oxw();u.Q6J("text",e.quiz.name)("contextInstanceId",e.quiz.coursemodule)("courseId",e.courseId)}}function AddonModQuizAttemptPage_ion_list_13_p_6_Template(e,t){1&e&&(u.TgZ(0,"p"),u._uU(1),u.ALo(2,"translate"),u.qZA()),2&e&&(u.xp6(),u.Oqu(u.lcZ(2,1,"addon.mod_quiz.preview")))}function AddonModQuizAttemptPage_ion_list_13_p_7_Template(e,t){if(1&e&&(u.TgZ(0,"p"),u._uU(1),u.qZA()),2&e){const e=u.oxw(2);u.xp6(),u.Oqu(e.attempt.attempt)}}function AddonModQuizAttemptPage_ion_list_13_p_13_Template(e,t){if(1&e&&(u.TgZ(0,"p"),u._uU(1),u.qZA()),2&e){const e=t.$implicit;u.xp6(),u.Oqu(e)}}function AddonModQuizAttemptPage_ion_list_13_ion_item_14_Template(e,t){if(1&e&&(u.TgZ(0,"ion-item",10)(1,"ion-label")(2,"p",11),u._uU(3),u.ALo(4,"translate"),u.qZA(),u.TgZ(5,"p"),u._uU(6),u.qZA()()()),2&e){const e=u.oxw(2);u.xp6(3),u.AsE("",u.lcZ(4,3,"addon.mod_quiz.marks")," / ",e.quiz.sumGradesFormatted,""),u.xp6(3),u.Oqu(e.attempt.readableMark)}}function AddonModQuizAttemptPage_ion_list_13_ion_item_15_Template(e,t){if(1&e&&(u.TgZ(0,"ion-item",10)(1,"ion-label")(2,"p",11),u._uU(3),u.ALo(4,"translate"),u.qZA(),u.TgZ(5,"p"),u._uU(6),u.qZA()()()),2&e){const e=u.oxw(2);u.xp6(3),u.AsE("",u.lcZ(4,3,"addon.mod_quiz.grade")," / ",e.quiz.gradeFormatted,""),u.xp6(3),u.Oqu(e.attempt.readableGrade)}}function AddonModQuizAttemptPage_ion_list_13_ion_item_16_Template(e,t){if(1&e&&(u.TgZ(0,"ion-item",10)(1,"ion-label")(2,"p",11),u._uU(3),u.ALo(4,"translate"),u.qZA(),u.TgZ(5,"p"),u._UZ(6,"core-format-text",15),u.qZA()()()),2&e){const e=u.oxw(2);u.xp6(3),u.Oqu(u.lcZ(4,6,"addon.mod_quiz.feedback")),u.xp6(3),u.Q6J("component",e.component)("componentId",e.componentId)("text",e.feedback)("contextInstanceId",e.cmId)("courseId",e.courseId)}}function AddonModQuizAttemptPage_ion_list_13_ion_item_17_Template(e,t){1&e&&(u.TgZ(0,"ion-item",16)(1,"ion-label")(2,"p"),u._uU(3),u.ALo(4,"translate"),u.qZA()()()),2&e&&(u.xp6(3),u.Oqu(u.lcZ(4,1,"addon.mod_quiz.noreviewattempt")))}function AddonModQuizAttemptPage_ion_list_13_Template(e,t){if(1&e&&(u.TgZ(0,"ion-list")(1,"ion-item",10)(2,"ion-label")(3,"p",11),u._uU(4),u.ALo(5,"translate"),u.qZA(),u.YNc(6,AddonModQuizAttemptPage_ion_list_13_p_6_Template,3,3,"p",7)(7,AddonModQuizAttemptPage_ion_list_13_p_7_Template,2,1,"p",7),u.qZA()(),u.TgZ(8,"ion-item",10)(9,"ion-label")(10,"p",11),u._uU(11),u.ALo(12,"translate"),u.qZA(),u.YNc(13,AddonModQuizAttemptPage_ion_list_13_p_13_Template,2,1,"p",12),u.qZA()(),u.YNc(14,AddonModQuizAttemptPage_ion_list_13_ion_item_14_Template,7,5,"ion-item",13)(15,AddonModQuizAttemptPage_ion_list_13_ion_item_15_Template,7,5,"ion-item",13)(16,AddonModQuizAttemptPage_ion_list_13_ion_item_16_Template,7,8,"ion-item",13)(17,AddonModQuizAttemptPage_ion_list_13_ion_item_17_Template,5,3,"ion-item",14),u.qZA()),2&e){const e=u.oxw();u.xp6(4),u.Oqu(u.lcZ(5,9,"addon.mod_quiz.attemptnumber")),u.xp6(2),u.Q6J("ngIf",e.attempt.preview),u.xp6(),u.Q6J("ngIf",!e.attempt.preview),u.xp6(4),u.Oqu(u.lcZ(12,11,"addon.mod_quiz.attemptstate")),u.xp6(2),u.Q6J("ngForOf",e.attempt.readableState),u.xp6(),u.Q6J("ngIf",e.quiz.showMarkColumn&&""!==e.attempt.readableMark),u.xp6(),u.Q6J("ngIf",e.quiz.showGradeColumn&&""!==e.attempt.readableGrade),u.xp6(),u.Q6J("ngIf",e.quiz.showFeedbackColumn&&e.feedback),u.xp6(),u.Q6J("ngIf",!e.showReviewColumn)}}function AddonModQuizAttemptPage_div_14_Template(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"div",17)(1,"div",18)(2,"ion-button",19),u.NdJ("click",(function AddonModQuizAttemptPage_div_14_Template_ion_button_click_2_listener(){u.CHM(e);const t=u.oxw();return u.KtG(t.reviewAttempt())})),u._UZ(3,"ion-icon",20),u._uU(4),u.ALo(5,"translate"),u.qZA()()()}2&e&&(u.xp6(4),u.hij(" ",u.lcZ(5,1,"addon.mod_quiz.review")," "))}let M=(()=>{var e;class AddonModQuizAttemptPage{constructor(){this.component=w.Q.COMPONENT,this.loaded=!1,this.showReviewColumn=!1}ngOnInit(){try{this.cmId=A.b.getRequiredRouteNumberParam("cmId"),this.courseId=A.b.getRequiredRouteNumberParam("courseId"),this.attemptId=A.b.getRequiredRouteNumberParam("attemptId")}catch(e){return v.OQ.showErrorModal(e),A.b.back(),void 0}this.fetchQuizData().finally((()=>{this.loaded=!0}))}doRefresh(e){this.refreshData().finally((()=>{e.complete()}))}fetchQuizData(){var e=this;return(0,g.Z)((function*(){try{e.quiz=yield w.A.getQuiz(e.courseId,e.cmId),e.componentId=e.quiz.coursemodule;const[t,o,i]=yield Promise.all([w.A.getCombinedReviewOptions(e.quiz.id,{cmId:e.quiz.coursemodule}),e.fetchAccessInfo(e.quiz),e.fetchAttempt(e.quiz.id)]);e.showReviewColumn=o.canreviewmyattempts,x.p.setQuizCalculatedData(e.quiz,t),e.attempt=yield x.p.setAttemptCalculatedData(e.quiz,i,!1,void 0,!0);const n=Number(e.attempt.rescaledGrade);if(e.quiz.showFeedbackColumn&&w.A.isAttemptFinished(e.attempt.state)&&t.someoptions.overallfeedback&&(0,f.R)(n)){const t=yield w.A.getFeedbackForGrade(e.quiz.id,n,{cmId:e.quiz.coursemodule});e.feedback=t.feedbacktext}else delete e.feedback}catch(e){v.OQ.showErrorModalDefault(e,"addon.mod_quiz.errorgetattempt",!0)}}))()}fetchAttempt(e){var t=this;return(0,g.Z)((function*(){const o=(yield w.A.getUserAttempts(e,{cmId:t.cmId})).find((e=>e.id==t.attemptId));if(!o)throw t.attempt=void 0,new h.G(z.vN.instant("addon.mod_quiz.errorgetattempt"));return o}))()}fetchAccessInfo(e){var t=this;return(0,g.Z)((function*(){const o=yield w.A.getQuizAccessInformation(e.id,{cmId:t.cmId});if(!o.canreviewmyattempts)return o;yield q.Tr.ignoreErrors(w.A.invalidateAttemptReviewForPage(t.attemptId,-1));try{yield w.A.getAttemptReview(t.attemptId,{page:-1,cmId:e.coursemodule})}catch{o.canreviewmyattempts=!1}return o}))()}refreshData(){var e=this;return(0,g.Z)((function*(){const t=[];t.push(w.A.invalidateQuizData(e.courseId)),t.push(w.A.invalidateAttemptReview(e.attemptId)),e.quiz&&(t.push(w.A.invalidateUserAttemptsForUser(e.quiz.id)),t.push(w.A.invalidateQuizAccessInformation(e.quiz.id)),t.push(w.A.invalidateCombinedReviewOptionsForUser(e.quiz.id)),e.attempt&&void 0!==e.feedback&&t.push(w.A.invalidateFeedback(e.quiz.id))),yield q.Tr.ignoreErrors(Promise.all(t)),yield e.fetchQuizData()}))()}reviewAttempt(){var e=this;return(0,g.Z)((function*(){e.attempt&&A.b.navigate(`../../review/${e.attempt.id}`)}))()}}return(e=AddonModQuizAttemptPage).ɵfac=function AddonModQuizAttemptPage_Factory(t){return new(t||e)},e.ɵcmp=u.Xpm({type:e,selectors:[["page-addon-mod-quiz-attempt"]],decls:15,vars:11,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId",4,"ngIf"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[4,"ngIf"],["collapsible-footer","","appearOnBottom","","slot","fixed",4,"ngIf"],["contextLevel","module",3,"text","contextInstanceId","courseId"],[1,"ion-text-wrap"],[1,"item-heading"],[4,"ngFor","ngForOf"],["class","ion-text-wrap",4,"ngIf"],["class","ion-text-wrap core-danger-item",4,"ngIf"],["contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],[1,"ion-text-wrap","core-danger-item"],["collapsible-footer","","appearOnBottom","","slot","fixed"],[1,"list-item-limited-width"],["expand","block",1,"ion-margin","ion-text-wrap",3,"click"],["name","fas-magnifying-glass","slot","start","aria-hidden","true"]],template:function AddonModQuizAttemptPage_Template(e,t){1&e&&(u.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),u._UZ(3,"ion-back-button",1),u.ALo(4,"translate"),u.qZA(),u.TgZ(5,"ion-title")(6,"h1"),u.YNc(7,AddonModQuizAttemptPage_core_format_text_7_Template,1,3,"core-format-text",2),u.qZA()()()(),u.TgZ(8,"ion-content",3)(9,"ion-refresher",4),u.NdJ("ionRefresh",(function AddonModQuizAttemptPage_Template_ion_refresher_ionRefresh_9_listener(e){return t.doRefresh(e.target)})),u._UZ(10,"ion-refresher-content",5),u.ALo(11,"translate"),u.qZA(),u.TgZ(12,"core-loading",6),u.YNc(13,AddonModQuizAttemptPage_ion_list_13_Template,18,13,"ion-list",7)(14,AddonModQuizAttemptPage_div_14_Template,6,3,"div",8),u.qZA()()),2&e&&(u.xp6(3),u.Q6J("text",u.lcZ(4,7,"core.back")),u.xp6(4),u.Q6J("ngIf",t.quiz),u.xp6(2),u.Q6J("disabled",!t.loaded),u.xp6(),u.s9C("pullingText",u.lcZ(11,9,"core.pulltorefresh")),u.xp6(2),u.Q6J("hideUntil",t.loaded),u.xp6(),u.Q6J("ngIf",t.attempt),u.xp6(),u.Q6J("ngIf",t.loaded&&t.attempt&&t.showReviewColumn&&t.attempt.finished))},dependencies:[P.sg,P.O5,T.r,b.I,l.r,Q.u,c.t,I.O,m.YG,m.Sm,m.W2,m.Gu,m.gu,m.Ie,m.Q$,m.q_,m.nJ,m.Wo,m.wd,m.sr,m.oU,_.X$],encapsulation:2}),AddonModQuizAttemptPage})();var Z=o(79571),y=o(18714),k=o(61328),O=o(53564),C=o(12265),S=o(98370),R=o(65619),J=o(77730),E=o(53167);class AddonModQuizAutoSave{constructor(e,t){this.formName=e,this.buttonSelector=t,this.CHECK_CHANGES_INTERVAL=5e3,this.popoverShown=!1,this.logger=J.d.getInstance("AddonModQuizAutoSave"),this.errorObservable=new R.X(!1)}cancelAutoSave(){clearTimeout(this.autoSaveTimeout),this.autoSaveTimeout=void 0}checkChanges(e,t,o,i){if(this.autoSaveTimeout)return;const n=this.getAnswers();if(!this.previousAnswers)return this.previousAnswers=n,void 0;let a=!0;for(const e in n)if(this.previousAnswers[e]!=n[e]){a=!1;break}a||this.setAutoSaveTimer(e,t,o,i),this.previousAnswers=n}getAnswers(){return k.L.getAnswersFromForm(document.forms[this.formName])}hideAutoSaveError(){var e;this.errorObservable.next(!1),null===(e=this.popover)||void 0===e||e.dismiss()}onError(){return this.errorObservable}setAutoSaveTimer(e,t,o,i){var n=this;!e.autosaveperiod||this.autoSaveTimeout||w.A.isAttemptTimeNearlyOver(e,t)||(this.autoSaveTimeout=window.setTimeout((0,g.Z)((function*(){const a=n.getAnswers();n.cancelAutoSave(),n.previousAnswers=a;try{yield w.A.saveAttempt(e,t,a,o,i),n.hideAutoSaveError()}catch(a){n.logger.warn("Error auto-saving data.",a),n.errorObservable.getValue()||(n.errorObservable.next(!0),n.showAutoSaveError()),n.setAutoSaveTimer(e,t,o,i)}})),1e3*e.autosaveperiod))}showAutoSaveError(e){var t=this;return(0,g.Z)((function*(){if(t.popoverShown)return;const o=e||{target:document.querySelector(t.buttonSelector),stopPropagation:()=>{},preventDefault:()=>{}};t.popoverShown=!0,t.popover=yield v.OQ.openPopover({component:E.H,event:o}),t.popoverShown=!1}))()}startCheckChangesProcess(e,t,o,i){!this.checkChangesInterval&&e.autosaveperiod&&(this.previousAnswers=void 0,this.loadPreviousAnswersTimeout=window.setTimeout((()=>{this.checkChanges(e,t,o,i)}),2500),this.checkChangesInterval=window.setInterval((()=>{this.checkChanges(e,t,o,i)}),this.CHECK_CHANGES_INTERVAL))}stopCheckChangesProcess(){clearTimeout(this.loadPreviousAnswersTimeout),clearInterval(this.checkChangesInterval),this.loadPreviousAnswersTimeout=void 0,this.checkChangesInterval=void 0}}var N=o(34705),L=o(43649),U=o(40067),D=o(93988),F=o(88817),G=o(30771),H=o(99728),Y=o(43468),$=o(33813),V=o(21525),B=o(56223);const K=["quizForm"];function AddonModQuizPlayerPage_core_format_text_7_Template(e,t){if(1&e&&u._UZ(0,"core-format-text",16),2&e){const e=u.oxw();u.Q6J("text",e.quiz.name)("contextInstanceId",e.quiz.coursemodule)("courseId",e.courseId)}}function AddonModQuizPlayerPage_ion_button_12_Template(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"ion-button",17),u.NdJ("click",(function AddonModQuizPlayerPage_ion_button_12_Template_ion_button_click_0_listener(){u.CHM(e);const t=u.oxw();return u.KtG(t.openNavigation())})),u.ALo(1,"translate"),u._UZ(2,"ion-icon",18),u.qZA()}2&e&&u.uIk("aria-label",u.lcZ(1,1,"addon.mod_quiz.opentoc"))}function AddonModQuizPlayerPage_core_timer_13_Template(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"core-timer",19),u.NdJ("finished",(function AddonModQuizPlayerPage_core_timer_13_Template_core_timer_finished_0_listener(){u.CHM(e);const t=u.oxw();return u.KtG(t.timeUp())})),u.ALo(1,"translate"),u.qZA()}if(2&e){const e=u.oxw();u.Q6J("endTime",e.endTime)("timerText",u.lcZ(1,3,"addon.mod_quiz.timeleft"))("hiddable",!0)}}function AddonModQuizPlayerPage_ion_button_16_Template(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"ion-button",20),u.NdJ("click",(function AddonModQuizPlayerPage_ion_button_16_Template_ion_button_click_0_listener(){u.CHM(e);const t=u.oxw();return u.KtG(t.start())})),u._uU(1),u.ALo(2,"translate"),u.qZA()}2&e&&(u.xp6(),u.hij(" ",u.lcZ(2,1,"addon.mod_quiz.startattempt")," "))}const _c1=e=>({$a:e});function AddonModQuizPlayerPage_form_17_div_2_h2_4_Template(e,t){if(1&e&&(u.TgZ(0,"h2",29),u._uU(1),u.ALo(2,"translate"),u.qZA()),2&e){const e=u.oxw().$implicit;u.xp6(),u.hij(" ",u.xi3(2,1,"core.question.questionno",u.VKq(4,_c1,e.questionnumber))," ")}}function AddonModQuizPlayerPage_form_17_div_2_h2_5_Template(e,t){1&e&&(u.TgZ(0,"h2",29),u._uU(1),u.ALo(2,"translate"),u.qZA()),2&e&&(u.xp6(),u.hij(" ",u.lcZ(2,1,"core.question.information")," "))}function AddonModQuizPlayerPage_form_17_div_2_div_6_p_1_Template(e,t){if(1&e&&(u.TgZ(0,"p",33),u._uU(1),u.qZA()),2&e){const e=u.oxw(2).$implicit;u.xp6(),u.Oqu(e.status)}}function AddonModQuizPlayerPage_form_17_div_2_div_6_p_2_Template(e,t){if(1&e&&u._UZ(0,"p",34),2&e){const e=u.oxw(2).$implicit;u.Q6J("innerHTML",e.readableMark,u.oJD)}}function AddonModQuizPlayerPage_form_17_div_2_div_6_Template(e,t){if(1&e&&(u.TgZ(0,"div",30),u.YNc(1,AddonModQuizPlayerPage_form_17_div_2_div_6_p_1_Template,2,1,"p",31)(2,AddonModQuizPlayerPage_form_17_div_2_div_6_p_2_Template,1,1,"p",32),u.qZA()),2&e){const e=u.oxw().$implicit;u.xp6(),u.Q6J("ngIf",e.status),u.xp6(),u.Q6J("ngIf",e.readableMark)}}function AddonModQuizPlayerPage_form_17_div_2_Template(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"div")(1,"ion-card",24)(2,"ion-item-divider")(3,"ion-label",25),u.YNc(4,AddonModQuizPlayerPage_form_17_div_2_h2_4_Template,3,6,"h2",26)(5,AddonModQuizPlayerPage_form_17_div_2_h2_5_Template,3,3,"h2",26),u.qZA(),u.YNc(6,AddonModQuizPlayerPage_form_17_div_2_div_6_Template,3,2,"div",27),u.qZA(),u.TgZ(7,"core-question",28),u.NdJ("onAbort",(function AddonModQuizPlayerPage_form_17_div_2_Template_core_question_onAbort_7_listener(){u.CHM(e);const t=u.oxw(2);return u.KtG(t.abortQuiz())}))("buttonClicked",(function AddonModQuizPlayerPage_form_17_div_2_Template_core_question_buttonClicked_7_listener(t){u.CHM(e);const o=u.oxw(2);return u.KtG(o.behaviourButtonClicked(t))})),u.qZA()()()}if(2&e){const e=t.$implicit,o=u.oxw(2);u.xp6(),u.MGl("id","addon-mod_quiz-question-",e.slot,""),u.xp6(3),u.Q6J("ngIf","description"!==e.type&&e.questionnumber),u.xp6(),u.Q6J("ngIf","description"===e.type||!e.questionnumber),u.xp6(),u.Q6J("ngIf",e.status||e.readableMark),u.xp6(),u.Q6J("question",e)("component",o.component)("componentId",o.cmId)("attemptId",o.attempt.id)("usageId",o.attempt.uniqueid)("offlineEnabled",o.offline)("contextInstanceId",o.cmId)("courseId",o.courseId)("preferredBehaviour",o.quiz.preferredbehaviour)("review",!1)}}function AddonModQuizPlayerPage_form_17_Template(e,t){if(1&e&&(u.TgZ(0,"form",21,22),u.YNc(2,AddonModQuizPlayerPage_form_17_div_2_Template,8,14,"div",23),u.qZA()),2&e){const e=u.oxw();u.xp6(2),u.Q6J("ngForOf",e.questions)}}function AddonModQuizPlayerPage_ion_row_18_ion_col_1_Template(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"ion-col")(1,"ion-button",36),u.NdJ("click",(function AddonModQuizPlayerPage_ion_row_18_ion_col_1_Template_ion_button_click_1_listener(){u.CHM(e);const t=u.oxw(2);return u.KtG(t.changePage(t.previousPage))})),u._UZ(2,"ion-icon",37),u._uU(3),u.ALo(4,"translate"),u.qZA()()}2&e&&(u.xp6(3),u.hij(" ",u.lcZ(4,1,"core.previous")," "))}function AddonModQuizPlayerPage_ion_row_18_ion_col_2_ion_button_1_Template(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"ion-button",39),u.NdJ("click",(function AddonModQuizPlayerPage_ion_row_18_ion_col_2_ion_button_1_Template_ion_button_click_0_listener(){u.CHM(e);const t=u.oxw(3);return u.KtG(t.changePage(t.nextPage))})),u._uU(1),u.ALo(2,"translate"),u._UZ(3,"ion-icon",40),u.qZA()}2&e&&(u.xp6(),u.hij(" ",u.lcZ(2,1,"core.next")," "))}function AddonModQuizPlayerPage_ion_row_18_ion_col_2_ion_button_2_Template(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"ion-button",39),u.NdJ("click",(function AddonModQuizPlayerPage_ion_row_18_ion_col_2_ion_button_2_Template_ion_button_click_0_listener(){u.CHM(e);const t=u.oxw(3);return u.KtG(t.changePage(t.nextPage))})),u._uU(1),u.ALo(2,"translate"),u.qZA()}2&e&&(u.xp6(),u.hij(" ",u.lcZ(2,1,"core.submit")," "))}function AddonModQuizPlayerPage_ion_row_18_ion_col_2_Template(e,t){if(1&e&&(u.TgZ(0,"ion-col"),u.YNc(1,AddonModQuizPlayerPage_ion_row_18_ion_col_2_ion_button_1_Template,4,3,"ion-button",38)(2,AddonModQuizPlayerPage_ion_row_18_ion_col_2_ion_button_2_Template,3,3,"ion-button",38),u.qZA()),2&e){const e=u.oxw(2);u.xp6(),u.Q6J("ngIf",e.nextPage>0),u.xp6(),u.Q6J("ngIf",-1===e.nextPage)}}function AddonModQuizPlayerPage_ion_row_18_Template(e,t){if(1&e&&(u.TgZ(0,"ion-row",35),u.YNc(1,AddonModQuizPlayerPage_ion_row_18_ion_col_1_Template,5,3,"ion-col",14)(2,AddonModQuizPlayerPage_ion_row_18_ion_col_2_Template,3,2,"ion-col",14),u.qZA()),2&e){const e=u.oxw();u.xp6(),u.Q6J("ngIf",e.previousPage>=0),u.xp6(),u.Q6J("ngIf",e.nextPage>=-1)}}function AddonModQuizPlayerPage_ion_card_19_ng_container_19_ion_item_1_Template(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"ion-item",49),u.NdJ("click",(function AddonModQuizPlayerPage_ion_card_19_ng_container_19_ion_item_1_Template_ion_item_click_0_listener(){u.CHM(e);const t=u.oxw().$implicit,o=u.oxw(2);return u.KtG(o.changePage(t.page,!1,t.slot))})),u.ALo(1,"translate"),u.TgZ(2,"ion-label")(3,"ion-row",42)(4,"ion-col",50),u._uU(5),u.qZA(),u.TgZ(6,"ion-col",51),u._uU(7),u.qZA()()()()}if(2&e){const e=u.oxw().$implicit,t=u.oxw(2);u.Q6J("detail",!t.isSequential&&t.canReturn)("button",!t.isSequential&&t.canReturn),u.uIk("aria-label",u.xi3(1,5,"core.question.questionno",u.VKq(8,_c1,e.questionnumber))),u.xp6(5),u.Oqu(e.questionnumber),u.xp6(2),u.Oqu(e.status)}}function AddonModQuizPlayerPage_ion_card_19_ng_container_19_Template(e,t){if(1&e&&(u.ynx(0),u.YNc(1,AddonModQuizPlayerPage_ion_card_19_ng_container_19_ion_item_1_Template,8,10,"ion-item",48),u.BQk()),2&e){const e=t.$implicit;u.xp6(),u.Q6J("ngIf","description"!==e.type&&e.questionnumber)}}function AddonModQuizPlayerPage_ion_card_19_ion_item_20_Template(e,t){if(1&e&&(u.TgZ(0,"ion-item",25)(1,"ion-label"),u._uU(2),u.qZA()()),2&e){const e=u.oxw(2);u.xp6(2),u.Oqu(e.dueDateWarning)}}function AddonModQuizPlayerPage_ion_card_19_core_timer_21_Template(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"core-timer",52),u.NdJ("finished",(function AddonModQuizPlayerPage_ion_card_19_core_timer_21_Template_core_timer_finished_0_listener(){u.CHM(e);const t=u.oxw(2);return u.KtG(t.timeUp())})),u.ALo(1,"translate"),u.qZA()}if(2&e){const e=u.oxw(2);u.Q6J("endTime",e.endTime)("timerText",u.lcZ(1,2,"addon.mod_quiz.timeleft"))}}function AddonModQuizPlayerPage_ion_card_19_ion_item_22_p_5_Template(e,t){if(1&e&&(u.TgZ(0,"p"),u._uU(1),u.qZA()),2&e){const e=t.$implicit;u.xp6(),u.Oqu(e)}}function AddonModQuizPlayerPage_ion_card_19_ion_item_22_Template(e,t){if(1&e&&(u.TgZ(0,"ion-item",25)(1,"ion-label")(2,"p",53),u._uU(3),u.ALo(4,"translate"),u.qZA(),u.YNc(5,AddonModQuizPlayerPage_ion_card_19_ion_item_22_p_5_Template,2,1,"p",23),u.qZA()()),2&e){const e=u.oxw(2);u.xp6(3),u.Oqu(u.lcZ(4,2,"addon.mod_quiz.cannotsubmitquizdueto")),u.xp6(2),u.Q6J("ngForOf",e.preventSubmitMessages)}}function AddonModQuizPlayerPage_ion_card_19_Template(e,t){if(1&e&&(u.TgZ(0,"ion-card",41)(1,"ion-card-header",25)(2,"ion-card-title"),u._uU(3),u.ALo(4,"translate"),u.qZA()(),u.TgZ(5,"ion-item",25)(6,"ion-label")(7,"ion-row",42)(8,"ion-col",43)(9,"strong"),u._uU(10),u.ALo(11,"translate"),u.qZA()(),u.TgZ(12,"ion-col",44)(13,"strong"),u._uU(14,"#"),u.qZA()(),u.TgZ(15,"ion-col",45)(16,"strong"),u._uU(17),u.ALo(18,"translate"),u.qZA()()()()(),u.YNc(19,AddonModQuizPlayerPage_ion_card_19_ng_container_19_Template,2,1,"ng-container",23)(20,AddonModQuizPlayerPage_ion_card_19_ion_item_20_Template,3,1,"ion-item",46)(21,AddonModQuizPlayerPage_ion_card_19_core_timer_21_Template,2,4,"core-timer",47)(22,AddonModQuizPlayerPage_ion_card_19_ion_item_22_Template,6,4,"ion-item",46),u.qZA()),2&e){const e=u.oxw();u.xp6(3),u.Oqu(u.lcZ(4,7,"addon.mod_quiz.summaryofattempt")),u.xp6(7),u.Oqu(u.lcZ(11,9,"addon.mod_quiz.question")),u.xp6(7),u.Oqu(u.lcZ(18,11,"addon.mod_quiz.status")),u.xp6(2),u.Q6J("ngForOf",e.summaryQuestions),u.xp6(),u.Q6J("ngIf",e.dueDateWarning),u.xp6(),u.Q6J("ngIf",e.endTime),u.xp6(),u.Q6J("ngIf",e.preventSubmitMessages.length)}}function AddonModQuizPlayerPage_ion_card_20_ion_button_5_Template(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"ion-button",55),u.NdJ("click",(function AddonModQuizPlayerPage_ion_card_20_ion_button_5_Template_ion_button_click_0_listener(){u.CHM(e);const t=u.oxw(2);return u.KtG(t.changePage(t.attempt.currentpage))})),u._uU(1),u.ALo(2,"translate"),u.qZA()}2&e&&(u.xp6(),u.hij(" ",u.lcZ(2,1,"addon.mod_quiz.returnattempt")," "))}function AddonModQuizPlayerPage_ion_card_20_Template(e,t){if(1&e&&(u.TgZ(0,"ion-card")(1,"ion-item",25)(2,"ion-label"),u._uU(3),u.ALo(4,"translate"),u.qZA()(),u.YNc(5,AddonModQuizPlayerPage_ion_card_20_ion_button_5_Template,3,3,"ion-button",54),u.qZA()),2&e){const e=u.oxw();u.xp6(3),u.Oqu(u.lcZ(4,2,"addon.mod_quiz.errorparsequestions")),u.xp6(2),u.Q6J("ngIf",e.canReturn)}}function AddonModQuizPlayerPage_div_21_ion_button_2_Template(e,t){if(1&e&&(u.TgZ(0,"ion-button",60),u._uU(1),u.ALo(2,"translate"),u._UZ(3,"ion-icon",61),u.qZA()),2&e){const e=u.oxw(2);u.Q6J("href",e.moduleUrl)("showBrowserWarning",!1),u.xp6(),u.hij(" ",u.lcZ(2,3,"core.openinbrowser")," ")}}function AddonModQuizPlayerPage_div_21_ion_button_3_Template(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"ion-button",62),u.NdJ("click",(function AddonModQuizPlayerPage_div_21_ion_button_3_Template_ion_button_click_0_listener(){u.CHM(e);const t=u.oxw(2);return u.KtG(t.finishAttempt(!0))})),u._uU(1),u.ALo(2,"translate"),u.qZA()}2&e&&(u.xp6(),u.hij(" ",u.lcZ(2,1,"addon.mod_quiz.submitallandfinish")," "))}function AddonModQuizPlayerPage_div_21_Template(e,t){if(1&e&&(u.TgZ(0,"div",56)(1,"div",57),u.YNc(2,AddonModQuizPlayerPage_div_21_ion_button_2_Template,4,5,"ion-button",58)(3,AddonModQuizPlayerPage_div_21_ion_button_3_Template,3,3,"ion-button",59),u.qZA()()),2&e){const e=u.oxw();u.xp6(2),u.Q6J("ngIf",e.preventSubmitMessages.length),u.xp6(),u.Q6J("ngIf",!e.attempt.finishedOffline&&!e.preventSubmitMessages.length)}}let W=(()=>{var e;class AddonModQuizPlayerPage{constructor(e,t){this.changeDetector=e,this.elementRef=t,this.component=w.Q.COMPONENT,this.loaded=!1,this.quizAborted=!1,this.offline=!1,this.navigation=[],this.questions=[],this.nextPage=-2,this.previousPage=-1,this.showSummary=!1,this.summaryQuestions=[],this.canReturn=!1,this.preventSubmitMessages=[],this.autoSaveError=!1,this.isSequential=!1,this.preflightData={},this.newAttempt=!1,this.quizDataLoaded=!1,this.timeUpCalled=!1,this.forceLeave=!1,this.reloadNavigation=!1}ngOnInit(){try{this.cmId=A.b.getRequiredRouteNumberParam("cmId"),this.courseId=A.b.getRequiredRouteNumberParam("courseId"),this.moduleUrl=A.b.getRouteParam("moduleUrl")}catch(e){return v.OQ.showErrorModal(e),A.b.back(),void 0}this.autoSave=new AddonModQuizAutoSave("addon-mod_quiz-player-form","#addon-mod_quiz-connection-error-button"),this.start(),this.autoSaveErrorSubscription=this.autoSave.onError().subscribe((e=>{this.autoSaveError=e,this.changeDetector.detectChanges()}))}ngOnDestroy(){this.stopAutoSave(),this.quiz&&C.d.unblockOperation(w.Q.COMPONENT,this.quiz.id)}canLeave(){var e=this;return(0,g.Z)((function*(){if(e.forceLeave||e.quizAborted||!e.questions.length||e.showSummary)return!0;const t=yield v.OQ.showModalLoading("core.sending",!0);try{yield e.processAttempt(!1,!1)}catch(o){t.dismiss(),yield v.OQ.showConfirm(z.vN.instant("addon.mod_quiz.confirmleavequizonerror")),U.o.triggerFormCancelledEvent(e.formElement,O.m9.getCurrentSiteId())}finally{t.dismiss()}return!0}))()}ionViewWillLeave(){return(0,g.Z)((function*(){const e=yield z.IN.getTop();null==e||e.dismiss()}))()}abortQuiz(){this.quizAborted=!0}behaviourButtonClicked(e){var t=this;return(0,g.Z)((function*(){if(!t.quiz||!t.attempt)return;let o;try{var i,n;yield v.OQ.showConfirm(z.vN.instant("core.areyousure")),o=yield v.OQ.showModalLoading("core.sending",!0);const r=yield t.prepareAnswers(t.quiz.coursemodule);r[e.name]=e.value,yield w.A.processAttempt(t.quiz,t.attempt,r,t.preflightData),t.reloadNavigation=!0;const d=yield null===(i=t.content)||void 0===i?void 0:i.getScrollElement(),u=(null==d?void 0:d.scrollTop)||-1;t.loaded=!1,null===(n=t.content)||void 0===n||n.scrollToTop();try{var a;yield t.loadPage(null!==(a=t.attempt.currentpage)&&void 0!==a?a:0)}finally{t.loaded=!0,-1!=u&&setTimeout((()=>{var e;null===(e=t.content)||void 0===e||e.scrollToPoint(0,u)}),50)}}catch(e){v.OQ.showErrorModalDefault(e,"Error performing action.")}finally{var r;null===(r=o)||void 0===r||r.dismiss()}}))()}changePage(e,t,o){var i=this;return(0,g.Z)((function*(){var n;if(i.attempt&&(-1==e||i.attempt.state!=w.Q.ATTEMPT_OVERDUE&&!i.attempt.finishedOffline)){if(e==i.attempt.currentpage&&!i.showSummary&&void 0!==o)return yield i.scrollToQuestion(o),void 0;if(!(e==i.attempt.currentpage&&!i.showSummary||t&&i.isSequential&&-1!=e||-1===e&&i.showSummary)){if(null===(n=i.content)||void 0===n||n.scrollToTop(),!i.showSummary){const e=yield v.OQ.showModalLoading("core.sending",!0);try{yield i.processAttempt(!1,!1),e.dismiss()}catch(t){return v.OQ.showErrorModalDefault(t,"addon.mod_quiz.errorsaveattempt",!0),e.dismiss(),void 0}i.reloadNavigation=!0}i.loaded=!1;try{i.autoSave.stopCheckChangesProcess(),-1===e?yield i.loadSummary():yield i.loadPage(e)}catch(e){!i.showSummary&&i.quiz&&i.autoSave.startCheckChangesProcess(i.quiz,i.attempt,i.preflightData,i.offline),v.OQ.showErrorModalDefault(e,"addon.mod_quiz.errorgetquestions",!0)}finally{i.loaded=!0,void 0!==o&&(yield i.scrollToQuestion(o))}}}}))()}fetchData(){var e=this;return(0,g.Z)((function*(){e.quiz=yield w.A.getQuiz(e.courseId,e.cmId),C.d.blockOperation(w.Q.COMPONENT,e.quiz.id),yield L.v.waitForSync(e.quiz.id),e.isSequential=w.A.isNavigationSequential(e.quiz),e.offline=!!w.A.isQuizOffline(e.quiz)||(yield w.A.isLastAttemptOfflineUnfinished(e.quiz)),e.quiz.timelimit&&e.quiz.timelimit>0&&(e.readableTimeLimit=F.V.formatTime(e.quiz.timelimit)),e.quizAccessInfo=yield w.A.getQuizAccessInformation(e.quiz.id,{cmId:e.quiz.coursemodule,readingStrategy:e.offline?1:2});const t=yield w.A.getUserAttempts(e.quiz.id,{cmId:e.quiz.coursemodule,readingStrategy:e.offline?1:2});if(!t.length)return e.newAttempt=!0,void 0;e.lastAttempt=yield x.p.setAttemptCalculatedData(e.quiz,t[t.length-1],!1,void 0,!0),e.newAttempt=w.A.isAttemptFinished(e.lastAttempt.state)}))()}finishAttempt(e,t){var o=this;return(0,g.Z)((function*(){if(!o.quiz||!o.attempt)return;let i;try{t||o.attempt.state!=w.Q.ATTEMPT_IN_PROGRESS||(yield v.OQ.showConfirm(z.vN.instant("addon.mod_quiz.confirmclose"))),i=yield v.OQ.showModalLoading("core.sending",!0),yield o.processAttempt(e,t),S.R.trigger(w.Q.ATTEMPT_FINISHED_EVENT,{quizId:o.quiz.id,attemptId:o.attempt.id,synced:!o.offline},O.m9.getCurrentSiteId()),S.R.trigger(S.R.ACTIVITY_DATA_SENT,{module:"quiz"}),t&&o.quiz.graceperiod?(o.stopAutoSave(),o.clearTimer(),yield o.refreshAttempt(),yield o.loadSummary()):(o.forceLeave=!0,A.b.back())}catch(e){v.OQ.showErrorModalDefault(e,"addon.mod_quiz.errorsaveattempt",!0).then(function(){var t=(0,g.Z)((function*(t){yield null==t?void 0:t.onWillDismiss(),e instanceof H.S&&"attemptalreadyclosed"===e.errorcode&&A.b.back()}));return function(e){return t.apply(this,arguments)}}())}finally{var n;null===(n=i)||void 0===n||n.dismiss()}}))()}fixSequenceChecks(){var e=this;return(0,g.Z)((function*(){var t,o,i;if(!e.attempt)return;const n=yield w.A.getAttemptData(e.attempt.id,null!==(t=e.attempt.currentpage)&&void 0!==t?t:0,e.preflightData,{cmId:null===(o=e.quiz)||void 0===o?void 0:o.coursemodule,readingStrategy:e.offline?1:2}),a={};n.questions.forEach((e=>{const t=k.L.getQuestionSequenceCheckFromHtml(e.html);t&&(a[e.slot]=t)})),null===(i=e.questionComponents)||void 0===i||i.forEach((e=>{e.updateSequenceCheck(a)}))}))()}getAnswers(){return k.L.getAnswersFromForm(document.forms["addon-mod_quiz-player-form"])}initTimer(){var e;if(!this.quizAccessInfo||!this.attempt||null===(e=this.attemptAccessInfo)||void 0===e||!e.endtime||this.attemptAccessInfo.endtime<0)return;w.A.shouldShowTimeLeft(this.quizAccessInfo.activerulenames,this.attempt,this.attemptAccessInfo.endtime)?this.endTime=this.attemptAccessInfo.endtime:delete this.endTime}clearTimer(){delete this.endTime}loadPage(e){var t=this;return(0,g.Z)((function*(){if(!t.quiz||!t.attempt)return;t.isSequential&&(yield t.logViewPage(e));const o=yield w.A.getAttemptData(t.attempt.id,e,t.preflightData,{cmId:t.quiz.coursemodule,readingStrategy:t.offline?1:2});t.attempt=o.attempt,t.attempt.currentpage=e,t.questions=o.questions,t.nextPage=o.nextpage,t.previousPage=t.isSequential?-1:e-1,t.showSummary=!1,t.questions.forEach((e=>{e.readableMark=x.p.getQuestionMarkFromHtml(e.html),k.L.extractQuestionInfoBox(e,".info"),w.A.isQuestionBlocked(e)&&(e.type="description")})),t.isSequential||(yield t.logViewPage(e)),t.autoSave.startCheckChangesProcess(t.quiz,t.attempt,t.preflightData,t.offline)}))()}logViewPage(e){var t=this;return(0,g.Z)((function*(){t.quiz&&t.attempt&&(yield q.Tr.ignoreErrors(w.A.logViewAttempt(t.attempt.id,e,t.preflightData,t.offline)),Y.ke.logEvent({type:Y.gM.VIEW_ITEM,ws:"mod_quiz_view_attempt",name:t.quiz.name,data:{id:t.attempt.id,quizid:t.quiz.id,page:e,category:"quiz"},url:`/mod/quiz/attempt.php?attempt=${t.attempt.id}&cmid=${t.cmId}`+(e>0?`&page=${e}`:"")}))}))()}logViewSummary(){var e=this;return(0,g.Z)((function*(){e.quiz&&e.attempt&&(yield q.Tr.ignoreErrors(w.A.logViewAttemptSummary(e.attempt.id,e.preflightData,e.quiz.id)),Y.ke.logEvent({type:Y.gM.VIEW_ITEM,ws:"mod_quiz_view_attempt_summary",name:e.quiz.name,data:{id:e.attempt.id,quizid:e.quiz.id,category:"quiz"},url:`/mod/quiz/summary.php?attempt=${e.attempt.id}&cmid=${e.cmId}`}))}))()}refreshAttempt(){var e=this;return(0,g.Z)((function*(){if(!e.quiz)return;const t=yield w.A.getUserAttempts(e.quiz.id,{cmId:e.quiz.coursemodule,readingStrategy:e.offline?1:2});e.attempt=t.find((t=>{var o;return t.id===(null===(o=e.attempt)||void 0===o?void 0:o.id)}))}))()}loadSummary(){var e=this;return(0,g.Z)((function*(){e.quiz&&e.attempt&&(e.summaryQuestions=[],e.summaryQuestions=yield w.A.getAttemptSummary(e.attempt.id,e.preflightData,{cmId:e.quiz.coursemodule,loadLocal:e.offline,readingStrategy:e.offline?1:2}),e.showSummary=!0,e.canReturn=e.attempt.state==w.Q.ATTEMPT_IN_PROGRESS&&!e.attempt.finishedOffline,e.preventSubmitMessages=w.A.getPreventSubmitMessages(e.summaryQuestions),e.dueDateWarning=w.A.getAttemptDueDateWarning(e.quiz,e.attempt),e.logViewSummary())}))()}loadNavigation(){var e=this;return(0,g.Z)((function*(){var t;e.attempt&&(e.navigation=yield w.A.getAttemptSummary(e.attempt.id,e.preflightData,{cmId:null===(t=e.quiz)||void 0===t?void 0:t.coursemodule,loadLocal:e.offline,readingStrategy:e.offline?1:2}),e.navigation.forEach((e=>{e.stateClass=k.L.getQuestionStateClass(e.state||"")})))}))()}openNavigation(){var e=this;return(0,g.Z)((function*(){var t;if(e.reloadNavigation){const t=yield v.OQ.showModalLoading();yield q.Tr.ignoreErrors(e.loadNavigation()),t.dismiss(),e.reloadNavigation=!1}const o=yield v.OQ.openSideModal({component:N.O,componentProps:{navigation:e.navigation,summaryShown:e.showSummary,currentPage:null===(t=e.attempt)||void 0===t?void 0:t.currentpage,isReview:!1}});o&&e.changePage(o.page,!0,o.slot)}))()}prepareAnswers(e){return k.L.prepareAnswers(this.questions,this.getAnswers(),this.offline,this.component,e)}processAttempt(e,t,o){var i=this;return(0,g.Z)((function*(){if(!i.quiz||!i.attempt)return;let n={};i.showSummary||(n=yield i.prepareAnswers(i.quiz.coursemodule));try{yield w.A.processAttempt(i.quiz,i.attempt,n,i.preflightData,e,t,i.offline)}catch(n){if(!n||"submissionoutofsequencefriendlymessage"!=n.errorcode)throw n;try{yield i.fixSequenceChecks()}catch{throw n}if(o)throw n;return i.processAttempt(e,t,!0)}return i.autoSave.cancelAutoSave(),i.autoSave.hideAutoSaveError(),i.formElement&&U.o.triggerFormSubmittedEvent(i.formElement,!i.offline,O.m9.getCurrentSiteId()),k.L.clearTmpData(i.questions,i.component,i.quiz.coursemodule)}))()}scrollToQuestion(e){var t=this;return(0,g.Z)((function*(){yield q.Tr.nextTick(),yield G.c.waitDirectivesReady(t.elementRef.nativeElement,"core-question"),yield D.V.scrollToElement(t.elementRef.nativeElement,"#addon-mod_quiz-question-"+e)}))()}showConnectionError(e){this.autoSave.showAutoSaveError(e)}start(){var e=this;return(0,g.Z)((function*(){try{e.loaded=!1,e.quizDataLoaded||(yield e.fetchData(),e.quizDataLoaded=!0),yield e.startOrContinueAttempt()}catch(e){v.OQ.showErrorModalDefault(e,"addon.mod_quiz.errorgetquiz",!0)}finally{e.loaded=!0}}))()}startOrContinueAttempt(){var e=this;return(0,g.Z)((function*(){if(!e.quiz||!e.quizAccessInfo)return;let t=e.newAttempt?void 0:e.lastAttempt;var o;(t=yield x.p.getAndCheckPreflightData(e.quiz,e.quizAccessInfo,e.preflightData,t,e.offline,!1,"addon.mod_quiz.startattempt"),e.attemptAccessInfo=yield w.A.getAttemptAccessInformation(e.quiz.id,t.id,{cmId:e.quiz.coursemodule,readingStrategy:e.offline?1:2}),e.attempt=t,yield e.loadNavigation(),e.attempt.state==w.Q.ATTEMPT_OVERDUE||e.attempt.finishedOffline)?yield e.loadSummary():(yield e.loadPage(null!==(o=e.attempt.currentpage)&&void 0!==o?o:0),e.initTimer())}))()}timeUp(){this.timeUpCalled||(this.timeUpCalled=!0,this.finishAttempt(!1,!0))}stopAutoSave(){var e;this.autoSave.cancelAutoSave(),this.autoSave.stopCheckChangesProcess(),null===(e=this.autoSaveErrorSubscription)||void 0===e||e.unsubscribe()}}return(e=AddonModQuizPlayerPage).ɵfac=function AddonModQuizPlayerPage_Factory(t){return new(t||e)(u.Y36(u.sBO),u.Y36(u.SBq))},e.ɵcmp=u.Xpm({type:e,selectors:[["page-addon-mod-quiz-player"]],viewQuery:function AddonModQuizPlayerPage_Query(e,t){if(1&e&&(u.Gf(m.W2,5),u.Gf(K,5),u.Gf(y.L,5)),2&e){let e;u.iGM(e=u.CRH())&&(t.content=e.first),u.iGM(e=u.CRH())&&(t.formElement=e.first),u.iGM(e=u.CRH())&&(t.questionComponents=e)}},decls:22,vars:17,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId",4,"ngIf"],["slot","end"],["fill","clear","id","addon-mod_quiz-connection-error-button","aria-haspopup","dialog",3,"hidden","click"],["name","fas-circle-exclamation","slot","icon-only","aria-hidden","true"],[3,"click",4,"ngIf"],[3,"endTime","timerText","hiddable","finished",4,"ngIf"],[1,"limited-width"],[1,"has-spacer",3,"hideUntil"],["expand","block","class","ion-margin",3,"click",4,"ngIf"],["name","addon-mod_quiz-player-form",4,"ngIf"],["class","spacer-top",4,"ngIf"],["class","addon-mod_quiz-table",4,"ngIf"],[4,"ngIf"],["collapsible-footer","","appearOnBottom","","slot","fixed",4,"ngIf"],["contextLevel","module",3,"text","contextInstanceId","courseId"],[3,"click"],["name","fas-bookmark","slot","icon-only","aria-hidden","true"],[3,"endTime","timerText","hiddable","finished"],["expand","block",1,"ion-margin",3,"click"],["name","addon-mod_quiz-player-form"],["quizForm",""],[4,"ngFor","ngForOf"],[3,"id"],[1,"ion-text-wrap"],["class","inline",4,"ngIf"],["slot","end","class","ion-text-wrap ion-margin-horizontal addon-mod_quiz-question-note",4,"ngIf"],["contextLevel","module",1,"ion-text-wrap",3,"question","component","componentId","attemptId","usageId","offlineEnabled","contextInstanceId","courseId","preferredBehaviour","review","onAbort","buttonClicked"],[1,"inline"],["slot","end",1,"ion-text-wrap","ion-margin-horizontal","addon-mod_quiz-question-note"],["class","block",4,"ngIf"],[3,"innerHTML",4,"ngIf"],[1,"block"],[3,"innerHTML"],[1,"spacer-top"],["expand","block","fill","outline",1,"ion-text-wrap",3,"click"],["name","fas-chevron-left","slot","start","aria-hidden","true"],["expand","block","class","ion-text-wrap",3,"click",4,"ngIf"],["expand","block",1,"ion-text-wrap",3,"click"],["name","fas-chevron-right","slot","end","aria-hidden","true"],[1,"addon-mod_quiz-table"],[1,"ion-align-items-center"],["size","3",1,"ion-text-center","ion-hide-md-down"],["size","3",1,"ion-text-center","ion-hide-md-up"],["size","9",1,"ion-text-center"],["class","ion-text-wrap",4,"ngIf"],[3,"endTime","timerText","finished",4,"ngIf"],[3,"detail","button","click",4,"ngIf"],[3,"detail","button","click"],["size","3",1,"ion-text-center","ion-text-wrap"],["size","9",1,"ion-text-center","ion-text-wrap"],[3,"endTime","timerText","finished"],[1,"item-heading"],["expand","block","class","ion-margin ion-text-wrap","fill","outline",3,"click",4,"ngIf"],["expand","block","fill","outline",1,"ion-margin","ion-text-wrap",3,"click"],["collapsible-footer","","appearOnBottom","","slot","fixed"],[1,"list-item-limited-width"],["expand","block","class","ion-margin ion-text-wrap","core-link","",3,"href","showBrowserWarning",4,"ngIf"],["expand","block","class","ion-margin ion-text-wrap",3,"click",4,"ngIf"],["expand","block","core-link","",1,"ion-margin","ion-text-wrap",3,"href","showBrowserWarning"],["name","fas-up-right-from-square","slot","end","aria-hidden","true"],["expand","block",1,"ion-margin","ion-text-wrap",3,"click"]],template:function AddonModQuizPlayerPage_Template(e,t){1&e&&(u.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),u._UZ(3,"ion-back-button",1),u.ALo(4,"translate"),u.qZA(),u.TgZ(5,"ion-title")(6,"h1"),u.YNc(7,AddonModQuizPlayerPage_core_format_text_7_Template,1,3,"core-format-text",2),u.qZA()(),u.TgZ(8,"ion-buttons",3)(9,"ion-button",4),u.NdJ("click",(function AddonModQuizPlayerPage_Template_ion_button_click_9_listener(e){return t.showConnectionError(e)})),u.ALo(10,"translate"),u._UZ(11,"ion-icon",5),u.qZA(),u.YNc(12,AddonModQuizPlayerPage_ion_button_12_Template,3,3,"ion-button",6),u.qZA()(),u.YNc(13,AddonModQuizPlayerPage_core_timer_13_Template,2,5,"core-timer",7),u.qZA(),u.TgZ(14,"ion-content",8)(15,"core-loading",9),u.YNc(16,AddonModQuizPlayerPage_ion_button_16_Template,3,3,"ion-button",10)(17,AddonModQuizPlayerPage_form_17_Template,3,1,"form",11)(18,AddonModQuizPlayerPage_ion_row_18_Template,3,2,"ion-row",12)(19,AddonModQuizPlayerPage_ion_card_19_Template,23,13,"ion-card",13)(20,AddonModQuizPlayerPage_ion_card_20_Template,6,4,"ion-card",14)(21,AddonModQuizPlayerPage_div_21_Template,4,2,"div",15),u.qZA()()),2&e&&(u.xp6(3),u.Q6J("text",u.lcZ(4,13,"core.back")),u.xp6(4),u.Q6J("ngIf",t.quiz),u.xp6(2),u.Q6J("hidden",!t.autoSaveError),u.uIk("aria-label",u.lcZ(10,15,"addon.mod_quiz.connectionerror")),u.xp6(3),u.Q6J("ngIf",t.navigation.length),u.xp6(),u.Q6J("ngIf",t.loaded&&t.endTime&&t.questions.length&&!t.quizAborted&&!t.showSummary),u.xp6(2),u.Q6J("hideUntil",t.loaded),u.xp6(),u.Q6J("ngIf",!t.attempt),u.xp6(),u.Q6J("ngIf",t.questions.length&&!t.quizAborted&&!t.showSummary),u.xp6(),u.Q6J("ngIf",t.questions.length&&!t.quizAborted&&!t.showSummary),u.xp6(),u.Q6J("ngIf",!t.quizAborted&&t.showSummary&&t.summaryQuestions.length),u.xp6(),u.Q6J("ngIf",t.attempt&&(!t.questions.length&&!t.showSummary||t.quizAborted)),u.xp6(),u.Q6J("ngIf",!t.quizAborted&&t.showSummary&&t.summaryQuestions.length&&t.loaded))},dependencies:[P.sg,P.O5,T.r,$.L,b.I,l.r,V.y,Q.u,c.t,I.O,B._Y,B.JL,B.F,m.YG,m.Sm,m.PM,m.Zi,m.Dq,m.wI,m.W2,m.Gu,m.gu,m.Ie,m.rH,m.Q$,m.Nd,m.wd,m.sr,m.oU,y.L,_.X$],styles:["[_nghost-%COMP%]   .addon-mod_quiz-question-note[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:2px;margin-bottom:2px}[_nghost-%COMP%]   core-timer.core-timer-timeleft-0[_ngcontent-%COMP%]{--timer-background: #ca3120;--timer-text-color: var(--white)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-1[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, .9333333333);--timer-text-color: var(--white)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-2[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, .8666666667);--timer-text-color: var(--white)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-3[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, .8);--timer-text-color: var(--white)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-4[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, .7333333333);--timer-text-color: var(--white)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-5[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, .6666666667);--timer-text-color: var(--white)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-6[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, .6);--timer-text-color: var(--white)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-7[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, .5333333333);--timer-text-color: var(--white)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-8[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, .4666666667)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-9[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, .4)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-10[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, .3333333333)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-11[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, .2666666667)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-12[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, .2)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-13[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, .1333333333)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-14[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, .0666666667)}[_nghost-%COMP%]   core-timer.core-timer-timeleft-15[_ngcontent-%COMP%]{--timer-background: rgba(202, 49, 32, 0)}"]}),AddonModQuizPlayerPage})();var j=o(84095),X=o(83369);function AddonModQuizReviewPage_ion_button_10_Template(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"ion-button",10),u.NdJ("click",(function AddonModQuizReviewPage_ion_button_10_Template_ion_button_click_0_listener(){u.CHM(e);const t=u.oxw();return u.KtG(t.openNavigation())})),u.ALo(1,"translate"),u._UZ(2,"ion-icon",11),u.qZA()}2&e&&u.uIk("aria-label",u.lcZ(1,1,"addon.mod_quiz.opentoc"))}function AddonModQuizReviewPage_ion_card_16_ion_item_17_Template(e,t){if(1&e&&(u.TgZ(0,"ion-item",12)(1,"ion-label")(2,"p",13),u._uU(3),u.ALo(4,"translate"),u.qZA(),u.TgZ(5,"p"),u._uU(6),u.ALo(7,"coreFormatDate"),u.qZA()()()),2&e){const e=u.oxw(2);u.xp6(3),u.Oqu(u.lcZ(4,2,"addon.mod_quiz.completedon")),u.xp6(3),u.Oqu(u.lcZ(7,4,1e3*e.attempt.timefinish))}}function AddonModQuizReviewPage_ion_card_16_ion_item_18_Template(e,t){if(1&e&&(u.TgZ(0,"ion-item",12)(1,"ion-label")(2,"p",13),u._uU(3),u.ALo(4,"translate"),u.qZA(),u.TgZ(5,"p"),u._uU(6),u.qZA()()()),2&e){const e=u.oxw(2);u.xp6(3),u.Oqu(u.lcZ(4,2,"addon.mod_quiz.timetaken")),u.xp6(3),u.Oqu(e.timeTaken)}}function AddonModQuizReviewPage_ion_card_16_ion_item_19_Template(e,t){if(1&e&&(u.TgZ(0,"ion-item",12)(1,"ion-label")(2,"p",13),u._uU(3),u.ALo(4,"translate"),u.qZA(),u.TgZ(5,"p"),u._uU(6),u.qZA()()()),2&e){const e=u.oxw(2);u.xp6(3),u.Oqu(u.lcZ(4,2,"addon.mod_quiz.overdue")),u.xp6(3),u.Oqu(e.overTime)}}function AddonModQuizReviewPage_ion_card_16_ion_item_20_Template(e,t){if(1&e&&(u.TgZ(0,"ion-item",12)(1,"ion-label")(2,"p",13),u._uU(3),u.ALo(4,"translate"),u.qZA(),u.TgZ(5,"p"),u._uU(6),u.qZA()()()),2&e){const e=u.oxw(2);u.xp6(3),u.Oqu(u.lcZ(4,2,"addon.mod_quiz.marks")),u.xp6(3),u.Oqu(e.readableMark)}}function AddonModQuizReviewPage_ion_card_16_ion_item_21_Template(e,t){if(1&e&&(u.TgZ(0,"ion-item",12)(1,"ion-label")(2,"p",13),u._uU(3),u.ALo(4,"translate"),u.qZA(),u.TgZ(5,"p"),u._uU(6),u.qZA()()()),2&e){const e=u.oxw(2);u.xp6(3),u.Oqu(u.lcZ(4,2,"addon.mod_quiz.grade")),u.xp6(3),u.Oqu(e.readableGrade)}}function AddonModQuizReviewPage_ion_card_16_ion_item_22_Template(e,t){if(1&e&&(u.TgZ(0,"ion-item",12)(1,"ion-label")(2,"p",13),u._uU(3),u.qZA(),u._UZ(4,"core-format-text",16),u.qZA()()),2&e){const e=t.$implicit,o=u.oxw(2);u.xp6(3),u.Oqu(e.title),u.xp6(),u.Q6J("component",o.component)("componentId",o.cmId)("text",e.content)("contextInstanceId",o.cmId)("courseId",o.courseId)}}function AddonModQuizReviewPage_ion_card_16_Template(e,t){if(1&e&&(u.TgZ(0,"ion-card")(1,"ion-list")(2,"ion-item",12)(3,"ion-label")(4,"p",13),u._uU(5),u.ALo(6,"translate"),u.qZA(),u.TgZ(7,"p"),u._uU(8),u.ALo(9,"coreFormatDate"),u.qZA()()(),u.TgZ(10,"ion-item",12)(11,"ion-label")(12,"p",13),u._uU(13),u.ALo(14,"translate"),u.qZA(),u.TgZ(15,"p"),u._uU(16),u.qZA()()(),u.YNc(17,AddonModQuizReviewPage_ion_card_16_ion_item_17_Template,8,6,"ion-item",14)(18,AddonModQuizReviewPage_ion_card_16_ion_item_18_Template,7,4,"ion-item",14)(19,AddonModQuizReviewPage_ion_card_16_ion_item_19_Template,7,4,"ion-item",14)(20,AddonModQuizReviewPage_ion_card_16_ion_item_20_Template,7,4,"ion-item",14)(21,AddonModQuizReviewPage_ion_card_16_ion_item_21_Template,7,4,"ion-item",14)(22,AddonModQuizReviewPage_ion_card_16_ion_item_22_Template,5,6,"ion-item",15),u.qZA()()),2&e){const e=u.oxw();u.xp6(5),u.Oqu(u.lcZ(6,10,"addon.mod_quiz.startedon")),u.xp6(3),u.Oqu(u.lcZ(9,12,1e3*e.attempt.timestart)),u.xp6(5),u.Oqu(u.lcZ(14,14,"addon.mod_quiz.attemptstate")),u.xp6(3),u.Oqu(e.readableState),u.xp6(),u.Q6J("ngIf",e.showCompleted),u.xp6(),u.Q6J("ngIf",e.timeTaken),u.xp6(),u.Q6J("ngIf",e.overTime),u.xp6(),u.Q6J("ngIf",e.readableMark),u.xp6(),u.Q6J("ngIf",e.readableGrade),u.xp6(),u.Q6J("ngForOf",e.additionalData)}}const review_c0=e=>({$a:e});function AddonModQuizReviewPage_div_17_div_1_h2_4_Template(e,t){if(1&e&&(u.TgZ(0,"h2"),u._uU(1),u.ALo(2,"translate"),u.qZA()),2&e){const e=u.oxw().$implicit;u.xp6(),u.hij(" ",u.xi3(2,1,"core.question.questionno",u.VKq(4,review_c0,e.questionnumber))," ")}}function AddonModQuizReviewPage_div_17_div_1_h2_5_Template(e,t){1&e&&(u.TgZ(0,"h2"),u._uU(1),u.ALo(2,"translate"),u.qZA()),2&e&&(u.xp6(),u.hij(" ",u.lcZ(2,1,"core.question.information")," "))}function AddonModQuizReviewPage_div_17_div_1_div_6_p_1_Template(e,t){if(1&e&&(u.TgZ(0,"p"),u._uU(1),u.qZA()),2&e){const e=u.oxw(2).$implicit;u.xp6(),u.Oqu(e.status)}}function AddonModQuizReviewPage_div_17_div_1_div_6_p_2_Template(e,t){if(1&e&&u._UZ(0,"p",23),2&e){const e=u.oxw(2).$implicit;u.Q6J("innerHTML",e.readableMark,u.oJD)}}function AddonModQuizReviewPage_div_17_div_1_div_6_Template(e,t){if(1&e&&(u.TgZ(0,"div",21),u.YNc(1,AddonModQuizReviewPage_div_17_div_1_div_6_p_1_Template,2,1,"p",8)(2,AddonModQuizReviewPage_div_17_div_1_div_6_p_2_Template,1,1,"p",22),u.qZA()),2&e){const e=u.oxw().$implicit;u.xp6(),u.Q6J("ngIf",e.status),u.xp6(),u.Q6J("ngIf",e.readableMark)}}function AddonModQuizReviewPage_div_17_div_1_Template(e,t){if(1&e&&(u.TgZ(0,"div")(1,"ion-card",18)(2,"ion-item-divider")(3,"ion-label",12),u.YNc(4,AddonModQuizReviewPage_div_17_div_1_h2_4_Template,3,6,"h2",8)(5,AddonModQuizReviewPage_div_17_div_1_h2_5_Template,3,3,"h2",8),u.qZA(),u.YNc(6,AddonModQuizReviewPage_div_17_div_1_div_6_Template,3,2,"div",19),u.qZA(),u._UZ(7,"core-question",20),u.qZA()()),2&e){const e=t.$implicit,o=u.oxw(2);u.xp6(),u.MGl("id","addon-mod_quiz-question-",e.slot,""),u.xp6(3),u.Q6J("ngIf","description"!==e.type&&e.questionnumber),u.xp6(),u.Q6J("ngIf","description"===e.type||!e.questionnumber),u.xp6(),u.Q6J("ngIf",e.status||e.readableMark),u.xp6(),u.Q6J("question",e)("component",o.component)("componentId",o.cmId)("attemptId",o.attempt.id)("usageId",o.attempt.uniqueid)("offlineEnabled",!1)("contextInstanceId",o.cmId)("courseId",o.courseId)("review",!0)("preferredBehaviour",null==o.quiz?null:o.quiz.preferredbehaviour)}}function AddonModQuizReviewPage_div_17_Template(e,t){if(1&e&&(u.TgZ(0,"div"),u.YNc(1,AddonModQuizReviewPage_div_17_div_1_Template,8,14,"div",17),u.qZA()),2&e){const e=u.oxw();u.xp6(),u.Q6J("ngForOf",e.questions)}}function AddonModQuizReviewPage_div_18_ion_col_2_Template(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"ion-col",30)(1,"ion-button",31),u.NdJ("click",(function AddonModQuizReviewPage_div_18_ion_col_2_Template_ion_button_click_1_listener(){u.CHM(e);const t=u.oxw(2);return u.KtG(t.changePage(t.previousPage))})),u.ALo(2,"translate"),u._UZ(3,"ion-icon",32),u.qZA()()}if(2&e){const e=u.oxw(2);u.xp6(),u.Q6J("disabled",e.previousPage<0),u.uIk("aria-label",u.lcZ(2,2,"core.previous"))}}function AddonModQuizReviewPage_div_18_ion_button_4_span_1_Template(e,t){1&e&&(u.TgZ(0,"span"),u._uU(1),u.ALo(2,"translate"),u.qZA()),2&e&&(u.xp6(),u.Oqu(u.lcZ(2,1,"addon.mod_quiz.showall")))}function AddonModQuizReviewPage_div_18_ion_button_4_span_2_Template(e,t){1&e&&(u.TgZ(0,"span"),u._uU(1),u.ALo(2,"translate"),u.qZA()),2&e&&(u.xp6(),u.Oqu(u.lcZ(2,1,"addon.mod_quiz.showeachpage")))}function AddonModQuizReviewPage_div_18_ion_button_4_Template(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"ion-button",33),u.NdJ("click",(function AddonModQuizReviewPage_div_18_ion_button_4_Template_ion_button_click_0_listener(){u.CHM(e);const t=u.oxw(2);return u.KtG(t.switchMode())})),u.YNc(1,AddonModQuizReviewPage_div_18_ion_button_4_span_1_Template,3,3,"span",8)(2,AddonModQuizReviewPage_div_18_ion_button_4_span_2_Template,3,3,"span",8),u.qZA()}if(2&e){const e=u.oxw(2);u.xp6(),u.Q6J("ngIf",!e.showAll),u.xp6(),u.Q6J("ngIf",e.showAll)}}function AddonModQuizReviewPage_div_18_ion_col_5_Template(e,t){if(1&e){const e=u.EpF();u.TgZ(0,"ion-col",34)(1,"ion-button",31),u.NdJ("click",(function AddonModQuizReviewPage_div_18_ion_col_5_Template_ion_button_click_1_listener(){u.CHM(e);const t=u.oxw(2);return u.KtG(t.changePage(t.nextPage))})),u.ALo(2,"translate"),u._UZ(3,"ion-icon",35),u.qZA()()}if(2&e){const e=u.oxw(2);u.xp6(),u.Q6J("disabled",e.nextPage>=e.numPages),u.uIk("aria-label",u.lcZ(2,2,"core.next"))}}function AddonModQuizReviewPage_div_18_Template(e,t){if(1&e&&(u.TgZ(0,"div",24)(1,"ion-row",25),u.YNc(2,AddonModQuizReviewPage_div_18_ion_col_2_Template,4,4,"ion-col",26),u.TgZ(3,"ion-col",27),u.YNc(4,AddonModQuizReviewPage_div_18_ion_button_4_Template,3,2,"ion-button",28),u.qZA(),u.YNc(5,AddonModQuizReviewPage_div_18_ion_col_5_Template,4,4,"ion-col",29),u.qZA()()),2&e){const e=u.oxw();u.xp6(2),u.Q6J("ngIf",!e.showAll),u.xp6(2),u.Q6J("ngIf",e.numPages>1),u.xp6(),u.Q6J("ngIf",!e.showAll)}}let ee=(()=>{var e;class AddonModQuizReviewPage{constructor(e){this.elementRef=e,this.component=w.Q.COMPONENT,this.showAll=!1,this.numPages=1,this.showCompleted=!1,this.loaded=!1,this.navigation=[],this.questions=[],this.nextPage=-2,this.previousPage=-2,this.logView=F.V.once((()=>this.performLogView(!0,{showAllDisabled:!this.showAll,page:this.currentPage})))}ngOnInit(){var e=this;return(0,g.Z)((function*(){try{e.cmId=A.b.getRequiredRouteNumberParam("cmId"),e.courseId=A.b.getRequiredRouteNumberParam("courseId"),e.attemptId=A.b.getRequiredRouteNumberParam("attemptId"),e.currentPage=A.b.getRouteNumberParam("page")||-1,e.showAll=-1==e.currentPage}catch(e){return v.OQ.showErrorModal(e),A.b.back(),void 0}try{yield e.fetchData()}finally{e.loaded=!0}}))()}changePage(e,t){var o=this;return(0,g.Z)((function*(){var i,n;if(void 0!==t&&(-1==(null===(i=o.attempt)||void 0===i?void 0:i.currentpage)||e==o.currentPage))return o.scrollToQuestion(t),void 0;if(e!=o.currentPage){o.loaded=!1,null===(n=o.content)||void 0===n||n.scrollToTop();try{yield o.loadPage(e),o.performLogView(!1,{page:e})}catch(e){v.OQ.showErrorModalDefault(e,"addon.mod_quiz.errorgetquestions",!0)}finally{o.loaded=!0,void 0!==t&&o.scrollToQuestion(t)}}}))()}fetchData(){var e=this;return(0,g.Z)((function*(){try{e.quiz=yield w.A.getQuiz(e.courseId,e.cmId),e.options=yield w.A.getCombinedReviewOptions(e.quiz.id,{cmId:e.cmId}),yield e.loadNavigation(),yield e.loadPage(e.currentPage),e.logView()}catch(e){v.OQ.showErrorModalDefault(e,"addon.mod_quiz.errorgetquiz",!0)}}))()}loadPage(e){var t=this;return(0,g.Z)((function*(){var o;const i=yield w.A.getAttemptReview(t.attemptId,{page:e,cmId:null===(o=t.quiz)||void 0===o?void 0:o.coursemodule});t.attempt=i.attempt,t.attempt.currentpage=e,t.currentPage=e,t.setSummaryCalculatedData(i),t.questions=i.questions,t.nextPage=e+1,t.previousPage=e-1,t.questions.forEach((e=>{e.readableMark=x.p.getQuestionMarkFromHtml(e.html),k.L.extractQuestionInfoBox(e,".info")}))}))()}loadNavigation(){var e=this;return(0,g.Z)((function*(){var t;const o=yield w.A.getAttemptReview(e.attemptId,{page:-1,cmId:null===(t=e.quiz)||void 0===t?void 0:t.coursemodule});e.navigation=o.questions,e.navigation.forEach((e=>{e.stateClass=k.L.getQuestionStateClass(e.state||"")}));const i=o.questions[o.questions.length-1];e.numPages=i?i.page+1:0}))()}refreshData(e){var t=this;return(0,g.Z)((function*(){const o=[];o.push(w.A.invalidateQuizData(t.courseId)),o.push(w.A.invalidateAttemptReview(t.attemptId)),t.quiz&&o.push(w.A.invalidateCombinedReviewOptionsForUser(t.quiz.id)),yield q.Tr.ignoreErrors(Promise.all(o));try{yield t.fetchData()}finally{e.complete()}}))()}scrollToQuestion(e){D.V.scrollToElement(this.elementRef.nativeElement,`#addon-mod_quiz-question-${e}`)}setSummaryCalculatedData(e){var t;if(!this.attempt||!this.quiz)return;if(this.readableState=w.A.getAttemptReadableStateName(null!==(t=this.attempt.state)&&void 0!==t?t:""),this.attempt.state!=w.Q.ATTEMPT_FINISHED)return;this.showCompleted=!0,this.additionalData=e.additionaldata;const o=(this.attempt.timefinish||0)-(this.attempt.timestart||0);if(o>0?(this.timeTaken=F.V.formatTime(o),this.quiz.timelimit&&o>this.quiz.timelimit+60&&(this.overTime=F.V.formatTime(o-this.quiz.timelimit))):this.timeTaken=void 0,this.options&&this.options.someoptions.marks>=w.Q.QUESTION_OPTIONS_MARK_AND_MAX&&w.A.quizHasGrades(this.quiz))if(null==e.grade)this.readableGrade=w.A.formatGrade(e.grade,this.quiz.decimalpoints);else{this.quiz.grade!=this.quiz.sumgrades&&(this.readableMark=z.vN.instant("addon.mod_quiz.outofshort",{$a:{grade:w.A.formatGrade(this.attempt.sumgrades,this.quiz.decimalpoints),maxgrade:w.A.formatGrade(this.quiz.sumgrades,this.quiz.decimalpoints)}}));const t={grade:w.A.formatGrade(Number(e.grade),this.quiz.decimalpoints),maxgrade:w.A.formatGrade(this.quiz.grade,this.quiz.decimalpoints)};var i,n;if(100!=this.quiz.grade)t.percent=w.A.formatGrade(100*(null!==(i=this.attempt.sumgrades)&&void 0!==i?i:0)/(null!==(n=this.quiz.sumgrades)&&void 0!==n?n:1),this.quiz.decimalpoints),this.readableGrade=z.vN.instant("addon.mod_quiz.outofpercent",{$a:t});else this.readableGrade=z.vN.instant("addon.mod_quiz.outof",{$a:t})}this.additionalData.forEach((e=>{e.content=v.OQ.removeElementFromHtml(e.content,".helptooltip")}))}switchMode(){var e=this;return(0,g.Z)((function*(){e.showAll=!e.showAll,yield e.loadPage(e.showAll?-1:0),e.performLogView(!1,{showAllDisabled:!e.showAll})}))()}openNavigation(){var e=this;return(0,g.Z)((function*(){var t;const o=yield v.OQ.openSideModal({component:N.O,componentProps:{navigation:e.navigation,summaryShown:!1,currentPage:null===(t=e.attempt)||void 0===t?void 0:t.currentpage,isReview:!0}});o&&e.changePage(o.page,o.slot)}))()}performLogView(e=!1,t={}){var o=this;return(0,g.Z)((function*(){if(!o.quiz)return;e&&(yield q.Tr.ignoreErrors(w.A.logViewAttemptReview(o.attemptId,o.quiz.id)));let i=`/mod/quiz/review.php?attempt=${o.attemptId}&cmid=${o.cmId}`;t.showAllDisabled?i+="&showall=0":t.page&&t.page>0&&(i+=`&page=${t.page}`),Y.ke.logEvent({type:Y.gM.VIEW_ITEM,ws:"mod_quiz_view_attempt_review",name:o.quiz.name,data:{id:o.attemptId,quizid:o.quiz.id,page:t.page,category:"quiz"},url:i})}))()}}return(e=AddonModQuizReviewPage).ɵfac=function AddonModQuizReviewPage_Factory(t){return new(t||e)(u.Y36(u.SBq))},e.ɵcmp=u.Xpm({type:e,selectors:[["page-addon-mod-quiz-review"]],viewQuery:function AddonModQuizReviewPage_Query(e,t){if(1&e&&u.Gf(m.W2,5),2&e){let e;u.iGM(e=u.CRH())&&(t.content=e.first)}},decls:19,vars:15,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear","aria-haspopup","true",3,"click",4,"ngIf"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[4,"ngIf"],["collapsible-footer","","appearOnBottom","","slot","fixed",4,"ngIf"],["fill","clear","aria-haspopup","true",3,"click"],["name","fas-bookmark","slot","icon-only","aria-hidden","true"],[1,"ion-text-wrap"],[1,"item-heading"],["class","ion-text-wrap",4,"ngIf"],["class","ion-text-wrap",4,"ngFor","ngForOf"],["contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],[4,"ngFor","ngForOf"],[3,"id"],["class","ion-text-wrap ion-margin-horizontal addon-mod_quiz-question-note","slot","end",4,"ngIf"],["contextLevel","module",1,"ion-text-wrap",3,"question","component","componentId","attemptId","usageId","offlineEnabled","contextInstanceId","courseId","review","preferredBehaviour"],["slot","end",1,"ion-text-wrap","ion-margin-horizontal","addon-mod_quiz-question-note"],[3,"innerHTML",4,"ngIf"],[3,"innerHTML"],["collapsible-footer","","appearOnBottom","","slot","fixed"],[1,"ion-justify-content-between","ion-align-items-center","ion-no-padding","ion-wrap"],["class","ion-text-start ion-no-padding core-navigation-arrow","size","auto",4,"ngIf"],[1,"ion-text-center"],["class","ion-text-wrap","fill","outline",3,"click",4,"ngIf"],["class","ion-text-end ion-no-padding core-navigation-arrow","size","auto",4,"ngIf"],["size","auto",1,"ion-text-start","ion-no-padding","core-navigation-arrow"],["fill","clear",3,"disabled","click"],["name","fas-chevron-left","slot","icon-only","aria-hidden","true"],["fill","outline",1,"ion-text-wrap",3,"click"],["size","auto",1,"ion-text-end","ion-no-padding","core-navigation-arrow"],["name","fas-chevron-right","slot","icon-only","aria-hidden","true"]],template:function AddonModQuizReviewPage_Template(e,t){1&e&&(u.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),u._UZ(3,"ion-back-button",1),u.ALo(4,"translate"),u.qZA(),u.TgZ(5,"ion-title")(6,"h1"),u._uU(7),u.ALo(8,"translate"),u.qZA()(),u.TgZ(9,"ion-buttons",2),u.YNc(10,AddonModQuizReviewPage_ion_button_10_Template,3,3,"ion-button",3),u.qZA()()(),u.TgZ(11,"ion-content",4)(12,"ion-refresher",5),u.NdJ("ionRefresh",(function AddonModQuizReviewPage_Template_ion_refresher_ionRefresh_12_listener(e){return t.refreshData(e.target)})),u._UZ(13,"ion-refresher-content",6),u.ALo(14,"translate"),u.qZA(),u.TgZ(15,"core-loading",7),u.YNc(16,AddonModQuizReviewPage_ion_card_16_Template,23,16,"ion-card",8)(17,AddonModQuizReviewPage_div_17_Template,2,1,"div",8)(18,AddonModQuizReviewPage_div_18_Template,6,3,"div",9),u.qZA()()),2&e&&(u.xp6(3),u.Q6J("text",u.lcZ(4,9,"core.back")),u.xp6(4),u.Oqu(u.lcZ(8,11,"addon.mod_quiz.review")),u.xp6(3),u.Q6J("ngIf",t.navigation.length),u.xp6(2),u.Q6J("disabled",!t.loaded),u.xp6(),u.s9C("pullingText",u.lcZ(14,13,"core.pulltorefresh")),u.xp6(2),u.Q6J("hideUntil",t.loaded),u.xp6(),u.Q6J("ngIf",t.attempt),u.xp6(),u.Q6J("ngIf",t.attempt&&t.questions.length),u.xp6(),u.Q6J("ngIf",t.loaded&&t.numPages>1))},dependencies:[P.sg,P.O5,T.r,b.I,l.r,Q.u,c.t,I.O,m.YG,m.Sm,m.PM,m.wI,m.W2,m.Gu,m.gu,m.Ie,m.rH,m.Q$,m.q_,m.nJ,m.Wo,m.Nd,m.wd,m.sr,m.oU,y.L,X.o,_.X$],styles:["[_nghost-%COMP%]   .addon-mod_quiz-question-note[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:2px;margin-bottom:2px}"]}),AddonModQuizReviewPage})();const te=[{path:":courseId/:cmId",component:p},{path:":courseId/:cmId/player",component:W,canDeactivate:[j.Y]},{path:":courseId/:cmId/attempt/:attemptId",component:M},{path:":courseId/:cmId/review/:attemptId",component:ee}];let oe=(()=>{var e;class AddonModQuizLazyModule{}return(e=AddonModQuizLazyModule).ɵfac=function AddonModQuizLazyModule_Factory(t){return new(t||e)},e.ɵmod=u.oAB({type:e}),e.ɵinj=u.cJS({imports:[i.Bz.forChild(te),n.L,a.e,Z.l]}),AddonModQuizLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&u.kYT(oe,{declarations:[p,M,W,ee],imports:[i.Bz,n.L,a.e,Z.l]}))}}]);