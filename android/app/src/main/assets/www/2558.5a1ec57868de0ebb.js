"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2558],{12558:(t,i,o)=>{o.r(i),o.d(i,{AddonNotificationsLazyModule:()=>H});var n=o(23966),e=o(13386),a=o(49671),r=o(13010),c=o(75803),s=o(98370),d=o(65578),l=o(43555),_=o(30242),f=o(25233),g=o(62369),m=o(53564),u=o(52467),p=o(52160),h=o(54129);class AddonNotificationsNotificationsSource extends h.H{constructor(){super(...arguments),this.totals={}}getItemPath(t){return t.id.toString()}reset(){this.totals={},super.reset()}loadPageItems(t){var i=this;return(0,a.Z)((function*(){const o=yield i.loadNotifications(d.AF.BOTH,t*i.getPageLength());return{items:o.notifications,hasMoreItems:o.hasMoreNotifications}}))()}loadNotifications(t,i,o){var n=this;return(0,a.Z)((function*(){var e,a;if(o=null!==(e=o)&&void 0!==e?e:n.getPageLength(),t in n.totals&&n.totals[t]<=i)return{notifications:[],hasMoreNotifications:!1};const r=yield d.hv.getNotificationsWithStatus(t,{offset:i,limit:o});return r.length<o&&(n.totals[t]=i+r.length),{notifications:r,hasMoreNotifications:(null!==(a=n.totals[t])&&void 0!==a?a:Number.MAX_VALUE)>i+o}}))()}setItems(t,i){const o=t.slice(0);o.sort(((t,i)=>t.timecreated<i.timecreated?1:-1)),super.setItems(o,i)}getPageLength(){return d.he.LIST_LIMIT}}var v=o(1389);class AddonLegacyNotificationsNotificationsSource extends AddonNotificationsNotificationsSource{loadPageItems(t){var i=this;return(0,a.Z)((function*(){let o=[],n=!1,e=0;const a=i.getPageLength(),totalUnread=()=>{var t;return null!==(t=i.totals[d.AF.UNREAD])&&void 0!==t?t:Number.MAX_VALUE};if(totalUnread()>t*a){const r=yield i.loadNotifications(d.AF.UNREAD,t*a);o=o.concat(r.notifications),n=r.hasMoreNotifications,e=r.notifications.length}if(totalUnread()<(t+1)*a){const r=Math.max(0,t*a-totalUnread()),c=yield i.loadNotifications(d.AF.READ,r,a-e);o=o.concat(c.notifications),n=c.hasMoreNotifications}return{items:o,hasMoreItems:n}}))()}}var x=o(19212),N=o(96814),P=o(55126),A=o(52133),M=o(66931),b=o(80070),C=o(50668),O=o(86700),I=o(8947),T=o(19289),y=o(29657),Z=o(31903),w=o(83431),L=o(54490),k=o(89515);function AddonNotificationsListPage_ion_item_17_core_user_avatar_1_div_1_Template(t,i){if(1&t&&(x.TgZ(0,"div",19),x._UZ(1,"img",20),x.qZA()),2&t){const t=x.oxw(2).$implicit;x.xp6(),x.Q6J("src",t.iconurl,x.LSH)}}function AddonNotificationsListPage_ion_item_17_core_user_avatar_1_Template(t,i){if(1&t&&(x.TgZ(0,"core-user-avatar",17),x.YNc(1,AddonNotificationsListPage_ion_item_17_core_user_avatar_1_div_1_Template,2,1,"div",18),x.qZA()),2&t){const t=x.oxw().$implicit;x.Q6J("user",t)("profileUrl",t.profileimageurlfrom)("fullname",t.userfromfullname)("userId",t.useridfrom),x.xp6(),x.Q6J("ngIf",t.iconurl)}}function AddonNotificationsListPage_ion_item_17_ng_container_2_img_1_Template(t,i){if(1&t&&x._UZ(0,"img",23),2&t){const t=x.oxw(2).$implicit;x.Q6J("src",t.imgUrl,x.LSH)}}function AddonNotificationsListPage_ion_item_17_ng_container_2_div_2_img_1_Template(t,i){if(1&t&&x._UZ(0,"img",27),2&t){const t=x.oxw(3).$implicit;x.Q6J("src",t.iconurl,x.LSH)}}function AddonNotificationsListPage_ion_item_17_ng_container_2_div_2_ion_icon_2_Template(t,i){1&t&&x._UZ(0,"ion-icon",28)}function AddonNotificationsListPage_ion_item_17_ng_container_2_div_2_Template(t,i){if(1&t&&(x.TgZ(0,"div",24),x.YNc(1,AddonNotificationsListPage_ion_item_17_ng_container_2_div_2_img_1_Template,1,1,"img",25)(2,AddonNotificationsListPage_ion_item_17_ng_container_2_div_2_ion_icon_2_Template,1,0,"ion-icon",26),x.qZA()),2&t){const t=x.oxw(2).$implicit;x.xp6(),x.Q6J("ngIf",t.iconurl),x.xp6(),x.Q6J("ngIf",!t.iconurl)}}function AddonNotificationsListPage_ion_item_17_ng_container_2_Template(t,i){if(1&t&&(x.ynx(0),x.YNc(1,AddonNotificationsListPage_ion_item_17_ng_container_2_img_1_Template,1,1,"img",21)(2,AddonNotificationsListPage_ion_item_17_ng_container_2_div_2_Template,3,2,"div",22),x.BQk()),2&t){const t=x.oxw().$implicit;x.xp6(),x.Q6J("ngIf",t.imgUrl),x.xp6(),x.Q6J("ngIf",!t.imgUrl)}}function AddonNotificationsListPage_ion_item_17_ng_container_10_Template(t,i){if(1&t&&(x.ynx(0),x._uU(1),x.BQk()),2&t){const t=x.oxw().$implicit;x.xp6(),x.hij(" · ",t.userfromfullname,"")}}function AddonNotificationsListPage_ion_item_17_ion_note_11_Template(t,i){1&t&&(x.TgZ(0,"ion-note",2),x._UZ(1,"ion-icon",29),x.qZA())}const _c0=t=>({$a:t});function AddonNotificationsListPage_ion_item_17_Template(t,i){if(1&t){const t=x.EpF();x.TgZ(0,"ion-item",11),x.NdJ("click",(function AddonNotificationsListPage_ion_item_17_Template_ion_item_click_0_listener(){const i=x.CHM(t).$implicit,o=x.oxw();return x.KtG(o.notifications.select(i))})),x.YNc(1,AddonNotificationsListPage_ion_item_17_core_user_avatar_1_Template,2,5,"core-user-avatar",12)(2,AddonNotificationsListPage_ion_item_17_ng_container_2_Template,3,2,"ng-container",13),x.TgZ(3,"ion-label")(4,"p",14),x.ALo(5,"translate"),x._UZ(6,"core-format-text",15),x.qZA(),x.TgZ(7,"p"),x._uU(8),x.ALo(9,"coreTimeAgo"),x.YNc(10,AddonNotificationsListPage_ion_item_17_ng_container_10_Template,2,1,"ng-container",13),x.qZA()(),x.YNc(11,AddonNotificationsListPage_ion_item_17_ion_note_11_Template,2,0,"ion-note",16),x.qZA()}if(2&t){const t=i.$implicit,o=x.oxw();x.Q6J("detail",!1),x.uIk("aria-current",o.notifications.getItemAriaCurrent(t)),x.xp6(),x.Q6J("ngIf",t.useridfrom>0),x.xp6(),x.Q6J("ngIf",t.useridfrom<=0),x.xp6(2),x.uIk("aria-label",t.timeread?t.subject:x.xi3(5,11,"addon.notifications.unreadnotification",x.VKq(16,_c0,t.subject))),x.xp6(2),x.Q6J("text",t.subject)("contextInstanceId",0)("wsNotFiltered",!0),x.xp6(2),x.Oqu(x.lcZ(9,14,t.timecreated)),x.xp6(2),x.Q6J("ngIf",t.useridfrom>0),x.xp6(),x.Q6J("ngIf",!t.timeread)}}function AddonNotificationsListPage_core_empty_box_18_Template(t,i){1&t&&(x._UZ(0,"core-empty-box",30),x.ALo(1,"translate")),2&t&&x.Q6J("message",x.lcZ(1,1,"addon.notifications.therearentnotificationsyet"))}function AddonNotificationsListPage_ion_chip_21_ion_icon_1_Template(t,i){1&t&&x._UZ(0,"ion-icon",33)}function AddonNotificationsListPage_ion_chip_21_ion_spinner_2_Template(t,i){1&t&&(x._UZ(0,"ion-spinner"),x.ALo(1,"translate")),2&t&&x.uIk("aria-label",x.lcZ(1,1,"core.loading"))}function AddonNotificationsListPage_ion_chip_21_Template(t,i){if(1&t){const t=x.EpF();x.TgZ(0,"ion-chip",31),x.NdJ("click",(function AddonNotificationsListPage_ion_chip_21_Template_ion_chip_click_0_listener(){x.CHM(t);const i=x.oxw();return x.KtG(i.markAllNotificationsAsRead())})),x.YNc(1,AddonNotificationsListPage_ion_chip_21_ion_icon_1_Template,1,0,"ion-icon",32)(2,AddonNotificationsListPage_ion_chip_21_ion_spinner_2_Template,2,3,"ion-spinner",13),x._uU(3),x.ALo(4,"translate"),x.qZA()}if(2&t){const t=x.oxw();x.Q6J("disabled",t.loadingMarkAllNotificationsAsRead),x.xp6(),x.Q6J("ngIf",!t.loadingMarkAllNotificationsAsRead),x.xp6(),x.Q6J("ngIf",t.loadingMarkAllNotificationsAsRead),x.xp6(),x.hij(" ",x.lcZ(4,4,"addon.notifications.markallread")," ")}}let Q=(()=>{var t;class AddonNotificationsListPage{constructor(){this.fetchMoreNotificationsFailed=!1,this.canMarkAllNotificationsAsRead=!1,this.loadingMarkAllNotificationsAsRead=!1,this.pendingRefresh=!1;try{const t=f.p.getOrCreateSource(m.m9.getRequiredCurrentSite().isVersionGreaterEqualThan("4.0")?AddonNotificationsNotificationsSource:AddonLegacyNotificationsNotificationsSource,[]);this.notifications=new v.a(t,AddonNotificationsListPage)}catch(t){r.OQ.showErrorModal(t),l.b.back()}}ngAfterViewInit(){var t=this;return(0,a.Z)((function*(){yield t.fetchInitialNotifications(),t.notifications.start(t.splitView),t.cronObserver=s.R.on(d.he.READ_CRON_EVENT,(()=>{t.isCurrentView&&t.refreshNotifications()}),m.m9.getCurrentSiteId()),t.pushObserver=g.F.on("receive").subscribe((i=>{if(!t.isCurrentView)return t.pendingRefresh=!0,void 0;c.Tr.isTrueOrOne(i.notif)&&m.m9.isCurrentSite(i.site)&&t.refreshNotifications()})),t.readObserver=s.R.on(d.he.READ_CHANGED_EVENT,(i=>{if(!i.id)return;const o=t.notifications.items.find((t=>t.id===i.id));o&&(o.read=!0,o.timeread=i.time,t.loadMarkAllAsReadButton())}));(new u.L).treatLink()}))()}fetchNotifications(t){var i=this;return(0,a.Z)((function*(){t?yield i.notifications.reload():yield i.notifications.load(),i.fetchMoreNotificationsFailed=!1,i.loadMarkAllAsReadButton()}))()}fetchInitialNotifications(){var t=this;return(0,a.Z)((function*(){try{yield t.fetchNotifications(!0)}catch(i){r.OQ.showErrorModalDefault(i,"Error loading notifications"),t.notifications.reset()}}))()}fetchMoreNotifications(t){var i=this;return(0,a.Z)((function*(){try{yield i.fetchNotifications(!1)}catch(t){r.OQ.showErrorModalDefault(t,"Error loading more notifications"),i.fetchMoreNotificationsFailed=!0}t()}))()}markAllNotificationsAsRead(){var t=this;return(0,a.Z)((function*(){t.loadingMarkAllNotificationsAsRead=!0,yield c.Tr.ignoreErrors(d.hv.markAllNotificationsAsRead()),s.R.trigger(d.he.READ_CHANGED_EVENT,{time:p.D.timestamp()},m.m9.getCurrentSiteId()),yield t.refreshNotifications()}))()}loadMarkAllAsReadButton(){var t=this;return(0,a.Z)((function*(){try{t.loadingMarkAllNotificationsAsRead=!0;const i=yield d.hv.getUnreadNotificationsCount();t.canMarkAllNotificationsAsRead=i.count>0}finally{t.loadingMarkAllNotificationsAsRead=!1}}))()}refreshNotifications(t){var i=this;return(0,a.Z)((function*(){yield c.Tr.ignoreErrors(d.hv.invalidateNotificationsList()),yield c.Tr.ignoreErrors(i.fetchNotifications(!0)),null==t||t.complete()}))()}ionViewDidEnter(){this.isCurrentView=!0,this.pendingRefresh&&(this.pendingRefresh=!1,this.refreshNotifications())}ionViewDidLeave(){this.isCurrentView=!1}ngOnDestroy(){var t,i,o,n;null===(t=this.cronObserver)||void 0===t||t.off(),null===(i=this.readObserver)||void 0===i||i.off(),null===(o=this.pushObserver)||void 0===o||o.unsubscribe(),null===(n=this.notifications)||void 0===n||n.destroy()}}return(t=AddonNotificationsListPage).ɵfac=function AddonNotificationsListPage_Factory(i){return new(i||t)},t.ɵcmp=x.Xpm({type:t,selectors:[["page-addon-notifications-list"]],viewQuery:function AddonNotificationsListPage_Query(t,i){if(1&t&&x.Gf(_.A,5),2&t){let t;x.iGM(t=x.CRH())&&(i.splitView=t.first)}},decls:22,vars:16,consts:[["slot","start"],[3,"text"],["slot","end"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],["class","ion-text-wrap","button","","lines","full",3,"detail","click",4,"ngFor","ngForOf"],["icon","far-bell",3,"message",4,"ngIf"],[3,"enabled","error","action"],["slot","fixed","collapsible-footer","","appearOnBottom","",1,"mark-all-as-read"],["color","info","class","clickable fab-chip",3,"disabled","click",4,"ngIf"],["button","","lines","full",1,"ion-text-wrap",3,"detail","click"],["slot","start",3,"user","profileUrl","fullname","userId",4,"ngIf"],[4,"ngIf"],[1,"item-heading"],["contextLevel","system",3,"text","contextInstanceId","wsNotFiltered"],["slot","end",4,"ngIf"],["slot","start",3,"user","profileUrl","fullname","userId"],["class","core-avatar-extra-img",4,"ngIf"],[1,"core-avatar-extra-img"],["alt","","role","presentation",3,"src"],["class","core-notification-img","core-external-content","","alt","","role","presentation","slot","start",3,"src",4,"ngIf"],["class","core-notification-icon","slot","start",4,"ngIf"],["core-external-content","","alt","","role","presentation","slot","start",1,"core-notification-img",3,"src"],["slot","start",1,"core-notification-icon"],["core-external-content","","alt","","role","presentation",3,"src",4,"ngIf"],["name","fas-bell","aria-hidden","true",4,"ngIf"],["core-external-content","","alt","","role","presentation",3,"src"],["name","fas-bell","aria-hidden","true"],["name","fas-circle","color","primary","aria-hidden","true"],["icon","far-bell",3,"message"],["color","info",1,"clickable","fab-chip",3,"disabled","click"],["name","fas-eye","aria-hidden","true",4,"ngIf"],["name","fas-eye","aria-hidden","true"]],template:function AddonNotificationsListPage_Template(t,i){1&t&&(x.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),x._UZ(3,"ion-back-button",1),x.ALo(4,"translate"),x.qZA(),x.TgZ(5,"ion-title")(6,"h1"),x._uU(7),x.ALo(8,"translate"),x.qZA()(),x.TgZ(9,"ion-buttons",2),x._UZ(10,"core-user-menu-button"),x.qZA()()(),x.TgZ(11,"ion-content")(12,"core-split-view")(13,"ion-refresher",3),x.NdJ("ionRefresh",(function AddonNotificationsListPage_Template_ion_refresher_ionRefresh_13_listener(t){return i.refreshNotifications(t.target)})),x._UZ(14,"ion-refresher-content",4),x.ALo(15,"translate"),x.qZA(),x.TgZ(16,"core-loading",5),x.YNc(17,AddonNotificationsListPage_ion_item_17_Template,12,18,"ion-item",6)(18,AddonNotificationsListPage_core_empty_box_18_Template,2,3,"core-empty-box",7),x.TgZ(19,"core-infinite-loading",8),x.NdJ("action",(function AddonNotificationsListPage_Template_core_infinite_loading_action_19_listener(t){return i.fetchMoreNotifications(t)})),x.qZA()(),x.TgZ(20,"div",9),x.YNc(21,AddonNotificationsListPage_ion_chip_21_Template,5,6,"ion-chip",10),x.qZA()()()),2&t&&(x.xp6(3),x.Q6J("text",x.lcZ(4,10,"core.back")),x.xp6(4),x.Oqu(x.lcZ(8,12,"addon.notifications.notifications")),x.xp6(6),x.Q6J("disabled",!i.notifications.loaded),x.xp6(),x.s9C("pullingText",x.lcZ(15,14,"core.pulltorefresh")),x.xp6(2),x.Q6J("hideUntil",i.notifications.loaded),x.xp6(),x.Q6J("ngForOf",i.notifications.items),x.xp6(),x.Q6J("ngIf",!i.notifications||i.notifications.empty),x.xp6(),x.Q6J("enabled",i.notifications.loaded&&!i.notifications.completed)("error",i.fetchMoreNotificationsFailed),x.xp6(2),x.Q6J("ngIf",i.notifications.loaded&&i.canMarkAllNotificationsAsRead))},dependencies:[N.sg,N.O5,P.z,A.n,M.r,_.A,b.X,C.l,O.I,I.r,T.u,y.t,Z.Sm,Z.hM,Z.W2,Z.Gu,Z.gu,Z.Ie,Z.Q$,Z.uN,Z.nJ,Z.Wo,Z.PQ,Z.wd,Z.sr,Z.oU,w.o,L.e,k.X$],styles:["ion-item[_ngcontent-%COMP%]{--icon-size: 16px;--extra-icon-size: 12px;--core-avatar-size: 32px}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-top:8px;margin-bottom:8px}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p.item-heading[_ngcontent-%COMP%]{font-size:var(--text-size);-webkit-line-clamp:3;overflow:hidden;text-overflow:ellipsis;-webkit-box-orient:vertical;display:-webkit-box}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:12px}ion-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{margin:0;padding-inline-start:8px;padding-inline-end:0;padding-top:12px}ion-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:6px;vertical-align:middle}ion-item[_ngcontent-%COMP%]   [slot=start][_ngcontent-%COMP%]{align-self:start;margin-top:16px}ion-item[_ngcontent-%COMP%]   div.core-notification-icon[_ngcontent-%COMP%], ion-item[_ngcontent-%COMP%]   core-mod-icon.core-notification-icon[_ngcontent-%COMP%]{--padding: 8px;max-width:var(--core-avatar-size);max-height:var(--core-avatar-size)}.mark-all-as-read[_ngcontent-%COMP%]{padding-bottom:16px;bottom:0;left:0;right:0;display:flex;background:transparent;box-shadow:none;pointer-events:none}.mark-all-as-read[_ngcontent-%COMP%]   ion-chip.ion-color[_ngcontent-%COMP%]{margin:0 auto}.mark-all-as-read[_ngcontent-%COMP%]   ion-chip.ion-color[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{width:16px;height:16px;margin-inline-start:0;margin-inline-end:8px}ion-content[_ngcontent-%COMP%]::part(scroll){padding-bottom:44px}","[_nghost-%COMP%]{--extra-icon-size: 16px;--icon-size: 24px}[_nghost-%COMP%]     core-user-avatar .core-avatar-extra-img, [_nghost-%COMP%]     core-user-avatar core-mod-icon{margin:0!important;position:absolute;right:-4px;bottom:-4px;--padding: .2rem}[_nghost-%COMP%]     core-user-avatar .core-avatar-extra-img{background:var(--background-color);border-radius:var(--radius-sm)}[_nghost-%COMP%]     core-user-avatar .core-avatar-extra-img img{max-width:var(--extra-icon-size);max-height:var(--extra-icon-size);display:block}[_nghost-%COMP%]     core-user-avatar core-mod-icon{--size: var(--extra-icon-size)}[_nghost-%COMP%]   div.core-notification-icon[_ngcontent-%COMP%]{padding:.7rem;background:var(--background-color);border-radius:var(--radius-xs)}[_nghost-%COMP%]   div.core-notification-icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:var(--icon-size);height:var(--icon-size)}[_nghost-%COMP%]   div.core-notification-icon[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:var(--icon-size)}[_nghost-%COMP%]   .core-notification-icon[_ngcontent-%COMP%]{--module-icon-size: var(--icon-size);margin-inline-start:0px;margin-inline-end:8px;margin-top:6px;margin-bottom:6px}[_nghost-%COMP%]   .core-notification-img[_ngcontent-%COMP%]{margin-inline-start:0px;margin-inline-end:8px;margin-top:6px;margin-bottom:6px;width:var(--core-avatar-size);height:var(--core-avatar-size);object-fit:cover}"]}),AddonNotificationsListPage})();var J=o(87985),U=o(67643),z=o(71460),R=o(11573),S=o(43468),E=o(10727),q=o(5065),F=o(22068),B=o(75989);function AddonNotificationsNotificationPage_div_11_core_user_avatar_2_div_1_Template(t,i){if(1&t&&(x.TgZ(0,"div",16),x._UZ(1,"img",17),x.qZA()),2&t){const t=x.oxw(3);x.xp6(),x.Q6J("src",t.notification.iconurl,x.LSH)}}function AddonNotificationsNotificationPage_div_11_core_user_avatar_2_Template(t,i){if(1&t&&(x.TgZ(0,"core-user-avatar",14),x.YNc(1,AddonNotificationsNotificationPage_div_11_core_user_avatar_2_div_1_Template,2,1,"div",15),x.qZA()),2&t){const t=x.oxw(2);x.Q6J("userId",t.notification.useridfrom)("profileUrl",t.notification.profileimageurlfrom)("fullname",t.notification.userfromfullname),x.xp6(),x.Q6J("ngIf",t.notification.iconurl)}}function AddonNotificationsNotificationPage_div_11_ng_container_3_img_1_Template(t,i){if(1&t&&x._UZ(0,"img",20),2&t){const t=x.oxw(3);x.Q6J("src",t.notification.imgUrl,x.LSH)}}function AddonNotificationsNotificationPage_div_11_ng_container_3_div_2_img_1_Template(t,i){if(1&t&&x._UZ(0,"img",24),2&t){const t=x.oxw(4);x.Q6J("src",t.notification.iconurl,x.LSH)}}function AddonNotificationsNotificationPage_div_11_ng_container_3_div_2_ion_icon_2_Template(t,i){1&t&&x._UZ(0,"ion-icon",25)}function AddonNotificationsNotificationPage_div_11_ng_container_3_div_2_Template(t,i){if(1&t&&(x.TgZ(0,"div",21),x.YNc(1,AddonNotificationsNotificationPage_div_11_ng_container_3_div_2_img_1_Template,1,1,"img",22)(2,AddonNotificationsNotificationPage_div_11_ng_container_3_div_2_ion_icon_2_Template,1,0,"ion-icon",23),x.qZA()),2&t){const t=x.oxw(3);x.xp6(),x.Q6J("ngIf",t.notification.iconurl),x.xp6(),x.Q6J("ngIf",!t.notification.iconurl)}}function AddonNotificationsNotificationPage_div_11_ng_container_3_Template(t,i){if(1&t&&(x.ynx(0),x.YNc(1,AddonNotificationsNotificationPage_div_11_ng_container_3_img_1_Template,1,1,"img",18)(2,AddonNotificationsNotificationPage_div_11_ng_container_3_div_2_Template,3,2,"div",19),x.BQk()),2&t){const t=x.oxw(2);x.xp6(),x.Q6J("ngIf",t.notification.imgUrl),x.xp6(),x.Q6J("ngIf",!t.notification.imgUrl)}}function AddonNotificationsNotificationPage_div_11_p_7_ng_container_3_Template(t,i){if(1&t&&(x.ynx(0),x._uU(1),x.BQk()),2&t){const t=x.oxw(3);x.xp6(),x.hij(" · ",t.notification.userfromfullname,"")}}function AddonNotificationsNotificationPage_div_11_p_7_Template(t,i){if(1&t&&(x.TgZ(0,"p"),x._uU(1),x.ALo(2,"coreTimeAgo"),x.YNc(3,AddonNotificationsNotificationPage_div_11_p_7_ng_container_3_Template,2,1,"ng-container",9),x.qZA()),2&t){const t=x.oxw(2);x.xp6(),x.hij(" ",x.lcZ(2,2,t.notification.timecreated)," "),x.xp6(2),x.Q6J("ngIf",t.notification.useridfrom>0)}}function AddonNotificationsNotificationPage_div_11_Template(t,i){if(1&t&&(x.TgZ(0,"div",6)(1,"ion-item",7),x.YNc(2,AddonNotificationsNotificationPage_div_11_core_user_avatar_2_Template,2,4,"core-user-avatar",8)(3,AddonNotificationsNotificationPage_div_11_ng_container_3_Template,3,2,"ng-container",9),x.TgZ(4,"ion-label")(5,"p",10),x._UZ(6,"core-format-text",11),x.qZA(),x.YNc(7,AddonNotificationsNotificationPage_div_11_p_7_Template,4,4,"p",9),x.qZA()(),x.TgZ(8,"ion-item",12)(9,"ion-label"),x._UZ(10,"core-format-text",13),x.ALo(11,"coreCreateLinks"),x.qZA()()()),2&t){const t=x.oxw();x.xp6(2),x.Q6J("ngIf",t.notification.useridfrom>0),x.xp6(),x.Q6J("ngIf",t.notification.useridfrom<=0),x.xp6(3),x.Q6J("text",t.notification.subject)("contextInstanceId",0)("wsNotFiltered",!0),x.xp6(),x.Q6J("ngIf",t.notification.timecreated>0),x.xp6(3),x.Q6J("text",x.lcZ(11,8,t.notification.mobiletext))("contextInstanceId",0)}}function AddonNotificationsNotificationPage_div_12_ion_button_2_Template(t,i){if(1&t){const t=x.EpF();x.TgZ(0,"ion-button",29),x.NdJ("click",(function AddonNotificationsNotificationPage_div_12_ion_button_2_Template_ion_button_click_0_listener(){const i=x.CHM(t);return x.KtG(i.$implicit.action())})),x._UZ(1,"ion-icon",30),x._uU(2),x.ALo(3,"translate"),x.qZA()}if(2&t){const t=i.$implicit;x.xp6(),x.s9C("name",t.icon),x.xp6(),x.hij(" ",x.lcZ(3,2,t.message)," ")}}function AddonNotificationsNotificationPage_div_12_Template(t,i){if(1&t&&(x.TgZ(0,"div",26)(1,"div",27),x.YNc(2,AddonNotificationsNotificationPage_div_12_ion_button_2_Template,4,4,"ion-button",28),x.qZA()()),2&t){const t=x.oxw();x.xp6(2),x.Q6J("ngForOf",t.actions)}}let D=(()=>{var t;class AddonNotificationsNotificationPage{constructor(){this.loaded=!1,this.actions=[]}ngOnInit(){var t=this;return(0,a.Z)((function*(){let i;try{i=t.getNotification()}catch(t){return r.OQ.showErrorModal(t),l.b.back(),void 0}t.notification="subject"in i?i:yield d.hv.convertPushToMessage(i),yield t.loadActions(t.notification),J.T.markNotificationAsRead(i),t.loaded=!0,i.id&&S.ke.logEvent({type:S.gM.VIEW_ITEM,ws:"core_message_get_messages",name:E.vN.instant("addon.notifications.notifications"),data:{id:i.id,category:"notifications"},url:`/message/output/popup/notifications.php?notificationid=${i.id}&offset=0`})}))()}getNotification(){const t=l.b.getRouteNumberParam("id"),i=t?this.getNotificationById(t):void 0;return null!=i?i:l.b.getRequiredRouteParam("notification")}getNotificationById(t){var i;const o=f.p.getOrCreateSource(m.m9.getRequiredCurrentSite().isVersionGreaterEqualThan("4.0")?AddonNotificationsNotificationsSource:AddonLegacyNotificationsNotificationsSource,[]),n=null===(i=o.getItems())||void 0===i?void 0:i.find((({id:i})=>i===t));if(n)return this.loadNotifications(o),n}loadNotifications(t){var i=this;return(0,a.Z)((function*(){i.notifications=new AddonNotificationSwipeItemsManager(t),yield i.notifications.start()}))()}loadActions(t){var i=this;return(0,a.Z)((function*(){var o;if(!(t.contexturl||t.customdata&&t.customdata.appurl))return;let n=[];i.actionsData=t.customdata,i.contextUrl=t.contexturl||void 0,i.courseId="courseid"in t?t.courseid:void 0,null!==(o=i.actionsData)&&void 0!==o&&o.appurl&&(n=yield R.I.getActionsFor(i.actionsData.appurl,i.courseId,void 0,i.actionsData)),!n.length&&i.contextUrl&&(n=yield R.I.getActionsFor(i.contextUrl,i.courseId,void 0,i.actionsData)),n.length||n.push({message:"core.view",icon:"fas-eye",action:t=>i.openInBrowser(t)}),i.actions=n}))()}openInBrowser(t){var i=this;return(0,a.Z)((function*(){var o;const n=(null===(o=i.actionsData)||void 0===o?void 0:o.appurl)||i.contextUrl;if(!n)return;(yield m.m9.getSite(t)).openInBrowserWithAutoLogin(n)}))()}ngOnDestroy(){var t;null===(t=this.notifications)||void 0===t||t.destroy()}}return(t=AddonNotificationsNotificationPage).ɵfac=function AddonNotificationsNotificationPage_Factory(i){return new(i||t)},t.ɵcmp=x.Xpm({type:t,selectors:[["page-addon-notifications-notification"]],decls:13,vars:10,consts:[["slot","start"],[3,"text"],[3,"core-swipe-navigation"],[3,"hideUntil"],["class","list-item-limited-width",4,"ngIf"],["collapsible-footer","","appearOnBottom","","slot","fixed",4,"ngIf"],[1,"list-item-limited-width"],["lines","full",1,"ion-text-wrap","core-notification-title"],["slot","start",3,"userId","profileUrl","fullname",4,"ngIf"],[4,"ngIf"],[1,"item-heading"],["contextLevel","system",3,"text","contextInstanceId","wsNotFiltered"],[1,"ion-text-wrap","core-notification-body"],["contextLevel","system",3,"text","contextInstanceId"],["slot","start",3,"userId","profileUrl","fullname"],["class","core-avatar-extra-img",4,"ngIf"],[1,"core-avatar-extra-img"],["alt","","role","presentation",3,"src"],["class","core-notification-img","core-external-content","","alt","","role","presentation","slot","start",3,"src",4,"ngIf"],["class","core-notification-icon","slot","start",4,"ngIf"],["core-external-content","","alt","","role","presentation","slot","start",1,"core-notification-img",3,"src"],["slot","start",1,"core-notification-icon"],["core-external-content","","alt","","role","presentation",3,"src",4,"ngIf"],["name","fas-bell","aria-hidden","true",4,"ngIf"],["core-external-content","","alt","","role","presentation",3,"src"],["name","fas-bell","aria-hidden","true"],["collapsible-footer","","appearOnBottom","","slot","fixed"],[1,"list-item-limited-width","adaptable-buttons-row"],["expand","block",3,"click",4,"ngFor","ngForOf"],["expand","block",3,"click"],["slot","start","aria-hidden","true",3,"name"]],template:function AddonNotificationsNotificationPage_Template(t,i){1&t&&(x.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),x._UZ(3,"ion-back-button",1),x.ALo(4,"translate"),x.qZA(),x.TgZ(5,"ion-title")(6,"h1"),x._uU(7),x.ALo(8,"translate"),x.qZA()()()(),x.TgZ(9,"ion-content",2)(10,"core-loading",3),x.YNc(11,AddonNotificationsNotificationPage_div_11_Template,12,10,"div",4)(12,AddonNotificationsNotificationPage_div_12_Template,3,1,"div",5),x.qZA()()),2&t&&(x.xp6(3),x.Q6J("text",x.lcZ(4,6,"core.back")),x.xp6(4),x.Oqu(x.lcZ(8,8,"addon.notifications.notifications")),x.xp6(2),x.Q6J("core-swipe-navigation",i.notifications),x.xp6(),x.Q6J("hideUntil",i.loaded),x.xp6(),x.Q6J("ngIf",i.notification),x.xp6(),x.Q6J("ngIf",i.loaded&&i.actions&&i.actions.length>0))},dependencies:[N.sg,N.O5,M.r,b.X,C.l,O.I,I.r,q.g,T.u,y.t,F.O,Z.YG,Z.Sm,Z.W2,Z.Gu,Z.gu,Z.Ie,Z.Q$,Z.wd,Z.sr,Z.oU,B.V,L.e,k.X$],styles:["[_nghost-%COMP%]{--extra-icon-size: 16px;--icon-size: 24px}[_nghost-%COMP%]     core-user-avatar .core-avatar-extra-img, [_nghost-%COMP%]     core-user-avatar core-mod-icon{margin:0!important;position:absolute;right:-4px;bottom:-4px;--padding: .2rem}[_nghost-%COMP%]     core-user-avatar .core-avatar-extra-img{background:var(--background-color);border-radius:var(--radius-sm)}[_nghost-%COMP%]     core-user-avatar .core-avatar-extra-img img{max-width:var(--extra-icon-size);max-height:var(--extra-icon-size);display:block}[_nghost-%COMP%]     core-user-avatar core-mod-icon{--size: var(--extra-icon-size)}[_nghost-%COMP%]   div.core-notification-icon[_ngcontent-%COMP%]{padding:.7rem;background:var(--background-color);border-radius:var(--radius-xs)}[_nghost-%COMP%]   div.core-notification-icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:var(--icon-size);height:var(--icon-size)}[_nghost-%COMP%]   div.core-notification-icon[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:var(--icon-size)}[_nghost-%COMP%]   .core-notification-icon[_ngcontent-%COMP%]{--module-icon-size: var(--icon-size);margin-inline-start:0px;margin-inline-end:8px;margin-top:6px;margin-bottom:6px}[_nghost-%COMP%]   .core-notification-img[_ngcontent-%COMP%]{margin-inline-start:0px;margin-inline-end:8px;margin-top:6px;margin-bottom:6px;width:var(--core-avatar-size);height:var(--core-avatar-size);object-fit:cover}","[_nghost-%COMP%]   .core-notification-title[_ngcontent-%COMP%]   [slot=start][_ngcontent-%COMP%]{align-self:start;margin-top:16px}[_nghost-%COMP%]   .core-notification-title[_ngcontent-%COMP%]   p.item-heading[_ngcontent-%COMP%]{font-size:16px}[_nghost-%COMP%]   .core-notification-title[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:12px}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]{font-size:var(--text-size)}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-weight:700}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .forumpost{border:1px solid var(--gray-200);width:100%;margin:0 0 1em}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .forumpost td{padding:10px}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .forumpost .header{background-color:var(--light)}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .forumpost .header .picture{width:48px;text-align:center;padding-inline-start:4px;padding-inline-end:0px;padding-top:8px}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .forumpost .header .picture img{width:44px!important}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .forumpost .subject{font-weight:700;margin-bottom:1rem}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     a{text-decoration:none}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .userpicture{border-radius:50%}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .mdl-right{text-align:end}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .mdl-right a{display:none}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .mdl-right font{font-size:.9em}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     .commands{display:none}[_nghost-%COMP%]   .core-notification-body[_ngcontent-%COMP%]   core-format-text[_ngcontent-%COMP%]     hr{margin-top:1.5rem;margin-bottom:1.5rem;background-color:var(--gray-200)}"]}),AddonNotificationsNotificationPage})();class AddonNotificationSwipeItemsManager extends z.t{getSelectedItemPathFromRoute(t){return(t instanceof U.De?t:t.snapshot).params.id}}var V=o(56283),Y=o(39716),$=o(38049),j=o(21296);function buildRoutes(t){return[{path:"list",data:{mainMenuTabRoot:j.C.PAGE_NAME},component:Q,children:(0,n.Vr)([{path:":id",component:D}],(()=>$.X4.isTablet))},...(0,n.Vr)([{path:"list/:id",component:D}],(()=>$.X4.isMobile)),{path:"notification",component:D},...(0,Y.o)(t,{redirectTo:"list",pathMatch:"full"})]}let H=(()=>{var t;class AddonNotificationsLazyModule{}return(t=AddonNotificationsLazyModule).ɵfac=function AddonNotificationsLazyModule_Factory(i){return new(i||t)},t.ɵmod=x.oAB({type:t}),t.ɵinj=x.cJS({providers:[{provide:U.Z6,multi:!0,deps:[x.zs3],useFactory:buildRoutes}],imports:[e.L,V.g,U.Bz]}),AddonNotificationsLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&x.kYT(H,{declarations:[Q,D],imports:[e.L,V.g],exports:[U.Bz]}))},71460:(t,i,o)=>{o.d(i,{t:()=>CoreSwipeNavigationItemsManager});var n=o(49671),e=o(67643),a=o(43555),r=o(22594);class CoreSwipeNavigationItemsManager extends r.A{start(){var t=this;return(0,n.Z)((function*(){t.updateSelectedItem()}))()}navigateToNextItem(){var t=this;return(0,n.Z)((function*(){yield t.navigateToItemBy(1,"forward")}))()}navigateToPreviousItem(){var t=this;return(0,n.Z)((function*(){yield t.navigateToItemBy(-1,"back")}))()}hasNextItem(){var t=this;return(0,n.Z)((function*(){return!!(yield t.getItemBy(1))}))()}hasPreviousItem(){var t=this;return(0,n.Z)((function*(){return!!(yield t.getItemBy(-1))}))()}getCurrentPageRoute(){return a.b.getCurrentRoute()}getSelectedItemPathFromRoute(t){const i=[];for(;t;){if(i.push(...(t instanceof e.De?t:t.snapshot).url),!t.firstChild)break;t=t.firstChild}return i.map((t=>t.path)).join("/").replace(/\/+/,"/").trim()||null}navigateToItemBy(t,i){var o=this;return(0,n.Z)((function*(){const n=yield o.getItemBy(t);n&&(yield o.navigateToItem(n,{animationDirection:i,replace:!0}))}))()}getItemBy(t){var i=this;return(0,n.Z)((function*(){var o;const n=i.getSource().getItems(),e=null!==(o=i.selectedItem&&(null==n?void 0:n.indexOf(i.selectedItem)))&&void 0!==o?o:-1;if(-1===e||null===n)return null;const a=t>0?1:-1;let r=e,c=0;for(;c!==t;){if(r+=a,r<0)return null;if(r>=n.length)break;i.skipItemInSwipe(n[r])||(c+=a)}return c===t?n[r]:i.getSource().isCompleted()?null:(yield i.getSource().load(),i.getItemBy(t))}))()}skipItemInSwipe(t){return!1}}}}]);