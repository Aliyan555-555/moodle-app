"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8230],{48230:(e,o,r)=>{r.r(o),r.d(o,{CoreCoursesLazyModule:()=>N});var s=r(13386),t=r(19212),n=r(67643),a=r(47494),i=r(49671),c=r(53564),l=r(13010),d=r(75803),u=r(92974),g=r(10727),_=r(43555),h=r(98370),C=r(43468),p=r(88817),m=r(96814),f=r(11771),y=r(17418),b=r(55126),x=r(66931),w=r(86700),E=r(8947),T=r(22742),Z=r(29657),I=r(31903),L=r(53465),P=r(89515);function CoreCoursesCategoriesPage_core_context_menu_item_10_Template(e,o){if(1&e){const e=t.EpF();t.TgZ(0,"core-context-menu-item",5),t.NdJ("action",(function CoreCoursesCategoriesPage_core_context_menu_item_10_Template_core_context_menu_item_action_0_listener(){t.CHM(e);const o=t.oxw();return t.KtG(o.toggleDownload())}))("toggleChange",(function CoreCoursesCategoriesPage_core_context_menu_item_10_Template_core_context_menu_item_toggleChange_0_listener(o){t.CHM(e);const r=t.oxw();return t.KtG(r.downloadEnabled=o)})),t.ALo(1,"translate"),t.qZA()}if(2&e){const e=t.oxw();t.Q6J("priority",1e3)("content",t.lcZ(1,3,"core.settings.showdownloadoptions"))("toggle",e.downloadEnabled)}}function CoreCoursesCategoriesPage_ion_item_19_p_6_Template(e,o){if(1&e&&(t.TgZ(0,"p"),t._UZ(1,"core-format-text",16),t.qZA()),2&e){const e=t.oxw(2);t.xp6(),t.Q6J("text",e.currentCategory.description)("contextInstanceId",e.currentCategory.id)}}function CoreCoursesCategoriesPage_ion_item_19_Template(e,o){if(1&e&&(t.TgZ(0,"ion-item",13),t._UZ(1,"ion-icon",14),t.ALo(2,"translate"),t.TgZ(3,"ion-label")(4,"p",15),t._UZ(5,"core-format-text",2),t.qZA(),t.YNc(6,CoreCoursesCategoriesPage_ion_item_19_p_6_Template,2,2,"p",11),t.qZA()()),2&e){const e=t.oxw();t.xp6(),t.uIk("aria-label",t.lcZ(2,4,"core.category")),t.xp6(4),t.Q6J("text",e.currentCategory.name)("contextInstanceId",e.currentCategory.id),t.xp6(),t.Q6J("ngIf",e.currentCategory.description)}}const _c0=e=>({$a:e});function CoreCoursesCategoriesPage_ng_container_20_ion_card_6_ion_badge_7_Template(e,o){if(1&e&&(t.TgZ(0,"ion-badge",21)(1,"span",22),t._uU(2),t.qZA(),t.TgZ(3,"span",23),t._uU(4),t.ALo(5,"translate"),t.qZA()()),2&e){const e=t.oxw().$implicit;t.xp6(2),t.Oqu(e.coursecount),t.xp6(2),t.Oqu(t.xi3(5,2,"core.courses.therearecourses",t.VKq(5,_c0,e.coursecount)))}}function CoreCoursesCategoriesPage_ng_container_20_ion_card_6_Template(e,o){if(1&e){const e=t.EpF();t.TgZ(0,"ion-card")(1,"ion-item",19),t.NdJ("click",(function CoreCoursesCategoriesPage_ng_container_20_ion_card_6_Template_ion_item_click_1_listener(){const o=t.CHM(e).$implicit,r=t.oxw(2);return t.KtG(r.openCategory(o.id))})),t._UZ(2,"ion-icon",14),t.ALo(3,"translate"),t.TgZ(4,"ion-label")(5,"p",15),t._UZ(6,"core-format-text",2),t.qZA()(),t.YNc(7,CoreCoursesCategoriesPage_ng_container_20_ion_card_6_ion_badge_7_Template,6,7,"ion-badge",20),t.qZA()()}if(2&e){const e=o.$implicit,r=t.oxw(2);t.xp6(),t.Q6J("detail",!0),t.uIk("aria-label",e.name),t.xp6(),t.uIk("aria-label",t.lcZ(3,6,"core.category")),t.xp6(4),t.Q6J("text",e.name)("contextInstanceId",e.id),t.xp6(),t.Q6J("ngIf",!r.showOnlyEnrolled&&e.coursecount>0)}}function CoreCoursesCategoriesPage_ng_container_20_Template(e,o){if(1&e&&(t.ynx(0),t.TgZ(1,"ion-item-divider")(2,"ion-label")(3,"h2",17),t._uU(4),t.ALo(5,"translate"),t.qZA()()(),t.YNc(6,CoreCoursesCategoriesPage_ng_container_20_ion_card_6_Template,8,8,"ion-card",18),t.BQk()),2&e){const e=t.oxw();t.xp6(4),t.Oqu(t.lcZ(5,2,"core.courses.categories")),t.xp6(2),t.Q6J("ngForOf",e.categories)}}function CoreCoursesCategoriesPage_ng_container_21_h2_3_Template(e,o){1&e&&(t.TgZ(0,"h2",17),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&e&&(t.xp6(),t.Oqu(t.lcZ(2,1,"core.courses.courses")))}function CoreCoursesCategoriesPage_ng_container_21_h2_4_Template(e,o){1&e&&(t.TgZ(0,"h2",17),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&e&&(t.xp6(),t.Oqu(t.lcZ(2,1,"core.courses.mycourses")))}function CoreCoursesCategoriesPage_ng_container_21_core_courses_course_list_item_5_Template(e,o){if(1&e&&t._UZ(0,"core-courses-course-list-item",26),2&e){const e=o.$implicit,r=t.oxw(2);t.Q6J("course",e)("showDownload",r.downloadEnabled)}}function CoreCoursesCategoriesPage_ng_container_21_Template(e,o){if(1&e&&(t.ynx(0),t.TgZ(1,"ion-item-divider")(2,"ion-label"),t.YNc(3,CoreCoursesCategoriesPage_ng_container_21_h2_3_Template,3,3,"h2",24)(4,CoreCoursesCategoriesPage_ng_container_21_h2_4_Template,3,3,"h2",24),t.qZA()(),t.YNc(5,CoreCoursesCategoriesPage_ng_container_21_core_courses_course_list_item_5_Template,1,2,"core-courses-course-list-item",25),t.BQk()),2&e){const e=t.oxw();t.xp6(3),t.Q6J("ngIf",!e.showOnlyEnrolled),t.xp6(),t.Q6J("ngIf",e.showOnlyEnrolled),t.xp6(),t.Q6J("ngForOf",e.courses)}}function CoreCoursesCategoriesPage_core_empty_box_22_Template(e,o){1&e&&(t._UZ(0,"core-empty-box",27),t.ALo(1,"translate")),2&e&&t.Q6J("message",t.lcZ(1,1,"core.courses.nocoursesyet"))}let A=(()=>{var e;class CoreCoursesCategoriesPage{constructor(){this.categories=[],this.courses=[],this.categoriesLoaded=!1,this.showOnlyEnrolled=!1,this.downloadEnabled=!1,this.downloadCourseEnabled=!1,this.downloadCoursesEnabled=!1,this.categoryCourses=[],this.categoryId=0,this.isDestroyed=!1,this.title=g.vN.instant("core.courses.categories"),this.currentSiteId=c.m9.getRequiredCurrentSite().getId(),this.myCoursesObserver=h.R.on(u.c.EVENT_MY_COURSES_UPDATED,(e=>{e.action==u.c.ACTION_ENROL&&this.fetchCategories()}),this.currentSiteId),this.siteUpdatedObserver=h.R.on(h.R.SITE_UPDATED,(()=>{this.downloadCourseEnabled=!u.B.isDownloadCourseDisabledInSite(),this.downloadCoursesEnabled=!u.B.isDownloadCoursesDisabledInSite(),this.downloadEnabled=(this.downloadCourseEnabled||this.downloadCoursesEnabled)&&this.downloadEnabled}),this.currentSiteId),this.downloadEnabledObserver=h.R.on(u.c.EVENT_DASHBOARD_DOWNLOAD_ENABLED_CHANGED,(e=>{this.downloadEnabled=(this.downloadCourseEnabled||this.downloadCoursesEnabled)&&e.enabled})),this.logView=p.V.once((()=>{C.ke.logEvent({type:C.gM.VIEW_ITEM_LIST,ws:"core_course_get_categories",name:this.title,data:{categoryid:this.categoryId,category:"course"},url:"/course/index.php"+(this.categoryId>0?`?categoryid=${this.categoryId}`:"")})}))}ngOnInit(){this.categoryId=_.b.getRouteNumberParam("id")||0,this.showOnlyEnrolled=_.b.getRouteBooleanParam("enrolled")||this.showOnlyEnrolled,this.downloadCourseEnabled=!u.B.isDownloadCourseDisabledInSite(),this.downloadCoursesEnabled=!u.B.isDownloadCoursesDisabledInSite(),this.downloadEnabled=(this.downloadCourseEnabled||this.downloadCoursesEnabled)&&u.B.getCourseDownloadOptionsEnabled(),this.fetchCategories().finally((()=>{this.categoriesLoaded=!0}))}fetchCategories(){var e=this;return(0,i.Z)((function*(){try{const o=yield u.B.getCategories(e.categoryId,!0);e.currentCategory=void 0;const r=o.findIndex((o=>o.id==e.categoryId));if(r>=0&&(e.currentCategory=o[r],delete o[r]),o.sort(((e,o)=>e.depth==o.depth?e.sortorder>o.sortorder?1:o.sortorder>e.sortorder?-1:0:e.depth>o.depth?1:-1)),e.categories=d.Tr.formatTree(o,"parent","id",e.categoryId),e.currentCategory){e.title=e.currentCategory.name;try{e.categoryCourses=yield u.B.getCoursesByField("category",e.categoryId),yield e.filterEnrolled()}catch(o){!e.isDestroyed&&l.OQ.showErrorModalDefault(o,"core.courses.errorloadcourses",!0)}}e.logView()}catch(o){!e.isDestroyed&&l.OQ.showErrorModalDefault(o,"core.courses.errorloadcategories",!0)}}))()}refreshCategories(e){const o=[];o.push(u.B.invalidateUserCourses()),o.push(u.B.invalidateCategories(this.categoryId,!0)),o.push(u.B.invalidateCoursesByField("category",this.categoryId)),o.push(c.m9.getRequiredCurrentSite().invalidateConfig()),Promise.all(o).finally((()=>{this.fetchCategories().finally((()=>{null==e||e.complete()}))}))}openCategory(e){_.b.navigateToSitePath("courses/categories/"+e,{params:{enrolled:this.showOnlyEnrolled}})}filterEnrolled(){var e=this;return(0,i.Z)((function*(){e.showOnlyEnrolled?(yield Promise.all(e.categoryCourses.map(function(){var e=(0,i.Z)((function*(e){if(!(void 0!==e.progress))try{const o=yield u.B.getUserCourse(e.id);e.progress=o.progress,e.completionusertracked=o.completionusertracked}catch{}}));return function(o){return e.apply(this,arguments)}}())),e.courses=e.categoryCourses.filter((e=>"progress"in e))):e.courses=e.categoryCourses}))()}toggleDownload(){u.B.setCourseDownloadOptionsEnabled(this.downloadEnabled)}ngOnDestroy(){this.myCoursesObserver.off(),this.siteUpdatedObserver.off(),this.downloadEnabledObserver.off(),this.isDestroyed=!0}}return(e=CoreCoursesCategoriesPage).ɵfac=function CoreCoursesCategoriesPage_Factory(o){return new(o||e)},e.ɵcmp=t.Xpm({type:e,selectors:[["page-core-courses-categories"]],decls:23,vars:20,consts:[["slot","start"],[3,"text"],["contextLevel","coursecat",3,"text","contextInstanceId"],["slot","end"],["iconAction","toggle",3,"priority","content","toggle","action","toggleChange",4,"ngIf"],["iconAction","toggle",3,"priority","content","toggle","action","toggleChange"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[1,"list-item-limited-width"],["class","ion-text-wrap",4,"ngIf"],[4,"ngIf"],["icon","fas-graduation-cap",3,"message",4,"ngIf"],[1,"ion-text-wrap"],["name","fas-folder","slot","start"],[1,"item-heading"],["collapsible-item","","contextLevel","coursecat",3,"text","contextInstanceId"],[1,"big"],[4,"ngFor","ngForOf"],["button","",1,"ion-text-wrap",3,"detail","click"],["slot","end","color","light",4,"ngIf"],["slot","end","color","light"],["aria-hidden","true"],[1,"sr-only"],["class","big",4,"ngIf"],[3,"course","showDownload",4,"ngFor","ngForOf"],[3,"course","showDownload"],["icon","fas-graduation-cap",3,"message"]],template:function CoreCoursesCategoriesPage_Template(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"ion-title")(6,"h1"),t._UZ(7,"core-format-text",2),t.qZA()(),t.TgZ(8,"ion-buttons",3)(9,"core-context-menu"),t.YNc(10,CoreCoursesCategoriesPage_core_context_menu_item_10_Template,2,5,"core-context-menu-item",4),t.TgZ(11,"core-context-menu-item",5),t.NdJ("action",(function CoreCoursesCategoriesPage_Template_core_context_menu_item_action_11_listener(){return o.filterEnrolled()}))("toggleChange",(function CoreCoursesCategoriesPage_Template_core_context_menu_item_toggleChange_11_listener(e){return o.showOnlyEnrolled=e})),t.ALo(12,"translate"),t.qZA()()()()(),t.TgZ(13,"ion-content")(14,"ion-refresher",6),t.NdJ("ionRefresh",(function CoreCoursesCategoriesPage_Template_ion_refresher_ionRefresh_14_listener(e){return o.refreshCategories(e.target)})),t._UZ(15,"ion-refresher-content",7),t.ALo(16,"translate"),t.qZA(),t.TgZ(17,"core-loading",8)(18,"ion-list",9),t.YNc(19,CoreCoursesCategoriesPage_ion_item_19_Template,7,6,"ion-item",10)(20,CoreCoursesCategoriesPage_ng_container_20_Template,7,4,"ng-container",11)(21,CoreCoursesCategoriesPage_ng_container_21_Template,6,3,"ng-container",11),t.qZA(),t.YNc(22,CoreCoursesCategoriesPage_core_empty_box_22_Template,2,3,"core-empty-box",12),t.qZA()()),2&e&&(t.xp6(3),t.Q6J("text",t.lcZ(4,14,"core.back")),t.xp6(4),t.Q6J("text",o.title)("contextInstanceId",o.currentCategory&&o.currentCategory.id),t.xp6(3),t.Q6J("ngIf",o.downloadCourseEnabled||o.downloadCoursesEnabled),t.xp6(),t.Q6J("priority",900)("content",t.lcZ(12,16,"core.courses.showonlyenrolled"))("toggle",o.showOnlyEnrolled),t.xp6(3),t.Q6J("disabled",!o.categoriesLoaded),t.xp6(),t.s9C("pullingText",t.lcZ(16,18,"core.pulltorefresh")),t.xp6(2),t.Q6J("hideUntil",o.categoriesLoaded),t.xp6(2),t.Q6J("ngIf",o.currentCategory),t.xp6(),t.Q6J("ngIf",o.categories.length>0),t.xp6(),t.Q6J("ngIf",o.courses.length>0),t.xp6(),t.Q6J("ngIf",!o.categories.length&&!o.courses.length))},dependencies:[m.sg,m.O5,f.P,y.l,b.z,x.r,w.I,E.r,T._,Z.t,I.yp,I.Sm,I.PM,I.W2,I.Gu,I.gu,I.Ie,I.rH,I.Q$,I.q_,I.nJ,I.Wo,I.wd,I.sr,I.oU,L.X,P.X$],encapsulation:2}),CoreCoursesCategoriesPage})();var O=r(55467),D=r(52133),M=r(83431),v=r(93268);function CoreCoursesListPage_h1_6_Template(e,o){1&e&&(t.TgZ(0,"h1"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&e&&(t.xp6(),t.Oqu(t.lcZ(2,1,"core.courses.availablecourses")))}function CoreCoursesListPage_h1_7_Template(e,o){1&e&&(t.TgZ(0,"h1"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&e&&(t.xp6(),t.Oqu(t.lcZ(2,1,"core.courses.mycourses")))}function CoreCoursesListPage_core_context_menu_item_10_Template(e,o){if(1&e){const e=t.EpF();t.TgZ(0,"core-context-menu-item",5),t.NdJ("action",(function CoreCoursesListPage_core_context_menu_item_10_Template_core_context_menu_item_action_0_listener(){t.CHM(e);const o=t.oxw();return t.KtG(o.toggleDownload())}))("toggleChange",(function CoreCoursesListPage_core_context_menu_item_10_Template_core_context_menu_item_toggleChange_0_listener(o){t.CHM(e);const r=t.oxw();return t.KtG(r.downloadEnabled=o)})),t.ALo(1,"translate"),t.qZA()}if(2&e){const e=t.oxw();t.Q6J("priority",1e3)("content",t.lcZ(1,3,"core.settings.showdownloadoptions"))("toggle",e.downloadEnabled)}}function CoreCoursesListPage_core_search_box_18_Template(e,o){if(1&e){const e=t.EpF();t.TgZ(0,"core-search-box",15),t.NdJ("onSubmit",(function CoreCoursesListPage_core_search_box_18_Template_core_search_box_onSubmit_0_listener(o){t.CHM(e);const r=t.oxw();return t.KtG(r.search(o))}))("onClear",(function CoreCoursesListPage_core_search_box_18_Template_core_search_box_onClear_0_listener(){t.CHM(e);const o=t.oxw();return t.KtG(o.clearSearch())})),t.ALo(1,"translate"),t.ALo(2,"translate"),t.qZA()}if(2&e){const e=t.oxw();t.Q6J("placeholder",t.lcZ(1,3,"core.courses.search"))("searchLabel",t.lcZ(2,5,"core.courses.search"))("autoFocus",e.searchMode)}}const list_c0=e=>({$a:e});function CoreCoursesListPage_ng_container_20_Template(e,o){if(1&e&&(t.ynx(0),t.TgZ(1,"ion-item-divider")(2,"ion-label")(3,"h2"),t._uU(4),t.ALo(5,"translate"),t.qZA()()(),t.BQk()),2&e){const e=t.oxw();t.xp6(4),t.Oqu(t.xi3(5,1,"core.courses.totalcoursesearchresults",t.VKq(4,list_c0,e.searchTotal)))}}function CoreCoursesListPage_core_courses_course_list_item_22_Template(e,o){if(1&e&&t._UZ(0,"core-courses-course-list-item",16),2&e){const e=o.$implicit,r=t.oxw();t.Q6J("course",e)("showDownload",r.downloadEnabled)}}function CoreCoursesListPage_core_empty_box_24_Template(e,o){1&e&&(t._UZ(0,"core-empty-box",17),t.ALo(1,"translate")),2&e&&t.Q6J("message",t.lcZ(1,1,"core.courses.nosearchresults"))}function CoreCoursesListPage_core_empty_box_25_Template(e,o){1&e&&(t._UZ(0,"core-empty-box",18),t.ALo(1,"translate")),2&e&&t.Q6J("message",t.lcZ(1,1,"core.courses.nocourses"))}let J=(()=>{var e;class CoreCoursesListPage{constructor(){var e=this;this.downloadAllCoursesEnabled=!1,this.searchEnabled=!1,this.searchMode=!1,this.searchTotal=0,this.downloadEnabled=!1,this.downloadCourseEnabled=!1,this.downloadCoursesEnabled=!1,this.courses=[],this.loaded=!1,this.coursesLoaded=0,this.canLoadMore=!1,this.loadMoreError=!1,this.showOnlyEnrolled=!1,this.loadedCourses=[],this.loadCoursesPerPage=20,this.searchPage=0,this.searchText="",this.courseIds="",this.isDestroyed=!1,this.currentSiteId=c.m9.getRequiredCurrentSite().getId(),this.frontpageCourseId=c.m9.getRequiredCurrentSite().getSiteHomeId(),this.myCoursesObserver=h.R.on(u.c.EVENT_MY_COURSES_UPDATED,(e=>{e.action==u.c.ACTION_ENROL&&this.fetchCourses()}),this.currentSiteId),this.siteUpdatedObserver=h.R.on(h.R.SITE_UPDATED,(()=>{this.searchEnabled=!u.B.isSearchCoursesDisabledInSite(),this.downloadCourseEnabled=!u.B.isDownloadCourseDisabledInSite(),this.downloadCoursesEnabled=!u.B.isDownloadCoursesDisabledInSite(),this.downloadEnabled=(this.downloadCourseEnabled||this.downloadCoursesEnabled)&&this.downloadEnabled,!this.searchEnabled&&this.searchMode&&(this.searchMode=!1,this.fetchCourses())}),this.currentSiteId),this.downloadEnabledObserver=h.R.on(u.c.EVENT_DASHBOARD_DOWNLOAD_ENABLED_CHANGED,(e=>{this.downloadEnabled=(this.downloadCourseEnabled||this.downloadCoursesEnabled)&&e.enabled})),this.logView=p.V.once((0,i.Z)((function*(){C.ke.logEvent(e.showOnlyEnrolled?{type:C.gM.VIEW_ITEM_LIST,ws:"core_enrol_get_users_courses",name:g.vN.instant("core.courses.mycourses"),data:{category:"course"},url:"/my/courses.php"}:{type:C.gM.VIEW_ITEM_LIST,ws:"core_course_get_courses_by_field",name:g.vN.instant("core.courses.availablecourses"),data:{category:"course"},url:"/course/index.php"})})))}ngOnInit(){this.downloadCourseEnabled=!u.B.isDownloadCourseDisabledInSite(),this.downloadCoursesEnabled=!u.B.isDownloadCoursesDisabledInSite(),this.downloadEnabled=(this.downloadCourseEnabled||this.downloadCoursesEnabled)&&u.B.getCourseDownloadOptionsEnabled();const e=_.b.getRouteParam("mode")||"my";"search"==e&&(this.searchMode=!0),"my"==e&&(this.showOnlyEnrolled=!0),this.searchEnabled=!u.B.isSearchCoursesDisabledInSite(),this.searchEnabled||(this.searchMode=!1),this.fetchCourses()}fetchCourses(){var e=this;return(0,i.Z)((function*(){try{e.searchMode?e.searchText&&(yield e.searchCourses()):yield e.loadCourses(!0)}finally{e.loaded=!0}}))()}loadCourses(e=!1){var o=this;return(0,i.Z)((function*(){o.loadMoreError=!1;try{if(e){if(o.showOnlyEnrolled)o.loadedCourses=yield u.B.getUserCourses();else{const e=yield u.B.getCoursesByField();o.loadedCourses=e.filter((e=>e.id!=o.frontpageCourseId))}o.coursesLoaded=0,o.courses=[]}const r=o.loadedCourses.slice(o.coursesLoaded,o.coursesLoaded+o.loadCoursesPerPage);yield O.IP.loadCoursesExtraInfo(r,!0),o.courses=o.courses.concat(r),o.courseIds=o.courses.map((e=>e.id)).join(","),o.coursesLoaded=o.courses.length,o.canLoadMore=o.loadedCourses.length>o.courses.length,o.logView()}catch(e){o.loadMoreError=!0,!o.isDestroyed&&l.OQ.showErrorModalDefault(e,"core.courses.errorloadcourses",!0)}}))()}refreshCourses(e){const o=[];this.searchMode||(o.push(this.showOnlyEnrolled?u.B.invalidateUserCourses():u.B.invalidateCoursesByField()),this.courseIds&&o.push(u.B.invalidateCoursesByField("ids",this.courseIds))),Promise.all(o).finally((()=>{this.fetchCourses().finally((()=>{null==e||e.complete()}))}))}search(e){var o=this;return(0,i.Z)((function*(){o.searchMode=!0,o.searchText=e,o.courses=[],o.searchPage=0,o.searchTotal=0,o.logSearch=p.V.once((()=>o.performLogSearch()));const r=yield l.OQ.showModalLoading("core.searching",!0);yield o.searchCourses().finally((()=>{r.dismiss()}))}))()}clearSearch(){this.searchText="",this.courses=[],this.searchPage=0,this.searchTotal=0,this.searchMode=!1,this.loaded=!1,this.fetchCourses()}performLogSearch(){var e=this;return(0,i.Z)((function*(){e.searchMode&&C.ke.logEvent({type:C.gM.VIEW_ITEM_LIST,ws:"core_course_search_courses",name:g.vN.instant("core.courses.availablecourses"),data:{search:e.searchText,category:"course"},url:`/course/search.php?search=${e.searchText}`})}))()}loadMoreCourses(e){var o=this;return(0,i.Z)((function*(){try{o.searchMode?yield o.searchCourses():yield o.loadCourses()}finally{e&&e()}}))()}searchCourses(){var e=this;return(0,i.Z)((function*(){e.loadMoreError=!1;try{var o;const r=yield u.B.search(e.searchText,e.searchPage,void 0,e.showOnlyEnrolled);e.courses=0===e.searchPage?r.courses:e.courses.concat(r.courses),e.searchTotal=r.total,e.searchPage++,e.canLoadMore=e.courses.length<e.searchTotal,null===(o=e.logSearch)||void 0===o||o.call(e)}catch(o){e.loadMoreError=!0,!e.isDestroyed&&l.OQ.showErrorModalDefault(o,"core.courses.errorsearching",!0)}}))()}toggleEnrolled(){this.loaded=!1,this.fetchCourses()}toggleDownload(){u.B.setCourseDownloadOptionsEnabled(this.downloadEnabled)}ngOnDestroy(){this.myCoursesObserver.off(),this.siteUpdatedObserver.off(),this.downloadEnabledObserver.off(),this.isDestroyed=!0}}return(e=CoreCoursesListPage).ɵfac=function CoreCoursesListPage_Factory(o){return new(o||e)},e.ɵcmp=t.Xpm({type:e,selectors:[["page-core-courses-list"]],decls:26,vars:23,consts:[["slot","start"],[3,"text"],[4,"ngIf"],["slot","end"],["iconAction","toggle",3,"priority","content","toggle","action","toggleChange",4,"ngIf"],["iconAction","toggle",3,"priority","content","toggle","action","toggleChange"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],["searchArea","CoreCoursesSearch",3,"placeholder","searchLabel","autoFocus","onSubmit","onClear",4,"ngIf"],[3,"hideUntil"],[1,"list-item-limited-width"],[3,"course","showDownload",4,"ngFor","ngForOf"],[3,"enabled","error","action"],["icon","fas-magnifying-glass",3,"message",4,"ngIf"],["icon","fas-graduation-cap",3,"message",4,"ngIf"],["searchArea","CoreCoursesSearch",3,"placeholder","searchLabel","autoFocus","onSubmit","onClear"],[3,"course","showDownload"],["icon","fas-magnifying-glass",3,"message"],["icon","fas-graduation-cap",3,"message"]],template:function CoreCoursesListPage_Template(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"ion-title"),t.YNc(6,CoreCoursesListPage_h1_6_Template,3,3,"h1",2)(7,CoreCoursesListPage_h1_7_Template,3,3,"h1",2),t.qZA(),t.TgZ(8,"ion-buttons",3)(9,"core-context-menu"),t.YNc(10,CoreCoursesListPage_core_context_menu_item_10_Template,2,5,"core-context-menu-item",4),t.TgZ(11,"core-context-menu-item",5),t.NdJ("action",(function CoreCoursesListPage_Template_core_context_menu_item_action_11_listener(){return o.toggleEnrolled()}))("toggleChange",(function CoreCoursesListPage_Template_core_context_menu_item_toggleChange_11_listener(e){return o.showOnlyEnrolled=e})),t.ALo(12,"translate"),t.qZA()(),t._UZ(13,"core-user-menu-button"),t.qZA()()(),t.TgZ(14,"ion-content")(15,"ion-refresher",6),t.NdJ("ionRefresh",(function CoreCoursesListPage_Template_ion_refresher_ionRefresh_15_listener(e){return o.refreshCourses(e.target)})),t._UZ(16,"ion-refresher-content",7),t.ALo(17,"translate"),t.qZA(),t.YNc(18,CoreCoursesListPage_core_search_box_18_Template,3,7,"core-search-box",8),t.TgZ(19,"core-loading",9),t.YNc(20,CoreCoursesListPage_ng_container_20_Template,6,6,"ng-container",2),t.TgZ(21,"ion-list",10),t.YNc(22,CoreCoursesListPage_core_courses_course_list_item_22_Template,1,2,"core-courses-course-list-item",11),t.qZA(),t.TgZ(23,"core-infinite-loading",12),t.NdJ("action",(function CoreCoursesListPage_Template_core_infinite_loading_action_23_listener(e){return o.loadMoreCourses(e)})),t.qZA(),t.YNc(24,CoreCoursesListPage_core_empty_box_24_Template,2,3,"core-empty-box",13)(25,CoreCoursesListPage_core_empty_box_25_Template,2,3,"core-empty-box",14),t.qZA()()),2&e&&(t.xp6(3),t.Q6J("text",t.lcZ(4,17,"core.back")),t.xp6(3),t.Q6J("ngIf",!o.showOnlyEnrolled),t.xp6(),t.Q6J("ngIf",o.showOnlyEnrolled),t.xp6(3),t.Q6J("ngIf",o.downloadCourseEnabled||o.downloadCoursesEnabled),t.xp6(),t.Q6J("priority",900)("content",t.lcZ(12,19,"core.courses.showonlyenrolled"))("toggle",o.showOnlyEnrolled),t.xp6(4),t.Q6J("disabled",!o.loaded),t.xp6(),t.s9C("pullingText",t.lcZ(17,21,"core.pulltorefresh")),t.xp6(2),t.Q6J("ngIf",o.searchEnabled),t.xp6(),t.Q6J("hideUntil",o.loaded),t.xp6(),t.Q6J("ngIf",o.searchMode&&o.searchTotal>0),t.xp6(2),t.Q6J("ngForOf",o.courses),t.xp6(),t.Q6J("enabled",o.canLoadMore)("error",o.loadMoreError),t.xp6(),t.Q6J("ngIf",o.searchMode&&!o.courses.length),t.xp6(),t.Q6J("ngIf",!o.searchMode&&!o.courses.length))},dependencies:[m.sg,m.O5,f.P,y.l,b.z,D.n,x.r,Z.t,I.Sm,I.W2,I.Gu,I.rH,I.Q$,I.q_,I.nJ,I.Wo,I.wd,I.sr,I.oU,L.X,M.o,v.L,P.X$],encapsulation:2}),CoreCoursesListPage})();var Q=r(56283),S=r(39716),q=r(74744),U=r(17358);function buildRoutes(e){return[{path:"my",data:{mainMenuTabRoot:U.m.PAGE_NAME},loadChildren:()=>O.IP.getMyRouteModule()},{path:"categories",redirectTo:"categories/root",pathMatch:"full"},{path:"categories/:id",component:A},{path:"list",component:J},...(0,S.o)(e,{redirectTo:"my",pathMatch:"full"})]}let N=(()=>{var e;class CoreCoursesLazyModule{}return(e=CoreCoursesLazyModule).ɵfac=function CoreCoursesLazyModule_Factory(o){return new(o||e)},e.ɵmod=t.oAB({type:e}),e.ɵinj=t.cJS({providers:[{provide:n.Z6,multi:!0,deps:[t.zs3],useFactory:buildRoutes}],imports:[s.L,a.H,Q.g,q.w,n.Bz]}),CoreCoursesLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&t.kYT(N,{declarations:[A,J],imports:[s.L,a.H,Q.g,q.w],exports:[n.Bz]}))}}]);