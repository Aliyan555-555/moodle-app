"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7845],{37845:(e,o,n)=>{n.r(o),n.d(o,{AddonModLessonLazyModule:()=>oe});var t=n(67643),i=n(13386),a=n(36034),s=n(98712),_=n(43555),d=n(70808),r=n(19212),l=n(8947),c=n(60067),g=n(29657),m=n(31903),u=n(89515);let p=(()=>{var e;class AddonModLessonIndexPage extends s.S{ngOnInit(){super.ngOnInit(),this.group=_.b.getRouteNumberParam("group"),this.action=_.b.getRouteParam("action")}}return(e=AddonModLessonIndexPage).ɵfac=(()=>{let o;return function AddonModLessonIndexPage_Factory(n){return(o||(o=r.n5z(e)))(n||e)}})(),e.ɵcmp=r.Xpm({type:e,selectors:[["page-addon-mod-lesson-index"]],viewQuery:function AddonModLessonIndexPage_Query(e,o){if(1&e&&r.Gf(d.j,5),2&e){let e;r.iGM(e=r.CRH())&&(o.activityComponent=e.first)}},features:[r.qOj],decls:14,vars:14,consts:[["collapsible",""],["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"module","courseId","group","action","dataRetrieved"]],template:function AddonModLessonIndexPage_Template(e,o){1&e&&(r.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),r._UZ(3,"ion-back-button",2),r.ALo(4,"translate"),r.qZA(),r.TgZ(5,"ion-title")(6,"h1"),r._UZ(7,"core-format-text",3),r.qZA()(),r._UZ(8,"ion-buttons",4),r.qZA()(),r.TgZ(9,"ion-content",5)(10,"ion-refresher",6),r.NdJ("ionRefresh",(function AddonModLessonIndexPage_Template_ion_refresher_ionRefresh_10_listener(e){return null==o.activityComponent?null:o.activityComponent.doRefresh(e.target)})),r._UZ(11,"ion-refresher-content",7),r.ALo(12,"translate"),r.qZA(),r.TgZ(13,"addon-mod-lesson-index",8),r.NdJ("dataRetrieved",(function AddonModLessonIndexPage_Template_addon_mod_lesson_index_dataRetrieved_13_listener(e){return o.updateData(e)})),r.qZA()()),2&e&&(r.xp6(3),r.Q6J("text",r.lcZ(4,10,"core.back")),r.xp6(4),r.Q6J("text",o.title)("contextInstanceId",o.module.id)("courseId",o.courseId),r.xp6(3),r.Q6J("disabled",null==o.activityComponent?null:o.activityComponent.showLoading),r.xp6(),r.s9C("pullingText",r.lcZ(12,12,"core.pulltorefresh")),r.xp6(2),r.Q6J("module",o.module)("courseId",o.courseId)("group",o.group)("action",o.action))},dependencies:[l.r,c.e,g.t,m.Sm,m.W2,m.Gu,m.nJ,m.Wo,m.wd,m.sr,m.oU,d.j,u.X$],encapsulation:2}),AddonModLessonIndexPage})();var f=n(83599),x=n(49671),v=n(31381),P=n(81370),I=n(53564),A=n(12265),h=n(13010),w=n(857),T=n(75803),Z=n(10727),L=n(98370),y=n(61990),M=n(55793),b=n(52254),k=n(12258),q=n(65823),Q=n(40067),U=n(43468),J=n(56223);const R=["questionFormEl"];function AddonModLessonPlayerPage_ion_button_9_Template(e,o){if(1&e){const e=r.EpF();r.TgZ(0,"ion-button",9),r.NdJ("click",(function AddonModLessonPlayerPage_ion_button_9_Template_ion_button_click_0_listener(){r.CHM(e);const o=r.oxw();return r.KtG(o.showMenu())})),r.ALo(1,"translate"),r._UZ(2,"ion-icon",10),r.qZA()}2&e&&r.uIk("aria-label",r.lcZ(1,1,"addon.mod_lesson.lessonmenu"))}function AddonModLessonPlayerPage_ion_card_12_Template(e,o){if(1&e&&(r.TgZ(0,"ion-card",11)(1,"ion-item",12),r._UZ(2,"ion-icon",13),r.TgZ(3,"ion-label"),r._uU(4),r.qZA()()()),2&e){const e=r.oxw();r.xp6(4),r.Oqu(e.messages[0].message)}}function AddonModLessonPlayerPage_div_13_core_timer_1_Template(e,o){if(1&e){const e=r.EpF();r.TgZ(0,"core-timer",20),r.NdJ("finished",(function AddonModLessonPlayerPage_div_13_core_timer_1_Template_core_timer_finished_0_listener(){r.CHM(e);const o=r.oxw(2);return r.KtG(o.timeUp())})),r.ALo(1,"translate"),r.qZA()}if(2&e){const e=r.oxw(2);r.Q6J("endTime",e.endTime)("timeLeftClassThreshold",-1)("timerText",r.lcZ(1,3,"addon.mod_lesson.timeremaining"))}}const _c1=e=>({$a:e});function AddonModLessonPlayerPage_div_13_ion_item_2_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",12)(1,"ion-label")(2,"p"),r._uU(3),r.ALo(4,"translate"),r.qZA()()()),2&e){const e=r.oxw(2);r.xp6(3),r.Oqu(r.xi3(4,1,"addon.mod_lesson.attempt",r.VKq(4,_c1,e.retake)))}}function AddonModLessonPlayerPage_div_13_ion_item_3_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",21)(1,"ion-label"),r._uU(2),r.qZA()()),2&e){const e=r.oxw(2);r.xp6(2),r.Oqu(e.pageData.ongoingscore)}}function AddonModLessonPlayerPage_div_13_ion_card_4_ion_item_1_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",12)(1,"ion-label"),r._UZ(2,"core-format-text",23),r.qZA()()),2&e){const e=r.oxw(3);r.xp6(2),r.Q6J("component",e.component)("componentId",e.lesson.coursemodule)("text",e.pageContent)("contextInstanceId",e.lesson.coursemodule)("courseId",e.courseId)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ion_item_divider_2_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item-divider",12)(1,"ion-label")(2,"h2"),r._UZ(3,"core-format-text",23),r.qZA()()()),2&e){const e=r.oxw(4);r.xp6(3),r.Q6J("component",e.component)("componentId",e.lesson.coursemodule)("text",e.pageContent)("contextInstanceId",e.lesson.coursemodule)("courseId",e.courseId)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ion_item_4_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",12),r._UZ(1,"ion-input",31),r.ALo(2,"translate"),r.ALo(3,"translate"),r.qZA()),2&e){const e=r.oxw(4);r.xp6(),r.s9C("placeholder",r.lcZ(2,6,"addon.mod_lesson.youranswer")),r.Q6J("type",e.question.input.type)("id",e.question.input.id)("formControlName",e.question.input.name)("maxlength",e.question.input.maxlength),r.uIk("aria-label",r.lcZ(3,8,"addon.mod_lesson.youranswer"))}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_5_ion_item_1_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item")(1,"ion-label",32),r._uU(2),r.ALo(3,"translate"),r.qZA(),r._UZ(4,"core-rich-text-editor",33),r.ALo(5,"translate"),r.qZA()),2&e){const e=r.oxw(5);r.xp6(2),r.Oqu(r.lcZ(3,7,"core.content")),r.xp6(2),r.s9C("placeholder",r.lcZ(5,9,"addon.mod_lesson.youranswer")),r.Q6J("control",e.question.control)("component",e.component)("componentId",e.lesson.coursemodule)("autoSave",!0)("contextInstanceId",e.lesson.coursemodule)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_5_ion_item_2_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",12)(1,"ion-label")(2,"p",34),r._uU(3),r.ALo(4,"translate"),r.qZA(),r.TgZ(5,"p"),r._UZ(6,"core-format-text",23),r.qZA()()()),2&e){const e=r.oxw(5);r.xp6(3),r.Oqu(r.lcZ(4,6,"addon.mod_lesson.youranswer")),r.xp6(3),r.Q6J("component",e.component)("componentId",e.lesson.coursemodule)("text",e.question.useranswer)("contextInstanceId",e.lesson.coursemodule)("courseId",e.courseId)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_5_Template(e,o){if(1&e&&(r.ynx(0),r.YNc(1,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_5_ion_item_1_Template,6,11,"ion-item",18)(2,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_5_ion_item_2_Template,7,8,"ion-item",16),r.BQk()),2&e){const e=r.oxw(4);r.xp6(),r.Q6J("ngIf",e.question.textarea),r.xp6(),r.Q6J("ngIf",!e.question.textarea&&e.question.useranswer)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_ion_radio_group_1_ion_item_1_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",12)(1,"ion-radio",38),r._UZ(2,"core-format-text",23),r.qZA()()),2&e){const e=o.$implicit,n=r.oxw(6);r.xp6(),r.Q6J("id",e.id)("value",e.value)("disabled",e.disabled),r.xp6(),r.Q6J("component",n.component)("componentId",n.lesson.coursemodule)("text",e.text)("contextInstanceId",n.lesson.coursemodule)("courseId",n.courseId)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_ion_radio_group_1_Template(e,o){if(1&e&&(r.TgZ(0,"ion-radio-group",36),r.YNc(1,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_ion_radio_group_1_ion_item_1_Template,3,8,"ion-item",37),r.qZA()),2&e){const e=r.oxw(5);r.Q6J("formControlName",e.question.controlName),r.xp6(),r.Q6J("ngForOf",e.question.options)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_ng_container_2_ion_item_1_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",12)(1,"ion-checkbox",39),r._UZ(2,"core-format-text",23),r.qZA()()),2&e){const e=o.$implicit,n=r.oxw(6);r.xp6(),r.Q6J("id",e.id)("formControlName",e.name),r.xp6(),r.Q6J("component",n.component)("componentId",n.lesson.coursemodule)("text",e.text)("contextInstanceId",n.lesson.coursemodule)("courseId",n.courseId)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_ng_container_2_Template(e,o){if(1&e&&(r.ynx(0),r.YNc(1,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_ng_container_2_ion_item_1_Template,3,7,"ion-item",37),r.BQk()),2&e){const e=r.oxw(5);r.xp6(),r.Q6J("ngForOf",e.question.options)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_Template(e,o){if(1&e&&(r.ynx(0),r.YNc(1,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_ion_radio_group_1_Template,2,2,"ion-radio-group",35)(2,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_ng_container_2_Template,2,1,"ng-container",18),r.BQk()),2&e){const e=r.oxw(4);r.xp6(),r.Q6J("ngIf",!e.question.multi),r.xp6(),r.Q6J("ngIf",e.question.multi)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_7_ion_item_1_ion_select_option_4_Template(e,o){if(1&e&&(r.TgZ(0,"ion-select-option",43),r._uU(1),r.qZA()),2&e){const e=o.$implicit;r.Q6J("value",e.value),r.xp6(),r.hij(" ",e.label," ")}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_7_ion_item_1_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",12)(1,"ion-select",40),r.ALo(2,"translate"),r._UZ(3,"core-format-text",41),r.YNc(4,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_7_ion_item_1_ion_select_option_4_Template,2,2,"ion-select-option",42),r.qZA()()),2&e){const e=o.$implicit,n=r.oxw(5);r.xp6(),r.Q6J("id",e.id)("formControlName",e.name)("cancelText",r.lcZ(2,9,"core.cancel")),r.xp6(2),r.Q6J("component",n.component)("componentId",n.lesson.coursemodule)("text",e.text)("contextInstanceId",n.lesson.coursemodule)("courseId",n.courseId),r.xp6(),r.Q6J("ngForOf",e.options)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_7_Template(e,o){if(1&e&&(r.ynx(0),r.YNc(1,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_7_ion_item_1_Template,5,11,"ion-item",37),r.BQk()),2&e){const e=r.oxw(4);r.xp6(),r.Q6J("ngForOf",e.question.rows)}}function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_Template(e,o){if(1&e){const e=r.EpF();r.TgZ(0,"form",24,25),r.NdJ("ngSubmit",(function AddonModLessonPlayerPage_div_13_ion_card_4_form_2_Template_form_ngSubmit_0_listener(o){r.CHM(e);const n=r.oxw(3);return r.KtG(n.submitQuestion(o))})),r.YNc(2,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ion_item_divider_2_Template,4,5,"ion-item-divider",16),r.ynx(3,26),r.YNc(4,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ion_item_4_Template,4,10,"ion-item",27)(5,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_5_Template,3,2,"ng-container",28)(6,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_6_Template,3,2,"ng-container",28)(7,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_ng_container_7_Template,2,1,"ng-container",28),r.BQk(),r.TgZ(8,"ion-button",29),r._uU(9),r.qZA(),r._UZ(10,"input",30),r.qZA()}if(2&e){const e=r.oxw(3);r.Q6J("formGroup",e.questionForm),r.xp6(2),r.Q6J("ngIf",e.pageContent),r.xp6(),r.Q6J("ngSwitch",e.question.template),r.xp6(),r.Q6J("ngSwitchCase","shortanswer"),r.xp6(),r.Q6J("ngSwitchCase","essay"),r.xp6(),r.Q6J("ngSwitchCase","multichoice"),r.xp6(),r.Q6J("ngSwitchCase","matching"),r.xp6(2),r.hij(" ",e.question.submitLabel," ")}}function AddonModLessonPlayerPage_div_13_ion_card_4_Template(e,o){if(1&e&&(r.TgZ(0,"ion-card"),r.YNc(1,AddonModLessonPlayerPage_div_13_ion_card_4_ion_item_1_Template,3,5,"ion-item",16)(2,AddonModLessonPlayerPage_div_13_ion_card_4_form_2_Template,11,8,"form",22),r.qZA()),2&e){const e=r.oxw(2);r.xp6(),r.Q6J("ngIf",!e.question&&e.pageContent),r.xp6(),r.Q6J("ngIf",e.question&&e.loaded)}}function AddonModLessonPlayerPage_div_13_ion_list_5_ion_grid_1_ion_col_2_Template(e,o){if(1&e){const e=r.EpF();r.TgZ(0,"ion-col",48)(1,"ion-button",49),r.NdJ("click",(function AddonModLessonPlayerPage_div_13_ion_list_5_ion_grid_1_ion_col_2_Template_ion_button_click_1_listener(){const o=r.CHM(e).$implicit,n=r.oxw(4);return r.KtG(n.buttonClicked(o.data))})),r._uU(2),r.qZA()()}if(2&e){const e=o.$implicit;r.xp6(),r.Q6J("id",e.id),r.xp6(),r.hij(" ",e.content," ")}}function AddonModLessonPlayerPage_div_13_ion_list_5_ion_grid_1_Template(e,o){if(1&e&&(r.TgZ(0,"ion-grid",45)(1,"ion-row",46),r.YNc(2,AddonModLessonPlayerPage_div_13_ion_list_5_ion_grid_1_ion_col_2_Template,3,2,"ion-col",47),r.qZA()()),2&e){const e=r.oxw(3);r.xp6(2),r.Q6J("ngForOf",e.pageButtons)}}function AddonModLessonPlayerPage_div_13_ion_list_5_ion_item_2_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",12)(1,"ion-label")(2,"span",50),r._uU(3),r.ALo(4,"translate"),r.qZA(),r._UZ(5,"core-progress-bar",51),r.qZA()()),2&e){const e=r.oxw(3);r.xp6(2),r.MGl("id","addon-mod_lesson-",e.cmId,"-progress"),r.xp6(),r.hij(" ",r.xi3(4,4,"addon.mod_lesson.progresscompleted",r.VKq(7,_c1,e.pageData.progress))," "),r.xp6(2),r.MGl("ariaDescribedBy","addon-mod_lesson-",e.cmId,"-progress"),r.Q6J("progress",e.pageData.progress)}}function AddonModLessonPlayerPage_div_13_ion_list_5_ion_card_3_Template(e,o){1&e&&(r.TgZ(0,"ion-card",11)(1,"ion-item",12),r._UZ(2,"ion-icon",13),r.TgZ(3,"ion-label"),r._uU(4),r.ALo(5,"translate"),r.qZA()()()),2&e&&(r.xp6(4),r.Oqu(r.lcZ(5,1,"addon.mod_lesson.progressbarteacherwarning2")))}function AddonModLessonPlayerPage_div_13_ion_list_5_Template(e,o){if(1&e&&(r.TgZ(0,"ion-list"),r.YNc(1,AddonModLessonPlayerPage_div_13_ion_list_5_ion_grid_1_Template,3,1,"ion-grid",44)(2,AddonModLessonPlayerPage_div_13_ion_list_5_ion_item_2_Template,6,9,"ion-item",16)(3,AddonModLessonPlayerPage_div_13_ion_list_5_ion_card_3_Template,6,3,"ion-card",7),r.qZA()),2&e){const e=r.oxw(2);r.xp6(),r.Q6J("ngIf",null==e.pageButtons?null:e.pageButtons.length),r.xp6(),r.Q6J("ngIf",e.lesson.progressbar&&!e.canManage&&e.pageData),r.xp6(),r.Q6J("ngIf",e.lesson.progressbar&&e.canManage)}}function AddonModLessonPlayerPage_div_13_ion_card_6_Template(e,o){1&e&&(r.TgZ(0,"ion-card",52)(1,"ion-item"),r._UZ(2,"ion-icon",53),r.TgZ(3,"ion-label"),r._uU(4),r.ALo(5,"translate"),r.qZA()()()),2&e&&(r.xp6(4),r.Oqu(r.lcZ(5,1,"addon.mod_lesson.finishretakeoffline")))}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_card_header_1_Template(e,o){1&e&&(r.TgZ(0,"ion-card-header",12)(1,"ion-card-title"),r._uU(2),r.ALo(3,"translate"),r.qZA()()),2&e&&(r.xp6(2),r.Oqu(r.lcZ(3,1,"addon.mod_lesson.congratulations")))}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_2_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",12)(1,"ion-label"),r._uU(2),r.qZA()()),2&e){const e=r.oxw(3);r.xp6(2),r.Oqu(e.eolData.notenoughtimespent.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_3_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",12)(1,"ion-label"),r._uU(2),r.qZA()()),2&e){const e=r.oxw(3);r.xp6(2),r.Oqu(e.eolData.numberofpagesviewed.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_4_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",12)(1,"ion-label"),r._uU(2),r.qZA()()),2&e){const e=r.oxw(3);r.xp6(2),r.Oqu(e.eolData.youshouldview.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_5_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",12)(1,"ion-label"),r._uU(2),r.qZA()()),2&e){const e=r.oxw(3);r.xp6(2),r.Oqu(e.eolData.numberofcorrectanswers.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_6_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",12),r._UZ(1,"ion-label",56),r.qZA()),2&e){const e=r.oxw(3);r.xp6(),r.Q6J("innerHTML",e.eolData.displayscorewithessays.message,r.oJD)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_7_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",12)(1,"ion-label"),r._uU(2),r.qZA()()),2&e){const e=r.oxw(3);r.xp6(2),r.Oqu(e.eolData.displayscorewithoutessays.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_8_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",12)(1,"ion-label"),r._uU(2),r.qZA()()),2&e){const e=r.oxw(3);r.xp6(2),r.Oqu(e.eolData.yourcurrentgradeisoutof.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_9_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",12)(1,"ion-label"),r._uU(2),r.qZA()()),2&e){const e=r.oxw(3);r.xp6(2),r.Oqu(e.eolData.eolstudentoutoftimenoanswers.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_10_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",12)(1,"ion-label"),r._uU(2),r.qZA()()),2&e){const e=r.oxw(3);r.xp6(2),r.Oqu(e.eolData.welldone.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_11_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",12)(1,"ion-label")(2,"span",50),r._uU(3),r.ALo(4,"translate"),r.qZA(),r._UZ(5,"core-progress-bar",51),r.qZA()()),2&e){const e=r.oxw(3);r.xp6(2),r.MGl("id","addon-mod_lesson-",e.cmId,"-progress-end"),r.xp6(),r.hij(" ",r.xi3(4,4,"addon.mod_lesson.progresscompleted",r.VKq(7,_c1,e.eolData.progresscompleted.value))," "),r.xp6(2),r.MGl("ariaDescribedBy","addon-mod_lesson-",e.cmId,"-progress-end"),r.Q6J("progress",e.eolData.progresscompleted.value)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_12_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",12)(1,"ion-label"),r._uU(2),r.qZA()()),2&e){const e=r.oxw(3);r.xp6(2),r.Oqu(e.eolData.displayofgrade.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_button_13_Template(e,o){if(1&e){const e=r.EpF();r.TgZ(0,"ion-button",57),r.NdJ("click",(function AddonModLessonPlayerPage_div_13_ion_card_7_ion_button_13_Template_ion_button_click_0_listener(){r.CHM(e);const o=r.oxw(3);return r.KtG(o.reviewLesson(o.reviewPageId))})),r._uU(1),r.ALo(2,"translate"),r.qZA()}2&e&&(r.xp6(),r.hij(" ",r.lcZ(2,1,"addon.mod_lesson.reviewlesson")," "))}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_14_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",12)(1,"ion-label"),r._uU(2),r.qZA()()),2&e){const e=r.oxw(3);r.xp6(2),r.Oqu(e.eolData.modattemptsnoteacher.message)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_button_15_Template(e,o){if(1&e&&(r.TgZ(0,"ion-button",58),r._UZ(1,"core-format-text",2),r.qZA()),2&e){const e=r.oxw(3);r.Q6J("href",e.activityLink.href)("capture",!0),r.xp6(),r.Q6J("text",e.activityLink.label)("contextInstanceId",e.lesson.coursemodule)("courseId",e.courseId)}}function AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_16_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",12)(1,"ion-label"),r._UZ(2,"core-format-text",2),r.qZA()()),2&e){const e=r.oxw(3);r.xp6(2),r.Q6J("text",e.activityLink.label)("contextInstanceId",e.lesson.coursemodule)("courseId",e.courseId)}}function AddonModLessonPlayerPage_div_13_ion_card_7_Template(e,o){if(1&e&&(r.TgZ(0,"ion-card"),r.YNc(1,AddonModLessonPlayerPage_div_13_ion_card_7_ion_card_header_1_Template,4,3,"ion-card-header",16)(2,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_2_Template,3,1,"ion-item",16)(3,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_3_Template,3,1,"ion-item",16)(4,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_4_Template,3,1,"ion-item",16)(5,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_5_Template,3,1,"ion-item",16)(6,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_6_Template,2,1,"ion-item",16)(7,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_7_Template,3,1,"ion-item",16)(8,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_8_Template,3,1,"ion-item",16)(9,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_9_Template,3,1,"ion-item",16)(10,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_10_Template,3,1,"ion-item",16)(11,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_11_Template,6,9,"ion-item",16)(12,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_12_Template,3,1,"ion-item",16)(13,AddonModLessonPlayerPage_div_13_ion_card_7_ion_button_13_Template,3,3,"ion-button",54)(14,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_14_Template,3,1,"ion-item",16)(15,AddonModLessonPlayerPage_div_13_ion_card_7_ion_button_15_Template,2,5,"ion-button",55)(16,AddonModLessonPlayerPage_div_13_ion_card_7_ion_item_16_Template,3,3,"ion-item",16),r.qZA()),2&e){const e=r.oxw(2);r.xp6(),r.Q6J("ngIf",e.eolData.gradelesson),r.xp6(),r.Q6J("ngIf",e.eolData.notenoughtimespent),r.xp6(),r.Q6J("ngIf",e.eolData.numberofpagesviewed),r.xp6(),r.Q6J("ngIf",e.eolData.youshouldview),r.xp6(),r.Q6J("ngIf",e.eolData.numberofcorrectanswers),r.xp6(),r.Q6J("ngIf",e.eolData.displayscorewithessays),r.xp6(),r.Q6J("ngIf",!e.eolData.displayscorewithessays&&e.eolData.displayscorewithoutessays),r.xp6(),r.Q6J("ngIf",e.eolData.yourcurrentgradeisoutof),r.xp6(),r.Q6J("ngIf",e.eolData.eolstudentoutoftimenoanswers),r.xp6(),r.Q6J("ngIf",e.eolData.welldone),r.xp6(),r.Q6J("ngIf",e.lesson.progressbar&&e.eolData.progresscompleted),r.xp6(),r.Q6J("ngIf",e.eolData.displayofgrade),r.xp6(),r.Q6J("ngIf",e.eolData.reviewlesson),r.xp6(),r.Q6J("ngIf",e.eolData.modattemptsnoteacher),r.xp6(),r.Q6J("ngIf",e.activityLink&&e.activityLink.formatted),r.xp6(),r.Q6J("ngIf",e.activityLink&&!e.activityLink.formatted)}}function AddonModLessonPlayerPage_div_13_ion_list_8_ion_item_1_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",12)(1,"ion-label"),r._uU(2),r.qZA()()),2&e){const e=r.oxw(3);r.xp6(2),r.Oqu(e.processData.ongoingscore)}}function AddonModLessonPlayerPage_div_13_ion_list_8_ion_item_2_div_2_Template(e,o){if(1&e&&(r.TgZ(0,"div"),r._UZ(1,"core-format-text",23),r.qZA()),2&e){const e=r.oxw(4);r.xp6(),r.Q6J("component",e.component)("componentId",e.lesson.coursemodule)("text",e.processData.feedback)("contextInstanceId",e.lesson.coursemodule)("courseId",e.courseId)}}function AddonModLessonPlayerPage_div_13_ion_list_8_ion_item_2_div_3_Template(e,o){1&e&&(r.TgZ(0,"div")(1,"p"),r._uU(2),r.ALo(3,"translate"),r.qZA(),r.TgZ(4,"p"),r._uU(5),r.ALo(6,"translate"),r.qZA(),r.TgZ(7,"p"),r._uU(8),r.ALo(9,"translate"),r.qZA()()),2&e&&(r.xp6(2),r.Oqu(r.lcZ(3,3,"addon.mod_lesson.gotoendoflesson")),r.xp6(3),r.Oqu(r.lcZ(6,5,"addon.mod_lesson.or")),r.xp6(3),r.Oqu(r.lcZ(9,7,"addon.mod_lesson.continuetonextpage")))}function AddonModLessonPlayerPage_div_13_ion_list_8_ion_item_2_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",12)(1,"ion-label"),r.YNc(2,AddonModLessonPlayerPage_div_13_ion_list_8_ion_item_2_div_2_Template,2,5,"div",18)(3,AddonModLessonPlayerPage_div_13_ion_list_8_ion_item_2_div_3_Template,10,9,"div",18),r.qZA()()),2&e){const e=r.oxw(3);r.xp6(2),r.Q6J("ngIf",!e.processData.reviewmode),r.xp6(),r.Q6J("ngIf",e.review)}}function AddonModLessonPlayerPage_div_13_ion_list_8_ion_button_3_Template(e,o){if(1&e){const e=r.EpF();r.TgZ(0,"ion-button",61),r.NdJ("click",(function AddonModLessonPlayerPage_div_13_ion_list_8_ion_button_3_Template_ion_button_click_0_listener(){r.CHM(e);const o=r.oxw(3);return r.KtG(o.changePage(o.LESSON_EOL))})),r._uU(1),r.ALo(2,"translate"),r.qZA()}2&e&&(r.xp6(),r.hij(" ",r.lcZ(2,1,"addon.mod_lesson.finish")," "))}function AddonModLessonPlayerPage_div_13_ion_list_8_ion_button_4_Template(e,o){if(1&e){const e=r.EpF();r.TgZ(0,"ion-button",62),r.NdJ("click",(function AddonModLessonPlayerPage_div_13_ion_list_8_ion_button_4_Template_ion_button_click_0_listener(){const o=r.CHM(e).$implicit,n=r.oxw(3);return r.KtG(n.changePage(o.pageId,!0))})),r._uU(1),r.ALo(2,"translate"),r.qZA()}if(2&e){const e=o.$implicit;r.xp6(),r.hij(" ",r.lcZ(2,1,e.label)," ")}}function AddonModLessonPlayerPage_div_13_ion_list_8_Template(e,o){if(1&e&&(r.TgZ(0,"ion-list"),r.YNc(1,AddonModLessonPlayerPage_div_13_ion_list_8_ion_item_1_Template,3,1,"ion-item",16)(2,AddonModLessonPlayerPage_div_13_ion_list_8_ion_item_2_Template,4,2,"ion-item",16)(3,AddonModLessonPlayerPage_div_13_ion_list_8_ion_button_3_Template,3,3,"ion-button",59)(4,AddonModLessonPlayerPage_div_13_ion_list_8_ion_button_4_Template,3,3,"ion-button",60),r.qZA()),2&e){const e=r.oxw(2);r.xp6(),r.Q6J("ngIf",e.processData.ongoingscore&&!e.processData.reviewmode),r.xp6(),r.Q6J("ngIf",!e.processData.reviewmode||e.review),r.xp6(),r.Q6J("ngIf",e.review),r.xp6(),r.Q6J("ngForOf",e.processDataButtons)}}const _c2=e=>({"addon-mod_lesson-slideshow":e}),_c3=(e,o)=>({width:e,height:o});function AddonModLessonPlayerPage_div_13_Template(e,o){if(1&e&&(r.TgZ(0,"div",14),r.YNc(1,AddonModLessonPlayerPage_div_13_core_timer_1_Template,2,5,"core-timer",15)(2,AddonModLessonPlayerPage_div_13_ion_item_2_Template,5,6,"ion-item",16)(3,AddonModLessonPlayerPage_div_13_ion_item_3_Template,3,1,"ion-item",17)(4,AddonModLessonPlayerPage_div_13_ion_card_4_Template,3,2,"ion-card",18)(5,AddonModLessonPlayerPage_div_13_ion_list_5_Template,4,3,"ion-list",18)(6,AddonModLessonPlayerPage_div_13_ion_card_6_Template,6,3,"ion-card",19)(7,AddonModLessonPlayerPage_div_13_ion_card_7_Template,17,16,"ion-card",18)(8,AddonModLessonPlayerPage_div_13_ion_list_8_Template,5,4,"ion-list",18),r.qZA()),2&e){const e=r.oxw();r.Q6J("ngClass",r.VKq(10,_c2,e.lesson.slideshow))("ngStyle",r.WLB(12,_c3,e.lessonWidth,e.lessonHeight)),r.xp6(),r.Q6J("ngIf",e.endTime),r.xp6(),r.Q6J("ngIf",e.showRetake&&!e.eolData&&!e.processData),r.xp6(),r.Q6J("ngIf",e.pageData&&e.pageData.ongoingscore&&!e.eolData&&!e.processData),r.xp6(),r.Q6J("ngIf",!e.eolData&&!e.processData),r.xp6(),r.Q6J("ngIf",!e.eolData&&!e.processData),r.xp6(),r.Q6J("ngIf",e.eolData&&!e.processData&&(null==e.eolData.offline?null:e.eolData.offline.value)),r.xp6(),r.Q6J("ngIf",e.eolData&&!e.processData),r.xp6(),r.Q6J("ngIf",e.processData)}}let O=(()=>{var e;class AddonModLessonPlayerPage{constructor(e,o){this.changeDetector=e,this.formBuilder=o,this.component=M.R.COMPONENT,this.LESSON_EOL=M.R.LESSON_EOL,this.messages=[],this.processDataButtons=[],this.forceLeave=!1,this.menuShown=!1}ngOnInit(){var e=this;return(0,x.Z)((function*(){try{e.cmId=_.b.getRequiredRouteNumberParam("cmId"),e.courseId=_.b.getRequiredRouteNumberParam("courseId"),e.password=_.b.getRouteParam("password"),e.review=!!_.b.getRouteBooleanParam("review"),e.currentPage=_.b.getRouteNumberParam("pageId"),e.retakeToReview=_.b.getRouteNumberParam("retake")}catch(e){return h.OQ.showErrorModal(e),_.b.back(),void 0}try{(yield e.fetchLessonData())&&q.X.deleteRetakeFinishedInSync(e.lesson.id)}finally{e.loaded=!0}}))()}ngOnDestroy(){this.lesson&&A.d.unblockOperation(this.component,this.lesson.id)}canLeave(){var e=this;return(0,x.Z)((function*(){return e.forceLeave||!e.questionForm||(e.question&&!e.eolData&&!e.processData&&e.originalData&&(T.Tr.basicLeftCompare(e.questionForm.getRawValue(),e.originalData,3)||(yield h.OQ.showConfirm(Z.vN.instant("core.confirmcanceledit")))),Q.o.triggerFormCancelledEvent(e.formElement,I.m9.getCurrentSiteId())),!0}))()}ionViewWillLeave(){this.menuShown&&Z.IN.dismiss()}buttonClicked(e){this.processPage(e)}callFunction(e,o){var n=this;return(0,x.Z)((function*(){try{return yield e()}catch(t){if(n.offline||n.review||!M.g.isLessonOffline(n.lesson))throw t;if(T.Tr.isWebServiceError(t))throw t;return n.offline=!0,n.jumps=yield M.g.getPagesPossibleJumps(n.lesson.id,{cmId:n.cmId,readingStrategy:1}),o.readingStrategy=1,o.jumps=n.jumps,o.offline=!0,e()}}))()}changePage(e,o){var n=this;return(0,x.Z)((function*(){if(o||n.eolData||n.currentPage!=e){n.loaded=!0,n.messages=[];try{yield n.loadPage(e)}catch(e){h.OQ.showErrorModalDefault(e,"Error loading page")}finally{n.loaded=!0}}}))()}fetchLessonData(){var e=this;return(0,x.Z)((function*(){try{var o;e.lesson=yield M.g.getLesson(e.courseId,e.cmId),e.title=e.lesson.name,A.d.blockOperation(e.component,e.lesson.id),yield q.X.waitForSync(e.lesson.id),e.offline=yield k.j.hasOfflineData(e.lesson.id),e.offline||P.AS.isOnline()||!M.g.isLessonOffline(e.lesson)||e.review||(e.offline=!0);const n=e.lesson.id,t={cmId:e.cmId,readingStrategy:e.offline?1:2};e.accessInfo=yield e.callFunction((()=>M.g.getAccessInformation(n,t)),t);const i=[];if(e.canManage=e.accessInfo.canmanage,e.retake=e.accessInfo.attemptscount,e.showRetake=!e.currentPage&&e.retake>0,e.accessInfo.preventaccessreasons.length){const o=M.g.getPreventAccessReason(e.accessInfo,!!e.password,e.review);if(o)throw new v.G(o.message)}if(e.review&&e.retakeToReview!=e.accessInfo.attemptscount-1)throw new v.G(Z.vN.instant("addon.mod_lesson.errorreviewretakenotlast"));if(e.password){const o={password:e.password,cmId:e.cmId,readingStrategy:e.offline?1:2};i.push(e.callFunction((()=>M.g.getLessonWithPassword(n,o)),o).then((o=>{e.lesson=o})))}return e.offline&&i.push(M.g.getPagesPossibleJumps(e.lesson.id,{cmId:e.cmId,readingStrategy:1}).then((o=>{e.jumps=o}))),yield Promise.all(i),e.mediaFile=null===(o=e.lesson.mediafiles)||void 0===o?void 0:o[0],e.lessonWidth=e.lesson.slideshow?h.OQ.formatPixelsSize(e.lesson.mediawidth):"",e.lessonHeight=e.lesson.slideshow?h.OQ.formatPixelsSize(e.lesson.mediaheight):"",yield e.launchRetake(e.currentPage),!0}catch(o){return e.review&&e.retakeToReview&&T.Tr.isWebServiceError(o)&&(yield q.X.deleteRetakeFinishedInSync(e.lesson.id)),h.OQ.showErrorModalDefault(o,"core.course.errorgetmodule",!0),e.forceLeave=!0,_.b.back(),!1}}))()}finishRetake(e){var o=this;return(0,x.Z)((function*(){if(!o.lesson)return;const n=o.lesson;if(o.messages=[],o.offline&&P.AS.isOnline()){var t;const e=yield T.Tr.ignoreErrors(q.X.syncLesson(n.id,!0,!0));if(null!=e&&null!==(t=e.warnings)&&void 0!==t&&t.length){if((yield M.g.getAccessInformation(n.id,{cmId:o.cmId})).attemptscount!=o.accessInfo.attemptscount)throw o.forceLeave=!0,_.b.back(),new v.G(e.warnings[0]);h.OQ.showAlert(void 0,e.warnings[0])}o.offline=!1}const i={password:o.password,outOfTime:e,review:o.review,offline:o.offline,accessInfo:o.accessInfo},a=yield o.callFunction((()=>M.g.finishRetake(n,o.courseId,i)),i);if(o.title=n.name,o.eolData=a.data,o.messages=o.messages.concat(a.messages),o.processData=void 0,o.endTime=void 0,L.R.trigger(L.R.ACTIVITY_DATA_SENT,{module:"lesson"}),o.activityLink=o.eolData.activitylink?b._.formatActivityLink(o.eolData.activitylink.value):void 0,o.eolData.reviewlesson){const e=w.T.extractUrlParams(o.eolData.reviewlesson.value);e&&e.pageid?o.reviewPageId=Number(e.pageid):delete o.eolData.reviewlesson}o.logPageLoaded(M.R.LESSON_EOL,Z.vN.instant("addon.mod_lesson.congratulations"))}))()}jumpToPage(e){var o=this;return(0,x.Z)((function*(){return 0===e?(o.forceLeave=!0,_.b.back(),void 0):e==M.R.LESSON_EOL?o.finishRetake():(o.messages=[],o.loadPage(e))}))()}launchRetake(e){var o=this;return(0,x.Z)((function*(){var n;let t;if(o.review);else if(o.offline){(yield k.j.hasFinishedRetake(o.lesson.id))&&(e=M.R.LESSON_EOL)}else t=yield M.g.launchRetake(o.lesson.id,o.password,e);if(o.currentPage=e||o.accessInfo.firstpageid,o.messages=(null===(n=t)||void 0===n?void 0:n.messages)||[],o.lesson.timelimit&&!o.accessInfo.canmanage){const e=yield M.g.getTimers(o.lesson.id,{cmId:o.cmId,readingStrategy:2});o.endTime=e[e.length-1].starttime+o.lesson.timelimit}return o.loadPage(o.currentPage)}))()}loadMenu(){var e=this;return(0,x.Z)((function*(){if(!e.loadingMenu&&e.lesson)try{e.loadingMenu=!0;const o=e.lesson.id,n={password:e.password,cmId:e.cmId,readingStrategy:e.offline?1:2},t=yield e.callFunction((()=>M.g.getPages(o,n)),n);e.lessonPages=t.map((e=>e.page))}catch(e){h.OQ.showErrorModalDefault(e,"Error loading menu.")}finally{e.loadingMenu=!1}}))()}loadPage(e){var o=this;return(0,x.Z)((function*(){var n,t;if(e==M.R.LESSON_EOL)return o.finishRetake();if(!o.lesson)return;const i=o.lesson,a={password:o.password,review:o.review,includeContents:!0,cmId:o.cmId,readingStrategy:o.offline?1:2,accessInfo:o.accessInfo,jumps:o.jumps,includeOfflineData:!0},s=yield o.callFunction((()=>M.g.getPageData(i,e,a)),a);if(s.newpageid==M.R.LESSON_EOL)return o.finishRetake();o.pageData=s,o.title=s.page.title,o.pageContent=b._.getPageContentsFromPageData(s),o.loaded=!0,o.currentPage=e,o.messages=o.messages.concat(s.messages),o.eolData=o.processData=void 0,M.g.isQuestionPage(s.page.type)?(o.questionForm=o.formBuilder.group({}),o.pageButtons=[],o.question=b._.getQuestionFromPageData(o.questionForm,s),o.originalData=o.questionForm.getRawValue()):(o.pageButtons=b._.getPageButtonsFromHtml(s.pagecontent||""),o.question=void 0,o.originalData=void 0),!s.displaymenu||o.displayMenu||o.review||o.loadMenu(),o.displayMenu=!o.review&&!!s.displaymenu,o.firstPageLoaded?o.showRetake=!1:o.firstPageLoaded=!0,o.logPageLoaded(e,null!==(n=null===(t=s.page)||void 0===t?void 0:t.title)&&void 0!==n?n:"")}))()}logPageLoaded(e,o){this.lesson&&U.ke.logEvent({type:U.gM.VIEW_ITEM,ws:"mod_lesson_get_page_data",name:this.lesson.name+": "+o,data:{id:this.lesson.id,pageid:e,category:"lesson"},url:`/mod/lesson/view.php?id=${this.lesson.id}&pageid=${e}`})}logContinuePageLoaded(){this.lesson&&U.ke.logEvent({type:U.gM.VIEW_ITEM,ws:"mod_lesson_process_page",name:this.lesson.name+": "+Z.vN.instant("addon.mod_lesson.continue"),data:{id:this.lesson.id,category:"lesson"},url:"/mod/lesson/continue.php"})}processPage(e,o){var n=this;return(0,x.Z)((function*(){if(!n.lesson||!n.pageData)return;n.loaded=!1;const t=n.lesson,i=n.pageData,a={password:n.password,review:n.review,offline:n.offline,accessInfo:n.accessInfo,jumps:n.jumps};try{const d=yield n.callFunction((()=>M.g.processPage(t,n.courseId,i,e,a)),a);if(o&&Q.o.triggerFormSubmittedEvent(n.formElement,d.sent,I.m9.getCurrentSiteId()),!n.offline&&!n.review&&M.g.isLessonOffline(t)){var s;const e=n.accessInfo.attemptscount,o={cmId:n.cmId,readingStrategy:2};M.g.isQuestionPage((null===(s=n.pageData)||void 0===s||null===(s=s.page)||void 0===s?void 0:s.type)||-1)?M.g.getQuestionsAttemptsOnline(t.id,e,o):M.g.getContentPagesViewedOnline(t.id,e,o)}if(d.nodefaultresponse||d.inmediatejump)return yield n.jumpToPage(d.newpageid);var _;if(d.feedback=b._.removeQuestionFromFeedback(d.feedback),n.messages=d.messages,n.processData=d,n.processDataButtons=[],!t.review||d.correctanswer||d.noanswer||d.isessayquestion||d.maxattemptsreached||d.reviewmode||n.processDataButtons.push({label:"addon.mod_lesson.reviewquestionback",pageId:n.currentPage}),!t.review||d.correctanswer||d.noanswer||d.isessayquestion||d.maxattemptsreached)n.processDataButtons.push({label:"addon.mod_lesson.continue",pageId:d.newpageid});else(null===(_=i.page)||void 0===_?void 0:_.id)!=d.newpageid&&n.processDataButtons.push({label:"addon.mod_lesson.reviewquestioncontinue",pageId:d.newpageid});n.logContinuePageLoaded()}catch(e){h.OQ.showErrorModalDefault(e,"Error processing page")}finally{n.loaded=!0}}))()}reviewLesson(e){var o=this;return(0,x.Z)((function*(){o.loaded=!1,o.review=!0,o.offline=!1;try{yield o.loadPage(e)}catch(e){h.OQ.showErrorModalDefault(e,"Error loading page")}finally{o.loaded=!0}}))()}submitQuestion(e){e.preventDefault(),e.stopPropagation(),this.loaded=!1;const o=b._.prepareQuestionData(this.question,this.questionForm.getRawValue());this.processPage(o,!0).finally((()=>{this.loaded=!0}))}timeUp(){var e=this;return(0,x.Z)((function*(){e.endTime=void 0,e.loaded=!1;try{yield e.finishRetake(!0)}catch(e){h.OQ.showErrorModalDefault(e,"Error finishing attempt")}finally{e.loaded=!0}}))()}showMenu(){var e=this;return(0,x.Z)((function*(){e.menuShown=!0,yield h.OQ.openSideModal({component:y.s,componentProps:{pageInstance:e}}),e.menuShown=!1}))()}}return(e=AddonModLessonPlayerPage).ɵfac=function AddonModLessonPlayerPage_Factory(o){return new(o||e)(r.Y36(r.sBO),r.Y36(J.qu))},e.ɵcmp=r.Xpm({type:e,selectors:[["page-addon-mod-lesson-player"]],viewQuery:function AddonModLessonPlayerPage_Query(e,o){if(1&e&&(r.Gf(m.W2,5),r.Gf(R,5)),2&e){let e;r.iGM(e=r.CRH())&&(o.content=e.first),r.iGM(e=r.CRH())&&(o.formElement=e.first)}},decls:14,vars:10,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],["fill","clear",3,"click",4,"ngIf"],[1,"limited-width"],[3,"hideUntil"],["class","core-info-card",4,"ngIf"],[3,"ngClass","ngStyle",4,"ngIf"],["fill","clear",3,"click"],["name","fas-bookmark","slot","icon-only","aria-hidden","true"],[1,"core-info-card"],[1,"ion-text-wrap"],["name","fas-circle-info","slot","start","aria-hidden","true"],[3,"ngClass","ngStyle"],[3,"endTime","timeLeftClassThreshold","timerText","finished",4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],["class","addon-mod_lesson-ongoingscore ion-text-wrap",4,"ngIf"],[4,"ngIf"],["class","core-warning-card",4,"ngIf"],[3,"endTime","timeLeftClassThreshold","timerText","finished"],[1,"addon-mod_lesson-ongoingscore","ion-text-wrap"],[3,"formGroup","ngSubmit",4,"ngIf"],["contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],[3,"formGroup","ngSubmit"],["questionFormEl",""],[3,"ngSwitch"],["class","ion-text-wrap",4,"ngSwitchCase"],[4,"ngSwitchCase"],["expand","block","type","submit",1,"ion-text-wrap","ion-margin","button-no-uppercase"],["type","submit",1,"core-submit-hidden-enter"],["autocorrect","off",3,"type","placeholder","id","formControlName","maxlength"],[1,"sr-only"],["contextLevel","module","elementId","answer_editor",3,"placeholder","control","component","componentId","autoSave","contextInstanceId"],[1,"item-heading"],[3,"formControlName",4,"ngIf"],[3,"formControlName"],["class","ion-text-wrap",4,"ngFor","ngForOf"],[3,"id","value","disabled"],[3,"id","formControlName"],["interface","action-sheet",3,"id","formControlName","cancelText"],["slot","label","contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["class","ion-text-wrap addon-mod_lesson-pagebuttons",4,"ngIf"],[1,"ion-text-wrap","addon-mod_lesson-pagebuttons"],[1,"ion-align-items-center"],["size","12","size-md","6","size-lg","3","col-xl","",4,"ngFor","ngForOf"],["size","12","size-md","6","size-lg","3","col-xl",""],["expand","block","fill","outline",1,"ion-text-wrap","button-no-uppercase",3,"id","click"],[3,"id"],[3,"progress","ariaDescribedBy"],[1,"core-warning-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],["expand","block","class","ion-text-wrap ion-margin button-no-uppercase",3,"click",4,"ngIf"],["expand","block","fill","outline","core-link","","class","ion-text-wrap ion-margin button-no-uppercase",3,"href","capture",4,"ngIf"],[3,"innerHTML"],["expand","block",1,"ion-text-wrap","ion-margin","button-no-uppercase",3,"click"],["expand","block","fill","outline","core-link","",1,"ion-text-wrap","ion-margin","button-no-uppercase",3,"href","capture"],["expand","block","class","ion-text-wrap ion-margin",3,"click",4,"ngIf"],["expand","block","class","ion-text-wrap ion-margin","fill","outline",3,"click",4,"ngFor","ngForOf"],["expand","block",1,"ion-text-wrap","ion-margin",3,"click"],["expand","block","fill","outline",1,"ion-text-wrap","ion-margin",3,"click"]],template:function AddonModLessonPlayerPage_Template(e,o){1&e&&(r.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),r._UZ(3,"ion-back-button",1),r.ALo(4,"translate"),r.qZA(),r.TgZ(5,"ion-title")(6,"h1"),r._UZ(7,"core-format-text",2),r.qZA()(),r.TgZ(8,"ion-buttons",3),r.YNc(9,AddonModLessonPlayerPage_ion_button_9_Template,3,3,"ion-button",4),r.qZA()()(),r.TgZ(10,"ion-content",5)(11,"core-loading",6),r.YNc(12,AddonModLessonPlayerPage_ion_card_12_Template,5,1,"ion-card",7)(13,AddonModLessonPlayerPage_div_13_Template,9,15,"div",8),r.qZA()()),2&e&&(r.xp6(3),r.Q6J("text",r.lcZ(4,8,"core.back")),r.xp6(4),r.Q6J("text",o.title)("contextInstanceId",null==o.lesson?null:o.lesson.coursemodule)("courseId",o.courseId),r.xp6(2),r.Q6J("ngIf",o.displayMenu||o.mediaFile),r.xp6(2),r.Q6J("hideUntil",o.loaded),r.xp6(),r.Q6J("ngIf",o.lesson&&(null==o.messages?null:o.messages.length)),r.xp6(),r.Q6J("ngIf",o.lesson))},styles:["[_nghost-%COMP%]{--background-odd: var(--light)}html.dark[_nghost-%COMP%], html.dark   [_nghost-%COMP%]{--background-odd: var(--medium)}[_nghost-%COMP%]     .addon-mod_lesson-slideshow{max-width:100%;max-height:100%;margin:0 auto}[_nghost-%COMP%]     .studentanswer{padding-inline-start:8px}[_nghost-%COMP%]     table{width:100%;margin-top:1.5rem}[_nghost-%COMP%]     table tr:nth-child(odd){background-color:var(--background-odd)}[_nghost-%COMP%]     table tr:last-child td{border-bottom:0}[_nghost-%COMP%]     table td{padding:5px;line-height:1.5;border-bottom:1px solid var(--stroke)}"]}),AddonModLessonPlayerPage})();var D=n(84095),C=n(45151),N=n(34749),E=n(88817),S=n(96814),F=n(66931),Y=n(74176),$=n(80070),B=n(97037),j=n(22742),G=n(22068),V=n(83369);function AddonModLessonUserRetakePage_div_14_ion_item_7_ion_select_option_7_Template(e,o){if(1&e&&(r.TgZ(0,"ion-select-option",16),r._uU(1),r.qZA()),2&e){const e=o.$implicit;r.Q6J("value",e.try),r.xp6(),r.hij(" ",e.label," ")}}const user_retake_c0=e=>({header:e});function AddonModLessonUserRetakePage_div_14_ion_item_7_Template(e,o){if(1&e){const e=r.EpF();r.TgZ(0,"ion-item",12)(1,"ion-select",13),r.NdJ("ngModelChange",(function AddonModLessonUserRetakePage_div_14_ion_item_7_Template_ion_select_ngModelChange_1_listener(o){r.CHM(e);const n=r.oxw(2);return r.KtG(n.selectedRetake=o)}))("ionChange",(function AddonModLessonUserRetakePage_div_14_ion_item_7_Template_ion_select_ionChange_1_listener(){r.CHM(e);const o=r.oxw(2);return r.KtG(o.changeRetake(o.selectedRetake))})),r.ALo(2,"translate"),r.ALo(3,"translate"),r.TgZ(4,"p",14),r._uU(5),r.ALo(6,"translate"),r.qZA(),r.YNc(7,AddonModLessonUserRetakePage_div_14_ion_item_7_ion_select_option_7_Template,2,2,"ion-select-option",15),r.qZA()()}if(2&e){const e=r.oxw(2);r.xp6(),r.Q6J("ngModel",e.selectedRetake)("cancelText",r.lcZ(2,5,"core.cancel"))("interfaceOptions",r.VKq(11,user_retake_c0,r.lcZ(3,7,"addon.mod_lesson.attemptheader"))),r.xp6(4),r.Oqu(r.lcZ(6,9,"addon.mod_lesson.attemptheader")),r.xp6(2),r.Q6J("ngForOf",e.student.attempts)}}const user_retake_c1=e=>({$a:e});function AddonModLessonUserRetakePage_div_14_ion_list_8_Template(e,o){if(1&e&&(r.TgZ(0,"ion-list",17)(1,"ion-item")(2,"ion-label",12)(3,"ion-grid",18)(4,"ion-row")(5,"ion-col")(6,"p",19),r._uU(7),r.ALo(8,"translate"),r.qZA(),r.TgZ(9,"p"),r._uU(10),r.ALo(11,"translate"),r.qZA()(),r.TgZ(12,"ion-col")(13,"p",19),r._uU(14),r.ALo(15,"translate"),r.qZA(),r.TgZ(16,"p"),r._uU(17),r.qZA()()()()()(),r.TgZ(18,"ion-item",12)(19,"ion-label")(20,"p",19),r._uU(21),r.ALo(22,"translate"),r.qZA(),r.TgZ(23,"p"),r._uU(24),r.qZA()()(),r.TgZ(25,"ion-item",12)(26,"ion-label")(27,"p",19),r._uU(28),r.ALo(29,"translate"),r.qZA(),r.TgZ(30,"p"),r._uU(31),r.ALo(32,"coreFormatDate"),r.qZA()()()()),2&e){const e=r.oxw(2);r.xp6(7),r.Oqu(r.lcZ(8,9,"addon.mod_lesson.grade")),r.xp6(3),r.Oqu(r.xi3(11,11,"core.percentagenumber",r.VKq(22,user_retake_c1,e.retake.userstats.grade))),r.xp6(4),r.Oqu(r.lcZ(15,14,"addon.mod_lesson.rawgrade")),r.xp6(3),r.AsE("",e.retake.userstats.gradeinfo.earned," / ",e.retake.userstats.gradeinfo.total,""),r.xp6(4),r.Oqu(r.lcZ(22,16,"addon.mod_lesson.timetaken")),r.xp6(3),r.Oqu(e.timeTakenReadable),r.xp6(4),r.Oqu(r.lcZ(29,18,"addon.mod_lesson.completed")),r.xp6(3),r.Oqu(r.lcZ(32,20,1e3*e.retake.userstats.completed))}}function AddonModLessonUserRetakePage_div_14_ion_item_9_Template(e,o){1&e&&(r.TgZ(0,"ion-item",12)(1,"ion-label"),r._uU(2),r.ALo(3,"translate"),r.qZA()()),2&e&&(r.xp6(2),r.Oqu(r.lcZ(3,1,"addon.mod_lesson.notcompleted")))}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_ion_item_16_Template(e,o){1&e&&(r.TgZ(0,"ion-item",12)(1,"ion-label")(2,"p"),r._uU(3),r.ALo(4,"translate"),r.qZA()()()),2&e&&(r.xp6(3),r.Oqu(r.lcZ(4,1,"addon.mod_lesson.didnotanswerquestion")))}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_1_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item")(1,"ion-label",12)(2,"ion-grid",18)(3,"ion-row")(4,"ion-col")(5,"ion-button",26),r._uU(6),r.qZA()(),r.TgZ(7,"ion-col"),r._UZ(8,"p",27),r.qZA()()()()()),2&e){const e=r.oxw().$implicit;r.xp6(5),r.Q6J("disabled",!0),r.xp6(),r.hij(" ",e[0].buttonText," "),r.xp6(2),r.Q6J("innerHTML",e[0].content,r.oJD)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_ion_badge_4_Template(e,o){if(1&e&&(r.TgZ(0,"ion-badge",34),r._UZ(1,"core-format-text",31),r.qZA()),2&e){const e=r.oxw(3).$implicit,o=r.oxw(5);r.xp6(),r.Q6J("component",o.component)("componentId",null==o.lesson?null:o.lesson.coursemodule)("text",e[1])("contextInstanceId",null==o.lesson?null:o.lesson.coursemodule)("courseId",o.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_ion_badge_5_Template(e,o){if(1&e&&(r.TgZ(0,"ion-badge",35),r._uU(1),r.qZA()),2&e){const e=r.oxw(3).$implicit;r.xp6(),r.hij(" ",e[0].successBadge," ")}}const user_retake_c2=e=>({"addon-mod_lesson-highlight":e});function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",29)(1,"ion-checkbox",30)(2,"p"),r._UZ(3,"core-format-text",31),r.qZA(),r.YNc(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_ion_badge_4_Template,2,5,"ion-badge",32)(5,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_ion_badge_5_Template,2,1,"ion-badge",33),r.qZA()()),2&e){const e=r.oxw(2).$implicit,o=r.oxw(5);r.Q6J("ngClass",r.VKq(11,user_retake_c2,e[0].highlight)),r.xp6(),r.Q6J("ngModel",e[0].checked)("disabled",!0),r.uIk("name",e[0].name),r.xp6(2),r.Q6J("component",o.component)("componentId",null==o.lesson?null:o.lesson.coursemodule)("text",e[0].content)("contextInstanceId",null==o.lesson?null:o.lesson.coursemodule)("courseId",o.courseId),r.xp6(),r.Q6J("ngIf",e[1]),r.xp6(),r.Q6J("ngIf",e[0].successBadge)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_2_ion_badge_4_Template(e,o){if(1&e&&(r.TgZ(0,"ion-badge",37),r._UZ(1,"core-format-text",31),r.qZA()),2&e){const e=r.oxw(3).$implicit,o=r.oxw(5);r.xp6(),r.Q6J("component",o.component)("componentId",null==o.lesson?null:o.lesson.coursemodule)("text",e[1])("contextInstanceId",null==o.lesson?null:o.lesson.coursemodule)("courseId",o.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_2_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",12)(1,"ion-label")(2,"p"),r._uU(3),r.qZA(),r.YNc(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_2_ion_badge_4_Template,2,5,"ion-badge",36),r.qZA()()),2&e){const e=r.oxw(2).$implicit;r.xp6(3),r.Oqu(e[0].value),r.xp6(),r.Q6J("ngIf",e[1])}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_3_ion_badge_10_Template(e,o){if(1&e&&(r.TgZ(0,"ion-badge",37),r._UZ(1,"core-format-text",31),r.qZA()),2&e){const e=r.oxw(3).$implicit,o=r.oxw(5);r.xp6(),r.Q6J("component",o.component)("componentId",null==o.lesson?null:o.lesson.coursemodule)("text",e[1])("contextInstanceId",null==o.lesson?null:o.lesson.coursemodule)("courseId",o.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_3_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item")(1,"ion-label",12)(2,"ion-grid",18)(3,"ion-row")(4,"ion-col")(5,"p"),r._UZ(6,"core-format-text",31),r.qZA()(),r.TgZ(7,"ion-col")(8,"p"),r._uU(9),r.qZA(),r.YNc(10,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_3_ion_badge_10_Template,2,5,"ion-badge",36),r.qZA()()()()()),2&e){const e=r.oxw(2).$implicit,o=r.oxw(5);r.xp6(6),r.Q6J("component",o.component)("componentId",null==o.lesson?null:o.lesson.coursemodule)("text",e[0].content)("contextInstanceId",null==o.lesson?null:o.lesson.coursemodule)("courseId",o.courseId),r.xp6(3),r.Oqu(e[0].value),r.xp6(),r.Q6J("ngIf",e[1])}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_4_ion_badge_4_Template(e,o){if(1&e&&(r.TgZ(0,"ion-badge",37),r._UZ(1,"core-format-text",31),r.qZA()),2&e){const e=r.oxw(3).$implicit,o=r.oxw(5);r.xp6(),r.Q6J("component",o.component)("componentId",null==o.lesson?null:o.lesson.coursemodule)("text",e[1])("contextInstanceId",null==o.lesson?null:o.lesson.coursemodule)("courseId",o.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_4_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",12)(1,"ion-label")(2,"p"),r._UZ(3,"core-format-text",31),r.qZA(),r.YNc(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_4_ion_badge_4_Template,2,5,"ion-badge",36),r.qZA()()),2&e){const e=r.oxw(2).$implicit,o=r.oxw(5);r.xp6(3),r.Q6J("component",o.component)("componentId",null==o.lesson?null:o.lesson.coursemodule)("text",e[0])("contextInstanceId",null==o.lesson?null:o.lesson.coursemodule)("courseId",o.courseId),r.xp6(),r.Q6J("ngIf",e[1])}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_Template(e,o){if(1&e&&(r.ynx(0),r.YNc(1,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_1_Template,6,13,"ion-item",28)(2,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_2_Template,5,2,"ion-item",10)(3,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_3_Template,11,7,"ion-item",6)(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_ion_item_4_Template,5,6,"ion-item",10),r.BQk()),2&e){const e=r.oxw().$implicit;r.xp6(),r.Q6J("ngIf",e[0].isCheckbox),r.xp6(),r.Q6J("ngIf",e[0].isText),r.xp6(),r.Q6J("ngIf",e[0].isSelect),r.xp6(),r.Q6J("ngIf",!e[0].isCheckbox&&!e[0].isText&&!e[0].isSelect)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_3_ion_badge_4_Template(e,o){if(1&e&&(r.TgZ(0,"ion-badge",37),r._UZ(1,"core-format-text",31),r.qZA()),2&e){const e=r.oxw(2).$implicit,o=r.oxw(5);r.xp6(),r.Q6J("component",o.component)("componentId",null==o.lesson?null:o.lesson.coursemodule)("text",e[1])("contextInstanceId",null==o.lesson?null:o.lesson.coursemodule)("courseId",o.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_3_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",12)(1,"ion-label")(2,"p"),r._UZ(3,"core-format-text",31),r.qZA(),r.YNc(4,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_3_ion_badge_4_Template,2,5,"ion-badge",36),r.qZA()()),2&e){const e=r.oxw().$implicit,o=r.oxw(5);r.xp6(3),r.Q6J("component",o.component)("componentId",null==o.lesson?null:o.lesson.coursemodule)("text",e[0])("contextInstanceId",null==o.lesson?null:o.lesson.coursemodule)("courseId",o.courseId),r.xp6(),r.Q6J("ngIf",e[1])}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_Template(e,o){if(1&e&&(r.ynx(0),r.YNc(1,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_1_Template,9,3,"ion-item",6)(2,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ng_container_2_Template,5,4,"ng-container",6)(3,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_ion_item_3_Template,5,6,"ion-item",10),r.BQk()),2&e){const e=r.oxw(2).$implicit;r.xp6(),r.Q6J("ngIf",e.isContent),r.xp6(),r.Q6J("ngIf",e.isQuestion),r.xp6(),r.Q6J("ngIf",!e.isContent&&!e.isQuestion)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ion_item_2_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",12)(1,"ion-label")(2,"p",19),r._uU(3),r.ALo(4,"translate"),r.qZA(),r.TgZ(5,"p"),r._UZ(6,"core-format-text",31),r.qZA()()()),2&e){const e=r.oxw(2).$implicit,o=r.oxw(3);r.xp6(3),r.Oqu(r.lcZ(4,6,"addon.mod_lesson.response")),r.xp6(3),r.Q6J("component",o.component)("componentId",null==o.lesson?null:o.lesson.coursemodule)("text",e.answerdata.response)("contextInstanceId",null==o.lesson?null:o.lesson.coursemodule)("courseId",o.courseId)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ion_item_3_Template(e,o){if(1&e&&(r.TgZ(0,"ion-item",12)(1,"ion-label")(2,"p"),r._uU(3),r.qZA()()()),2&e){const e=r.oxw(2).$implicit;r.xp6(3),r.Oqu(e.answerdata.score)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_Template(e,o){if(1&e&&(r.TgZ(0,"div",24),r.YNc(1,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ng_container_1_Template,4,3,"ng-container",25)(2,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ion_item_2_Template,7,8,"ion-item",10)(3,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_ion_item_3_Template,4,1,"ion-item",10),r.qZA()),2&e){const e=r.oxw().$implicit;r.xp6(),r.Q6J("ngForOf",e.answerdata.answers),r.xp6(),r.Q6J("ngIf",e.answerdata.response),r.xp6(),r.Q6J("ngIf",e.answerdata.score)}}const user_retake_c3=e=>({"text-dimmed":e});function AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_Template(e,o){if(1&e&&(r.TgZ(0,"ion-card",21)(1,"ion-card-header",12)(2,"ion-card-title"),r._uU(3),r.qZA()(),r.TgZ(4,"ion-item",12)(5,"ion-label")(6,"p",19),r._uU(7),r.ALo(8,"translate"),r.qZA(),r.TgZ(9,"p"),r._UZ(10,"core-format-text",22),r.qZA()()(),r.TgZ(11,"ion-item",12)(12,"ion-label")(13,"p",19),r._uU(14),r.ALo(15,"translate"),r.qZA()()(),r.YNc(16,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_ion_item_16_Template,5,3,"ion-item",10)(17,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_div_17_Template,4,3,"div",23),r.qZA()),2&e){const e=o.$implicit,n=r.oxw(3);r.Q6J("ngClass",r.VKq(16,user_retake_c3,e.grayout)),r.xp6(3),r.AsE("",e.qtype,": ",e.title,""),r.xp6(4),r.Oqu(r.lcZ(8,12,"addon.mod_lesson.question")),r.xp6(3),r.Q6J("component",n.component)("componentId",null==n.lesson?null:n.lesson.coursemodule)("text",e.contents)("contextInstanceId",null==n.lesson?null:n.lesson.coursemodule)("courseId",n.courseId),r.xp6(4),r.Oqu(r.lcZ(15,14,"addon.mod_lesson.answer")),r.xp6(2),r.Q6J("ngIf",!e.answerdata||!e.answerdata.answers||!e.answerdata.answers.length),r.xp6(),r.Q6J("ngIf",e.answerdata&&e.answerdata.answers&&e.answerdata.answers.length)}}function AddonModLessonUserRetakePage_div_14_ng_container_10_Template(e,o){if(1&e&&(r.ynx(0),r.YNc(1,AddonModLessonUserRetakePage_div_14_ng_container_10_ion_card_1_Template,18,18,"ion-card",20),r.BQk()),2&e){const e=r.oxw(2);r.xp6(),r.Q6J("ngForOf",e.retake.answerpages)}}function AddonModLessonUserRetakePage_div_14_Template(e,o){if(1&e&&(r.TgZ(0,"div")(1,"ion-item",7),r._UZ(2,"core-user-avatar",8),r.TgZ(3,"ion-label")(4,"h2"),r._uU(5),r.qZA(),r._UZ(6,"core-progress-bar",9),r.qZA()(),r.YNc(7,AddonModLessonUserRetakePage_div_14_ion_item_7_Template,8,13,"ion-item",10)(8,AddonModLessonUserRetakePage_div_14_ion_list_8_Template,33,24,"ion-list",11)(9,AddonModLessonUserRetakePage_div_14_ion_item_9_Template,4,3,"ion-item",10)(10,AddonModLessonUserRetakePage_div_14_ng_container_10_Template,2,1,"ng-container",6),r.qZA()),2&e){const e=r.oxw();r.xp6(),r.Q6J("userId",e.student.id)("courseId",e.courseId),r.uIk("aria-label",e.student.fullname),r.xp6(),r.Q6J("user",e.student)("userId",e.student.id)("courseId",e.courseId)("linkProfile",!1),r.xp6(3),r.Oqu(e.student.fullname),r.xp6(),r.Q6J("progress",e.student.bestgrade),r.xp6(),r.Q6J("ngIf",e.student.attempts&&e.student.attempts.length>1),r.xp6(),r.Q6J("ngIf",e.retake&&e.retake.userstats&&e.retake.userstats.gradeinfo),r.xp6(),r.Q6J("ngIf",e.retake&&(!e.retake.userstats||!e.retake.userstats.gradeinfo)),r.xp6(),r.Q6J("ngIf",e.retake)}}let H=(()=>{var e;class AddonModLessonUserRetakePage{constructor(){this.component=M.R.COMPONENT,this.logView=E.V.once((()=>this.performLogView()))}ngOnInit(){try{this.cmId=_.b.getRequiredRouteNumberParam("cmId"),this.courseId=_.b.getRequiredRouteNumberParam("courseId"),this.userId=_.b.getRouteNumberParam("userId")||I.m9.getCurrentSiteUserId(),this.retakeNumber=_.b.getRouteNumberParam("retake")}catch(e){return h.OQ.showErrorModal(e),_.b.back(),void 0}this.fetchData().finally((()=>{this.loaded=!0}))}changeRetake(e){var o=this;return(0,x.Z)((function*(){o.loaded=!1;try{yield o.setRetake(e),o.performLogView()}catch(e){var n;o.selectedRetake=null!==(n=o.previousSelectedRetake)&&void 0!==n?n:o.selectedRetake,h.OQ.showErrorModal(T.Tr.addDataNotDownloadedError(e,"Error getting attempt."))}finally{o.loaded=!0}}))()}doRefresh(e){this.refreshData().finally((()=>{null==e||e.complete()}))}fetchData(){var e=this;return(0,x.Z)((function*(){try{var o;e.lesson=yield M.g.getLesson(e.courseId,e.cmId);const n=yield M.g.getRetakesOverview(e.lesson.id,{cmId:e.cmId}),t=null==n||null===(o=n.students)||void 0===o?void 0:o.find((o=>o.id==e.userId));if(!t)throw new v.G(Z.vN.instant("addon.mod_lesson.cannotfinduser"));if(!t.attempts.length)throw new v.G(Z.vN.instant("addon.mod_lesson.cannotfindattempt"));t.bestgrade=N._1.roundToDecimals(t.bestgrade,2),t.attempts.forEach((o=>{e.selectedRetake||e.retakeNumber!=o.try||(e.selectedRetake=e.retakeNumber),o.label=b._.getRetakeLabel(o)})),e.selectedRetake||(e.selectedRetake=t.attempts[t.attempts.length-1].try);const i=yield T.Tr.ignoreErrors(C.My.getProfile(t.id,e.courseId,!0));e.student=t,e.student.profileimageurl=null==i?void 0:i.profileimageurl,yield e.setRetake(e.selectedRetake),e.logView()}catch(e){h.OQ.showErrorModalDefault(e,"Error getting data.",!0)}}))()}refreshData(){var e=this;return(0,x.Z)((function*(){const o=[];o.push(M.g.invalidateLessonData(e.courseId)),e.lesson&&(o.push(M.g.invalidateRetakesOverview(e.lesson.id)),o.push(M.g.invalidateUserRetakesForUser(e.lesson.id,e.userId))),yield T.Tr.ignoreErrors(Promise.all(o)),yield e.fetchData()}))()}setRetake(e){var o=this;return(0,x.Z)((function*(){o.selectedRetake=e;const n=yield M.g.getUserRetake(o.lesson.id,e,{cmId:o.cmId,userId:o.userId});o.retake=o.formatRetake(n),o.previousSelectedRetake=o.selectedRetake}))()}formatRetake(e){const o=e;return o.userstats.gradeinfo&&(o.userstats.grade=N._1.roundToDecimals(o.userstats.grade,2),this.timeTakenReadable=E.V.formatTime(o.userstats.timetotake)),o.answerpages.forEach((e=>{if(M.g.answerPageIsContent(e)){var o;const n=e;n.isContent=!0,null!==(o=n.answerdata)&&void 0!==o&&o.answers&&n.answerdata.answers.forEach((e=>{e[0]=b._.getContentPageAnswerDataFromHtml(e[0])}))}else if(M.g.answerPageIsQuestion(e)){var n;const o=e;o.isQuestion=!0,null!==(n=o.answerdata)&&void 0!==n&&n.answers&&o.answerdata.answers.forEach((e=>{e[0]=b._.getQuestionPageAnswerDataFromHtml(e[0])}))}})),o}performLogView(){this.lesson&&U.ke.logEvent({type:U.gM.VIEW_ITEM,ws:"mod_lesson_get_user_attempt",name:this.lesson.name+": "+Z.vN.instant("addon.mod_lesson.detailedstats"),data:{id:this.lesson.id,userid:this.userId,try:this.selectedRetake,category:"lesson"},url:`/mod/lesson/report.php?id=${this.cmId}&action=reportdetail&userid=${this.userId}&try=${this.selectedRetake}`})}}return(e=AddonModLessonUserRetakePage).ɵfac=function AddonModLessonUserRetakePage_Factory(o){return new(o||e)},e.ɵcmp=r.Xpm({type:e,selectors:[["page-addon-mod-lesson-user-retake"]],decls:15,vars:12,consts:[["slot","start"],[3,"text"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[4,"ngIf"],["core-user-link","",1,"ion-text-wrap",3,"userId","courseId"],["slot","start",3,"user","userId","courseId","linkProfile"],["a11yText","addon.mod_lesson.grade",3,"progress"],["class","ion-text-wrap",4,"ngIf"],["class","addon-mod_lesson-userstats",4,"ngIf"],[1,"ion-text-wrap"],["interface","action-sheet",3,"ngModel","cancelText","interfaceOptions","ngModelChange","ionChange"],["slot","label",1,"item-heading"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"addon-mod_lesson-userstats"],[1,"ion-no-padding"],[1,"item-heading"],["class","addon-mod_lesson-answerpage",3,"ngClass",4,"ngFor","ngForOf"],[1,"addon-mod_lesson-answerpage",3,"ngClass"],["collapsible-item","","contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],["class","addon-mod_lesson-answer",4,"ngIf"],[1,"addon-mod_lesson-answer"],[4,"ngFor","ngForOf"],["expand","block","fill","outline",1,"ion-text-wrap",3,"disabled"],[3,"innerHTML"],["class","ion-text-wrap",3,"ngClass",4,"ngIf"],[1,"ion-text-wrap",3,"ngClass"],[3,"ngModel","disabled"],["contextLevel","module",3,"component","componentId","text","contextInstanceId","courseId"],["color","dark","class","addon-mod_lesson-answer-stats",4,"ngIf"],["color","success","class","addon-mod_lesson-answer-success",4,"ngIf"],["color","dark",1,"addon-mod_lesson-answer-stats"],["color","success",1,"addon-mod_lesson-answer-success"],["color","dark",4,"ngIf"],["color","dark"]],template:function AddonModLessonUserRetakePage_Template(e,o){1&e&&(r.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),r._UZ(3,"ion-back-button",1),r.ALo(4,"translate"),r.qZA(),r.TgZ(5,"ion-title")(6,"h1"),r._uU(7),r.ALo(8,"translate"),r.qZA()()()(),r.TgZ(9,"ion-content",2)(10,"ion-refresher",3),r.NdJ("ionRefresh",(function AddonModLessonUserRetakePage_Template_ion_refresher_ionRefresh_10_listener(e){return o.doRefresh(e.target)})),r._UZ(11,"ion-refresher-content",4),r.ALo(12,"translate"),r.qZA(),r.TgZ(13,"core-loading",5),r.YNc(14,AddonModLessonUserRetakePage_div_14_Template,11,13,"div",6),r.qZA()()),2&e&&(r.xp6(3),r.Q6J("text",r.lcZ(4,6,"core.back")),r.xp6(4),r.Oqu(r.lcZ(8,8,"addon.mod_lesson.detailedstats")),r.xp6(3),r.Q6J("disabled",!o.loaded),r.xp6(),r.s9C("pullingText",r.lcZ(12,10,"core.pulltorefresh")),r.xp6(2),r.Q6J("hideUntil",o.loaded),r.xp6(),r.Q6J("ngIf",o.student))},dependencies:[S.mk,S.sg,S.O5,F.r,Y.j,$.X,l.r,B.j,j._,g.t,G.O,J.JJ,J.On,m.yp,m.YG,m.Sm,m.PM,m.Zi,m.Dq,m.nz,m.wI,m.W2,m.jY,m.Gu,m.Ie,m.Q$,m.q_,m.nJ,m.Wo,m.Nd,m.t9,m.n0,m.wd,m.sr,m.w,m.QI,m.oU,V.o,u.X$],styles:["[_nghost-%COMP%]   .button-disabled[_ngcontent-%COMP%]{opacity:.4}[_nghost-%COMP%]   .addon-mod_lesson-highlight[_ngcontent-%COMP%]{--background: var(--primary-tint)}[_nghost-%COMP%]   .addon-mod_lesson-highlight[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-mod_lesson-highlight[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--primary-shade)}[_nghost-%COMP%]   .item-interactive-disabled[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{opacity:.5}[_nghost-%COMP%]   .addon-mod_lesson-answer-stats[_ngcontent-%COMP%]{margin-inline-end:4px}"]}),AddonModLessonUserRetakePage})();var z=n(33813),K=n(86700),W=n(21525),X=n(15945);const ee=[{path:":courseId/:cmId",component:p},{path:":courseId/:cmId/player",component:O,canDeactivate:[D.Y]},{path:":courseId/:cmId/user-retake/:userId",component:H}];let oe=(()=>{var e;class AddonModLessonLazyModule{}return(e=AddonModLessonLazyModule).ɵfac=function AddonModLessonLazyModule_Factory(o){return new(o||e)},e.ɵmod=r.oAB({type:e}),e.ɵinj=r.cJS({imports:[t.Bz.forChild(ee),i.L,f.I,a._]}),AddonModLessonLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&r.kYT(oe,{declarations:[p,O,H],imports:[t.Bz,i.L,f.I,a._]})),r.B6R(O,(function(){return[S.mk,S.sg,S.O5,S.PC,S.RF,S.n9,F.r,Y.j,z.L,K.I,l.r,W.y,g.t,G.O,J._Y,J.JJ,J.JL,J.nD,m.YG,m.Sm,m.PM,m.Zi,m.Dq,m.nz,m.wI,m.W2,m.jY,m.Gu,m.gu,m.pK,m.Ie,m.rH,m.Q$,m.q_,m.B7,m.se,m.Nd,m.t9,m.n0,m.wd,m.sr,m.w,m.U5,m.QI,m.j9,m.oU,J.sg,J.u,X.$]}),(function(){return[u.X$]}))}}]);