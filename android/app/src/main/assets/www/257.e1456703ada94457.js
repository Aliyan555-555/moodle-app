"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[257],{37966:(o,n,e)=>{e.r(n),e.d(n,{AddonModForumDiscussionLazyModule:()=>K});var t=e(67643),s=e(20982),i=e(84095),r=e(13386),d=e(49671),c=e(18005),a=e(25233),u=e(90030),l=e(61157),m=e(15761),_=e(14686),g=e(45151),f=e(31903),p=e(81370),I=e(43555),h=e(38049),P=e(53564),A=e(13010),y=e(75803),v=e(10727),D=e(49099),T=e(93988),x=e(98370),M=e(51512),S=e(48263),Z=e(45265),O=e(85277),F=e(60855),w=e(6172),b=e(43468),C=e(19212),N=e(30242);function AddonModForumDiscussionPage_h1_6_Template(o,n){if(1&o&&(C.TgZ(0,"h1"),C._UZ(1,"core-format-text",23),C.qZA()),2&o){const o=C.oxw();C.xp6(),C.Q6J("text",o.startingPost.subject)("contextInstanceId",o.cmId)("courseId",o.courseId)}}function AddonModForumDiscussionPage_core_context_menu_item_10_Template(o,n){if(1&o){const o=C.EpF();C.TgZ(0,"core-context-menu-item",24),C.NdJ("action",(function AddonModForumDiscussionPage_core_context_menu_item_10_Template_core_context_menu_item_action_0_listener(n){C.CHM(o);const e=C.oxw();return C.KtG(e.doRefresh(null,n))})),C.ALo(1,"translate"),C.qZA()}if(2&o){const o=C.oxw();C.Q6J("priority",650)("content",C.lcZ(1,4,"addon.mod_forum.refreshposts"))("iconAction",o.refreshIcon)("closeOnClick",!1)}}function AddonModForumDiscussionPage_core_context_menu_item_11_Template(o,n){if(1&o){const o=C.EpF();C.TgZ(0,"core-context-menu-item",24),C.NdJ("action",(function AddonModForumDiscussionPage_core_context_menu_item_11_Template_core_context_menu_item_action_0_listener(n){C.CHM(o);const e=C.oxw();return C.KtG(e.doRefresh(null,n,!0))})),C.ALo(1,"translate"),C.qZA()}if(2&o){const o=C.oxw();C.Q6J("priority",550)("content",C.lcZ(1,4,"core.settings.synchronizenow"))("iconAction",o.syncIcon)("closeOnClick",!1)}}const _c0=o=>({$a:o});function AddonModForumDiscussionPage_ion_card_37_Template(o,n){if(1&o&&(C.TgZ(0,"ion-card",25)(1,"ion-item"),C._UZ(2,"ion-icon",26),C.TgZ(3,"ion-label"),C._uU(4),C.ALo(5,"translate"),C.qZA()()()),2&o){const o=C.oxw();C.xp6(4),C.Oqu(C.xi3(5,1,"core.hasdatatosync",C.VKq(4,_c0,o.discussionStr)))}}function AddonModForumDiscussionPage_ion_card_38_Template(o,n){if(1&o&&(C.TgZ(0,"ion-card",27)(1,"ion-item"),C._UZ(2,"ion-icon",28),C.TgZ(3,"ion-label"),C._uU(4),C.qZA()()()),2&o){const o=C.oxw();C.xp6(4),C.Oqu(o.availabilityMessage)}}function AddonModForumDiscussionPage_ion_card_39_Template(o,n){1&o&&(C.TgZ(0,"ion-card",27)(1,"ion-item"),C._UZ(2,"ion-icon",29),C.TgZ(3,"ion-label"),C._uU(4),C.ALo(5,"translate"),C.qZA()()()),2&o&&(C.xp6(4),C.Oqu(C.lcZ(5,1,"addon.mod_forum.discussionlocked")))}function AddonModForumDiscussionPage_ion_card_40_Template(o,n){1&o&&(C.TgZ(0,"ion-card",27)(1,"ion-item"),C._UZ(2,"ion-icon",28),C.TgZ(3,"ion-label"),C._uU(4),C.ALo(5,"translate"),C.qZA()()()),2&o&&(C.xp6(4),C.Oqu(C.lcZ(5,1,"addon.mod_forum.qandanotify")))}function AddonModForumDiscussionPage_div_41_Template(o,n){if(1&o){const o=C.EpF();C.TgZ(0,"div",30)(1,"addon-mod-forum-post",31),C.NdJ("onPostChange",(function AddonModForumDiscussionPage_div_41_Template_addon_mod_forum_post_onPostChange_1_listener(){C.CHM(o);const n=C.oxw();return C.KtG(n.postListChanged())})),C.qZA()()}if(2&o){const o=C.oxw();C.xp6(),C.Q6J("post",o.startingPost)("discussion",o.discussion)("courseId",o.courseId)("highlight",!0)("discussionId",o.discussionId)("component",o.component)("componentId",o.cmId)("formData",o.formData)("originalData",o.originalData)("forum",o.forum)("accessInfo",o.accessInfo)("trackPosts",o.trackPosts)("ratingInfo",o.ratingInfo)("leavingPage",o.leavingPage)}}function AddonModForumDiscussionPage_ion_card_42_ng_container_1_core_spacer_1_Template(o,n){1&o&&C._UZ(0,"core-spacer")}function AddonModForumDiscussionPage_ion_card_42_ng_container_1_Template(o,n){if(1&o){const o=C.EpF();C.ynx(0),C.YNc(1,AddonModForumDiscussionPage_ion_card_42_ng_container_1_core_spacer_1_Template,1,0,"core-spacer",2),C.TgZ(2,"addon-mod-forum-post",33),C.NdJ("onPostChange",(function AddonModForumDiscussionPage_ion_card_42_ng_container_1_Template_addon_mod_forum_post_onPostChange_2_listener(){C.CHM(o);const n=C.oxw(2);return C.KtG(n.postListChanged())})),C.qZA(),C.BQk()}if(2&o){const o=n.$implicit,e=n.first,t=C.oxw(2);C.xp6(),C.Q6J("ngIf",!e),C.xp6(),C.Q6J("post",o)("courseId",t.courseId)("discussionId",t.discussionId)("component",t.component)("componentId",t.cmId)("formData",t.formData)("originalData",t.originalData)("parentSubject",t.postSubjects[o.parentid])("forum",t.forum)("accessInfo",t.accessInfo)("trackPosts",t.trackPosts)("ratingInfo",t.ratingInfo)("leavingPage",t.leavingPage)}}function AddonModForumDiscussionPage_ion_card_42_Template(o,n){if(1&o&&(C.TgZ(0,"ion-card"),C.YNc(1,AddonModForumDiscussionPage_ion_card_42_ng_container_1_Template,3,14,"ng-container",32),C.qZA()),2&o){const o=C.oxw();C.xp6(),C.Q6J("ngForOf",o.posts)}}function AddonModForumDiscussionPage_ng_container_43_ng_container_1_ng_container_1_Template(o,n){1&o&&C.GkF(0)}const _c1=o=>({post:o});function AddonModForumDiscussionPage_ng_container_43_ng_container_1_Template(o,n){if(1&o&&(C.ynx(0),C.YNc(1,AddonModForumDiscussionPage_ng_container_43_ng_container_1_ng_container_1_Template,1,0,"ng-container",34),C.BQk()),2&o){const o=n.$implicit;C.oxw(2);const e=C.MAs(45);C.xp6(),C.Q6J("ngTemplateOutlet",e)("ngTemplateOutletContext",C.VKq(2,_c1,o))}}function AddonModForumDiscussionPage_ng_container_43_Template(o,n){if(1&o&&(C.ynx(0),C.YNc(1,AddonModForumDiscussionPage_ng_container_43_ng_container_1_Template,2,4,"ng-container",32),C.BQk()),2&o){const o=C.oxw();C.xp6(),C.Q6J("ngForOf",o.posts)}}function AddonModForumDiscussionPage_ng_template_44_div_2_ng_container_1_ng_container_1_Template(o,n){1&o&&C.GkF(0)}function AddonModForumDiscussionPage_ng_template_44_div_2_ng_container_1_Template(o,n){if(1&o&&(C.ynx(0),C.YNc(1,AddonModForumDiscussionPage_ng_template_44_div_2_ng_container_1_ng_container_1_Template,1,0,"ng-container",34),C.BQk()),2&o){const o=n.$implicit;C.oxw(3);const e=C.MAs(45);C.xp6(),C.Q6J("ngTemplateOutlet",e)("ngTemplateOutletContext",C.VKq(2,_c1,o))}}function AddonModForumDiscussionPage_ng_template_44_div_2_Template(o,n){if(1&o&&(C.TgZ(0,"div",36),C.YNc(1,AddonModForumDiscussionPage_ng_template_44_div_2_ng_container_1_Template,2,4,"ng-container",32),C.qZA()),2&o){const o=C.oxw().post;C.xp6(),C.Q6J("ngForOf",o.children)}}function AddonModForumDiscussionPage_ng_template_44_Template(o,n){if(1&o){const o=C.EpF();C.TgZ(0,"ion-card")(1,"addon-mod-forum-post",33),C.NdJ("onPostChange",(function AddonModForumDiscussionPage_ng_template_44_Template_addon_mod_forum_post_onPostChange_1_listener(){C.CHM(o);const n=C.oxw();return C.KtG(n.postListChanged())})),C.qZA()(),C.YNc(2,AddonModForumDiscussionPage_ng_template_44_div_2_Template,2,1,"div",35)}if(2&o){const o=n.post,e=C.oxw();C.xp6(),C.Q6J("post",o)("courseId",e.courseId)("discussionId",e.discussionId)("component",e.component)("componentId",e.cmId)("formData",e.formData)("originalData",e.originalData)("parentSubject",e.postSubjects[o.parentid])("forum",e.forum)("accessInfo",e.accessInfo)("trackPosts",e.trackPosts)("ratingInfo",e.ratingInfo)("leavingPage",e.leavingPage),C.xp6(),C.Q6J("ngIf",o.children&&o.children.length&&o.children[0].subject)}}let R=(()=>{var o;class AddonModForumDiscussionPage{constructor(o,n,e){this.splitView=o,this.elementRef=n,this.route=e,this.forum={},this.accessInfo={},this.posts=[],this.discussionLoaded=!1,this.sort="nested",this.formData={replyingTo:0,isEditing:!1,subject:"",message:null,files:[],isprivatereply:!1},this.originalData={subject:null,message:null,files:[],isprivatereply:!1},this.refreshIcon=c.i.ICON_LOADING,this.syncIcon=c.i.ICON_LOADING,this.discussionStr="",this.component=Z.x.COMPONENT,this.canPin=!1,this.availabilityMessage=null,this.showQAMessage=!1,this.leavingPage=!1,this.hasOfflineRatings=!1}get isMobile(){return h.X4.isMobile}ngOnInit(){var o=this;return(0,d.Z)((function*(){try{var n;const t=o.route.snapshot.data;var e;if(o.courseId=I.b.getRouteNumberParam("courseId"),o.cmId=I.b.getRouteNumberParam("cmId"),o.forumId=I.b.getRouteNumberParam("forumId"),o.discussion=I.b.getRouteParam("discussion"),o.discussionId=o.discussion?o.discussion.discussion:I.b.getRequiredRouteNumberParam("discussionId"),o.trackPosts=I.b.getRouteBooleanParam("trackPosts")||!1,o.postId=I.b.getRouteNumberParam("postId"),o.parent=I.b.getRouteNumberParam("parent"),o.courseId&&o.cmId&&(null===(n=t.swipeEnabled)||void 0===n||n))o.discussions=new AddonModForumDiscussionDiscussionsSwipeManager(a.p.getOrCreateSource(M.B,[o.courseId,o.cmId,null!==(e=t.discussionsPathPrefix)&&void 0!==e?e:""])),yield o.discussions.start()}catch(n){return A.OQ.showErrorModal(n),o.goBack(),void 0}const t=P.m9.getCurrentSite();o.isOnline=p.AS.isOnline(),o.externalUrl=t&&t.shouldDisplayInformativeLinks()?t.createSiteUrl("/mod/forum/discuss.php",{d:o.discussionId.toString()}):void 0,o.onlineObserver=p.AS.onChange().subscribe((()=>{v.R0.run((()=>{o.isOnline=p.AS.isOnline()}))})),o.discussionStr=v.vN.instant("addon.mod_forum.discussion")}))()}ngAfterViewInit(){var o=this;return(0,d.Z)((function*(){o.sort=o.parent?"nested":yield o.getUserSort(),yield o.fetchPosts(!0,!1,!0);const n=o.postId||o.parent;n&&T.V.scrollToElement(o.elementRef.nativeElement,"#addon-mod_forum-post-"+n)}))()}ionViewDidEnter(){var o=this;return(0,d.Z)((function*(){if(o.syncObserver)return;o.discussion||(yield o.loadDiscussion(o.discussionId,o.forumId,o.cmId));const n=o.discussion;o.syncObserver=x.R.on(w.j.AUTO_SYNCED,(n=>{n.forumId==o.forumId&&o.discussionId==n.discussionId&&n.userId==P.m9.getCurrentSiteUserId()&&(o.discussionLoaded=!1,o.refreshPosts())}),P.m9.getCurrentSiteId()),o.syncManualObserver=x.R.on(w.j.MANUAL_SYNCED,(n=>{"discussion"!=n.source&&n.forumId==o.forumId&&n.userId==P.m9.getCurrentSiteUserId()&&(o.discussionLoaded=!1,o.refreshPosts())}),P.m9.getCurrentSiteId()),o.forumId&&n&&n.numunread>0&&Z.R.invalidateDiscussionsList(o.forumId),o.ratingOfflineObserver=x.R.on(l.K.RATING_SAVED_EVENT,(n=>{"mod_forum"==n.component&&"post"==n.ratingArea&&"module"==n.contextLevel&&n.instanceId==o.cmId&&n.itemSetId==o.discussionId&&(o.hasOfflineRatings=!0)})),o.ratingSyncObserver=x.R.on(_.L.SYNCED_EVENT,function(){var n=(0,d.Z)((function*(n){"mod_forum"==n.component&&"post"==n.ratingArea&&"module"==n.contextLevel&&n.instanceId==o.cmId&&n.itemSetId==o.discussionId&&(o.hasOfflineRatings=!1)}));return function(o){return n.apply(this,arguments)}}()),o.changeDiscObserver=x.R.on(Z.x.CHANGE_DISCUSSION_EVENT,(e=>{n&&o.forumId&&(o.forumId===e.forumId||e.cmId===o.cmId)&&Z.R.invalidateDiscussionsList(o.forumId).finally((()=>{var t;(void 0!==e.locked&&(n.locked=e.locked),void 0!==e.pinned&&(n.pinned=e.pinned),void 0!==e.starred&&(n.starred=e.starred),void 0!==e.deleted&&e.deleted)&&(null!==(t=e.post)&&void 0!==t&&t.parentid?(o.discussionLoaded=!1,o.refreshPosts()):o.goBack())}))}))}))()}canLeave(){var o=this;return(0,d.Z)((function*(){return O.P.hasPostDataChanged(o.formData,o.originalData)&&(yield A.OQ.showConfirm(v.vN.instant("core.confirmcanceledit"))),u.b.clearTmpFiles(o.formData.files),o.leavingPage=!0,!0}))()}goBack(){var o;this.leavingPage||(null!==(o=this.splitView)&&void 0!==o&&o.outletActivated?I.b.navigate("../"):I.b.back())}ionViewWillLeave(){this.syncObserver&&this.syncObserver.off(),this.syncManualObserver&&this.syncManualObserver.off(),this.ratingOfflineObserver&&this.ratingOfflineObserver.off(),this.ratingSyncObserver&&this.ratingSyncObserver.off(),this.changeDiscObserver&&this.changeDiscObserver.off(),delete this.syncObserver}ngOnDestroy(){this.onlineObserver&&this.onlineObserver.unsubscribe(),this.discussions&&this.discussions.destroy()}getUserSort(){return(0,d.Z)((function*(){try{return yield P.m9.getRequiredCurrentSite().getLocalSiteConfig("AddonModForumDiscussionSort")}catch(o){try{const o=yield g.My.getUserPreference("forum_displaymode");switch(Number(o)){case 1:return"flat-oldest";case-1:return"flat-newest";case 3:return"nested"}}catch{}}return"flat-oldest"}))()}fetchForum(){if(this.courseId&&this.cmId)return Z.R.getForum(this.courseId,this.cmId);if(this.courseId&&this.forumId)return Z.R.getForumById(this.courseId,this.forumId);throw new Error("Cannot get the forum")}fetchPosts(o,n,e){var t=this;return(0,d.Z)((function*(){let s=[];const i=[];let r=!1;try{o&&(yield y.Tr.ignoreErrors(t.syncDiscussion(!!n)));const e=yield Z.R.getDiscussionPosts(t.discussionId,{cmId:t.cmId}),c=yield F.B.getDiscussionReplies(t.discussionId);t.ratingInfo=e.ratinginfo,s=e.posts,t.courseId=e.courseid||t.courseId,t.forumId=e.forumid||t.forumId,t.postHasOffline=!!c.length;const a=[],u={};s.forEach((o=>{u[o.id]=o,r=r||!!o.unread})),c.forEach((o=>{t.forumId||(t.forumId=o.forumid),t.courseId||(t.courseId=o.courseid),a.push(O.P.instance.convertOfflineReplyToOnline(o).then(function(){var o=(0,d.Z)((function*(o){i.push(o),o.parentid&&(u[o.parentid].capabilities.reply=!1)}));return function(n){return o.apply(this,arguments)}}()))})),yield Promise.all(a),s=y.Tr.objectToArray(u);let l=i.concat(s);if(t.startingPost=Z.R.extractStartingPost(l),"nested"==t.sort){Z.R.sortDiscussionPosts(l,"ASC");l=y.Tr.formatTree(l,"parentid","id",t.startingPost?t.startingPost.id:t.discussion?t.discussion.id:0)}else{Z.R.sortDiscussionPosts(l,"flat-newest"==t.sort?"DESC":"ASC")}try{const o=yield t.fetchForum();void 0!==o.istracked&&(t.trackPosts=o.istracked),t.forumId=o.id,t.cmId=o.cmid,t.courseId=o.course,t.forum=o,t.availabilityMessage=O.P.getAvailabilityMessage(o);const n=[];n.push(Z.R.instance.getAccessInformation(t.forumId,{cmId:t.cmId}).then(function(){var n=(0,d.Z)((function*(n){t.accessInfo=n,O.P.isCutoffDateReached(o)&&!n.cancanoverridecutoff&&l.forEach((o=>{o.capabilities.reply=!1}));const e=P.m9.getCurrentSiteUserId();t.showQAMessage="qanda"===o.type&&!n.canviewqandawithoutposting&&!l.some((o=>o.author.id===e))}));return function(o){return n.apply(this,arguments)}}())),t.discussion||n.push(t.loadDiscussion(t.discussionId,t.forumId,t.cmId)),yield Promise.all(n)}catch{}if(!t.discussion&&!t.startingPost)throw new Error("Invalid forum discussion.");if(t.startingPost&&t.startingPost.author&&"single"==t.forum.type&&(delete t.startingPost.author.fullname,delete t.startingPost.author.groups),t.posts=l,t.postSubjects=t.getAllPosts().reduce(((o,n)=>(o[n.id]=n.subject,o)),t.startingPost?{[t.startingPost.id]:t.startingPost.subject}:{}),Z.R.isSetPinStateAvailableForSite()&&t.forumId)try{const o=yield Z.R.canAddDiscussionToAll(t.forumId,{cmId:t.cmId});t.canPin=!!o.canpindiscussions}catch(o){t.canPin=!1}else t.canPin=!1;t.hasOfflineRatings=yield m.E.hasRatings("mod_forum","post","module",t.cmId,t.discussionId)}catch(o){A.OQ.showErrorModal(o)}finally{t.discussionLoaded=!0,t.refreshIcon=c.i.ICON_REFRESH,t.syncIcon=c.i.ICON_SYNC,(e||r&&t.trackPosts)&&t.logDiscussionView(e)}}))()}loadDiscussion(o,n,e){var t=this;return(0,d.Z)((function*(){!t.discussion&&n&&e&&(t.discussion=yield O.P.getDiscussionById(n,e,o),t.discussionId=t.discussion.discussion)}))()}syncDiscussion(o){var n=this;return(0,d.Z)((function*(){const e=[];e.push(w.y.instance.syncDiscussionReplies(n.discussionId).then((o=>{o.warnings&&o.warnings.length&&A.OQ.showAlert(void 0,o.warnings[0]),o&&o.updated&&n.forumId&&x.R.trigger(w.j.MANUAL_SYNCED,{forumId:n.forumId,userId:P.m9.getCurrentSiteUserId(),source:"discussion"},P.m9.getCurrentSiteId())}))),e.push(w.y.instance.syncRatings(n.cmId,n.discussionId).then((o=>{o.warnings&&o.warnings.length&&A.OQ.showAlert(void 0,o.warnings[0])})));try{yield Promise.all(e)}catch(n){throw o&&A.OQ.showErrorModalDefault(n,"core.errorsync",!0),new Error("Failed syncing discussion")}}))()}doRefresh(o,n,e=!1){var t=this;return(0,d.Z)((function*(){t.discussionLoaded&&(yield t.refreshPosts(!0,e).finally((()=>{null==o||o.complete(),n&&n()})))}))()}refreshPosts(o,n){var e=this;return(0,d.Z)((function*(){e.content.scrollToTop(),e.refreshIcon=c.i.ICON_LOADING,e.syncIcon=c.i.ICON_LOADING;const t=[];e.courseId&&t.push(Z.R.invalidateForumData(e.courseId)),t.push(Z.R.invalidateDiscussionPosts(e.discussionId,e.forumId)),e.forumId&&t.push(Z.R.invalidateAccessInformation(e.forumId)),e.forumId&&t.push(Z.R.invalidateCanAddDiscussion(e.forumId)),yield y.Tr.ignoreErrors(y.Tr.allPromises(t)),yield e.fetchPosts(o,n)}))()}changeSort(o){return this.discussionLoaded=!1,this.sort=o,P.m9.getRequiredCurrentSite().setLocalSiteConfig("AddonModForumDiscussionSort",this.sort),this.content.scrollToTop(),this.fetchPosts()}setLockState(o){var n=this;return(0,d.Z)((function*(){if(!n.discussion||!n.forumId||!n.cmId)return;const e=yield A.OQ.showModalLoading("core.sending",!0);try{const e=yield Z.R.setLockState(n.forumId,n.discussionId,o);n.discussion.locked=e.locked;x.R.trigger(Z.x.CHANGE_DISCUSSION_EVENT,{forumId:n.forumId,discussionId:n.discussionId,cmId:n.cmId,locked:n.discussion.locked},P.m9.getCurrentSiteId()),A.OQ.showToast("addon.mod_forum.lockupdated",!0)}catch(o){A.OQ.showErrorModal(o)}finally{e.dismiss()}}))()}setPinState(o){var n=this;return(0,d.Z)((function*(){if(!n.discussion||!n.forumId||!n.cmId)return;const e=yield A.OQ.showModalLoading("core.sending",!0);try{yield Z.R.setPinState(n.discussionId,o),n.discussion.pinned=o;x.R.trigger(Z.x.CHANGE_DISCUSSION_EVENT,{forumId:n.forumId,discussionId:n.discussionId,cmId:n.cmId,pinned:n.discussion.pinned},P.m9.getCurrentSiteId()),A.OQ.showToast("addon.mod_forum.pinupdated",!0)}catch(o){A.OQ.showErrorModal(o)}finally{e.dismiss()}}))()}toggleFavouriteState(o){var n=this;return(0,d.Z)((function*(){if(!n.discussion||!n.forumId||!n.cmId)return;const e=yield A.OQ.showModalLoading("core.sending",!0);try{yield Z.R.toggleFavouriteState(n.discussionId,o),n.discussion.starred=o;x.R.trigger(Z.x.CHANGE_DISCUSSION_EVENT,{forumId:n.forumId,discussionId:n.discussionId,cmId:n.cmId,starred:n.discussion.starred},P.m9.getCurrentSiteId()),A.OQ.showToast("addon.mod_forum.favouriteupdated",!0)}catch(o){A.OQ.showErrorModal(o)}finally{e.dismiss()}}))()}postListChanged(){if(!this.forumId||!this.cmId)return;x.R.trigger(Z.x.REPLY_DISCUSSION_EVENT,{forumId:this.forumId,discussionId:this.discussionId,cmId:this.cmId},P.m9.getCurrentSiteId()),this.discussionLoaded=!1,this.refreshPosts().finally((()=>{this.discussionLoaded=!0}))}getAllPosts(){const o=this.posts.map((o=>this.flattenPostHierarchy(o)));return D.F.flatten(o)}flattenPostHierarchy(o){const n=[o],e=o.children||[];for(const o of e)n.push(...this.flattenPostHierarchy(o));return n}logDiscussionView(o=!1){var n=this;return(0,d.Z)((function*(){var e,t,s;(yield y.Tr.ignoreErrors(Z.R.logDiscussionView(n.discussionId,n.forumId||-1)),o)&&b.ke.logEvent({type:b.gM.VIEW_ITEM,ws:"mod_forum_view_forum_discussion",name:null!==(e=null!==(t=null===(s=n.startingPost)||void 0===s?void 0:s.subject)&&void 0!==t?t:n.forum.name)&&void 0!==e?e:"",data:{id:n.discussionId,forumid:n.forumId,category:"forum"},url:`/mod/forum/discuss.php?d=${n.discussionId}`+(n.postId?`#p${n.postId}`:"")});n.courseId&&n.cmId&&x.R.trigger(Z.x.MARK_READ_EVENT,{courseId:n.courseId,moduleId:n.cmId},P.m9.getCurrentSiteId())}))()}}return(o=AddonModForumDiscussionPage).ɵfac=function AddonModForumDiscussionPage_Factory(n){return new(n||o)(C.Y36(N.A,8),C.Y36(C.SBq),C.Y36(t.gz))},o.ɵcmp=C.Xpm({type:o,selectors:[["page-addon-mod-forum-discussion"]],viewQuery:function AddonModForumDiscussionPage_Query(o,n){if(1&o&&C.Gf(f.W2,5),2&o){let o;C.iGM(o=C.CRH())&&(n.content=o.first)}},decls:46,vars:73,consts:[["slot","start"],[3,"text"],[4,"ngIf"],["slot","end"],[3,"priority","content","iconAction","closeOnClick","action",4,"ngIf"],["iconAction","fas-arrow-down",3,"hidden","priority","content","action"],["iconAction","fas-arrow-up",3,"hidden","priority","content","action"],["iconAction","fas-right-left",3,"hidden","priority","content","action"],["iconAction","fas-lock",3,"hidden","priority","content","action"],["iconAction","fas-unlock",3,"hidden","priority","content","action"],["iconAction","fas-map-pin",3,"hidden","priority","content","action"],["iconAction","fas-map-pin",3,"hidden","priority","content","iconSlash","action"],["iconAction","fas-star",3,"hidden","priority","content","action"],["iconAction","fas-star",3,"hidden","priority","content","iconSlash","action"],["iconAction","fas-up-right-from-square",3,"hidden","priority","content","href","showBrowserWarning"],[1,"limited-width",3,"core-swipe-navigation"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],["class","core-warning-card",4,"ngIf"],["class","core-info-card",4,"ngIf"],["class","ion-margin-bottom",4,"ngIf"],["nestedPosts",""],["contextLevel","module",3,"text","contextInstanceId","courseId"],[3,"priority","content","iconAction","closeOnClick","action"],[1,"core-warning-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],[1,"core-info-card"],["name","fas-circle-info","slot","start","aria-hidden","true"],["name","fas-lock","slot","start","aria-hidden","true"],[1,"ion-margin-bottom"],[3,"post","discussion","courseId","highlight","discussionId","component","componentId","formData","originalData","forum","accessInfo","trackPosts","ratingInfo","leavingPage","onPostChange"],[4,"ngFor","ngForOf"],[3,"post","courseId","discussionId","component","componentId","formData","originalData","parentSubject","forum","accessInfo","trackPosts","ratingInfo","leavingPage","onPostChange"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["class","ion-padding-start",4,"ngIf"],[1,"ion-padding-start"]],template:function AddonModForumDiscussionPage_Template(o,n){1&o&&(C.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),C._UZ(3,"ion-back-button",1),C.ALo(4,"translate"),C.qZA(),C.TgZ(5,"ion-title"),C.YNc(6,AddonModForumDiscussionPage_h1_6_Template,2,3,"h1",2),C.qZA(),C._UZ(7,"ion-buttons",3),C.qZA()(),C.TgZ(8,"core-navbar-buttons",3)(9,"core-context-menu"),C.YNc(10,AddonModForumDiscussionPage_core_context_menu_item_10_Template,2,6,"core-context-menu-item",4)(11,AddonModForumDiscussionPage_core_context_menu_item_11_Template,2,6,"core-context-menu-item",4),C.TgZ(12,"core-context-menu-item",5),C.NdJ("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_12_listener(){return n.changeSort("flat-oldest")})),C.ALo(13,"translate"),C.qZA(),C.TgZ(14,"core-context-menu-item",6),C.NdJ("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_14_listener(){return n.changeSort("flat-newest")})),C.ALo(15,"translate"),C.qZA(),C.TgZ(16,"core-context-menu-item",7),C.NdJ("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_16_listener(){return n.changeSort("nested")})),C.ALo(17,"translate"),C.qZA(),C.TgZ(18,"core-context-menu-item",8),C.NdJ("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_18_listener(){return n.setLockState(!0)})),C.ALo(19,"translate"),C.qZA(),C.TgZ(20,"core-context-menu-item",9),C.NdJ("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_20_listener(){return n.setLockState(!1)})),C.ALo(21,"translate"),C.qZA(),C.TgZ(22,"core-context-menu-item",10),C.NdJ("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_22_listener(){return n.setPinState(!0)})),C.ALo(23,"translate"),C.qZA(),C.TgZ(24,"core-context-menu-item",11),C.NdJ("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_24_listener(){return n.setPinState(!1)})),C.ALo(25,"translate"),C.qZA(),C.TgZ(26,"core-context-menu-item",12),C.NdJ("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_26_listener(){return n.toggleFavouriteState(!0)})),C.ALo(27,"translate"),C.qZA(),C.TgZ(28,"core-context-menu-item",13),C.NdJ("action",(function AddonModForumDiscussionPage_Template_core_context_menu_item_action_28_listener(){return n.toggleFavouriteState(!1)})),C.ALo(29,"translate"),C.qZA(),C._UZ(30,"core-context-menu-item",14),C.ALo(31,"translate"),C.qZA()(),C.TgZ(32,"ion-content",15)(33,"ion-refresher",16),C.NdJ("ionRefresh",(function AddonModForumDiscussionPage_Template_ion_refresher_ionRefresh_33_listener(o){return n.doRefresh(o.target)})),C._UZ(34,"ion-refresher-content",17),C.ALo(35,"translate"),C.qZA(),C.TgZ(36,"core-loading",18),C.YNc(37,AddonModForumDiscussionPage_ion_card_37_Template,6,6,"ion-card",19)(38,AddonModForumDiscussionPage_ion_card_38_Template,5,1,"ion-card",20)(39,AddonModForumDiscussionPage_ion_card_39_Template,6,3,"ion-card",20)(40,AddonModForumDiscussionPage_ion_card_40_Template,6,3,"ion-card",20)(41,AddonModForumDiscussionPage_div_41_Template,2,14,"div",21)(42,AddonModForumDiscussionPage_ion_card_42_Template,2,1,"ion-card",2)(43,AddonModForumDiscussionPage_ng_container_43_Template,2,1,"ng-container",2)(44,AddonModForumDiscussionPage_ng_template_44_Template,3,14,"ng-template",null,22,C.W1O),C.qZA()()),2&o&&(C.xp6(3),C.Q6J("text",C.lcZ(4,49,"core.back")),C.xp6(3),C.Q6J("ngIf",n.startingPost),C.xp6(4),C.Q6J("ngIf",n.discussionLoaded&&!n.postHasOffline&&n.isOnline),C.xp6(),C.Q6J("ngIf",n.discussionLoaded&&n.isMobile&&n.postHasOffline&&n.isOnline),C.xp6(),C.Q6J("hidden","flat-oldest"===n.sort)("priority",500)("content",C.lcZ(13,51,"addon.mod_forum.modeflatoldestfirst")),C.xp6(2),C.Q6J("hidden","flat-newest"===n.sort)("priority",450)("content",C.lcZ(15,53,"addon.mod_forum.modeflatnewestfirst")),C.xp6(2),C.Q6J("hidden","nested"===n.sort)("priority",400)("content",C.lcZ(17,55,"addon.mod_forum.modenested")),C.xp6(2),C.Q6J("hidden",!n.discussion||!n.discussion.canlock||n.discussion.locked)("priority",300)("content",C.lcZ(19,57,"addon.mod_forum.lockdiscussion")),C.xp6(2),C.Q6J("hidden",!n.discussion||!n.discussion.canlock||!n.discussion.locked)("priority",300)("content",C.lcZ(21,59,"addon.mod_forum.unlockdiscussion")),C.xp6(2),C.Q6J("hidden",!n.discussion||!n.canPin||n.discussion.pinned)("priority",250)("content",C.lcZ(23,61,"addon.mod_forum.pindiscussion")),C.xp6(2),C.Q6J("hidden",!n.discussion||!n.canPin||!n.discussion.pinned)("priority",250)("content",C.lcZ(25,63,"addon.mod_forum.unpindiscussion"))("iconSlash",!0),C.xp6(2),C.Q6J("hidden",!n.discussion||!n.discussion.canfavourite||n.discussion.starred)("priority",200)("content",C.lcZ(27,65,"addon.mod_forum.addtofavourites")),C.xp6(2),C.Q6J("hidden",!n.discussion||!n.discussion.canfavourite||!n.discussion.starred)("priority",200)("content",C.lcZ(29,67,"addon.mod_forum.removefromfavourites"))("iconSlash",!0),C.xp6(2),C.Q6J("hidden",!n.externalUrl)("priority",100)("content",C.lcZ(31,69,"core.openinbrowser"))("href",n.externalUrl)("showBrowserWarning",!1),C.xp6(2),C.Q6J("core-swipe-navigation",n.discussions),C.xp6(),C.Q6J("disabled",!n.discussionLoaded),C.xp6(),C.s9C("pullingText",C.lcZ(35,71,"core.pulltorefresh")),C.xp6(2),C.Q6J("hideUntil",n.discussionLoaded),C.xp6(),C.Q6J("ngIf",n.postHasOffline||n.hasOfflineRatings),C.xp6(),C.Q6J("ngIf",n.availabilityMessage),C.xp6(),C.Q6J("ngIf",n.discussion&&n.discussion.locked),C.xp6(),C.Q6J("ngIf",n.showQAMessage),C.xp6(),C.Q6J("ngIf",n.startingPost),C.xp6(),C.Q6J("ngIf","nested"!==n.sort&&n.posts.length),C.xp6(),C.Q6J("ngIf","nested"===n.sort&&n.posts.length))},styles:["[_nghost-%COMP%]   .addon-forum-reply-button[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{margin:0}"]}),AddonModForumDiscussionPage})();class AddonModForumDiscussionDiscussionsSwipeManager extends S.n{getSelectedItemPathFromRoute(o){const n=o instanceof t.De?o:o.snapshot;return this.getSource().DISCUSSIONS_PATH_PREFIX+n.params.discussionId}}var L=e(96814),k=e(11771),Q=e(17418),E=e(66931),J=e(78308),q=e(76025),U=e(86700),B=e(8947),V=e(5065),Y=e(29657),j=e(57613),G=e(89515);const H=[{path:"",component:R,canDeactivate:[i.Y]}];let K=(()=>{var o;class AddonModForumDiscussionLazyModule{}return(o=AddonModForumDiscussionLazyModule).ɵfac=function AddonModForumDiscussionLazyModule_Factory(n){return new(n||o)},o.ɵmod=C.oAB({type:o}),o.ɵinj=C.cJS({imports:[t.Bz.forChild(H),r.L,s.Q]}),AddonModForumDiscussionLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&C.kYT(K,{declarations:[R],imports:[t.Bz,r.L,s.Q]})),C.B6R(R,(function(){return[L.sg,L.O5,L.tP,k.P,Q.l,E.r,J.J,q.w,U.I,B.r,V.g,Y.t,f.Sm,f.PM,f.W2,f.Gu,f.gu,f.Ie,f.Q$,f.nJ,f.Wo,f.wd,f.sr,f.oU,j.J]}),(function(){return[G.X$]}))},71460:(o,n,e)=>{e.d(n,{t:()=>CoreSwipeNavigationItemsManager});var t=e(49671),s=e(67643),i=e(43555),r=e(22594);class CoreSwipeNavigationItemsManager extends r.A{start(){var o=this;return(0,t.Z)((function*(){o.updateSelectedItem()}))()}navigateToNextItem(){var o=this;return(0,t.Z)((function*(){yield o.navigateToItemBy(1,"forward")}))()}navigateToPreviousItem(){var o=this;return(0,t.Z)((function*(){yield o.navigateToItemBy(-1,"back")}))()}hasNextItem(){var o=this;return(0,t.Z)((function*(){return!!(yield o.getItemBy(1))}))()}hasPreviousItem(){var o=this;return(0,t.Z)((function*(){return!!(yield o.getItemBy(-1))}))()}getCurrentPageRoute(){return i.b.getCurrentRoute()}getSelectedItemPathFromRoute(o){const n=[];for(;o;){if(n.push(...(o instanceof s.De?o:o.snapshot).url),!o.firstChild)break;o=o.firstChild}return n.map((o=>o.path)).join("/").replace(/\/+/,"/").trim()||null}navigateToItemBy(o,n){var e=this;return(0,t.Z)((function*(){const t=yield e.getItemBy(o);t&&(yield e.navigateToItem(t,{animationDirection:n,replace:!0}))}))()}getItemBy(o){var n=this;return(0,t.Z)((function*(){var e;const t=n.getSource().getItems(),s=null!==(e=n.selectedItem&&(null==t?void 0:t.indexOf(n.selectedItem)))&&void 0!==e?e:-1;if(-1===s||null===t)return null;const i=o>0?1:-1;let r=s,d=0;for(;d!==o;){if(r+=i,r<0)return null;if(r>=t.length)break;n.skipItemInSwipe(t[r])||(d+=i)}return d===o?t[r]:n.getSource().isCompleted()?null:(yield n.getSource().load(),n.getItemBy(o))}))()}skipItemInSwipe(o){return!1}}}}]);