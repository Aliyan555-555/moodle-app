"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2265],{72265:(e,o,t)=>{t.r(o),t.d(o,{AddonModImscpLazyModule:()=>F});var n=t(67643),r=t(13386),d=t(91984),i=t(98712),a=t(5401),c=t(19212),s=t(8947),l=t(60067),m=t(29657),u=t(31903),p=t(89515);let I=(()=>{var e;class AddonModImscpIndexPage extends i.S{}return(e=AddonModImscpIndexPage).ɵfac=(()=>{let o;return function AddonModImscpIndexPage_Factory(t){return(o||(o=c.n5z(e)))(t||e)}})(),e.ɵcmp=c.Xpm({type:e,selectors:[["page-addon-mod-imscp-index"]],viewQuery:function AddonModImscpIndexPage_Query(e,o){if(1&e&&c.Gf(a.c,5),2&e){let e;c.iGM(e=c.CRH())&&(o.activityComponent=e.first)}},features:[c.qOj],decls:11,vars:8,consts:[["collapsible",""],["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],[1,"limited-width"],[3,"module","courseId","dataRetrieved"]],template:function AddonModImscpIndexPage_Template(e,o){1&e&&(c.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),c._UZ(3,"ion-back-button",2),c.ALo(4,"translate"),c.qZA(),c.TgZ(5,"ion-title")(6,"h1"),c._UZ(7,"core-format-text",3),c.qZA()(),c._UZ(8,"ion-buttons",4),c.qZA()(),c.TgZ(9,"ion-content",5)(10,"addon-mod-imscp-index",6),c.NdJ("dataRetrieved",(function AddonModImscpIndexPage_Template_addon_mod_imscp_index_dataRetrieved_10_listener(e){return o.updateData(e)})),c.qZA()()),2&e&&(c.xp6(3),c.Q6J("text",c.lcZ(4,6,"core.back")),c.xp6(4),c.Q6J("text",o.title)("contextInstanceId",o.module.id)("courseId",o.courseId),c.xp6(3),c.Q6J("module",o.module)("courseId",o.courseId))},dependencies:[s.r,l.e,m.t,u.Sm,u.W2,u.Gu,u.wd,u.sr,u.oU,a.c,p.X$],encapsulation:2}),AddonModImscpIndexPage})();var f=t(49671),g=t(18005),_=t(31381),h=t(73180),w=t(9588),M=t(81370),v=t(43555),A=t(13010),x=t(34749),b=t(75803),Z=t(10727),y=t(83224),T=t(74904),P=t(96814),O=t(11294),H=t(66931),J=t(81863),Q=t(86700),L=t(19289),k=t(22068);function AddonModImscpViewPage_ion_button_9_Template(e,o){if(1&e){const e=c.EpF();c.TgZ(0,"ion-button",9),c.NdJ("click",(function AddonModImscpViewPage_ion_button_9_Template_ion_button_click_0_listener(){c.CHM(e);const o=c.oxw();return c.KtG(o.showToc())})),c.ALo(1,"translate"),c._UZ(2,"ion-icon",10),c.qZA()}2&e&&c.uIk("aria-label",c.lcZ(1,1,"addon.mod_imscp.toc"))}function AddonModImscpViewPage_ion_card_12_Template(e,o){if(1&e&&(c.TgZ(0,"ion-card",11)(1,"ion-item"),c._UZ(2,"ion-icon",12),c.TgZ(3,"ion-label"),c._UZ(4,"span",13),c.qZA()()()),2&e){const e=c.oxw();c.xp6(4),c.Q6J("innerHTML",e.warning,c.oJD)}}function AddonModImscpViewPage_core_iframe_13_Template(e,o){if(1&e&&c._UZ(0,"core-iframe",14),2&e){const e=c.oxw();c.Q6J("src",e.src)("showFullscreenOnToolbar",!0)("autoFullscreenOnRotate",!0)}}function AddonModImscpViewPage_core_navigation_bar_14_Template(e,o){if(1&e){const e=c.EpF();c.TgZ(0,"core-navigation-bar",15),c.NdJ("action",(function AddonModImscpViewPage_core_navigation_bar_14_Template_core_navigation_bar_action_0_listener(o){c.CHM(e);const t=c.oxw();return c.KtG(t.loadItem(o))})),c.qZA()}if(2&e){const e=c.oxw();c.Q6J("items",e.navigationItems)}}let V=(()=>{var e;class AddonModImscpViewPage{constructor(){this.title="",this.src="",this.warning="",this.navigationItems=[],this.loaded=!1,this.items=[]}ngOnInit(){try{this.cmId=v.b.getRequiredRouteNumberParam("cmId"),this.courseId=v.b.getRequiredRouteNumberParam("courseId"),this.initialItemHref=v.b.getRouteParam("initialHref")}catch(e){return A.OQ.showErrorModal(e),v.b.back(),void 0}this.fetchContent()}fetchContent(e=!1){var o=this;return(0,f.Z)((function*(){try{const{module:t,imscp:n}=yield o.loadImscpData();o.title=n.name;const r=yield o.downloadResourceIfNeeded(t,e),d=yield h.FO.getModuleContents(t,o.courseId);if(o.items=T.o.createItemList(d),o.items.length&&(o.initialItemHref&&o.items.some((e=>e.href===o.initialItemHref))&&(o.currentHref=o.initialItemHref),void 0===o.currentHref)){const e=yield T.o.getLastItemViewed(n.id);o.currentHref=void 0!==e?e:o.items[0].href}if(void 0===o.currentHref)throw new _.G("Empty TOC");try{yield o.loadItemHref(o.currentHref)}catch(e){return A.OQ.showErrorModalDefault(e,"addon.mod_imscp.deploymenterror",!0),void 0}if(null!=r&&r.failed){const e=x._1.getErrorMessageFromError(r.error)||r.error;o.warning=Z.vN.instant("core.errordownloadingsomefiles")+(e?" "+e:"")}else o.warning=""}catch(e){A.OQ.showErrorModalDefault(e,"core.course.errorgetmodule",!0)}finally{o.loaded=!0}}))()}loadImscpData(){var e=this;return(0,f.Z)((function*(){return e.module=yield h.FO.getModule(e.cmId,e.courseId),e.imscp=yield T.o.getImscp(e.courseId,e.cmId),{module:e.module,imscp:e.imscp}}))()}downloadResourceIfNeeded(e,o=!1){var t=this;return(0,f.Z)((function*(){var n;const r={failed:!1};let d=!1;if((yield w.e.getModuleStatus(e,t.courseId,void 0,o))!==g.i.DOWNLOADED)try{yield w.e.downloadModule(e,t.courseId),d=!0}catch(e){r.failed=!0,r.error=e}if(null===(n=e.contents)||void 0===n||!n.length||o&&!d){const t=o&&M.AS.isOnline();try{yield h.FO.loadModuleContents(e,void 0,void 0,!1,t)}catch(o){if(t&&!e.contents)yield h.FO.loadModuleContents(e);else if(!e.contents)throw o}}return r}))()}doRefresh(e){var o=this;return(0,f.Z)((function*(){yield b.Tr.ignoreErrors(Promise.all([T.o.invalidateContent(o.cmId,o.courseId),w.e.invalidateCourseUpdates(o.courseId)])),yield b.Tr.ignoreErrors(o.fetchContent(!0)),null==e||e.complete()}))()}loadItemHref(e){var o=this;return(0,f.Z)((function*(){if(!o.module)return;const t=yield T.o.getIframeSrc(o.module,e);o.currentHref=e,o.navigationItems=o.items.map((e=>({item:e,current:e.href==o.currentHref,enabled:!!e.href}))),o.src&&t==o.src?(o.src="",setTimeout((()=>{o.src=t}))):o.src=t,o.imscp&&T.o.storeLastItemViewed(o.imscp.id,e,o.courseId)}))()}loadItem(e){this.loadItemHref(e.href)}showToc(){var e=this;return(0,f.Z)((function*(){const o=yield A.OQ.openSideModal({component:y.l,componentProps:{items:e.items,selected:e.currentHref}});o&&e.loadItemHref(o)}))()}}return(e=AddonModImscpViewPage).ɵfac=function AddonModImscpViewPage_Factory(o){return new(o||e)},e.ɵcmp=c.Xpm({type:e,selectors:[["page-addon-mod-imscp-view"]],decls:15,vars:11,consts:[["slot","start"],[3,"text"],["contextLevel","module",3,"text","contextInstanceId","courseId"],["slot","end"],["aria-haspopup","true",3,"click",4,"ngIf"],[3,"hideUntil"],["class","core-warning-card",4,"ngIf"],[3,"src","showFullscreenOnToolbar","autoFullscreenOnRotate",4,"ngIf"],["collapsible-footer","","appearOnBottom","",3,"items","action",4,"ngIf"],["aria-haspopup","true",3,"click"],["name","fas-bookmark","slot","icon-only","aria-hidden","true"],[1,"core-warning-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],[3,"innerHTML"],[3,"src","showFullscreenOnToolbar","autoFullscreenOnRotate"],["collapsible-footer","","appearOnBottom","",3,"items","action"]],template:function AddonModImscpViewPage_Template(e,o){1&e&&(c.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),c._UZ(3,"ion-back-button",1),c.ALo(4,"translate"),c.qZA(),c.TgZ(5,"ion-title")(6,"h1"),c._UZ(7,"core-format-text",2),c.qZA()(),c.TgZ(8,"ion-buttons",3),c.YNc(9,AddonModImscpViewPage_ion_button_9_Template,3,3,"ion-button",4),c.qZA()()(),c.TgZ(10,"ion-content")(11,"core-loading",5),c.YNc(12,AddonModImscpViewPage_ion_card_12_Template,5,1,"ion-card",6)(13,AddonModImscpViewPage_core_iframe_13_Template,1,3,"core-iframe",7),c.qZA(),c.YNc(14,AddonModImscpViewPage_core_navigation_bar_14_Template,1,1,"core-navigation-bar",8),c.qZA()),2&e&&(c.xp6(3),c.Q6J("text",c.lcZ(4,9,"core.back")),c.xp6(4),c.Q6J("text",o.title)("contextInstanceId",o.cmId)("courseId",o.courseId),c.xp6(2),c.Q6J("ngIf",o.loaded),c.xp6(2),c.Q6J("hideUntil",o.loaded),c.xp6(),c.Q6J("ngIf",o.warning),c.xp6(),c.Q6J("ngIf",o.loaded),c.xp6(),c.Q6J("ngIf",o.loaded&&o.navigationItems.length>1))},dependencies:[P.O5,O.X,H.r,J.J,Q.I,s.r,L.u,m.t,k.O,u.YG,u.Sm,u.PM,u.W2,u.Gu,u.gu,u.Ie,u.Q$,u.wd,u.sr,u.oU,p.X$],encapsulation:2}),AddonModImscpViewPage})();const C=[{path:":courseId/:cmId",component:I},{path:":courseId/:cmId/view",component:V}];let F=(()=>{var e;class AddonModImscpLazyModule{}return(e=AddonModImscpLazyModule).ɵfac=function AddonModImscpLazyModule_Factory(o){return new(o||e)},e.ɵmod=c.oAB({type:e}),e.ɵinj=c.cJS({imports:[n.Bz.forChild(C),r.L,d.O]}),AddonModImscpLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&c.kYT(F,{declarations:[I,V],imports:[n.Bz,r.L,d.O]}))}}]);