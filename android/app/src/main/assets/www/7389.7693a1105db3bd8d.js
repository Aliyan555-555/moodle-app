"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7389],{77389:(e,r,o)=>{o.r(r),o.d(r,{AddonModForumSearchLazyModule:()=>J});var t=o(13386),a=o(49671),n=o(45265),s=o(90284),c=o(24885),d=o(73180),l=o(59614),u=o(24442),i=o(43468),_=o(43555),h=o(53564),m=o(13010),g=o(857),p=o(75803),f=o(10727),A=o(19212),S=o(96814),M=o(55126),x=o(52133),y=o(86700),F=o(8947),b=o(29657),T=o(31903),Z=o(93268),P=o(22116),v=o(89515);function AddonModForumSearchPage_h1_6_Template(e,r){if(1&e&&(A.TgZ(0,"h1"),A._uU(1),A.qZA()),2&e){const e=A.oxw();A.xp6(),A.Oqu(e.forum.name)}}function AddonModForumSearchPage_h1_7_Template(e,r){1&e&&(A.TgZ(0,"h1"),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(),A.Oqu(A.lcZ(2,1,"addon.block_searchforums.pluginname")))}function AddonModForumSearchPage_ion_card_10_Template(e,r){if(1&e&&(A.TgZ(0,"ion-card",8)(1,"ion-item",9),A._UZ(2,"ion-icon",10),A.TgZ(3,"ion-label"),A._UZ(4,"core-format-text",1),A.qZA()()()),2&e){const e=A.oxw();A.xp6(4),A.Q6J("text",e.searchBanner)}}function AddonModForumSearchPage_ion_list_14_core_search_global_search_result_1_Template(e,r){if(1&e){const e=A.EpF();A.TgZ(0,"core-search-global-search-result",12),A.NdJ("onClick",(function AddonModForumSearchPage_ion_list_14_core_search_global_search_result_1_Template_core_search_global_search_result_onClick_0_listener(){const r=A.CHM(e).$implicit,o=A.oxw(2);return A.KtG(o.visitResult(r))})),A.qZA()}if(2&e){A.Q6J("result",r.$implicit)("showCourse",!1)}}function AddonModForumSearchPage_ion_list_14_Template(e,r){if(1&e&&(A.TgZ(0,"ion-list"),A.YNc(1,AddonModForumSearchPage_ion_list_14_core_search_global_search_result_1_Template,1,2,"core-search-global-search-result",11),A.qZA()),2&e){const e=A.oxw();A.xp6(),A.Q6J("ngForOf",e.resultsSource.getItems())}}function AddonModForumSearchPage_core_empty_box_16_p_1_Template(e,r){1&e&&(A.TgZ(0,"p"),A._uU(1),A.ALo(2,"translate"),A.qZA()),2&e&&(A.xp6(),A.Oqu(A.lcZ(2,1,"core.search.empty")))}const _c0=e=>({$a:e});function AddonModForumSearchPage_core_empty_box_16_ng_container_2_Template(e,r){if(1&e&&(A.ynx(0),A.TgZ(1,"p")(2,"strong"),A._uU(3),A.ALo(4,"translate"),A.qZA()(),A.TgZ(5,"p")(6,"small"),A._uU(7),A.ALo(8,"translate"),A.qZA()(),A.BQk()),2&e){const e=A.oxw(2);A.xp6(3),A.Oqu(A.xi3(4,2,"core.search.noresults",A.VKq(7,_c0,e.resultsSource.getQuery()))),A.xp6(4),A.Oqu(A.lcZ(8,5,"core.search.noresultshelp"))}}function AddonModForumSearchPage_core_empty_box_16_Template(e,r){if(1&e&&(A.TgZ(0,"core-empty-box",13),A.YNc(1,AddonModForumSearchPage_core_empty_box_16_p_1_Template,3,3,"p",2)(2,AddonModForumSearchPage_core_empty_box_16_ng_container_2_Template,9,9,"ng-container",2),A.qZA()),2&e){const e=A.oxw();A.Q6J("dimmed",!e.resultsSource.isLoaded()),A.xp6(),A.Q6J("ngIf",!e.resultsSource.isLoaded()),A.xp6(),A.Q6J("ngIf",e.resultsSource.isLoaded())}}let I=(()=>{var e;class AddonModForumSearchPage{constructor(){this.loadMoreError=null,this.searchBanner=null,this.resultsSource=new l.Y("",{}),this.ready=new s.b}ngOnInit(){var e=this;return(0,a.Z)((function*(){try{var r,o,t;const a=h.m9.getRequiredCurrentSite(),s=null!==(r=null===(o=a.config)||void 0===o||null===(o=o.searchbanner)||void 0===o?void 0:o.trim())&&void 0!==r?r:"",c=_.b.getRequiredRouteNumberParam("courseId"),l=_.b.getRouteNumberParam("forumId"),u={courseIds:[c]};if(p.Tr.isTrueOrOne(null===(t=a.config)||void 0===t?void 0:t.searchbannerenable)&&s.length>0&&(e.searchBanner=s),l){e.forum=yield n.R.getForumById(c,l);const r=yield d.FO.getModule(e.forum.cmid,c);u.searchAreaIds=["mod_forum-post"],r.contextid&&(u.contextIds=[r.contextid]),e.searchAreaId=`AddonModForumSearch-${c}-${e.forum.id}`}else u.searchAreaIds=["mod_forum-activity","mod_forum-post"],e.searchAreaId=`AddonModForumSearch-${c}`;e.resultsSource.setFilters(u),e.ready.resolve()}catch(e){return m.OQ.showErrorModal(e),_.b.back(),void 0}}))()}search(e){var r=this;return(0,a.Z)((function*(){yield r.ready,r.resultsSource.setQuery(e),r.resultsSource.hasEmptyQuery()||(yield m.OQ.showOperationModals("core.searching",!0,(0,a.Z)((function*(){yield r.resultsSource.reload(),yield p.Tr.ignoreErrors(u.HA.logViewResults(r.resultsSource.getQuery(),r.resultsSource.getFilters())),i.ke.logEvent({type:i.gM.VIEW_ITEM_LIST,ws:"core_search_view_results",name:f.vN.instant("core.search.globalsearch"),data:{query:e,filters:JSON.stringify(r.resultsSource.getFilters())},url:g.T.addParamsToUrl("/search/index.php",{q:e})})}))))}))()}clearSearch(){this.loadMoreError=null,this.resultsSource.setQuery(""),this.resultsSource.reset()}visitResult(e){return(0,a.Z)((function*(){yield c.J.handleLink(e.url)}))()}loadMoreResults(e){var r=this;return(0,a.Z)((function*(){try{var o;yield null===(o=r.resultsSource)||void 0===o?void 0:o.load()}catch(e){r.loadMoreError=m.OQ.getErrorMessage(e)}finally{e()}}))()}}return(e=AddonModForumSearchPage).ɵfac=function AddonModForumSearchPage_Factory(r){return new(r||e)},e.ɵcmp=A.Xpm({type:e,selectors:[["page-addon-mod-forum-search"]],decls:17,vars:18,consts:[["slot","start"],[3,"text"],[4,"ngIf"],[1,"limited-width"],["class","core-danger-card",4,"ngIf"],[3,"placeholder","searchLabel","autoFocus","searchArea","onSubmit","onClear"],[3,"enabled","error","action"],["icon","fas-magnifying-glass",3,"dimmed",4,"ngIf"],[1,"core-danger-card"],[1,"ion-text-wrap"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],[3,"result","showCourse","onClick",4,"ngFor","ngForOf"],[3,"result","showCourse","onClick"],["icon","fas-magnifying-glass",3,"dimmed"]],template:function AddonModForumSearchPage_Template(e,r){1&e&&(A.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),A._UZ(3,"ion-back-button",1),A.ALo(4,"translate"),A.qZA(),A.TgZ(5,"ion-title"),A.YNc(6,AddonModForumSearchPage_h1_6_Template,2,1,"h1",2)(7,AddonModForumSearchPage_h1_7_Template,3,3,"h1",2),A.qZA()()(),A.TgZ(8,"ion-content",3)(9,"div"),A.YNc(10,AddonModForumSearchPage_ion_card_10_Template,5,1,"ion-card",4),A.TgZ(11,"core-search-box",5),A.NdJ("onSubmit",(function AddonModForumSearchPage_Template_core_search_box_onSubmit_11_listener(e){return r.search(e)}))("onClear",(function AddonModForumSearchPage_Template_core_search_box_onClear_11_listener(){return r.clearSearch()})),A.ALo(12,"translate"),A.ALo(13,"translate"),A.qZA(),A.YNc(14,AddonModForumSearchPage_ion_list_14_Template,2,1,"ion-list",2),A.TgZ(15,"core-infinite-loading",6),A.NdJ("action",(function AddonModForumSearchPage_Template_core_infinite_loading_action_15_listener(e){return r.loadMoreResults(e)})),A.qZA(),A.YNc(16,AddonModForumSearchPage_core_empty_box_16_Template,3,3,"core-empty-box",7),A.qZA()()),2&e&&(A.xp6(3),A.Q6J("text",A.lcZ(4,12,"core.back")),A.xp6(3),A.Q6J("ngIf",r.forum),A.xp6(),A.Q6J("ngIf",!r.forum),A.xp6(3),A.Q6J("ngIf",r.searchBanner),A.xp6(),A.Q6J("placeholder",A.lcZ(12,14,"core.search"))("searchLabel",A.lcZ(13,16,"core.search"))("autoFocus",!0)("searchArea",r.searchAreaId),A.xp6(3),A.Q6J("ngIf",r.resultsSource.isLoaded()),A.xp6(),A.Q6J("enabled",r.resultsSource.isLoaded()&&!r.resultsSource.isCompleted())("error",r.loadMoreError),A.xp6(),A.Q6J("ngIf",r.resultsSource.isEmpty()))},dependencies:[S.sg,S.O5,M.z,x.n,y.I,F.r,b.t,T.Sm,T.PM,T.W2,T.Gu,T.gu,T.Ie,T.Q$,T.q_,T.wd,T.sr,T.oU,Z.L,P.M,v.X$],styles:["[_nghost-%COMP%]{--results-count-text-color: var(--gray-700)}[_nghost-%COMP%]   .results-count[_ngcontent-%COMP%]{color:var(--results-count-text-color);min-height:0px;margin:8px 16px;font-size:14px}html.dark[_nghost-%COMP%], html.dark   [_nghost-%COMP%]{--results-count-text-color: var(--gray-400)}"]}),AddonModForumSearchPage})();var q=o(67643),w=o(56283),L=o(74744);const Q=[{path:"",component:I}];let J=(()=>{var e;class AddonModForumSearchLazyModule{}return(e=AddonModForumSearchLazyModule).ɵfac=function AddonModForumSearchLazyModule_Factory(r){return new(r||e)},e.ɵmod=A.oAB({type:e}),e.ɵinj=A.cJS({imports:[q.Bz.forChild(Q),t.L,L.w,w.g]}),AddonModForumSearchLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&A.kYT(J,{declarations:[I],imports:[q.Bz,t.L,L.w,w.g]}))}}]);