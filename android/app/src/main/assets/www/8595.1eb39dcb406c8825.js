"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8595],{8595:(e,t,n)=>{n.r(t),n.d(t,{AddonCalendarLazyModule:()=>Ze});var o=n(13386),a=n(43677),i=n(49671),r=n(81370),d=n(98370),l=n(53564),s=n(13010),c=n(52160),_=n(32477),u=n(2965),m=n(83),g=n(49471),p=n(92974),f=n(55467),v=n(8469),h=n(69930),A=n.n(h),E=n(10727),y=n(43555),C=n(75803),x=n(18005),I=n(20387),T=n(14881),Z=n(86318),b=n(25233),O=n(54129);class AddonCalendarEventsSource extends O.H{constructor(e){super(),this.events=[],this.DATE=e}setEvents(e){this.events=e}loadPageItems(){var e=this;return(0,i.Z)((function*(){return{items:e.events.slice(0)}}))()}getItemPath(e){return e.id.toString()}getItemQueryParams(){return{date:this.DATE}}}var P=n(43468),D=n(857),w=n(88817),N=n(19212),L=n(96814),q=n(11771),U=n(17418),Q=n(55126),S=n(66931),J=n(52028),k=n(73946),M=n(86700),R=n(8947),F=n(29657),V=n(22068),G=n(31903),Y=n(89515);function AddonCalendarDayPage_core_context_menu_item_14_Template(e,t){if(1&e){const e=N.EpF();N.TgZ(0,"core-context-menu-item",20),N.NdJ("action",(function AddonCalendarDayPage_core_context_menu_item_14_Template_core_context_menu_item_action_0_listener(){N.CHM(e);const t=N.oxw();return N.KtG(t.goToCurrentDay())})),N.ALo(1,"translate"),N.qZA()}2&e&&N.Q6J("priority",900)("content",N.lcZ(1,2,"addon.calendar.today"))}const _c0=e=>({$a:e});function AddonCalendarDayPage_ng_template_37_ion_card_1_Template(e,t){1&e&&(N.TgZ(0,"ion-card",24)(1,"ion-item"),N._UZ(2,"ion-icon",25),N.TgZ(3,"ion-label"),N._uU(4),N.ALo(5,"translate"),N.ALo(6,"translate"),N.qZA()()()),2&e&&(N.xp6(4),N.Oqu(N.xi3(5,1,"core.hasdatatosync",N.VKq(6,_c0,N.lcZ(6,4,"core.day")))))}function AddonCalendarDayPage_ng_template_37_core_empty_box_2_Template(e,t){1&e&&(N._UZ(0,"core-empty-box",26),N.ALo(1,"translate")),2&e&&N.Q6J("message",N.lcZ(1,1,"addon.calendar.noevents"))}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_core_mod_icon_3_Template(e,t){if(1&e&&N._UZ(0,"core-mod-icon",38),2&e){const e=N.oxw().$implicit;N.Q6J("modicon",e.moduleIcon)("showAlt",!1)("modname",e.modulename)("componentId",e.instance)("purpose",e.purpose)}}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_icon_4_Template(e,t){if(1&e&&N._UZ(0,"ion-icon",39),2&e){const e=N.oxw().$implicit;N.Q6J("name",e.eventIcon)}}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_span_9_Template(e,t){if(1&e&&(N.TgZ(0,"span",32),N._uU(1),N.qZA()),2&e){const e=N.oxw().$implicit;N.xp6(),N.Oqu(e.iconTitle)}}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_14_Template(e,t){1&e&&(N.TgZ(0,"ion-note",2),N._UZ(1,"ion-icon",40),N.TgZ(2,"span",41),N._uU(3),N.ALo(4,"translate"),N.qZA()()),2&e&&(N.xp6(3),N.Oqu(N.lcZ(4,1,"core.notsent")))}function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_15_Template(e,t){1&e&&(N.TgZ(0,"ion-note",2),N._UZ(1,"ion-icon",42),N.TgZ(2,"span",41),N._uU(3),N.ALo(4,"translate"),N.qZA()()),2&e&&(N.xp6(3),N.Oqu(N.lcZ(4,1,"core.deletedoffline")))}const _c1=e=>[e];function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_Template(e,t){if(1&e){const e=N.EpF();N.ynx(0),N.TgZ(1,"ion-card")(2,"ion-item",29),N.NdJ("click",(function AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_Template_ion_item_click_2_listener(){const t=N.CHM(e).$implicit,n=N.oxw(2).item,o=N.oxw();return N.KtG(o.gotoEvent(t.id,n))})),N.YNc(3,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_core_mod_icon_3_Template,1,5,"core-mod-icon",30)(4,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_icon_4_Template,1,1,"ion-icon",31),N.TgZ(5,"ion-label")(6,"span",32),N._uU(7),N.ALo(8,"translate"),N.YNc(9,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_span_9_Template,2,1,"span",33),N.qZA(),N.TgZ(10,"p",34),N._UZ(11,"core-format-text",35),N.qZA(),N.TgZ(12,"p"),N._UZ(13,"core-format-text",36),N.qZA()(),N.YNc(14,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_14_Template,5,3,"ion-note",37)(15,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_ion_note_15_Template,5,3,"ion-note",37),N.qZA()(),N.BQk()}if(2&e){const e=t.$implicit;N.xp6(2),N.ekj("item-dimmed",e.ispast),N.Q6J("ngClass",N.VKq(18,_c1,"addon-calendar-eventtype-"+e.eventtype))("detail",!1),N.uIk("aria-label",e.name),N.xp6(),N.Q6J("ngIf",e.moduleIcon),N.xp6(),N.Q6J("ngIf",e.eventIcon&&!e.moduleIcon),N.xp6(3),N.hij(" ",N.lcZ(8,16,"addon.calendar.type"+e.formattedType)," "),N.xp6(2),N.Q6J("ngIf",e.moduleIcon&&e.iconTitle),N.xp6(2),N.Q6J("text",e.name)("contextLevel",e.contextLevel)("contextInstanceId",e.contextInstanceId),N.xp6(2),N.Q6J("text",e.formattedtime)("filter",!1),N.xp6(),N.Q6J("ngIf",e.offline&&!e.deleted),N.xp6(),N.Q6J("ngIf",e.deleted)}}function AddonCalendarDayPage_ng_template_37_ion_list_3_Template(e,t){if(1&e&&(N.TgZ(0,"ion-list",27),N.YNc(1,AddonCalendarDayPage_ng_template_37_ion_list_3_ng_container_1_Template,16,20,"ng-container",28),N.qZA()),2&e){const e=N.oxw().item;N.xp6(),N.Q6J("ngForOf",e.filteredEvents)}}function AddonCalendarDayPage_ng_template_37_Template(e,t){if(1&e&&(N.TgZ(0,"core-loading",9),N.YNc(1,AddonCalendarDayPage_ng_template_37_ion_card_1_Template,7,8,"ion-card",21)(2,AddonCalendarDayPage_ng_template_37_core_empty_box_2_Template,2,3,"core-empty-box",22)(3,AddonCalendarDayPage_ng_template_37_ion_list_3_Template,2,1,"ion-list",23),N.qZA()),2&e){const e=t.item;N.Q6J("hideUntil",e.loaded),N.xp6(),N.Q6J("ngIf",e.hasOffline),N.xp6(),N.Q6J("ngIf",!e.filteredEvents||!e.filteredEvents.length),N.xp6(),N.Q6J("ngIf",e.filteredEvents&&e.filteredEvents.length)}}function AddonCalendarDayPage_ion_fab_38_Template(e,t){if(1&e){const e=N.EpF();N.TgZ(0,"ion-fab",43)(1,"ion-fab-button",44),N.NdJ("click",(function AddonCalendarDayPage_ion_fab_38_Template_ion_fab_button_click_1_listener(){N.CHM(e);const t=N.oxw();return N.KtG(t.openEdit())})),N.ALo(2,"translate"),N._UZ(3,"ion-icon",45),N.TgZ(4,"span",32),N._uU(5),N.ALo(6,"translate"),N.qZA()()()}2&e&&(N.xp6(),N.uIk("aria-label",N.lcZ(2,2,"addon.calendar.newevent")),N.xp6(4),N.Oqu(N.lcZ(6,4,"addon.calendar.newevent")))}let B=(()=>{var e;class AddonCalendarDayPage{constructor(){var e=this;this.eventObservers=[],this.loaded=!1,this.isOnline=!1,this.syncIcon=x.i.ICON_LOADING,this.filter={filtered:!1,courseId:void 0,categoryId:void 0,course:!0,group:!0,site:!0,user:!0,category:!0},this.currentSiteId=l.m9.getCurrentSiteId(),this.eventObservers.push(d.R.on(_.gi.NEW_EVENT_EVENT,(e=>{var t;e&&e.eventId&&(null===(t=this.manager)||void 0===t||t.getSource().markAllItemsUnloaded(),this.refreshData(!0,!0))}),this.currentSiteId)),this.eventObservers.push(d.R.on(_.gi.NEW_EVENT_DISCARDED_EVENT,(()=>{var e;null===(e=this.manager)||void 0===e||e.getSource().markAllItemsUnloaded(),this.refreshData(!0,!0)}),this.currentSiteId)),this.eventObservers.push(d.R.on(_.gi.EDIT_EVENT_EVENT,(e=>{var t;e&&e.eventId&&(null===(t=this.manager)||void 0===t||t.getSource().markAllItemsUnloaded(),this.refreshData(!0,!0))}),this.currentSiteId)),this.eventObservers.push(d.R.on(g.U.AUTO_SYNCED,(()=>{var e;null===(e=this.manager)||void 0===e||e.getSource().markAllItemsUnloaded(),this.refreshData(!1,!0)}),this.currentSiteId)),this.eventObservers.push(d.R.on(g.U.MANUAL_SYNCED,(e=>{var t;const n=null===(t=this.manager)||void 0===t?void 0:t.getSelectedItem();var o;!e||"day"==e.source&&n&&e.moment&&n.moment.isSame(e.moment,"day")||(null===(o=this.manager)||void 0===o||o.getSource().markAllItemsUnloaded(),this.refreshData(!1,!0))}),this.currentSiteId)),this.eventObservers.push(d.R.on(_.gi.DELETED_EVENT_EVENT,(e=>{var t,n;e&&!e.sent?null===(t=this.manager)||void 0===t||t.getSource().markAsDeleted(e.eventId,!0):(null===(n=this.manager)||void 0===n||n.getSource().markAllItemsUnloaded(),this.refreshData(!1,!0))}),this.currentSiteId)),this.eventObservers.push(d.R.on(_.gi.UNDELETED_EVENT_EVENT,(e=>{var t;e&&e.eventId&&(null===(t=this.manager)||void 0===t||t.getSource().markAsDeleted(e.eventId,!1))}),this.currentSiteId)),this.eventObservers.push(d.R.on(_.gi.FILTER_CHANGED_EVENT,function(){var t=(0,i.Z)((function*(t){var n,o;e.filter=t,yield null===(n=e.manager)||void 0===n?void 0:n.getSource().loadCanCreate(e.filter.courseId),null===(o=e.manager)||void 0===o||o.getSource().filterAllDayEvents(e.filter)}));return function(e){return t.apply(this,arguments)}}())),this.onlineObserver=r.AS.onChange().subscribe((()=>{E.R0.run((()=>{this.isOnline=r.AS.isOnline()}))})),this.logView=w.V.once((()=>{var e;const t=null===(e=this.manager)||void 0===e?void 0:e.getSelectedItem();if(!t)return;const n={course:this.filter.courseId,time:t.moment.unix()};P.ke.logEvent({type:P.gM.VIEW_ITEM_LIST,ws:"core_calendar_get_calendar_day_view",name:E.vN.instant("addon.calendar.dayviewtitle",{$a:this.periodName}),data:{...n,category:"calendar"},url:D.T.addParamsToUrl("/calendar/view.php?view=day",n)})}))}ngOnInit(){const e=[];C.Tr.enumKeys(_.yk).forEach((t=>{var n;const o=_.yk[t];this.filter[t]=null===(n=y.b.getRouteBooleanParam(t))||void 0===n||n,e.push(o)})),this.filter.courseId=y.b.getRouteNumberParam("courseId"),this.filter.categoryId=y.b.getRouteNumberParam("categoryId"),this.filter.filtered=void 0!==this.filter.courseId||e.some((e=>!this.filter[e]));const t=y.b.getRouteNumberParam("month"),n=new AddonCalendarDaySlidesItemsManagerSource(this,A()({year:y.b.getRouteNumberParam("year"),month:t?t-1:void 0,date:y.b.getRouteNumberParam("day")}).startOf("day"));this.manager=new I.b(n),this.managerUnsubscribe=this.manager.addListener({onSelectedItemUpdated:e=>{this.onDayViewed(e)}}),this.fetchData(!0)}get canCreate(){var e;return(null===(e=this.manager)||void 0===e?void 0:e.getSource().canCreate)||!1}get timeFormat(){var e;return(null===(e=this.manager)||void 0===e?void 0:e.getSource().timeFormat)||"core.strftimetime"}fetchData(e){var t=this;return(0,i.Z)((function*(){t.syncIcon=x.i.ICON_LOADING,t.isOnline=r.AS.isOnline(),e&&(yield t.sync());try{var n,o,a;yield null===(n=t.manager)||void 0===n?void 0:n.getSource().fetchData(t.filter.courseId),yield null===(o=t.manager)||void 0===o?void 0:o.getSource().load(null===(a=t.manager)||void 0===a?void 0:a.getSelectedItem()),t.logView()}catch(e){s.OQ.showErrorModalDefault(e,"addon.calendar.errorloadevents",!0)}t.loaded=!0,t.syncIcon=x.i.ICON_SYNC}))()}onDayViewed(e){this.periodName=c.D.userDate(1e3*e.moment.unix(),"core.strftimedaydate")}doRefresh(e,t){var n=this;return(0,i.Z)((function*(){n.loaded&&(yield n.refreshData(!0).finally((()=>{null==e||e.complete(),t&&t()})))}))()}refreshData(e,t){var n=this;return(0,i.Z)((function*(){var o,a;n.syncIcon=x.i.ICON_LOADING;const i=(null===(o=n.manager)||void 0===o?void 0:o.getSelectedItem())||null;yield null===(a=n.manager)||void 0===a?void 0:a.getSource().invalidateContent(i,!t),yield n.fetchData(e)}))()}sync(e){var t=this;return(0,i.Z)((function*(){try{const e=yield g.a.syncEvents();if(e.warnings&&e.warnings.length&&s.OQ.showAlert(void 0,e.warnings[0]),e.updated){var n,o;const a=null===(n=t.manager)||void 0===n?void 0:n.getSelectedItem();e.source="day",e.moment=null==a?void 0:a.moment,null===(o=t.manager)||void 0===o||o.getSource().markAllItemsUnloaded(),d.R.trigger(g.U.MANUAL_SYNCED,e,t.currentSiteId)}}catch(t){e&&s.OQ.showErrorModalDefault(t,"core.errorsync",!0)}}))()}selectedDayIsCurrent(){var e;return!(null===(e=this.manager)||void 0===e||null===(e=e.getSelectedItem())||void 0===e||!e.isCurrentDay)}gotoEvent(e,t){y.b.navigateToSitePath(`/calendar/event/${e}`,{params:{date:t.moment.format("MMDDY")}})}openFilter(){var e=this;return(0,i.Z)((function*(){var t;yield s.OQ.openSideModal({component:v.M,componentProps:{courses:null===(t=e.manager)||void 0===t?void 0:t.getSource().courses,filter:e.filter}})}))()}openEdit(e){const t={};if(!e){var n;e=0;const o=null===(n=this.manager)||void 0===n?void 0:n.getSelectedItem();if(o){const e=A()();t.timestamp=1e3*o.moment.clone().set({hour:e.hour(),minute:e.minute()}).unix()}}this.filter.courseId&&(t.courseId=this.filter.courseId),y.b.navigateToSitePath(`/calendar/edit/${e}`,{params:t})}selectedDayHasOffline(){var e;const t=null===(e=this.manager)||void 0===e?void 0:e.getSelectedItem();return!(null==t||!t.hasOffline)}goToCurrentDay(){var e=this;return(0,i.Z)((function*(){const t=e.manager;if(!t||!e.swipeSlidesComponent)return;const n={moment:A()()};e.loaded=!1;try{yield t.getSource().loadItem(n),e.swipeSlidesComponent.slideToItem(n)}catch(e){s.OQ.showErrorModalDefault(e,"addon.calendar.errorloadevents",!0)}finally{e.loaded=!0}}))()}loadNext(){var e=this;return(0,i.Z)((function*(){var t;null===(t=e.swipeSlidesComponent)||void 0===t||t.slideNext()}))()}loadPrevious(){var e=this;return(0,i.Z)((function*(){var t;null===(t=e.swipeSlidesComponent)||void 0===t||t.slidePrev()}))()}ngOnDestroy(){var e,t,n,o;this.eventObservers.forEach((e=>e.off())),null===(e=this.onlineObserver)||void 0===e||e.unsubscribe(),null===(t=this.manager)||void 0===t||t.getSource().forgetRelatedSources(),null===(n=this.manager)||void 0===n||n.destroy(),null===(o=this.managerUnsubscribe)||void 0===o||o.call(this),delete this.manager}}return(e=AddonCalendarDayPage).ɵfac=function AddonCalendarDayPage_Factory(t){return new(t||e)},e.ɵcmp=N.Xpm({type:e,selectors:[["page-addon-calendar-day"]],viewQuery:function AddonCalendarDayPage_Query(e,t){if(1&e&&N.Gf(T.G,5),2&e){let e;N.iGM(e=N.CRH())&&(t.swipeSlidesComponent=e.first)}},decls:39,vars:31,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click"],["slot","icon-only","name","fas-filter","aria-hidden","true"],["iconAction","fas-calendar-day",3,"priority","content","action",4,"ngIf"],[3,"hidden","priority","content","iconAction","closeOnClick","action"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[1,"core-swipe-slides-container"],[1,"ion-no-padding","safe-area-padding"],[1,"ion-align-items-center"],[1,"ion-text-start"],["name","fas-chevron-left","slot","icon-only","aria-hidden","true"],[1,"ion-text-center","addon-calendar-period"],[1,"ion-text-end"],["name","fas-chevron-right","slot","icon-only","aria-hidden","true"],[3,"manager"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end",4,"ngIf"],["iconAction","fas-calendar-day",3,"priority","content","action"],["class","core-warning-card list-item-limited-width",4,"ngIf"],["icon","fas-calendar",3,"message",4,"ngIf"],["class","list-item-limited-width",4,"ngIf"],[1,"core-warning-card","list-item-limited-width"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],["icon","fas-calendar",3,"message"],[1,"list-item-limited-width"],[4,"ngFor","ngForOf"],["button","",1,"addon-calendar-event","ion-text-wrap",3,"ngClass","detail","click"],["slot","start",3,"modicon","showAlt","modname","componentId","purpose",4,"ngIf"],["slot","start","aria-hidden","true",3,"name",4,"ngIf"],[1,"sr-only"],["class","sr-only",4,"ngIf"],[1,"item-heading"],[3,"text","contextLevel","contextInstanceId"],[3,"text","filter"],["slot","end",4,"ngIf"],["slot","start",3,"modicon","showAlt","modname","componentId","purpose"],["slot","start","aria-hidden","true",3,"name"],["name","fas-clock","aria-hidden","true"],[1,"ion-text-wrap"],["name","fas-trash","aria-hidden","true"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],[3,"click"],["name","fas-plus","aria-hidden","true"]],template:function AddonCalendarDayPage_Template(e,t){1&e&&(N.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),N._UZ(3,"ion-back-button",1),N.ALo(4,"translate"),N.qZA(),N.TgZ(5,"ion-title")(6,"h1"),N._uU(7),N.ALo(8,"translate"),N.qZA()(),N.TgZ(9,"ion-buttons",2)(10,"ion-button",3),N.NdJ("click",(function AddonCalendarDayPage_Template_ion_button_click_10_listener(){return t.openFilter()})),N.ALo(11,"translate"),N._UZ(12,"ion-icon",4),N.qZA(),N.TgZ(13,"core-context-menu"),N.YNc(14,AddonCalendarDayPage_core_context_menu_item_14_Template,2,4,"core-context-menu-item",5),N.TgZ(15,"core-context-menu-item",6),N.NdJ("action",(function AddonCalendarDayPage_Template_core_context_menu_item_action_15_listener(e){return t.doRefresh(void 0,e)})),N.ALo(16,"translate"),N.qZA()()()()(),N.TgZ(17,"ion-content")(18,"ion-refresher",7),N.NdJ("ionRefresh",(function AddonCalendarDayPage_Template_ion_refresher_ionRefresh_18_listener(e){return t.doRefresh(e.target)})),N._UZ(19,"ion-refresher-content",8),N.ALo(20,"translate"),N.qZA(),N.TgZ(21,"core-loading",9)(22,"div",10)(23,"ion-grid",11)(24,"ion-row",12)(25,"ion-col",13)(26,"ion-button",3),N.NdJ("click",(function AddonCalendarDayPage_Template_ion_button_click_26_listener(){return t.loadPrevious()})),N.ALo(27,"translate"),N._UZ(28,"ion-icon",14),N.qZA()(),N.TgZ(29,"ion-col",15)(30,"h2"),N._uU(31),N.qZA()(),N.TgZ(32,"ion-col",16)(33,"ion-button",3),N.NdJ("click",(function AddonCalendarDayPage_Template_ion_button_click_33_listener(){return t.loadNext()})),N.ALo(34,"translate"),N._UZ(35,"ion-icon",17),N.qZA()()()(),N.TgZ(36,"core-swipe-slides",18),N.YNc(37,AddonCalendarDayPage_ng_template_37_Template,4,4,"ng-template"),N.qZA()()(),N.YNc(38,AddonCalendarDayPage_ion_fab_38_Template,7,6,"ion-fab",19),N.qZA()),2&e&&(N.xp6(3),N.Q6J("text",N.lcZ(4,17,"core.back")),N.xp6(4),N.Oqu(N.lcZ(8,19,"addon.calendar.calendarevents")),N.xp6(3),N.uIk("aria-label",N.lcZ(11,21,"core.filter")),N.xp6(4),N.Q6J("ngIf",!t.selectedDayIsCurrent()),N.xp6(),N.Q6J("hidden",!t.loaded||!t.selectedDayHasOffline()||!t.isOnline)("priority",400)("content",N.lcZ(16,23,"core.settings.synchronizenow"))("iconAction",t.syncIcon)("closeOnClick",!1),N.xp6(3),N.Q6J("disabled",!t.loaded),N.xp6(),N.s9C("pullingText",N.lcZ(20,25,"core.pulltorefresh")),N.xp6(2),N.Q6J("hideUntil",t.loaded),N.xp6(5),N.uIk("aria-label",N.lcZ(27,27,"addon.calendar.dayprev")),N.xp6(5),N.Oqu(t.periodName),N.xp6(2),N.uIk("aria-label",N.lcZ(34,29,"addon.calendar.daynext")),N.xp6(3),N.Q6J("manager",t.manager),N.xp6(2),N.Q6J("ngIf",t.canCreate&&t.loaded))},dependencies:[L.mk,L.sg,L.O5,q.P,U.l,Q.z,S.r,J.o,T.G,k.U,M.I,R.r,F.t,V.O,G.YG,G.Sm,G.PM,G.wI,G.W2,G.IJ,G.W4,G.jY,G.Gu,G.gu,G.Ie,G.Q$,G.q_,G.uN,G.nJ,G.Wo,G.Nd,G.wd,G.sr,G.oU,Y.X$],styles:["[_nghost-%COMP%]{--addon-calendar-blank-day-background-color: var(--light)}[_nghost-%COMP%]   .item.addon-calendar-event[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{color:#fff;border-radius:50%;padding:.7rem;--margin-vertical: 12px;--margin-end: 12px;margin-top:var(--margin-vertical);margin-bottom:var(--margin-vertical);margin-inline-end:var(--margin-end)}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-category[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#8e24aa}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-course[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#ca3120}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-group[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#f0ad4e}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-user[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#0f6cbf}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-site[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#357a32}","[_nghost-%COMP%]   .core-swipe-slides-container[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]{flex:none;width:100%}[_nghost-%COMP%]   .addon-calendar-period[_ngcontent-%COMP%]{flex-grow:3}[_nghost-%COMP%]   .addon-calendar-period[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:10px;font-size:1.2rem}"]}),AddonCalendarDayPage})();class AddonCalendarDaySlidesItemsManagerSource extends Z.T{constructor(e,t){super({moment:t}),this.courses=[],this.eventsSources=new Set,this.offlineEvents={},this.offlineEditedEventsIds=[],this.canCreate=!1,this.sendLog=!0,this.dayPage=e}fetchData(e){var t=this;return(0,i.Z)((function*(){yield Promise.all([t.loadCourses(e),t.loadCanCreate(e),t.loadCategories(),t.loadOfflineEvents(),t.loadOfflineDeletedEvents(),t.loadTimeFormat()])}))()}filterAllDayEvents(e){var t;null===(t=this.getItems())||void 0===t||t.forEach((t=>this.filterEvents(t,e)))}filterEvents(e,t){e.filteredEvents=m.Lh.getFilteredEvents(e.events||[],t,this.categories||{}),this.rememberEventsList(e)}loadCourses(e){var t=this;return(0,i.Z)((function*(){const n=yield f.IP.getCoursesForPopover(e);t.courses=n.courses}))()}loadCanCreate(e){var t=this;return(0,i.Z)((function*(){t.canCreate=yield m.Lh.canEditEvents(e)}))()}loadCategories(){var e=this;return(0,i.Z)((function*(){if(!e.categories)try{const t=yield p.B.getCategories(0,!0);e.categories=C.Tr.arrayToObject(t,"id")}catch{}}))()}loadOfflineEvents(){var e=this;return(0,i.Z)((function*(){const t=yield u.F.getAllEditedEvents();e.offlineEvents=m.Lh.classifyIntoMonths(t),e.offlineEditedEventsIds=t.filter((e=>e.id>0)).map((e=>e.id))}))()}loadOfflineDeletedEvents(){var e=this;return(0,i.Z)((function*(){const t=yield u.F.getAllDeletedEventsIds();e.deletedEvents=new Set(t)}))()}loadTimeFormat(){var e=this;return(0,i.Z)((function*(){e.timeFormat=yield _.hU.getCalendarTimeFormat()}))()}getItemId(e){return m.Lh.getDayId(e.moment)}getPreviousItem(e){return{moment:e.moment.clone().subtract(1,"day")}}getNextItem(e){return{moment:e.moment.clone().add(1,"day")}}loadItemData(e,t=!1){var n=this;return(0,i.Z)((function*(){const o={...e,hasOffline:!1,events:[],onlineEvents:[],filteredEvents:[],isCurrentDay:e.moment.isSame(A()(),"day"),isPastDay:e.moment.isBefore(A()(),"day")};if(t)return o;let a;try{a=yield _.hU.getDayEvents(e.moment.year(),e.moment.month()+1,e.moment.date()),o.onlineEvents=yield Promise.all(a.events.map((e=>m.Lh.formatEventData(e))))}catch(e){if(r.AS.isOnline())throw e}o.events=n.mergeEvents(o),n.filterEvents(o,n.dayPage.filter);const d=1e3*e.moment.unix(),l=c.D.timestamp(),s=o.events.map(function(){var e=(0,i.Z)((function*(e){e.ispast=o.isPastDay||o.isCurrentDay&&n.isEventPast(e,l),e.formattedtime=yield _.hU.formatEventTime(e,n.dayPage.timeFormat,!0,d)}));return function(t){return e.apply(this,arguments)}}());return yield Promise.all(s),o}))()}isEventPast(e,t){return e.timestart+e.timeduration<t}mergeEvents(e){var t,n;if(e.hasOffline=!1,!(Object.keys(this.offlineEvents).length||null!==(t=this.deletedEvents)&&void 0!==t&&t.size))return e.onlineEvents||[];const o=this.offlineEvents[m.Lh.getMonthId(e.moment)],a=o&&o[e.moment.date()];let i=e.onlineEvents||[];var r;(null!==(n=this.deletedEvents)&&void 0!==n&&n.size&&i.forEach((t=>{var n;t.deleted=null===(n=this.deletedEvents)||void 0===n?void 0:n.has(t.id),t.deleted&&(e.hasOffline=!0)})),this.offlineEditedEventsIds.length)&&(i=i.filter((e=>-1==this.offlineEditedEventsIds.indexOf(e.id))),i.length!=(null===(r=e.onlineEvents)||void 0===r?void 0:r.length)&&(e.hasOffline=!0));return a&&a.length&&(e.hasOffline=!0,i=m.Lh.sortEvents(i.concat(a))),i}invalidateContent(e,t){var n=this;return(0,i.Z)((function*(){const o=[];t&&e&&o.push(_.hU.invalidateDayEvents(e.moment.year(),e.moment.month()+1,e.moment.date())),o.push(_.hU.invalidateAllowedEventTypes()),o.push(p.B.invalidateCategories(0,!0)),o.push(_.hU.invalidateTimeFormat()),n.categories=void 0,n.sendLog=!0,e&&(e.dirty=!0),yield Promise.all(o)}))()}markAsDeleted(e,t){var n,o,a;(null===(n=this.getItems())||void 0===n||n.some((n=>{var o;const a=null===(o=n.onlineEvents)||void 0===o?void 0:o.find((t=>t.id==e));if(!a)return!1;var i,r,d;(a.deleted=t,t)?n.hasOffline=!0:n.hasOffline=(null===(i=n.events)||void 0===i?void 0:i.length)!=(null===(r=n.onlineEvents)||void 0===r?void 0:r.length)||(null===(d=n.events)||void 0===d?void 0:d.some((e=>e.deleted||e.offline)));return!0})),t)?null===(o=this.deletedEvents)||void 0===o||o.add(e):null===(a=this.deletedEvents)||void 0===a||a.delete(e)}forgetRelatedSources(){for(const e of this.eventsSources)b.p.removeReference(e,this)}rememberEventsList(e){var t=this;return(0,i.Z)((function*(){var n;const o=b.p.getOrCreateSource(AddonCalendarEventsSource,[e.moment.format("MMDDY")]);t.eventsSources.has(o)||(t.eventsSources.add(o),b.p.addReference(o,t)),o.setEvents(null!==(n=e.filteredEvents)&&void 0!==n?n:[]),yield o.reload()}))()}}var $=n(56223),H=n(95800),K=n(12265),z=n(15945),j=n(5134),W=n(31381),X=n(40067),ee=n(89933),te=n(56277),ne=n(55544),oe=n(80571),ae=n(19289),ie=n(15246);const re=["editEventForm"];function AddonCalendarEditEventPage_form_14_ng_template_16_Template(e,t){if(1&e&&(N.TgZ(0,"ion-datetime",31)(1,"span",32),N._uU(2),N.ALo(3,"translate"),N.qZA()()),2&e){const e=N.oxw(2);N.Q6J("max",e.maxDate)("min",e.minDate),N.xp6(2),N.Oqu(N.lcZ(3,3,"core.date"))}}function AddonCalendarEditEventPage_form_14_ion_label_19_Template(e,t){1&e&&(N.TgZ(0,"ion-label")(1,"p",14),N._uU(2),N.ALo(3,"translate"),N.qZA()()),2&e&&(N.xp6(),N.Q6J("core-mark-required",!0),N.xp6(),N.Oqu(N.lcZ(3,2,"addon.calendar.eventkind")))}function AddonCalendarEditEventPage_form_14_p_20_Template(e,t){if(1&e&&(N.TgZ(0,"p",33),N._uU(1),N.ALo(2,"translate"),N.qZA()),2&e){const e=N.oxw(2);N.xp6(),N.Oqu(N.lcZ(2,1,e.eventTypes[0].name))}}function AddonCalendarEditEventPage_form_14_ion_select_21_ion_select_option_6_Template(e,t){if(1&e&&(N.TgZ(0,"ion-select-option",26),N._uU(1),N.ALo(2,"translate"),N.qZA()),2&e){const e=t.$implicit;N.Q6J("value",e.value),N.xp6(),N.hij(" ",N.lcZ(2,2,e.name)," ")}}const edit_event_c1=e=>({header:e});function AddonCalendarEditEventPage_form_14_ion_select_21_Template(e,t){if(1&e&&(N.TgZ(0,"ion-select",34),N.ALo(1,"translate"),N.ALo(2,"translate"),N.TgZ(3,"div",11),N._uU(4),N.ALo(5,"translate"),N.qZA(),N.YNc(6,AddonCalendarEditEventPage_form_14_ion_select_21_ion_select_option_6_Template,3,4,"ion-select-option",35),N.qZA()),2&e){const e=N.oxw(2);N.Q6J("cancelText",N.lcZ(1,5,"core.cancel"))("interfaceOptions",N.VKq(11,edit_event_c1,N.lcZ(2,7,"addon.calendar.eventkind"))),N.xp6(3),N.Q6J("core-mark-required",!0),N.xp6(),N.Oqu(N.lcZ(5,9,"addon.calendar.eventkind")),N.xp6(2),N.Q6J("ngForOf",e.eventTypes)}}function AddonCalendarEditEventPage_form_14_ion_item_22_ion_select_option_8_Template(e,t){if(1&e&&(N.TgZ(0,"ion-select-option",26),N._uU(1),N.qZA()),2&e){const e=t.$implicit;N.Q6J("value",e.id),N.xp6(),N.hij(" ",e.name," ")}}function AddonCalendarEditEventPage_form_14_ion_item_22_Template(e,t){if(1&e&&(N.TgZ(0,"ion-item",9)(1,"ion-select",36),N.ALo(2,"translate"),N.ALo(3,"translate"),N.ALo(4,"translate"),N.TgZ(5,"p",11),N._uU(6),N.ALo(7,"translate"),N.qZA(),N.YNc(8,AddonCalendarEditEventPage_form_14_ion_item_22_ion_select_option_8_Template,2,2,"ion-select-option",35),N.qZA()()),2&e){const e=N.oxw(2);N.xp6(),N.Q6J("placeholder",N.lcZ(2,6,"core.noselection"))("cancelText",N.lcZ(3,8,"core.cancel"))("interfaceOptions",N.VKq(14,edit_event_c1,N.lcZ(4,10,"core.category"))),N.xp6(4),N.Q6J("core-mark-required",!0),N.xp6(),N.Oqu(N.lcZ(7,12,"core.category")),N.xp6(2),N.Q6J("ngForOf",e.categories)}}function AddonCalendarEditEventPage_form_14_ion_item_23_ion_select_option_8_Template(e,t){if(1&e&&(N.TgZ(0,"ion-select-option",26),N._uU(1),N.qZA()),2&e){const e=t.$implicit;N.Q6J("value",e.id),N.xp6(),N.Oqu(e.fullname)}}function AddonCalendarEditEventPage_form_14_ion_item_23_Template(e,t){if(1&e&&(N.TgZ(0,"ion-item",9)(1,"ion-select",37),N.ALo(2,"translate"),N.ALo(3,"translate"),N.ALo(4,"translate"),N.TgZ(5,"p",11),N._uU(6),N.ALo(7,"translate"),N.qZA(),N.YNc(8,AddonCalendarEditEventPage_form_14_ion_item_23_ion_select_option_8_Template,2,2,"ion-select-option",35),N.qZA()()),2&e){const e=N.oxw(2);N.xp6(),N.Q6J("placeholder",N.lcZ(2,6,"core.noselection"))("cancelText",N.lcZ(3,8,"core.cancel"))("interfaceOptions",N.VKq(14,edit_event_c1,N.lcZ(4,10,"core.course"))),N.xp6(4),N.Q6J("core-mark-required",!0),N.xp6(),N.Oqu(N.lcZ(7,12,"core.course")),N.xp6(2),N.Q6J("ngForOf",e.courses)}}function AddonCalendarEditEventPage_form_14_ng_container_24_ion_select_option_9_Template(e,t){if(1&e&&(N.TgZ(0,"ion-select-option",26),N._uU(1),N.qZA()),2&e){const e=t.$implicit;N.Q6J("value",e.id),N.xp6(),N.hij(" ",e.fullname," ")}}function AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_10_Template(e,t){1&e&&(N.TgZ(0,"ion-item",41)(1,"ion-label")(2,"p"),N._uU(3),N.ALo(4,"translate"),N.qZA()()()),2&e&&(N.xp6(3),N.Oqu(N.lcZ(4,1,"core.coursenogroups")))}function AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_11_ion_select_option_8_Template(e,t){if(1&e&&(N.TgZ(0,"ion-select-option",26),N._uU(1),N.qZA()),2&e){const e=t.$implicit;N.Q6J("value",e.id),N.xp6(),N.Oqu(e.name)}}function AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_11_Template(e,t){if(1&e&&(N.TgZ(0,"ion-item",42)(1,"ion-select",43),N.ALo(2,"translate"),N.ALo(3,"translate"),N.ALo(4,"translate"),N.TgZ(5,"p",11),N._uU(6),N.ALo(7,"translate"),N.qZA(),N.YNc(8,AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_11_ion_select_option_8_Template,2,2,"ion-select-option",35),N.qZA()()),2&e){const e=N.oxw(3);N.xp6(),N.Q6J("placeholder",N.lcZ(2,6,"core.noselection"))("cancelText",N.lcZ(3,8,"core.cancel"))("interfaceOptions",N.VKq(14,edit_event_c1,N.lcZ(4,10,"core.group"))),N.xp6(4),N.Q6J("core-mark-required",!0),N.xp6(),N.Oqu(N.lcZ(7,12,"core.group")),N.xp6(2),N.Q6J("ngForOf",e.groups)}}function AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_12_ion_spinner_2_Template(e,t){1&e&&(N._UZ(0,"ion-spinner"),N.ALo(1,"translate")),2&e&&N.uIk("aria-label",N.lcZ(1,1,"core.loading"))}function AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_12_Template(e,t){if(1&e&&(N.TgZ(0,"ion-item",9)(1,"ion-label"),N.YNc(2,AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_12_ion_spinner_2_Template,2,3,"ion-spinner",18),N.qZA()()),2&e){const e=N.oxw(3);N.xp6(2),N.Q6J("ngIf",e.loadingGroups)}}function AddonCalendarEditEventPage_form_14_ng_container_24_Template(e,t){if(1&e){const e=N.EpF();N.ynx(0),N.TgZ(1,"ion-item",9)(2,"ion-select",38),N.NdJ("ionChange",(function AddonCalendarEditEventPage_form_14_ng_container_24_Template_ion_select_ionChange_2_listener(){N.CHM(e);const t=N.oxw(2);return N.KtG(t.groupCourseSelected())})),N.ALo(3,"translate"),N.ALo(4,"translate"),N.ALo(5,"translate"),N.TgZ(6,"p",11),N._uU(7),N.ALo(8,"translate"),N.qZA(),N.YNc(9,AddonCalendarEditEventPage_form_14_ng_container_24_ion_select_option_9_Template,2,2,"ion-select-option",35),N.qZA()(),N.YNc(10,AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_10_Template,5,3,"ion-item",39)(11,AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_11_Template,9,16,"ion-item",40)(12,AddonCalendarEditEventPage_form_14_ng_container_24_ion_item_12_Template,3,1,"ion-item",21),N.BQk()}if(2&e){const e=N.oxw(2);N.xp6(2),N.Q6J("placeholder",N.lcZ(3,9,"core.noselection"))("cancelText",N.lcZ(4,11,"core.cancel"))("interfaceOptions",N.VKq(17,edit_event_c1,N.lcZ(5,13,"core.course"))),N.xp6(4),N.Q6J("core-mark-required",!0),N.xp6(),N.Oqu(N.lcZ(8,15,"core.course")),N.xp6(2),N.Q6J("ngForOf",e.courses),N.xp6(),N.Q6J("ngIf",!e.loadingGroups&&e.courseGroupSet&&!e.groups.length),N.xp6(),N.Q6J("ngIf",!e.loadingGroups&&e.groups.length>0),N.xp6(),N.Q6J("ngIf",e.loadingGroups)}}function AddonCalendarEditEventPage_form_14_ng_container_25_ion_item_9_Template(e,t){if(1&e){const e=N.EpF();N.TgZ(0,"ion-item",9)(1,"ion-label")(2,"p"),N._uU(3),N.qZA()(),N.TgZ(4,"ion-button",45),N.NdJ("click",(function AddonCalendarEditEventPage_form_14_ng_container_25_ion_item_9_Template_ion_button_click_4_listener(){const t=N.CHM(e).$implicit,n=N.oxw(3);return N.KtG(n.removeReminder(t))})),N.ALo(5,"translate"),N._UZ(6,"ion-icon",48),N.qZA()()}if(2&e){const e=t.$implicit;N.xp6(3),N.Oqu(e.label),N.xp6(),N.uIk("aria-label",N.lcZ(5,2,"core.delete"))}}function AddonCalendarEditEventPage_form_14_ng_container_25_Template(e,t){if(1&e){const e=N.EpF();N.ynx(0),N.TgZ(1,"ion-item-divider",44)(2,"ion-label")(3,"p",25),N._uU(4),N.ALo(5,"translate"),N.qZA()(),N.TgZ(6,"ion-button",45),N.NdJ("click",(function AddonCalendarEditEventPage_form_14_ng_container_25_Template_ion_button_click_6_listener(){N.CHM(e);const t=N.oxw(2);return N.KtG(t.addReminder())})),N.ALo(7,"translate"),N._UZ(8,"ion-icon",46),N.qZA()(),N.YNc(9,AddonCalendarEditEventPage_form_14_ng_container_25_ion_item_9_Template,7,4,"ion-item",47),N.BQk()}if(2&e){const e=N.oxw(2);N.xp6(4),N.Oqu(N.lcZ(5,3,"addon.calendar.reminders")),N.xp6(2),N.uIk("aria-label",N.lcZ(7,5,"addon.calendar.setnewreminder")),N.xp6(3),N.Q6J("ngForOf",e.reminders)}}function AddonCalendarEditEventPage_form_14_ion_item_43_ng_template_4_Template(e,t){if(1&e&&(N.TgZ(0,"ion-datetime",50)(1,"span",32),N._uU(2),N.ALo(3,"translate"),N.qZA()()),2&e){const e=N.oxw(3);N.Q6J("max",e.maxDate)("min",e.minDate),N.xp6(2),N.Oqu(N.lcZ(3,3,"addon.calendar.durationuntil"))}}function AddonCalendarEditEventPage_form_14_ion_item_43_Template(e,t){1&e&&(N.TgZ(0,"ion-item"),N._UZ(1,"ion-label",13)(2,"ion-datetime-button",49),N.TgZ(3,"ion-modal",16),N.YNc(4,AddonCalendarEditEventPage_form_14_ion_item_43_ng_template_4_Template,4,5,"ng-template"),N.qZA()()),2&e&&(N.xp6(3),N.Q6J("keepContentsMounted",!0))}function AddonCalendarEditEventPage_form_14_ion_item_49_Template(e,t){1&e&&(N.TgZ(0,"ion-item"),N._UZ(1,"ion-input",51),N.ALo(2,"translate"),N.qZA()),2&e&&(N.xp6(),N.Q6J("placeholder",N.lcZ(2,1,"addon.calendar.durationminutes")))}function AddonCalendarEditEventPage_form_14_ng_container_50_Template(e,t){if(1&e&&(N.ynx(0),N.TgZ(1,"ion-item",52)(2,"ion-checkbox",53)(3,"p",25),N._uU(4),N.ALo(5,"translate"),N.qZA()()(),N.TgZ(6,"ion-item",9),N._UZ(7,"ion-input",54),N.ALo(8,"translate"),N.qZA(),N.BQk()),2&e){const e=N.oxw(2);N.xp6(4),N.Oqu(N.lcZ(5,3,"addon.calendar.repeatevent")),N.xp6(3),N.Q6J("label",N.lcZ(8,5,"addon.calendar.repeatweeksl"))("disabled",!e.form.controls.repeat.value)}}const _c2=e=>({$a:e});function AddonCalendarEditEventPage_form_14_div_51_Template(e,t){if(1&e&&(N.TgZ(0,"div",22)(1,"ion-radio-group",55)(2,"ion-item-divider",24)(3,"ion-label")(4,"p",25),N._uU(5),N.ALo(6,"translate"),N.qZA()()(),N.TgZ(7,"ion-item")(8,"ion-radio",56)(9,"p"),N._uU(10),N.ALo(11,"translate"),N.qZA()()(),N.TgZ(12,"ion-item")(13,"ion-radio",57)(14,"p"),N._uU(15),N.ALo(16,"translate"),N.qZA()()()()()),2&e){const e=N.oxw(2);N.xp6(5),N.Oqu(N.lcZ(6,3,"addon.calendar.repeatedevents")),N.xp6(5),N.Oqu(N.xi3(11,5,"addon.calendar.repeateditall",N.VKq(10,_c2,e.otherEventsCount))),N.xp6(5),N.Oqu(N.lcZ(16,8,"addon.calendar.repeateditthis"))}}function AddonCalendarEditEventPage_form_14_Template(e,t){if(1&e&&(N.TgZ(0,"form",7,8)(2,"ion-item",9)(3,"ion-input",10),N.ALo(4,"translate"),N.TgZ(5,"div",11),N._uU(6),N.ALo(7,"translate"),N.qZA()(),N._UZ(8,"core-input-errors",12),N.qZA(),N.TgZ(9,"ion-item",9)(10,"ion-label",13)(11,"p",14),N._uU(12),N.ALo(13,"translate"),N.qZA()(),N._UZ(14,"ion-datetime-button",15),N.TgZ(15,"ion-modal",16),N.YNc(16,AddonCalendarEditEventPage_form_14_ng_template_16_Template,4,5,"ng-template"),N.qZA(),N._UZ(17,"core-input-errors",12),N.qZA(),N.TgZ(18,"ion-item",17),N.YNc(19,AddonCalendarEditEventPage_form_14_ion_label_19_Template,4,4,"ion-label",18)(20,AddonCalendarEditEventPage_form_14_p_20_Template,3,3,"p",19)(21,AddonCalendarEditEventPage_form_14_ion_select_21_Template,7,13,"ion-select",20),N.qZA(),N.YNc(22,AddonCalendarEditEventPage_form_14_ion_item_22_Template,9,16,"ion-item",21)(23,AddonCalendarEditEventPage_form_14_ion_item_23_Template,9,16,"ion-item",21)(24,AddonCalendarEditEventPage_form_14_ng_container_24_Template,13,19,"ng-container",18)(25,AddonCalendarEditEventPage_form_14_ng_container_25_Template,10,7,"ng-container",18),N.TgZ(26,"div",22)(27,"ion-radio-group",23)(28,"ion-item-divider",24)(29,"ion-label")(30,"p",25),N._uU(31),N.ALo(32,"translate"),N.qZA()()(),N.TgZ(33,"ion-item")(34,"ion-radio",26)(35,"p"),N._uU(36),N.ALo(37,"translate"),N.qZA()()(),N.TgZ(38,"ion-item")(39,"ion-radio",26)(40,"p"),N._uU(41),N.ALo(42,"translate"),N.qZA()()(),N.YNc(43,AddonCalendarEditEventPage_form_14_ion_item_43_Template,5,1,"ion-item",18),N.TgZ(44,"ion-item")(45,"ion-radio",26)(46,"p",27),N._uU(47),N.ALo(48,"translate"),N.qZA()()(),N.YNc(49,AddonCalendarEditEventPage_form_14_ion_item_49_Template,3,3,"ion-item",18),N.qZA()(),N.YNc(50,AddonCalendarEditEventPage_form_14_ng_container_50_Template,9,7,"ng-container",18)(51,AddonCalendarEditEventPage_form_14_div_51_Template,17,12,"div",28),N.TgZ(52,"ion-item",9)(53,"ion-label",13)(54,"p",25),N._uU(55),N.ALo(56,"translate"),N.qZA()(),N._UZ(57,"core-rich-text-editor",29),N.ALo(58,"translate"),N.ALo(59,"translate"),N.qZA(),N.TgZ(60,"ion-item",9),N._UZ(61,"ion-input",30),N.ALo(62,"translate"),N.ALo(63,"translate"),N.qZA()()),2&e){const e=N.oxw();N.Q6J("formGroup",e.form),N.xp6(3),N.Q6J("placeholder",N.lcZ(4,36,"addon.calendar.eventname")),N.xp6(2),N.Q6J("core-mark-required",!0),N.xp6(),N.Oqu(N.lcZ(7,38,"addon.calendar.eventname")),N.xp6(2),N.Q6J("control",e.form.controls.name),N.xp6(3),N.Q6J("core-mark-required",!0),N.xp6(),N.Oqu(N.lcZ(13,40,"core.date")),N.xp6(3),N.Q6J("keepContentsMounted",!0),N.xp6(2),N.Q6J("control",e.form.controls.timestart),N.xp6(2),N.Q6J("ngIf",1===e.eventTypes.length),N.xp6(),N.Q6J("ngIf",1===e.eventTypes.length),N.xp6(),N.Q6J("ngIf",e.eventTypes.length>1),N.xp6(),N.Q6J("ngIf","category"===e.typeControl.value),N.xp6(),N.Q6J("ngIf","course"===e.typeControl.value),N.xp6(),N.Q6J("ngIf","group"===e.typeControl.value),N.xp6(),N.Q6J("ngIf",e.remindersEnabled&&!e.eventId),N.xp6(6),N.Oqu(N.lcZ(32,42,"addon.calendar.eventduration")),N.xp6(3),N.Q6J("value",0),N.xp6(2),N.Oqu(N.lcZ(37,44,"addon.calendar.durationnone")),N.xp6(3),N.Q6J("value",1),N.xp6(2),N.Oqu(N.lcZ(42,46,"addon.calendar.durationuntil")),N.xp6(2),N.Q6J("ngIf",1===e.form.controls.duration.value),N.xp6(2),N.Q6J("value",2),N.xp6(2),N.Oqu(N.lcZ(48,48,"addon.calendar.durationminutes")),N.xp6(2),N.Q6J("ngIf",2===e.form.controls.duration.value),N.xp6(),N.Q6J("ngIf",!e.eventId||e.eventId<0),N.xp6(),N.Q6J("ngIf",e.eventRepeatId),N.xp6(4),N.Oqu(N.lcZ(56,50,"core.description")),N.xp6(2),N.Q6J("control",e.descriptionControl)("placeholder",N.lcZ(59,54,"core.description"))("component",e.component)("componentId",e.eventId)("autoSave",!1),N.uIk("aria-label",N.lcZ(58,52,"core.description")),N.xp6(4),N.Q6J("placeholder",N.lcZ(62,56,"core.location"))("label",N.lcZ(63,58,"core.location"))}}function AddonCalendarEditEventPage_div_15_Template(e,t){if(1&e){const e=N.EpF();N.TgZ(0,"div",58)(1,"div",59)(2,"ion-button",60),N.NdJ("click",(function AddonCalendarEditEventPage_div_15_Template_ion_button_click_2_listener(){N.CHM(e);const t=N.oxw();return N.KtG(t.submit())})),N._uU(3),N.ALo(4,"translate"),N.qZA()()()}if(2&e){const e=N.oxw();N.xp6(2),N.Q6J("disabled",!e.form.valid),N.xp6(),N.hij(" ",N.lcZ(4,2,"core.save")," ")}}let de=(()=>{var e;class AddonCalendarEditEventPage{constructor(e){this.fb=e,this.title="addon.calendar.newevent",this.component=_.gi.COMPONENT,this.loaded=!1,this.hasOffline=!1,this.eventTypes=[],this.categories=[],this.courses=[],this.groups=[],this.loadingGroups=!1,this.courseGroupSet=!1,this.error=!1,this.otherEventsCount=0,this.remindersEnabled=!1,this.reminders=[],this.types={},this.showAll=!1,this.isDestroyed=!1,this.gotEventData=!1,this.currentSite=l.m9.getRequiredCurrentSite(),this.remindersEnabled=ee.hR.isEnabled(),this.form=new $.cw({}),this.typeControl=this.fb.control(null,$.kI.required),this.groupControl=this.fb.control(null),this.descriptionControl=this.fb.control("",{nonNullable:!0}),this.form.addControl("name",this.fb.control("",$.kI.required)),this.form.addControl("eventtype",this.typeControl),this.form.addControl("categoryid",this.fb.control("")),this.form.addControl("groupcourseid",this.fb.control("")),this.form.addControl("groupid",this.groupControl),this.form.addControl("description",this.descriptionControl),this.form.addControl("location",this.fb.control("")),this.form.addControl("duration",this.fb.control(0)),this.form.addControl("timedurationminutes",this.fb.control("")),this.form.addControl("repeat",this.fb.control(!1)),this.form.addControl("repeats",this.fb.control("1")),this.form.addControl("repeateditall",this.fb.control(1)),this.maxDate=c.D.getDatetimeDefaultMax(),this.minDate=c.D.getDatetimeDefaultMin()}ngOnInit(){this.eventId=y.b.getRouteNumberParam("eventId")||void 0,this.courseId=y.b.getRouteNumberParam("courseId")||0,this.title=this.eventId?"addon.calendar.editevent":"addon.calendar.newevent";const e=y.b.getRouteNumberParam("timestamp"),t=c.D.toDatetimeFormat(e);this.form.addControl("timestart",this.fb.control(t,$.kI.required)),this.form.addControl("timedurationuntil",this.fb.control(t)),this.form.addControl("courseid",this.fb.control(this.courseId)),this.initReminders(),this.fetchData().finally((()=>{this.originalData=C.Tr.clone(this.form.value),this.loaded=!0}))}fetchData(){var e=this;return(0,i.Z)((function*(){e.error=!1;try{const[t,n]=yield Promise.all([_.hU.getAllowedEventTypes(e.courseId),C.Tr.ignoreErrors(_.hU.getAccessInformation(e.courseId),{canmanageentries:!1,canmanageownentries:!1,canmanagegroupentries:!1})]);e.types=t;const o=[],a=m.Lh.getEventTypeOptions(e.types);if(!a.length)throw new W.G(E.vN.instant("addon.calendar.nopermissiontoupdatecalendar"));if(e.eventId&&!e.gotEventData){const t=e.eventId;o.push(g.a.waitForSync(g.U.SYNC_ID).then((0,i.Z)((function*(){let n;!e.isDestroyed&&e.eventId&&K.d.blockOperation(_.gi.COMPONENT,t);try{n=yield u.F.getEvent(t),e.hasOffline=!0}catch{e.hasOffline=!1}if(t>0){const o=yield _.hU.getEventById(t);n||(n=o),e.eventRepeatId=null==o?void 0:o.repeatid,e.eventRepeatId&&(e.otherEventsCount=o.eventcount?o.eventcount-1:0)}if(e.gotEventData=!0,n)return e.loadEventData(n,e.hasOffline)}))))}e.types.category&&o.push(e.fetchCategories()),e.showAll=C.Tr.isTrueOrOne(e.currentSite.getStoredConfig("calendar_adminseesall"))&&n.canmanageentries,(e.types.course||e.types.groups)&&o.push(e.fetchCourses()),yield Promise.all(o),e.typeControl.value||e.typeControl.setValue(e.types.course?_.yk.COURSE:a[0].value),e.eventTypes=a}catch(t){s.OQ.showErrorModalDefault(t,"Error getting data."),e.error=!0}}))()}fetchCategories(){var e=this;return(0,i.Z)((function*(){e.categories=yield p.B.getCategories(0,!0)}))()}fetchCourses(){var e=this;return(0,i.Z)((function*(){let t=yield e.showAll?p.B.getCoursesByField():p.B.getUserCourses();if(t.length<0)return e.courses=[],void 0;const n=function(){var e=(0,i.Z)((function*(e){try{const t=yield j.X.getFiltersAndFormatText(e.fullname,"course",e.id);e.fullname=t.text}catch{}}));return function courseFillFullname(t){return e.apply(this,arguments)}}();if(e.showAll){const e=l.m9.getCurrentSiteHomeId();t=("contacts"in t[0],t.filter((t=>t.id!=e)))}"contacts"in t[0],yield Promise.all(t.map(n)),e.courses=t.sort(((e,t)=>{const n=e.fullname.toLowerCase(),o=t.fullname.toLowerCase();return n.localeCompare(o)}))}))()}loadEventData(e,t){var n=this;return(0,i.Z)((function*(){var o;if(!e)return;const a=e,i=e,r=t?a.courseid:null===(o=i.course)||void 0===o?void 0:o.id;n.form.controls.name.setValue(e.name),n.form.controls.timestart.setValue(c.D.toDatetimeFormat(1e3*e.timestart)),n.typeControl.setValue(e.eventtype),n.form.controls.categoryid.setValue(e.categoryid||""),n.form.controls.courseid.setValue(r||""),n.form.controls.groupcourseid.setValue(r||""),n.groupControl.setValue(e.groupid||null),n.form.controls.description.setValue(e.description),n.form.controls.location.setValue(e.location),t?(n.form.controls.duration.setValue(a.duration),n.form.controls.timedurationuntil.setValue(c.D.toDatetimeFormat(1e3*(a.timedurationuntil||0)||Date.now())),n.form.controls.timedurationminutes.setValue(a.timedurationminutes||""),n.form.controls.repeat.setValue(!!a.repeat),n.form.controls.repeats.setValue(a.repeats||"1"),n.form.controls.repeateditall.setValue(a.repeateditall||1)):(i.timeduration>0?(n.form.controls.duration.setValue(1),n.form.controls.timedurationuntil.setValue(c.D.toDatetimeFormat(1e3*(i.timestart+i.timeduration)))):(n.form.controls.duration.setValue(0),n.form.controls.timedurationuntil.setValue(c.D.toDatetimeFormat())),n.form.controls.timedurationminutes.setValue(""),n.form.controls.repeat.setValue(!!i.repeatid),n.form.controls.repeats.setValue(i.eventcount||"1"),n.form.controls.repeateditall.setValue(1)),e.eventtype==_.yk.GROUP&&r&&(yield n.loadGroups(r))}))()}refreshData(e){const t=[_.hU.invalidateAccessInformation(this.courseId),_.hU.invalidateAllowedEventTypes(this.courseId)];this.types&&(this.types.category&&t.push(p.B.invalidateCategories(0,!0)),(this.types.course||this.types.groups)&&t.push(this.showAll?p.B.invalidateCoursesByField():p.B.invalidateUserCourses())),Promise.all(t).finally((()=>{this.fetchData().finally((()=>{null==e||e.complete()}))}))}groupCourseSelected(){var e=this;return(0,i.Z)((function*(){const t=e.form.controls.groupcourseid.value;if(!t)return;const n=yield s.OQ.showModalLoading();try{yield e.loadGroups(t),e.groupControl.setValue(null)}catch(e){s.OQ.showErrorModalDefault(e,"Error getting data.")}n.dismiss()}))()}loadGroups(e){var t=this;return(0,i.Z)((function*(){t.loadingGroups=!0;try{t.groups=yield H.t.getUserGroupsInCourse(e),t.courseGroupSet=!0}finally{t.loadingGroups=!1}}))()}selectDuration(e){this.form.controls.duration.setValue(e)}submit(){var e=this;return(0,i.Z)((function*(){const t=e.form.value,n=A()(t.timestart).unix(),o=A()(t.timedurationuntil).unix(),a=parseInt(t.timedurationminutes||"",10);let i;if((t.eventtype!==_.yk.COURSE||t.courseid)&&(t.eventtype!==_.yk.GROUP||t.groupcourseid)?t.eventtype!==_.yk.GROUP||t.groupid?t.eventtype!==_.yk.CATEGORY||t.categoryid?1===t.duration&&n>o?i="addon.calendar.invalidtimedurationuntil":2===t.duration&&(isNaN(a)||a<1)&&(i="addon.calendar.invalidtimedurationminutes"):i="core.selectacategory":i="core.selectagroup":i="core.selectacourse",i)return s.OQ.showErrorModal(E.vN.instant(i)),void 0;const r={name:t.name,eventtype:t.eventtype,timestart:n,description:{text:t.description||"",format:1,itemid:0},location:t.location,duration:t.duration,repeat:t.repeat};t.eventtype==_.yk.COURSE?r.courseid=t.courseid:t.eventtype==_.yk.GROUP?(r.groupcourseid=t.groupcourseid,r.groupid=t.groupid):t.eventtype==_.yk.CATEGORY&&(r.categoryid=t.categoryid),1==t.duration?r.timedurationuntil=o:2==t.duration&&(r.timedurationminutes=t.timedurationminutes),t.repeat&&(r.repeats=Number(t.repeats)),e.eventRepeatId&&(r.repeatid=e.eventRepeatId,r.repeateditall=t.repeateditall);const d=yield s.OQ.showModalLoading("core.sending",!0);let l;try{const n=yield _.hU.submitEvent(e.eventId,r,{reminders:e.eventId?[]:e.reminders});if(l=n.event,X.o.triggerFormSubmittedEvent(e.formElement,n.sent,e.currentSite.getId()),n.sent){const o=t.repeat?t.repeats:r.repeateditall&&e.otherEventsCount?e.otherEventsCount+1:1;try{yield m.Lh.refreshAfterChangeEvent(n.event,o)}catch{}}e.returnToList(l)}catch(i){s.OQ.showErrorModalDefault(i,"Error sending data.")}d.dismiss()}))()}returnToList(e){this.unblockSync(),this.eventId&&this.eventId>0?d.R.trigger(_.gi.EDIT_EVENT_EVENT,{eventId:this.eventId},this.currentSite.getId()):d.R.trigger(_.gi.NEW_EVENT_EVENT,{eventId:e.id,oldEventId:this.eventId},this.currentSite.getId()),this.originalData=void 0,y.b.back()}canLeave(){var e=this;return(0,i.Z)((function*(){return m.Lh.hasEventDataChanged(e.form.value,e.originalData)&&(yield s.OQ.showConfirm(E.vN.instant("core.confirmcanceledit"))),X.o.triggerFormCancelledEvent(e.formElement,e.currentSite.getId()),!0}))()}unblockSync(){this.eventId&&K.d.unblockOperation(_.gi.COMPONENT,this.eventId)}initReminders(){var e=this;return(0,i.Z)((function*(){if(!e.remindersEnabled||e.eventId)return;const t=yield ee.hR.getDefaultNotificationTime(e.currentSite.getId());if(t===ee.T1.DISABLED)return;const n=ee.T1.convertSecondsToValueAndUnit(t);e.reminders.push({value:n.value,unit:n.unit,label:ee.hR.getUnitValueLabel(n.value,n.unit,!0)})}))()}addReminder(){var e=this;return(0,i.Z)((function*(){const t=e.form.value,n=A()(t.timestart).unix(),o=yield s.OQ.openPopover({component:te.Y,componentProps:{eventTime:n}});if(void 0===o)return;const a=ee.T1.convertSecondsToValueAndUnit(o.timeBefore);e.reminders.push({time:o.timeBefore,value:a.value,unit:a.unit,label:ee.hR.getUnitValueLabel(a.value,a.unit)})}))()}removeReminder(e){const t=this.reminders.indexOf(e);-1!==t&&this.reminders.splice(t,1)}ngOnDestroy(){this.unblockSync(),this.isDestroyed=!0}}return(e=AddonCalendarEditEventPage).ɵfac=function AddonCalendarEditEventPage_Factory(t){return new(t||e)(N.Y36($.qu))},e.ɵcmp=N.Xpm({type:e,selectors:[["page-addon-calendar-edit-event"]],viewQuery:function AddonCalendarEditEventPage_Query(e,t){if(1&e&&(N.Gf(z.$,5),N.Gf(re,5)),2&e){let e;N.iGM(e=N.CRH())&&(t.descriptionEditor=e.first),N.iGM(e=N.CRH())&&(t.formElement=e.first)}},decls:16,vars:13,consts:[["slot","start"],[3,"text"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[3,"formGroup",4,"ngIf"],["collapsible-footer","","appearOnBottom","","slot","fixed",4,"ngIf"],[3,"formGroup"],["editEventForm",""],[1,"ion-text-wrap"],["labelPlacement","stacked","type","text","name","name","formControlName","name",3,"placeholder"],["slot","label",3,"core-mark-required"],[3,"control"],["position","stacked"],[1,"item-heading",3,"core-mark-required"],["datetime","timestart"],[3,"keepContentsMounted"],[1,"ion-text-wrap","addon-calendar-eventtype-container"],[4,"ngIf"],["slot","end",4,"ngIf"],["formControlName","eventtype","interface","action-sheet",3,"cancelText","interfaceOptions",4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],[1,"ion-text-wrap","addon-calendar-radio-container"],["formControlName","duration"],[1,"addon-calendar-radio-title"],[1,"item-heading"],[3,"value"],["id","durationinminutes"],["class","ion-text-wrap addon-calendar-radio-container",4,"ngIf"],["name","description",3,"control","placeholder","component","componentId","autoSave"],["type","text","name","location","labelPlacement","stacked","formControlName","location",3,"placeholder","label"],["id","timestart","formControlName","timestart","presentation","date-time",3,"max","min"],["slot","title"],["slot","end"],["formControlName","eventtype","interface","action-sheet",3,"cancelText","interfaceOptions"],[3,"value",4,"ngFor","ngForOf"],["formControlName","categoryid","interface","action-sheet",3,"placeholder","cancelText","interfaceOptions"],["formControlName","courseid","interface","action-sheet",3,"placeholder","cancelText","interfaceOptions"],["formControlName","groupcourseid","interface","action-sheet",3,"placeholder","cancelText","interfaceOptions","ionChange"],["class","ion-text-wrap core-danger-item",4,"ngIf"],["class","ion-text-wrap core-edit-set-group",4,"ngIf"],[1,"ion-text-wrap","core-danger-item"],[1,"ion-text-wrap","core-edit-set-group"],["formControlName","groupid","interface","action-sheet",3,"placeholder","cancelText","interfaceOptions"],[1,"addon-calendar-reminders-title"],["fill","clear","slot","end",3,"click"],["name","fas-plus","slot","icon-only","aria-hidden","true"],["class","ion-text-wrap",4,"ngFor","ngForOf"],["name","fas-trash","color","danger","slot","icon-only","aria-hidden","true"],["datetime","timedurationuntil"],["id","timedurationuntil","formControlName","timedurationuntil","presentation","date-time",3,"max","min"],["type","number","name","timedurationminutes","labelPlacement","start","aria-labelledby","durationinminutes","formControlName","timedurationminutes",3,"placeholder"],[1,"ion-text-wrap","divider"],["labelPlacement","start","formControlName","repeat"],["labelPlacement","stacked","type","number","name","repeats","formControlName","repeats",3,"label","disabled"],["formControlName","repeateditall"],["value","1"],["value","0"],["collapsible-footer","","appearOnBottom","","slot","fixed"],[1,"list-item-limited-width","adaptable-buttons-row"],["expand","block","type","submit",1,"ion-margin","ion-text-wrap",3,"disabled","click"]],template:function AddonCalendarEditEventPage_Template(e,t){1&e&&(N.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),N._UZ(3,"ion-back-button",1),N.ALo(4,"translate"),N.qZA(),N.TgZ(5,"ion-title")(6,"h1"),N._uU(7),N.ALo(8,"translate"),N.qZA()()()(),N.TgZ(9,"ion-content")(10,"ion-refresher",2),N.NdJ("ionRefresh",(function AddonCalendarEditEventPage_Template_ion_refresher_ionRefresh_10_listener(e){return t.refreshData(e.target)})),N._UZ(11,"ion-refresher-content",3),N.ALo(12,"translate"),N.qZA(),N.TgZ(13,"core-loading",4),N.YNc(14,AddonCalendarEditEventPage_form_14_Template,64,60,"form",5)(15,AddonCalendarEditEventPage_div_15_Template,5,4,"div",6),N.qZA()()),2&e&&(N.xp6(3),N.Q6J("text",N.lcZ(4,7,"core.back")),N.xp6(4),N.Oqu(N.lcZ(8,9,t.title)),N.xp6(3),N.Q6J("disabled",!t.loaded),N.xp6(),N.s9C("pullingText",N.lcZ(12,11,"core.pulltorefresh")),N.xp6(2),N.Q6J("hideUntil",t.loaded),N.xp6(),N.Q6J("ngIf",!t.error),N.xp6(),N.Q6J("ngIf",t.loaded&&!t.error))},dependencies:[L.sg,L.O5,ne.v,S.r,oe.O,M.I,ae.u,F.t,V.O,ie.P,$._Y,$.JJ,$.JL,G.YG,G.Sm,G.nz,G.W2,G.x4,G.Mj,G.Gu,G.gu,G.pK,G.Ie,G.rH,G.Q$,G.B7,G.se,G.nJ,G.Wo,G.t9,G.n0,G.PQ,G.wd,G.sr,G.ki,G.w,G.as,G.U5,G.QI,G.j9,G.oU,$.sg,$.u,z.$,Y.X$],styles:["[_nghost-%COMP%]   .addon-calendar-eventtype-container.item-select-disabled[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%], [_nghost-%COMP%]   .addon-calendar-eventtype-container.item-select-disabled[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]{opacity:1}[_nghost-%COMP%]   .addon-calendar-eventtype-container.item-select-disabled[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]::part(icon){display:none}"]}),AddonCalendarEditEventPage})();var le=n(34749),se=n(73180),ce=n(67643),_e=n(71460),ue=n(21525),me=n(60067),ge=n(5065);function AddonCalendarEventPage_h1_6_Template(e,t){if(1&e&&(N.TgZ(0,"h1"),N._UZ(1,"core-format-text",13),N.qZA()),2&e){const e=N.oxw();N.xp6(),N.Q6J("text",e.event.name)("contextLevel",e.event.contextLevel)("contextInstanceId",e.event.contextInstanceId)}}function AddonCalendarEventPage_ion_list_22_core_mod_icon_2_Template(e,t){if(1&e&&N._UZ(0,"core-mod-icon",27),2&e){const e=N.oxw(2);N.Q6J("modicon",e.event.moduleIcon)("showAlt",!1)("modname",e.event.modulename)("componentId",e.event.instance)("purpose",e.event.purpose)}}function AddonCalendarEventPage_ion_list_22_ion_icon_3_Template(e,t){if(1&e&&N._UZ(0,"ion-icon",28),2&e){const e=N.oxw(2);N.Q6J("name",e.event.eventIcon)}}function AddonCalendarEventPage_ion_list_22_span_8_Template(e,t){if(1&e&&(N.TgZ(0,"span",17),N._uU(1),N.qZA()),2&e){const e=N.oxw(2);N.xp6(),N.Oqu(e.event.iconTitle)}}const event_c0=e=>({$a:e});function AddonCalendarEventPage_ion_list_22_ion_card_11_Template(e,t){1&e&&(N.TgZ(0,"ion-card",29)(1,"ion-item"),N._UZ(2,"ion-icon",30),N.TgZ(3,"ion-label"),N._uU(4),N.ALo(5,"translate"),N.ALo(6,"translate"),N.qZA()()()),2&e&&(N.xp6(4),N.Oqu(N.xi3(5,1,"core.hasdatatosync",N.VKq(6,event_c0,N.lcZ(6,4,"addon.calendar.calendarevent")))))}function AddonCalendarEventPage_ion_list_22_ion_note_18_Template(e,t){1&e&&(N.TgZ(0,"ion-note",4),N._UZ(1,"ion-icon",31),N._uU(2),N.ALo(3,"translate"),N.qZA()),2&e&&(N.xp6(2),N.hij(" ",N.lcZ(3,1,"core.deletedoffline")," "))}function AddonCalendarEventPage_ion_list_22_ion_item_27_Template(e,t){if(1&e&&(N.TgZ(0,"ion-item",32)(1,"ion-label")(2,"p",21),N._uU(3),N.ALo(4,"translate"),N.qZA(),N.TgZ(5,"p"),N._UZ(6,"core-format-text",33),N.qZA()()()),2&e){const e=N.oxw(2);N.Q6J("href",e.courseUrl)("detail",!0),N.xp6(3),N.Oqu(N.lcZ(4,5,"core.course")),N.xp6(3),N.Q6J("text",e.courseName)("contextInstanceId",e.courseId)}}function AddonCalendarEventPage_ion_list_22_ion_item_28_Template(e,t){if(1&e&&(N.TgZ(0,"ion-item",34)(1,"ion-label")(2,"p",21),N._uU(3),N.ALo(4,"translate"),N.qZA(),N.TgZ(5,"p"),N._UZ(6,"core-format-text",33),N.qZA()()()),2&e){const e=N.oxw(2);N.xp6(3),N.Oqu(N.lcZ(4,3,"core.group")),N.xp6(3),N.Q6J("text",e.groupName)("contextInstanceId",e.event.courseid)}}function AddonCalendarEventPage_ion_list_22_ion_item_29_Template(e,t){if(1&e&&(N.TgZ(0,"ion-item",20)(1,"ion-label")(2,"p",21),N._uU(3),N.ALo(4,"translate"),N.qZA(),N.TgZ(5,"p"),N._UZ(6,"core-format-text",35),N.qZA()()()),2&e){const e=N.oxw(2);N.xp6(3),N.Oqu(N.lcZ(4,3,"core.category")),N.xp6(3),N.Q6J("text",e.categoryPath)("contextInstanceId",e.event.categoryid)}}function AddonCalendarEventPage_ion_list_22_ion_item_30_Template(e,t){if(1&e&&(N.TgZ(0,"ion-item",20)(1,"ion-label")(2,"p",21),N._uU(3),N.ALo(4,"translate"),N.qZA(),N.TgZ(5,"p"),N._UZ(6,"core-format-text",13),N.qZA()()()),2&e){const e=N.oxw(2);N.xp6(3),N.Oqu(N.lcZ(4,4,"core.description")),N.xp6(3),N.Q6J("text",e.event.description)("contextLevel",e.event.contextLevel)("contextInstanceId",e.event.contextInstanceId)}}function AddonCalendarEventPage_ion_list_22_ion_item_31_Template(e,t){if(1&e&&(N.TgZ(0,"ion-item",20)(1,"ion-label")(2,"p",21),N._uU(3),N.ALo(4,"translate"),N.qZA(),N.TgZ(5,"p")(6,"a",36),N._UZ(7,"core-format-text",13),N.qZA()()()()),2&e){const e=N.oxw(2);N.xp6(3),N.Oqu(N.lcZ(4,5,"core.location")),N.xp6(3),N.Q6J("href",e.event.encodedLocation,N.LSH),N.xp6(),N.Q6J("text",e.event.location)("contextLevel",e.event.contextLevel)("contextInstanceId",e.event.contextInstanceId)}}function AddonCalendarEventPage_ion_list_22_ion_item_32_Template(e,t){if(1&e&&(N.TgZ(0,"ion-item")(1,"ion-label")(2,"ion-button",37),N._uU(3),N.ALo(4,"translate"),N.qZA()()()),2&e){const e=N.oxw(2);N.xp6(2),N.Q6J("href",e.moduleUrl),N.xp6(),N.hij(" ",N.lcZ(4,2,"addon.calendar.gotoactivity")," ")}}const event_c1=e=>[e];function AddonCalendarEventPage_ion_list_22_Template(e,t){if(1&e&&(N.TgZ(0,"ion-list")(1,"ion-item",14),N.YNc(2,AddonCalendarEventPage_ion_list_22_core_mod_icon_2_Template,1,5,"core-mod-icon",15)(3,AddonCalendarEventPage_ion_list_22_ion_icon_3_Template,1,1,"ion-icon",16),N.TgZ(4,"ion-label")(5,"span",17),N._uU(6),N.ALo(7,"translate"),N.YNc(8,AddonCalendarEventPage_ion_list_22_span_8_Template,2,1,"span",18),N.qZA(),N.TgZ(9,"h1"),N._UZ(10,"core-format-text",13),N.qZA()()(),N.YNc(11,AddonCalendarEventPage_ion_list_22_ion_card_11_Template,7,8,"ion-card",19),N.TgZ(12,"ion-item",20)(13,"ion-label")(14,"p",21),N._uU(15),N.ALo(16,"translate"),N.qZA(),N._UZ(17,"core-format-text",22),N.qZA(),N.YNc(18,AddonCalendarEventPage_ion_list_22_ion_note_18_Template,4,3,"ion-note",23),N.qZA(),N.TgZ(19,"ion-item")(20,"ion-label")(21,"p",21),N._uU(22),N.ALo(23,"translate"),N.qZA(),N.TgZ(24,"p"),N._uU(25),N.ALo(26,"translate"),N.qZA()()(),N.YNc(27,AddonCalendarEventPage_ion_list_22_ion_item_27_Template,7,7,"ion-item",24)(28,AddonCalendarEventPage_ion_list_22_ion_item_28_Template,7,5,"ion-item",25)(29,AddonCalendarEventPage_ion_list_22_ion_item_29_Template,7,5,"ion-item",26)(30,AddonCalendarEventPage_ion_list_22_ion_item_30_Template,7,6,"ion-item",26)(31,AddonCalendarEventPage_ion_list_22_ion_item_31_Template,8,7,"ion-item",26)(32,AddonCalendarEventPage_ion_list_22_ion_item_32_Template,5,4,"ion-item",3),N.qZA()),2&e){const e=N.oxw();N.xp6(),N.Q6J("ngClass",N.VKq(29,event_c1,"addon-calendar-eventtype-"+e.event.eventtype)),N.xp6(),N.Q6J("ngIf",e.event.moduleIcon),N.xp6(),N.Q6J("ngIf",e.event.eventIcon&&!e.event.moduleIcon),N.xp6(3),N.hij(" ",N.lcZ(7,21,"addon.calendar.type"+e.event.formattedType)," "),N.xp6(2),N.Q6J("ngIf",e.event.moduleIcon&&e.event.iconTitle),N.xp6(2),N.Q6J("text",e.event.name)("contextLevel",e.event.contextLevel)("contextInstanceId",e.event.contextInstanceId),N.xp6(),N.Q6J("ngIf",e.hasOffline||e.event.deleted),N.xp6(4),N.Oqu(N.lcZ(16,23,"addon.calendar.when")),N.xp6(2),N.Q6J("text",e.event.formattedtime)("filter",!1),N.xp6(),N.Q6J("ngIf",e.event.deleted),N.xp6(4),N.Oqu(N.lcZ(23,25,"addon.calendar.eventtype")),N.xp6(3),N.Oqu(N.lcZ(26,27,"addon.calendar.type"+e.event.formattedType)),N.xp6(2),N.Q6J("ngIf",e.courseName),N.xp6(),N.Q6J("ngIf",e.groupName),N.xp6(),N.Q6J("ngIf",e.categoryPath),N.xp6(),N.Q6J("ngIf",e.event.description),N.xp6(),N.Q6J("ngIf",e.event.location),N.xp6(),N.Q6J("ngIf",e.moduleUrl)}}function AddonCalendarEventPage_ion_card_23_ng_container_6_ion_item_1_p_4_Template(e,t){if(1&e&&(N.TgZ(0,"p"),N._uU(1),N.qZA()),2&e){const e=N.oxw(2).$implicit;N.xp6(),N.Oqu(e.sublabel)}}function AddonCalendarEventPage_ion_card_23_ng_container_6_ion_item_1_Template(e,t){if(1&e){const e=N.EpF();N.TgZ(0,"ion-item",20)(1,"ion-label")(2,"p",21),N._uU(3),N.qZA(),N.YNc(4,AddonCalendarEventPage_ion_card_23_ng_container_6_ion_item_1_p_4_Template,2,1,"p",3),N.qZA(),N.TgZ(5,"ion-button",40),N.NdJ("click",(function AddonCalendarEventPage_ion_card_23_ng_container_6_ion_item_1_Template_ion_button_click_5_listener(t){N.CHM(e);const n=N.oxw().$implicit,o=N.oxw(2);return N.KtG(o.deleteReminder(n.id,t))})),N.ALo(6,"translate"),N._UZ(7,"ion-icon",41),N.qZA()()}if(2&e){const e=N.oxw().$implicit,t=N.oxw(2);N.ekj("item-dimmed",e.timestamp<=t.currentTime),N.xp6(3),N.Oqu(e.label),N.xp6(),N.Q6J("ngIf",e.sublabel),N.xp6(),N.uIk("aria-label",N.lcZ(6,5,"core.delete"))}}function AddonCalendarEventPage_ion_card_23_ng_container_6_Template(e,t){if(1&e&&(N.ynx(0),N.YNc(1,AddonCalendarEventPage_ion_card_23_ng_container_6_ion_item_1_Template,8,7,"ion-item",39),N.BQk()),2&e){const e=t.$implicit;N.xp6(),N.Q6J("ngIf",e.timestamp>0)}}function AddonCalendarEventPage_ion_card_23_ng_container_7_Template(e,t){if(1&e){const e=N.EpF();N.ynx(0),N.TgZ(1,"ion-item")(2,"ion-label")(3,"ion-button",42),N.NdJ("click",(function AddonCalendarEventPage_ion_card_23_ng_container_7_Template_ion_button_click_3_listener(){N.CHM(e);const t=N.oxw(2);return N.KtG(t.addReminder())})),N._uU(4),N.ALo(5,"translate"),N.qZA()()(),N.BQk()}2&e&&(N.xp6(4),N.hij(" ",N.lcZ(5,1,"addon.calendar.setnewreminder")," "))}function AddonCalendarEventPage_ion_card_23_Template(e,t){if(1&e&&(N.TgZ(0,"ion-card")(1,"ion-item")(2,"ion-label")(3,"h2"),N._uU(4),N.ALo(5,"translate"),N.qZA()()(),N.YNc(6,AddonCalendarEventPage_ion_card_23_ng_container_6_Template,2,1,"ng-container",38)(7,AddonCalendarEventPage_ion_card_23_ng_container_7_Template,6,3,"ng-container",3),N.qZA()),2&e){const e=N.oxw();N.xp6(4),N.Oqu(N.lcZ(5,3,"addon.calendar.reminders")),N.xp6(2),N.Q6J("ngForOf",e.reminders),N.xp6(),N.Q6J("ngIf",e.event.timestart>e.currentTime)}}let pe=(()=>{var e;class AddonCalendarEventPage{constructor(e){this.route=e,this.eventLoaded=!1,this.courseName="",this.courseUrl="",this.remindersEnabled=!1,this.moduleUrl="",this.categoryPath="",this.currentTime=-1,this.reminders=[],this.canEdit=!1,this.hasOffline=!1,this.isOnline=!1,this.syncIcon=x.i.ICON_LOADING,this.remindersEnabled=ee.hR.isEnabled(),this.siteHomeId=l.m9.getCurrentSiteHomeId(),this.currentSiteId=l.m9.getCurrentSiteId(),this.canEdit=_.hU.canEditEventsInSite(),this.editEventObserver=d.R.on(_.gi.EDIT_EVENT_EVENT,(e=>{e&&e.eventId===this.eventId&&(this.eventLoaded=!1,this.refreshEvent(!0,!1))}),this.currentSiteId),this.newEventObserver=d.R.on(_.gi.NEW_EVENT_EVENT,(e=>{this.eventId<0&&e&&(e.eventId===this.eventId||e.oldEventId===this.eventId)&&(this.eventId=e.eventId,this.eventLoaded=!1,this.refreshEvent(!0,!1))}),this.currentSiteId),this.syncObserver=d.R.on(g.U.AUTO_SYNCED,(e=>this.checkSyncResult(!1,e)),this.currentSiteId),this.manualSyncObserver=d.R.on(g.U.MANUAL_SYNCED,(e=>this.checkSyncResult(!0,e)),this.currentSiteId),this.onlineObserver=r.AS.onChange().subscribe((()=>{E.R0.run((()=>{this.isOnline=r.AS.isOnline()}))})),this.defaultTimeChangedObserver=d.R.on(ee.T1.DEFAULT_NOTIFICATION_TIME_CHANGED,(()=>{this.loadReminders()}),this.currentSiteId),this.currentTime=c.D.timestamp(),this.updateCurrentTime=window.setInterval((()=>{this.currentTime=c.D.timestamp()}),5e3)}loadReminders(){var e=this;return(0,i.Z)((function*(){e.remindersEnabled&&e.event&&(e.reminders=yield m.Lh.getEventReminders(e.eventId,e.event.timestart,e.currentSiteId))}))()}ngOnInit(){var e=this;return(0,i.Z)((function*(){try{e.eventId=y.b.getRequiredRouteNumberParam("id")}catch(e){return s.OQ.showErrorModal(e),y.b.back(),void 0}e.syncIcon=x.i.ICON_LOADING,yield e.initializeSwipeManager(),yield e.fetchEvent()}))()}fetchEvent(e=!1,t=!1){var n=this;return(0,i.Z)((function*(){if(n.isOnline=r.AS.isOnline(),e){if(yield n.syncEvents(t))return}try{if(n.eventId>=0){const e=yield _.hU.getEventById(n.eventId);n.event=yield m.Lh.formatEventData(e)}try{const e=m.Lh.formatOfflineEventData(yield u.F.getEvent(n.eventId));n.hasOffline=!0,n.event=Object.assign(n.event||{},e)}catch{if(n.hasOffline=!1,n.eventId<0)return s.OQ.showErrorModal("Event not found."),y.b.back(),void 0}if(!n.event)return;if(n.loadReminders(),n.categoryPath="",n.courseName="",n.courseUrl="",n.moduleUrl="",n.event.moduleIcon){const e=se.FO.translateModuleName(n.event.modulename||"");-1===e.indexOf("core.mod_")&&(n.event.modulename=e),n.moduleUrl=n.event.url||""}const e=[],t=n.event,o=n.event.courseid;o!=n.siteHomeId&&n.event.course&&(n.courseId=n.event.course.id,n.courseName=n.event.course.fullname,n.courseUrl=n.event.course.viewurl),o&&n.event.groupid&&(n.groupName=t.groupname),n.event.iscategoryevent&&n.event.category&&(n.categoryPath=n.event.category.nestedname),n.event.location&&(n.event.location=le._1.decodeHTML(n.event.location),n.event.encodedLocation=le._1.buildAddressURL(n.event.location)),e.push(u.F.isEventDeleted(n.eventId).then((e=>{t.deleted=e}))),e.push(_.hU.getCalendarTimeFormat().then(function(){var e=(0,i.Z)((function*(e){t.formattedtime=yield _.hU.formatEventTime(t,e)}));return function(t){return e.apply(this,arguments)}}())),yield Promise.all(e)}catch(e){s.OQ.showErrorModalDefault(e,"addon.calendar.errorloadevent",!0)}n.eventLoaded=!0,n.syncIcon=x.i.ICON_SYNC}))()}initializeSwipeManager(){var e=this;return(0,i.Z)((function*(){const t=y.b.getRouteParam("date"),n=t&&b.p.getSource(AddonCalendarEventsSource,[t]);n&&(e.events=new AddonCalendarEventsSwipeItemsManager(n),yield e.events.start())}))()}syncEvents(e=!1){var t=this;return(0,i.Z)((function*(){let n=!1;try{const e=yield g.a.syncEvents();e.warnings&&e.warnings.length&&s.OQ.showAlert(void 0,e.warnings[0]),e.deleted&&-1!=e.deleted.indexOf(t.eventId)?n=!0:t.eventId<0&&e.offlineIdMap[t.eventId]&&(t.eventId=e.offlineIdMap[t.eventId]),e.updated&&(e.source="event",d.R.trigger(g.U.MANUAL_SYNCED,e,t.currentSiteId))}catch(t){e&&s.OQ.showErrorModalDefault(t,"core.errorsync",!0)}return n}))()}addReminder(){var e=this;return(0,i.Z)((function*(){if(!e.event||!e.event.id)return;const t=yield s.OQ.openPopover({component:te.Y,componentProps:{eventTime:e.event.timestart}});void 0!==t&&(yield _.hU.addEventReminder(e.event,t.timeBefore,e.currentSiteId),yield e.loadReminders())}))()}deleteReminder(e,t){var n=this;return(0,i.Z)((function*(){t.preventDefault(),t.stopPropagation();try{yield s.OQ.showDeleteConfirm();const t=yield s.OQ.showModalLoading("core.deleting",!0);try{yield ee.hR.removeReminder(e),yield n.loadReminders()}catch(e){s.OQ.showErrorModalDefault(e,"Error deleting reminder")}finally{t.dismiss()}}catch{}}))()}doRefresh(e,t,n=!1){var o=this;return(0,i.Z)((function*(){o.eventLoaded&&(yield o.refreshEvent(!0,n).finally((()=>{null==e||e.complete(),t&&t()})))}))()}refreshEvent(e=!1,t=!1){var n=this;return(0,i.Z)((function*(){n.syncIcon=x.i.ICON_LOADING;const o=[];n.eventId>0&&o.push(_.hU.invalidateEvent(n.eventId)),o.push(_.hU.invalidateTimeFormat()),yield C.Tr.allPromisesIgnoringErrors(o),yield n.fetchEvent(e,t)}))()}openEdit(){y.b.navigateToSitePath(`/calendar/edit/${this.eventId}`)}deleteEvent(){var e=this;return(0,i.Z)((function*(){if(!e.event)return;const t=E.vN.instant("addon.calendar.deleteevent"),n={};let o;e.event.eventcount>1?(o=E.vN.instant("addon.calendar.confirmeventseriesdelete",{$a:{name:e.event.name,count:e.event.eventcount}}),n.inputs=[{type:"radio",name:"deleteall",checked:!0,value:!1,label:E.vN.instant("addon.calendar.deleteoneevent")},{type:"radio",name:"deleteall",checked:!1,value:!0,label:E.vN.instant("addon.calendar.deleteallevents")}]):o=E.vN.instant("addon.calendar.confirmeventdelete",{$a:e.event.name});let a=!1;try{a=yield s.OQ.showConfirm(o,t,void 0,void 0,n)}catch{return}const i=yield s.OQ.showModalLoading("core.sending",!0);try{let t=!1;if(e.event.id<0?yield u.F.deleteEvent(e.event.id):t=yield _.hU.deleteEvent(e.event.id,e.event.name,a),t)try{yield m.Lh.refreshAfterChangeEvent(e.event,a?e.event.eventcount:1)}catch{}e.event.id<0?d.R.trigger(_.gi.NEW_EVENT_DISCARDED_EVENT,{},l.m9.getCurrentSiteId()):d.R.trigger(_.gi.DELETED_EVENT_EVENT,{eventId:e.eventId,sent:t},l.m9.getCurrentSiteId()),t||e.event.id<0?(s.OQ.showToast("addon.calendar.eventcalendareventdeleted",!0,s.O2.LONG),y.b.back()):e.event.deleted=!0}catch(e){s.OQ.showErrorModalDefault(e,"Error deleting event.")}i.dismiss()}))()}undoDelete(){var e=this;return(0,i.Z)((function*(){if(!e.event)return;const t=yield s.OQ.showModalLoading("core.sending",!0);try{yield u.F.unmarkDeleted(e.event.id),d.R.trigger(_.gi.UNDELETED_EVENT_EVENT,{eventId:e.eventId},l.m9.getCurrentSiteId()),e.event.deleted=!1}catch(e){s.OQ.showErrorModalDefault(e,"Error undeleting event.")}t.dismiss()}))()}checkSyncResult(e,t){if(t)if(t.deleted&&-1!=t.deleted.indexOf(this.eventId))s.OQ.showToast("addon.calendar.eventcalendareventdeleted",!0,s.O2.LONG),y.b.back();else if(t.events&&(!e||"event"!=t.source))if(this.eventId<0)t.offlineIdMap[this.eventId]&&(this.eventId=t.offlineIdMap[this.eventId],this.eventLoaded=!1,this.refreshEvent());else{t.events.find((e=>e.id==this.eventId))&&(this.eventLoaded=!1,this.refreshEvent())}}ngOnDestroy(){var e;this.editEventObserver.off(),this.syncObserver.off(),this.manualSyncObserver.off(),this.onlineObserver.unsubscribe(),this.newEventObserver.off(),null===(e=this.events)||void 0===e||e.destroy(),clearInterval(this.updateCurrentTime)}}return(e=AddonCalendarEventPage).ɵfac=function AddonCalendarEventPage_Factory(t){return new(t||e)(N.Y36(ce.gz))},e.ɵcmp=N.Xpm({type:e,selectors:[["page-addon-calendar-event"]],decls:24,vars:34,consts:[["collapsible",""],["slot","start"],[3,"text"],[4,"ngIf"],["slot","end"],[3,"hidden","priority","content","iconAction","closeOnClick","action"],["iconAction","fas-pen",3,"hidden","priority","content","action"],["iconAction","fas-trash",3,"hidden","priority","content","action"],["iconAction","fas-rotate-left",3,"hidden","priority","content","action"],[3,"core-swipe-navigation"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[3,"text","contextLevel","contextInstanceId"],["collapsible","",1,"ion-text-wrap","addon-calendar-event",3,"ngClass"],["slot","start",3,"modicon","showAlt","modname","componentId","purpose",4,"ngIf"],["aria-hidden","true","slot","start",3,"name",4,"ngIf"],[1,"sr-only"],["class","sr-only",4,"ngIf"],["class","core-warning-card",4,"ngIf"],[1,"ion-text-wrap"],[1,"item-heading"],[3,"text","filter"],["slot","end",4,"ngIf"],["class","ion-text-wrap","core-link","","capture","true",3,"href","detail",4,"ngIf"],["class","ion-text-wrap core-groupname",4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],["slot","start",3,"modicon","showAlt","modname","componentId","purpose"],["aria-hidden","true","slot","start",3,"name"],[1,"core-warning-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],["name","fas-trash","aria-hidden","true"],["core-link","","capture","true",1,"ion-text-wrap",3,"href","detail"],["contextLevel","course",3,"text","contextInstanceId"],[1,"ion-text-wrap","core-groupname"],["contextLevel","coursecat",3,"text","contextInstanceId"],["core-link","","auto-login","no",3,"href"],["expand","block","core-link","","capture","true",3,"href"],[4,"ngFor","ngForOf"],["class","ion-text-wrap",3,"item-dimmed",4,"ngIf"],["fill","clear","slot","end",3,"click"],["name","fas-trash","color","danger","slot","icon-only","aria-hidden","true"],["expand","block",3,"click"]],template:function AddonCalendarEventPage_Template(e,t){1&e&&(N.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),N._UZ(3,"ion-back-button",2),N.ALo(4,"translate"),N.qZA(),N.TgZ(5,"ion-title"),N.YNc(6,AddonCalendarEventPage_h1_6_Template,2,3,"h1",3),N.qZA(),N.TgZ(7,"ion-buttons",4)(8,"core-context-menu")(9,"core-context-menu-item",5),N.NdJ("action",(function AddonCalendarEventPage_Template_core_context_menu_item_action_9_listener(e){return t.doRefresh(void 0,e,!0)})),N.ALo(10,"translate"),N.qZA(),N.TgZ(11,"core-context-menu-item",6),N.NdJ("action",(function AddonCalendarEventPage_Template_core_context_menu_item_action_11_listener(){return t.openEdit()})),N.ALo(12,"translate"),N.qZA(),N.TgZ(13,"core-context-menu-item",7),N.NdJ("action",(function AddonCalendarEventPage_Template_core_context_menu_item_action_13_listener(){return t.deleteEvent()})),N.ALo(14,"translate"),N.qZA(),N.TgZ(15,"core-context-menu-item",8),N.NdJ("action",(function AddonCalendarEventPage_Template_core_context_menu_item_action_15_listener(){return t.undoDelete()})),N.ALo(16,"translate"),N.qZA()()()()(),N.TgZ(17,"ion-content",9)(18,"ion-refresher",10),N.NdJ("ionRefresh",(function AddonCalendarEventPage_Template_ion_refresher_ionRefresh_18_listener(e){return t.doRefresh(e.target)})),N._UZ(19,"ion-refresher-content",11),N.ALo(20,"translate"),N.qZA(),N.TgZ(21,"core-loading",12),N.YNc(22,AddonCalendarEventPage_ion_list_22_Template,33,31,"ion-list",3)(23,AddonCalendarEventPage_ion_card_23_Template,8,5,"ion-card",3),N.qZA()()),2&e&&(N.xp6(3),N.Q6J("text",N.lcZ(4,22,"core.back")),N.xp6(3),N.Q6J("ngIf",t.event),N.xp6(3),N.Q6J("hidden",!t.eventLoaded||!t.hasOffline&&t.event&&!t.event.deleted||!t.isOnline)("priority",400)("content",N.lcZ(10,24,"core.settings.synchronizenow"))("iconAction",t.syncIcon)("closeOnClick",!1),N.xp6(2),N.Q6J("hidden",!t.event||!t.event.canedit||t.event.deleted||!t.canEdit&&t.event.id>0)("priority",300)("content",N.lcZ(12,26,"core.edit")),N.xp6(2),N.Q6J("hidden",!t.event||!t.event.candelete||t.event.deleted)("priority",200)("content",N.lcZ(14,28,"core.delete")),N.xp6(2),N.Q6J("hidden",!t.event||!t.event.deleted)("priority",200)("content",N.lcZ(16,30,"core.restore")),N.xp6(2),N.Q6J("core-swipe-navigation",t.events),N.xp6(),N.Q6J("disabled",!t.eventLoaded),N.xp6(),N.s9C("pullingText",N.lcZ(20,32,"core.pulltorefresh")),N.xp6(2),N.Q6J("hideUntil",t.eventLoaded),N.xp6(),N.Q6J("ngIf",t.event),N.xp6(),N.Q6J("ngIf",t.remindersEnabled&&t.event))},dependencies:[L.mk,L.sg,L.O5,q.P,U.l,S.r,J.o,M.I,R.r,ue.y,me.e,ge.g,F.t,V.O,G.YG,G.Sm,G.PM,G.W2,G.Gu,G.gu,G.Ie,G.Q$,G.q_,G.uN,G.nJ,G.Wo,G.wd,G.sr,G.oU,Y.X$],styles:["[_nghost-%COMP%]{--addon-calendar-blank-day-background-color: var(--light)}[_nghost-%COMP%]   .item.addon-calendar-event[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{color:#fff;border-radius:50%;padding:.7rem;--margin-vertical: 12px;--margin-end: 12px;margin-top:var(--margin-vertical);margin-bottom:var(--margin-vertical);margin-inline-end:var(--margin-end)}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-category[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#8e24aa}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-course[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#ca3120}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-group[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#f0ad4e}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-user[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#0f6cbf}[_nghost-%COMP%]   .item.addon-calendar-event.addon-calendar-eventtype-site[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{background-color:#357a32}","[_nghost-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{font-size:1.6rem}"]}),AddonCalendarEventPage})();class AddonCalendarEventsSwipeItemsManager extends _e.t{getSelectedItemPathFromRoute(e){return(e instanceof ce.De?e:e.snapshot).params.id}}var fe=n(62166),ve=n(50810),he=n(52467),Ae=n(83431);function AddonCalendarIndexPage_core_context_menu_item_14_Template(e,t){if(1&e){const e=N.EpF();N.TgZ(0,"core-context-menu-item",15),N.NdJ("action",(function AddonCalendarIndexPage_core_context_menu_item_14_Template_core_context_menu_item_action_0_listener(){N.CHM(e);const t=N.oxw();return N.KtG(t.toggleDisplay())})),N.ALo(1,"translate"),N.qZA()}2&e&&N.Q6J("priority",800)("content",N.lcZ(1,2,"addon.calendar.upcomingevents"))}function AddonCalendarIndexPage_core_context_menu_item_15_Template(e,t){if(1&e){const e=N.EpF();N.TgZ(0,"core-context-menu-item",16),N.NdJ("action",(function AddonCalendarIndexPage_core_context_menu_item_15_Template_core_context_menu_item_action_0_listener(){N.CHM(e);const t=N.oxw();return N.KtG(t.toggleDisplay())})),N.ALo(1,"translate"),N.qZA()}2&e&&N.Q6J("priority",800)("content",N.lcZ(1,2,"addon.calendar.monthlyview"))}const index_c0=e=>({$a:e});function AddonCalendarIndexPage_ion_card_25_Template(e,t){1&e&&(N.TgZ(0,"ion-card",17)(1,"ion-item"),N._UZ(2,"ion-icon",18),N.TgZ(3,"ion-label"),N._uU(4),N.ALo(5,"translate"),N.ALo(6,"translate"),N.qZA()()()),2&e&&(N.xp6(4),N.Oqu(N.xi3(5,1,"core.hasdatatosync",N.VKq(6,index_c0,N.lcZ(6,4,"addon.calendar.calendar")))))}function AddonCalendarIndexPage_addon_calendar_upcoming_events_27_Template(e,t){if(1&e){const e=N.EpF();N.TgZ(0,"addon-calendar-upcoming-events",19),N.NdJ("onEventClicked",(function AddonCalendarIndexPage_addon_calendar_upcoming_events_27_Template_addon_calendar_upcoming_events_onEventClicked_0_listener(t){N.CHM(e);const n=N.oxw();return N.KtG(n.gotoEvent(t))})),N.qZA()}if(2&e){const e=N.oxw();N.Q6J("hidden",e.showCalendar)("filter",e.filter)}}function AddonCalendarIndexPage_ion_fab_28_Template(e,t){if(1&e){const e=N.EpF();N.TgZ(0,"ion-fab",20)(1,"ion-fab-button",21),N.NdJ("click",(function AddonCalendarIndexPage_ion_fab_28_Template_ion_fab_button_click_1_listener(){N.CHM(e);const t=N.oxw();return N.KtG(t.openEdit())})),N.ALo(2,"translate"),N._UZ(3,"ion-icon",22),N.TgZ(4,"span",23),N._uU(5),N.ALo(6,"translate"),N.qZA()()()}2&e&&(N.xp6(),N.uIk("aria-label",N.lcZ(2,2,"addon.calendar.newevent")),N.xp6(4),N.Oqu(N.lcZ(6,4,"addon.calendar.newevent")))}let Ee=(()=>{var e;class AddonCalendarIndexPage{constructor(e){var t=this;this.route=e,this.canCreate=!1,this.courses=[],this.loaded=!1,this.hasOffline=!1,this.isOnline=!1,this.syncIcon=x.i.ICON_LOADING,this.showCalendar=!0,this.loadUpcoming=!1,this.filter={filtered:!1,courseId:void 0,categoryId:void 0,course:!0,group:!0,site:!0,user:!0,category:!0},this.currentSiteId=l.m9.getCurrentSiteId(),this.newEventObserver=d.R.on(_.gi.NEW_EVENT_EVENT,(e=>{e&&e.eventId&&(this.loaded=!1,this.refreshData(!0,!1,!0))}),this.currentSiteId),this.discardedObserver=d.R.on(_.gi.NEW_EVENT_DISCARDED_EVENT,(()=>{this.loaded=!1,this.refreshData(!0,!1,!0)}),this.currentSiteId),this.editEventObserver=d.R.on(_.gi.EDIT_EVENT_EVENT,(e=>{e&&e.eventId&&(this.loaded=!1,this.refreshData(!0,!1,!0))}),this.currentSiteId),this.syncObserver=d.R.on(g.U.AUTO_SYNCED,(()=>{this.loaded=!1,this.refreshData(!1,!1,!0)}),this.currentSiteId),this.manualSyncObserver=d.R.on(g.U.MANUAL_SYNCED,(e=>{e&&"index"!=e.source&&(this.loaded=!1,this.refreshData(!1,!1,!0))}),this.currentSiteId),this.deleteEventObserver=d.R.on(_.gi.DELETED_EVENT_EVENT,(()=>{this.loaded=!1,this.refreshData(!1,!1,!0)}),this.currentSiteId),this.undeleteEventObserver=d.R.on(_.gi.UNDELETED_EVENT_EVENT,(0,i.Z)((function*(){t.hasOffline=yield u.F.hasOfflineData()})),this.currentSiteId),this.filterChangedObserver=d.R.on(_.gi.FILTER_CHANGED_EVENT,function(){var e=(0,i.Z)((function*(e){t.filter=e,t.canCreate=yield m.Lh.canEditEvents(t.filter.courseId)}));return function(t){return e.apply(this,arguments)}}()),this.onlineObserver=r.AS.onChange().subscribe((()=>{E.R0.run((()=>{this.isOnline=r.AS.isOnline()}))}))}ngOnInit(){var e=this;this.loadUpcoming=!!y.b.getRouteBooleanParam("upcoming"),this.showCalendar=!this.loadUpcoming,this.route.queryParams.subscribe((0,i.Z)((function*(){e.filter.courseId=y.b.getRouteNumberParam("courseId"),e.year=y.b.getRouteNumberParam("year"),e.month=y.b.getRouteNumberParam("month"),e.filter.filtered=!!e.filter.courseId,e.fetchData(!0,!1),void 0!==e.year&&void 0!==e.month&&e.calendarComponent&&e.calendarComponent.viewMonth(e.month,e.year)})));(new he.L).treatLink()}fetchData(e,t){var n=this;return(0,i.Z)((function*(){if(n.syncIcon=x.i.ICON_LOADING,n.isOnline=r.AS.isOnline(),e)try{const e=yield g.a.syncEvents();e.warnings&&e.warnings.length&&s.OQ.showAlert(void 0,e.warnings[0]),e.updated&&(e.source="index",d.R.trigger(g.U.MANUAL_SYNCED,e,n.currentSiteId))}catch(e){t&&s.OQ.showErrorModalDefault(e,"core.errorsync",!0)}try{const e=[];n.hasOffline=!1,e.push(f.IP.getCoursesForPopover(n.filter.courseId).then((e=>{n.courses=e.courses}))),e.push(m.Lh.canEditEvents(n.filter.courseId).then((e=>{n.canCreate=e}))),e.push(u.F.hasOfflineData().then((e=>{n.hasOffline=e}))),yield Promise.all(e)}catch(e){s.OQ.showErrorModalDefault(e,"addon.calendar.errorloadevents",!0)}n.loaded=!0,n.syncIcon=x.i.ICON_SYNC}))()}doRefresh(e,t,n){var o=this;return(0,i.Z)((function*(){o.loaded&&(yield o.refreshData(!0,n).finally((()=>{null==e||e.complete(),t&&t()})))}))()}refreshData(e=!1,t=!1,n=!1){var o=this;return(0,i.Z)((function*(){o.syncIcon=x.i.ICON_LOADING;const a=[];a.push(_.hU.invalidateAllowedEventTypes()),o.showCalendar&&o.calendarComponent?a.push(o.calendarComponent.refreshData(n)):!o.showCalendar&&o.upcomingEventsComponent&&a.push(o.upcomingEventsComponent.refreshData()),yield Promise.all(a).finally((()=>o.fetchData(e,t)))}))()}gotoEvent(e){y.b.navigateToSitePath(`/calendar/event/${e}`)}gotoDay(e){const t={day:e.day,month:e.month,year:e.year};Object.keys(this.filter).forEach((e=>{t[e]=this.filter[e]})),y.b.navigateToSitePath("/calendar/day",{params:t})}openFilter(){var e=this;return(0,i.Z)((function*(){yield s.OQ.openSideModal({component:v.M,componentProps:{courses:e.courses,filter:e.filter}})}))()}openEdit(e){const t={};e=e||0,this.filter.courseId&&(t.courseId=this.filter.courseId),y.b.navigateToSitePath(`/calendar/edit/${e}`,{params:t})}openSettings(){y.b.navigateToSitePath("/calendar/calendar-settings")}toggleDisplay(){this.showCalendar=!this.showCalendar,this.showCalendar||(this.loadUpcoming=!0)}ngOnDestroy(){var e,t,n,o,a,i,r,d,l;null===(e=this.newEventObserver)||void 0===e||e.off(),null===(t=this.discardedObserver)||void 0===t||t.off(),null===(n=this.editEventObserver)||void 0===n||n.off(),null===(o=this.deleteEventObserver)||void 0===o||o.off(),null===(a=this.undeleteEventObserver)||void 0===a||a.off(),null===(i=this.syncObserver)||void 0===i||i.off(),null===(r=this.manualSyncObserver)||void 0===r||r.off(),null===(d=this.filterChangedObserver)||void 0===d||d.off(),null===(l=this.onlineObserver)||void 0===l||l.unsubscribe()}}return(e=AddonCalendarIndexPage).ɵfac=function AddonCalendarIndexPage_Factory(t){return new(t||e)(N.Y36(ce.gz))},e.ɵcmp=N.Xpm({type:e,selectors:[["page-addon-calendar-index"]],viewQuery:function AddonCalendarIndexPage_Query(e,t){if(1&e&&(N.Gf(fe.c,5),N.Gf(ve.r,5)),2&e){let e;N.iGM(e=N.CRH())&&(t.calendarComponent=e.first),N.iGM(e=N.CRH())&&(t.upcomingEventsComponent=e.first)}},decls:29,vars:34,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click"],["slot","icon-only","name","fas-filter","aria-hidden","true"],["iconAction","fas-table-list",3,"priority","content","action",4,"ngIf"],["iconAction","fas-calendar-days",3,"priority","content","action",4,"ngIf"],["iconAction","fas-gears",3,"priority","content","action"],[3,"hidden","priority","content","iconAction","closeOnClick","action"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],["class","core-warning-card",4,"ngIf"],[3,"hidden","initialYear","initialMonth","filter","displayNavButtons","onEventClicked","onDayClicked"],[3,"hidden","filter","onEventClicked",4,"ngIf"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end",4,"ngIf"],["iconAction","fas-table-list",3,"priority","content","action"],["iconAction","fas-calendar-days",3,"priority","content","action"],[1,"core-warning-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],[3,"hidden","filter","onEventClicked"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],[3,"click"],["name","fas-plus","aria-hidden","true"],[1,"sr-only"]],template:function AddonCalendarIndexPage_Template(e,t){1&e&&(N.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),N._UZ(3,"ion-back-button",1),N.ALo(4,"translate"),N.qZA(),N.TgZ(5,"ion-title")(6,"h1"),N._uU(7),N.ALo(8,"translate"),N.qZA()(),N.TgZ(9,"ion-buttons",2)(10,"ion-button",3),N.NdJ("click",(function AddonCalendarIndexPage_Template_ion_button_click_10_listener(){return t.openFilter()})),N.ALo(11,"translate"),N._UZ(12,"ion-icon",4),N.qZA(),N.TgZ(13,"core-context-menu"),N.YNc(14,AddonCalendarIndexPage_core_context_menu_item_14_Template,2,4,"core-context-menu-item",5)(15,AddonCalendarIndexPage_core_context_menu_item_15_Template,2,4,"core-context-menu-item",6),N.TgZ(16,"core-context-menu-item",7),N.NdJ("action",(function AddonCalendarIndexPage_Template_core_context_menu_item_action_16_listener(){return t.openSettings()})),N.ALo(17,"translate"),N.qZA(),N.TgZ(18,"core-context-menu-item",8),N.NdJ("action",(function AddonCalendarIndexPage_Template_core_context_menu_item_action_18_listener(e){return t.doRefresh(void 0,e,!0)})),N.ALo(19,"translate"),N.qZA()(),N._UZ(20,"core-user-menu-button"),N.qZA()()(),N.TgZ(21,"ion-content")(22,"ion-refresher",9),N.NdJ("ionRefresh",(function AddonCalendarIndexPage_Template_ion_refresher_ionRefresh_22_listener(e){return t.doRefresh(e.target)})),N._UZ(23,"ion-refresher-content",10),N.ALo(24,"translate"),N.qZA(),N.YNc(25,AddonCalendarIndexPage_ion_card_25_Template,7,8,"ion-card",11),N.TgZ(26,"addon-calendar-calendar",12),N.NdJ("onEventClicked",(function AddonCalendarIndexPage_Template_addon_calendar_calendar_onEventClicked_26_listener(e){return t.gotoEvent(e)}))("onDayClicked",(function AddonCalendarIndexPage_Template_addon_calendar_calendar_onDayClicked_26_listener(e){return t.gotoDay(e)})),N.qZA(),N.YNc(27,AddonCalendarIndexPage_addon_calendar_upcoming_events_27_Template,1,2,"addon-calendar-upcoming-events",13)(28,AddonCalendarIndexPage_ion_fab_28_Template,7,6,"ion-fab",14),N.qZA()),2&e&&(N.xp6(3),N.Q6J("text",N.lcZ(4,22,"core.back")),N.xp6(4),N.Oqu(N.lcZ(8,24,t.showCalendar?"addon.calendar.calendarevents":"addon.calendar.upcomingevents")),N.xp6(3),N.uIk("aria-label",N.lcZ(11,26,"core.filter")),N.xp6(4),N.Q6J("ngIf",t.showCalendar),N.xp6(),N.Q6J("ngIf",!t.showCalendar),N.xp6(),N.Q6J("priority",600)("content",N.lcZ(17,28,"core.settings.settings")),N.xp6(2),N.Q6J("hidden",!t.loaded||!t.hasOffline||!t.isOnline)("priority",400)("content",N.lcZ(19,30,"core.settings.synchronizenow"))("iconAction",t.syncIcon)("closeOnClick",!1),N.xp6(4),N.Q6J("disabled",!t.loaded),N.xp6(),N.s9C("pullingText",N.lcZ(24,32,"core.pulltorefresh")),N.xp6(2),N.Q6J("ngIf",t.hasOffline),N.xp6(),N.Q6J("hidden",!t.showCalendar)("initialYear",t.year)("initialMonth",t.month)("filter",t.filter)("displayNavButtons",t.showCalendar),N.xp6(),N.Q6J("ngIf",t.loadUpcoming),N.xp6(),N.Q6J("ngIf",t.canCreate))},dependencies:[L.O5,q.P,U.l,k.U,M.I,F.t,V.O,G.YG,G.Sm,G.PM,G.W2,G.IJ,G.W4,G.Gu,G.gu,G.Ie,G.Q$,G.nJ,G.Wo,G.wd,G.sr,G.oU,fe.c,ve.r,Ae.o,Y.X$],encapsulation:2}),AddonCalendarIndexPage})();function AddonCalendarSettingsPage_ion_item_11_Template(e,t){if(1&e){const e=N.EpF();N.TgZ(0,"ion-item")(1,"ion-select",3),N.NdJ("ngModelChange",(function AddonCalendarSettingsPage_ion_item_11_Template_ion_select_ngModelChange_1_listener(t){N.CHM(e);const n=N.oxw();return N.KtG(n.defaultTimeLabel=t)}))("click",(function AddonCalendarSettingsPage_ion_item_11_Template_ion_select_click_1_listener(t){N.CHM(e);const n=N.oxw();return N.KtG(n.changeDefaultTime(t))})),N.ALo(2,"translate"),N.TgZ(3,"ion-select-option",4),N._uU(4),N.qZA()()()}if(2&e){const e=N.oxw();N.xp6(),N.Q6J("ngModel",e.defaultTimeLabel)("label",N.lcZ(2,4,"addon.calendar.defaultnotificationtime")),N.xp6(2),N.Q6J("value",e.defaultTimeLabel),N.xp6(),N.Oqu(e.defaultTimeLabel)}}let ye=(()=>{var e;class AddonCalendarSettingsPage{constructor(){this.defaultTimeLabel=""}ngOnInit(){var e=this;return(0,i.Z)((function*(){e.updateDefaultTimeLabel()}))()}changeDefaultTime(e){var t=this;return(0,i.Z)((function*(){var n;e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault();const o=yield s.OQ.openPopover({component:te.Y,componentProps:{initialValue:t.defaultTime,noReminderLabel:"core.settings.disabled"},event:e});void 0!==o&&(yield ee.hR.setDefaultNotificationTime(null!==(n=o.timeBefore)&&void 0!==n?n:ee.T1.DISABLED),t.updateDefaultTimeLabel())}))()}updateDefaultTimeLabel(){var e=this;return(0,i.Z)((function*(){e.defaultTime=yield ee.hR.getDefaultNotificationTime();const t=ee.T1.convertSecondsToValueAndUnit(e.defaultTime);e.defaultTimeLabel=ee.hR.getUnitValueLabel(t.value,t.unit)}))()}}return(e=AddonCalendarSettingsPage).ɵfac=function AddonCalendarSettingsPage_Factory(t){return new(t||e)},e.ɵcmp=N.Xpm({type:e,selectors:[["page-addon-calendar-settings"]],decls:12,vars:7,consts:[["slot","start"],[3,"text"],[4,"ngIf"],[3,"ngModel","label","ngModelChange","click"],[3,"value"]],template:function AddonCalendarSettingsPage_Template(e,t){1&e&&(N.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),N._UZ(3,"ion-back-button",1),N.ALo(4,"translate"),N.qZA(),N.TgZ(5,"ion-title")(6,"h1"),N._uU(7),N.ALo(8,"translate"),N.qZA()()()(),N.TgZ(9,"ion-content")(10,"ion-list"),N.YNc(11,AddonCalendarSettingsPage_ion_item_11_Template,5,6,"ion-item",2),N.qZA()()),2&e&&(N.xp6(3),N.Q6J("text",N.lcZ(4,3,"core.back")),N.xp6(4),N.Oqu(N.lcZ(8,5,"core.settings.settings")),N.xp6(4),N.Q6J("ngIf",t.defaultTimeLabel))},dependencies:[L.O5,F.t,$.JJ,$.On,G.Sm,G.W2,G.Gu,G.Ie,G.q_,G.t9,G.n0,G.wd,G.sr,G.QI,G.oU,Y.X$],encapsulation:2}),AddonCalendarSettingsPage})();var Ce=n(83599),xe=n(56283),Ie=n(39716),Te=n(68408);function buildRoutes(e){return[{path:"index",data:{mainMenuTabRoot:Te.c.PAGE_NAME},component:Ee},{path:"calendar-settings",component:ye},{path:"day",component:B},{path:"event/:id",component:pe},{path:"edit/:eventId",component:de},...(0,Ie.o)(e,{redirectTo:"index",pathMatch:"full"})]}let Ze=(()=>{var e;class AddonCalendarLazyModule{}return(e=AddonCalendarLazyModule).ɵfac=function AddonCalendarLazyModule_Factory(t){return new(t||e)},e.ɵmod=N.oAB({type:e}),e.ɵinj=N.cJS({providers:[{provide:ce.Z6,multi:!0,deps:[N.zs3],useFactory:buildRoutes}],imports:[o.L,a.s,xe.g,Ce.I,ce.Bz]}),AddonCalendarLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&N.kYT(Ze,{declarations:[B,de,pe,Ee,ye],imports:[o.L,a.s,xe.g,Ce.I],exports:[ce.Bz]}))},71460:(e,t,n)=>{n.d(t,{t:()=>CoreSwipeNavigationItemsManager});var o=n(49671),a=n(67643),i=n(43555),r=n(22594);class CoreSwipeNavigationItemsManager extends r.A{start(){var e=this;return(0,o.Z)((function*(){e.updateSelectedItem()}))()}navigateToNextItem(){var e=this;return(0,o.Z)((function*(){yield e.navigateToItemBy(1,"forward")}))()}navigateToPreviousItem(){var e=this;return(0,o.Z)((function*(){yield e.navigateToItemBy(-1,"back")}))()}hasNextItem(){var e=this;return(0,o.Z)((function*(){return!!(yield e.getItemBy(1))}))()}hasPreviousItem(){var e=this;return(0,o.Z)((function*(){return!!(yield e.getItemBy(-1))}))()}getCurrentPageRoute(){return i.b.getCurrentRoute()}getSelectedItemPathFromRoute(e){const t=[];for(;e;){if(t.push(...(e instanceof a.De?e:e.snapshot).url),!e.firstChild)break;e=e.firstChild}return t.map((e=>e.path)).join("/").replace(/\/+/,"/").trim()||null}navigateToItemBy(e,t){var n=this;return(0,o.Z)((function*(){const o=yield n.getItemBy(e);o&&(yield n.navigateToItem(o,{animationDirection:t,replace:!0}))}))()}getItemBy(e){var t=this;return(0,o.Z)((function*(){var n;const o=t.getSource().getItems(),a=null!==(n=t.selectedItem&&(null==o?void 0:o.indexOf(t.selectedItem)))&&void 0!==n?n:-1;if(-1===a||null===o)return null;const i=e>0?1:-1;let r=a,d=0;for(;d!==e;){if(r+=i,r<0)return null;if(r>=o.length)break;t.skipItemInSwipe(o[r])||(d+=i)}return d===e?o[r]:t.getSource().isCompleted()?null:(yield t.getSource().load(),t.getItemBy(e))}))()}skipItemInSwipe(e){return!1}}}}]);