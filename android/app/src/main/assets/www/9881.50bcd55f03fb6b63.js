"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9881],{9881:(o,e,t)=>{t.r(e),t.d(e,{AddonCourseCompletionLazyModule:()=>L});var n=t(13386),r=t(67643),i=t(24672),l=t(51845),a=t(49671),c=t(79480),p=t(45151),d=t(43468),_=t(43555),s=t(53564),u=t(13010),m=t(10727),g=t(88817),C=t(19212),Z=t(96814),f=t(66931),A=t(80070),x=t(86700),T=t(8947),q=t(29657),h=t(22068),I=t(31903),P=t(83369),R=t(89515);function AddonCourseCompletionReportPage_ion_item_14_Template(o,e){if(1&o&&(C.TgZ(0,"ion-item",8),C._UZ(1,"core-user-avatar",9),C.TgZ(2,"ion-label")(3,"p",10),C._uU(4),C.qZA()()()),2&o){const o=C.oxw();C.xp6(),C.Q6J("user",o.user)("courseId",o.courseId)("linkProfile",!1),C.xp6(3),C.Oqu(o.user.fullname)}}function AddonCourseCompletionReportPage_ion_card_15_p_14_Template(o,e){1&o&&(C.TgZ(0,"p"),C._uU(1),C.ALo(2,"translate"),C.qZA()),2&o&&(C.xp6(),C.Oqu(C.lcZ(2,1,"addon.coursecompletion.criteriarequiredall")))}function AddonCourseCompletionReportPage_ion_card_15_p_15_Template(o,e){1&o&&(C.TgZ(0,"p"),C._uU(1),C.ALo(2,"translate"),C.qZA()),2&o&&(C.xp6(),C.Oqu(C.lcZ(2,1,"addon.coursecompletion.criteriarequiredany")))}function AddonCourseCompletionReportPage_ion_card_15_Template(o,e){if(1&o&&(C.TgZ(0,"ion-card")(1,"ion-item",8)(2,"ion-label")(3,"p",10),C._uU(4),C.ALo(5,"translate"),C.qZA(),C.TgZ(6,"p"),C._uU(7),C.ALo(8,"translate"),C.qZA()()(),C.TgZ(9,"ion-item",8)(10,"ion-label")(11,"p",10),C._uU(12),C.ALo(13,"translate"),C.qZA(),C.YNc(14,AddonCourseCompletionReportPage_ion_card_15_p_14_Template,3,3,"p",6)(15,AddonCourseCompletionReportPage_ion_card_15_p_15_Template,3,3,"p",6),C.qZA()()()),2&o){const o=C.oxw();C.xp6(4),C.Oqu(C.lcZ(5,5,"addon.coursecompletion.status")),C.xp6(3),C.Oqu(C.lcZ(8,7,o.statusText)),C.xp6(5),C.Oqu(C.lcZ(13,9,"addon.coursecompletion.required")),C.xp6(2),C.Q6J("ngIf",1===o.completion.aggregation),C.xp6(),C.Q6J("ngIf",2===o.completion.aggregation)}}function AddonCourseCompletionReportPage_ion_card_16_ion_item_6_strong_6_Template(o,e){1&o&&(C.TgZ(0,"strong",17),C._uU(1),C.ALo(2,"translate"),C.qZA()),2&o&&(C.xp6(),C.Oqu(C.lcZ(2,1,"core.yes")))}function AddonCourseCompletionReportPage_ion_card_16_ion_item_6_strong_7_Template(o,e){1&o&&(C.TgZ(0,"strong",17),C._uU(1),C.ALo(2,"translate"),C.qZA()),2&o&&(C.xp6(),C.Oqu(C.lcZ(2,1,"core.no")))}function AddonCourseCompletionReportPage_ion_card_16_ion_item_6_Template(o,e){if(1&o&&(C.TgZ(0,"ion-item",14)(1,"ion-label")(2,"p",10),C._UZ(3,"core-format-text",15),C.qZA(),C.TgZ(4,"p"),C._UZ(5,"core-format-text",15),C.qZA()(),C.YNc(6,AddonCourseCompletionReportPage_ion_card_16_ion_item_6_strong_6_Template,3,3,"strong",16)(7,AddonCourseCompletionReportPage_ion_card_16_ion_item_6_strong_7_Template,3,3,"strong",16),C.qZA()),2&o){const o=e.$implicit;C.xp6(3),C.Q6J("text",o.details.criteria)("filter",!1),C.xp6(2),C.Q6J("text",o.details.requirement)("filter",!1),C.xp6(),C.Q6J("ngIf",o.complete),C.xp6(),C.Q6J("ngIf",!o.complete)}}function AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_9_Template(o,e){1&o&&(C.TgZ(0,"ion-col"),C._uU(1),C.ALo(2,"translate"),C.qZA()),2&o&&(C.xp6(),C.Oqu(C.lcZ(2,1,"core.yes")))}function AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_10_Template(o,e){1&o&&(C.TgZ(0,"ion-col"),C._uU(1),C.ALo(2,"translate"),C.qZA()),2&o&&(C.xp6(),C.Oqu(C.lcZ(2,1,"core.no")))}function AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_11_Template(o,e){if(1&o&&(C.TgZ(0,"ion-col"),C._uU(1),C.ALo(2,"coreFormatDate"),C.qZA()),2&o){const o=C.oxw().$implicit;C.xp6(),C.hij(" ",C.xi3(2,1,1e3*o.timecompleted,"strftimedatetimeshort")," ")}}function AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_12_Template(o,e){1&o&&C._UZ(0,"ion-col")}function AddonCourseCompletionReportPage_ion_card_16_ion_row_34_Template(o,e){if(1&o&&(C.TgZ(0,"ion-row")(1,"ion-col"),C._UZ(2,"core-format-text",15),C.qZA(),C.TgZ(3,"ion-col"),C._UZ(4,"core-format-text",15),C.qZA(),C.TgZ(5,"ion-col"),C._UZ(6,"core-format-text",15),C.qZA(),C.TgZ(7,"ion-col"),C._UZ(8,"core-format-text",18),C.qZA(),C.YNc(9,AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_9_Template,3,3,"ion-col",6)(10,AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_10_Template,3,3,"ion-col",6)(11,AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_11_Template,3,4,"ion-col",6)(12,AddonCourseCompletionReportPage_ion_card_16_ion_row_34_ion_col_12_Template,1,0,"ion-col",6),C.qZA()),2&o){const o=e.$implicit;C.xp6(2),C.Q6J("text",o.details.type)("filter",!1),C.xp6(2),C.Q6J("text",o.details.criteria)("filter",!1),C.xp6(2),C.Q6J("text",o.details.requirement)("filter",!1),C.xp6(2),C.Q6J("text",o.details.status)("filter",!1),C.xp6(),C.Q6J("ngIf",o.complete),C.xp6(),C.Q6J("ngIf",!o.complete),C.xp6(),C.Q6J("ngIf",o.timecompleted),C.xp6(),C.Q6J("ngIf",!o.timecompleted)}}function AddonCourseCompletionReportPage_ion_card_16_Template(o,e){if(1&o&&(C.TgZ(0,"ion-card")(1,"ion-item-divider")(2,"ion-label")(3,"h2"),C._uU(4),C.ALo(5,"translate"),C.qZA()()(),C.YNc(6,AddonCourseCompletionReportPage_ion_card_16_ion_item_6_Template,8,6,"ion-item",11),C.TgZ(7,"ion-item",12)(8,"ion-label")(9,"ion-row")(10,"ion-col")(11,"strong"),C._uU(12),C.ALo(13,"translate"),C.qZA()(),C.TgZ(14,"ion-col")(15,"strong"),C._uU(16),C.ALo(17,"translate"),C.qZA()(),C.TgZ(18,"ion-col")(19,"strong"),C._uU(20),C.ALo(21,"translate"),C.qZA()(),C.TgZ(22,"ion-col")(23,"strong"),C._uU(24),C.ALo(25,"translate"),C.qZA()(),C.TgZ(26,"ion-col")(27,"strong"),C._uU(28),C.ALo(29,"translate"),C.qZA()(),C.TgZ(30,"ion-col")(31,"strong"),C._uU(32),C.ALo(33,"translate"),C.qZA()()(),C.YNc(34,AddonCourseCompletionReportPage_ion_card_16_ion_row_34_Template,13,12,"ion-row",13),C.qZA()()()),2&o){const o=C.oxw();C.xp6(4),C.Oqu(C.lcZ(5,9,"addon.coursecompletion.requiredcriteria")),C.xp6(2),C.Q6J("ngForOf",o.completion.completions),C.xp6(6),C.Oqu(C.lcZ(13,11,"addon.coursecompletion.criteriagroup")),C.xp6(4),C.Oqu(C.lcZ(17,13,"addon.coursecompletion.criteria")),C.xp6(4),C.Oqu(C.lcZ(21,15,"addon.coursecompletion.requirement")),C.xp6(4),C.Oqu(C.lcZ(25,17,"addon.coursecompletion.status")),C.xp6(4),C.Oqu(C.lcZ(29,19,"addon.coursecompletion.complete")),C.xp6(4),C.Oqu(C.lcZ(33,21,"addon.coursecompletion.completiondate")),C.xp6(2),C.Q6J("ngForOf",o.completion.completions)}}function AddonCourseCompletionReportPage_ion_card_17_Template(o,e){if(1&o){const o=C.EpF();C.TgZ(0,"ion-card")(1,"ion-item-divider")(2,"ion-label")(3,"h2"),C._uU(4),C.ALo(5,"translate"),C.qZA()()(),C.TgZ(6,"ion-item")(7,"ion-label")(8,"ion-button",19),C.NdJ("click",(function AddonCourseCompletionReportPage_ion_card_17_Template_ion_button_click_8_listener(){C.CHM(o);const e=C.oxw();return C.KtG(e.completeCourse())})),C._uU(9),C.ALo(10,"translate"),C.qZA()()()()}2&o&&(C.xp6(4),C.Oqu(C.lcZ(5,2,"addon.coursecompletion.manualselfcompletion")),C.xp6(5),C.hij(" ",C.lcZ(10,4,"addon.coursecompletion.completecourse")," "))}function AddonCourseCompletionReportPage_ion_card_18_Template(o,e){1&o&&(C.TgZ(0,"ion-card",20)(1,"ion-item"),C._UZ(2,"ion-icon",21),C.TgZ(3,"ion-label"),C._uU(4),C.ALo(5,"translate"),C.qZA()()()),2&o&&(C.xp6(4),C.Oqu(C.lcZ(5,1,"addon.coursecompletion.nottracked")))}let w=(()=>{var o;class AddonCourseCompletionReportPage{constructor(){this.completionLoaded=!1,this.showSelfComplete=!1,this.tracked=!0,this.logView=g.V.once((()=>{d.ke.logEvent({type:d.gM.VIEW_ITEM,ws:"core_completion_get_course_completion_status",name:m.vN.instant("addon.coursecompletion.coursecompletion"),data:{course:this.courseId,user:this.userId},url:`/blocks/completionstatus/details.php?course=${this.courseId}&user=${this.userId}`})}))}ngOnInit(){try{this.courseId=_.b.getRequiredRouteNumberParam("courseId"),this.userId=_.b.getRouteNumberParam("userId")||s.m9.getCurrentSiteUserId()}catch(o){return u.OQ.showErrorModal(o),_.b.back(),void 0}this.fetchCompletion().finally((()=>{this.completionLoaded=!0}))}fetchCompletion(){var o=this;return(0,a.Z)((function*(){try{o.user=yield p.My.getProfile(o.userId,o.courseId,!0),o.completion=yield c.b.getCompletion(o.courseId,o.userId),o.statusText=c.b.getCompletedStatusText(o.completion),o.showSelfComplete=c.b.canMarkSelfCompleted(o.userId,o.completion),o.tracked=!0,o.logView()}catch(e){e&&"notenroled"==e.errorcode?o.tracked=!1:u.OQ.showErrorModalDefault(e,"addon.coursecompletion.couldnotloadreport",!0)}}))()}refreshCompletion(o){var e=this;return(0,a.Z)((function*(){yield c.b.invalidateCourseCompletion(e.courseId,e.userId).finally((()=>{e.fetchCompletion().finally((()=>{null==o||o.complete()}))}))}))()}completeCourse(){var o=this;return(0,a.Z)((function*(){const e=yield u.OQ.showModalLoading("core.sending",!0);try{yield c.b.markCourseAsSelfCompleted(o.courseId),yield o.refreshCompletion()}catch(o){u.OQ.showErrorModal(o)}finally{e.dismiss()}}))()}}return(o=AddonCourseCompletionReportPage).ɵfac=function AddonCourseCompletionReportPage_Factory(e){return new(e||o)},o.ɵcmp=C.Xpm({type:o,selectors:[["page-addon-course-completion-report"]],decls:19,vars:16,consts:[["slot","start"],[3,"text"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],["class","ion-text-wrap",4,"ngIf"],[4,"ngIf"],["class","core-warning-card",4,"ngIf"],[1,"ion-text-wrap"],["slot","start",3,"user","courseId","linkProfile"],[1,"item-heading"],["class","ion-hide-md-up ion-text-wrap",4,"ngFor","ngForOf"],[1,"ion-hide-md-down","ion-text-wrap"],[4,"ngFor","ngForOf"],[1,"ion-hide-md-up","ion-text-wrap"],["clean","true",3,"text","filter"],["slot","end",4,"ngIf"],["slot","end"],[3,"text","filter"],["expand","block",3,"click"],[1,"core-warning-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"]],template:function AddonCourseCompletionReportPage_Template(o,e){1&o&&(C.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),C._UZ(3,"ion-back-button",1),C.ALo(4,"translate"),C.qZA(),C.TgZ(5,"ion-title")(6,"h1"),C._uU(7),C.ALo(8,"translate"),C.qZA()()()(),C.TgZ(9,"ion-content")(10,"ion-refresher",2),C.NdJ("ionRefresh",(function AddonCourseCompletionReportPage_Template_ion_refresher_ionRefresh_10_listener(o){return e.refreshCompletion(o.target)})),C._UZ(11,"ion-refresher-content",3),C.ALo(12,"translate"),C.qZA(),C.TgZ(13,"core-loading",4),C.YNc(14,AddonCourseCompletionReportPage_ion_item_14_Template,5,4,"ion-item",5)(15,AddonCourseCompletionReportPage_ion_card_15_Template,16,11,"ion-card",6)(16,AddonCourseCompletionReportPage_ion_card_16_Template,35,23,"ion-card",6)(17,AddonCourseCompletionReportPage_ion_card_17_Template,11,6,"ion-card",6)(18,AddonCourseCompletionReportPage_ion_card_18_Template,6,3,"ion-card",7),C.qZA()()),2&o&&(C.xp6(3),C.Q6J("text",C.lcZ(4,10,"core.back")),C.xp6(4),C.Oqu(C.lcZ(8,12,"addon.coursecompletion.coursecompletion")),C.xp6(3),C.Q6J("disabled",!e.completionLoaded),C.xp6(),C.s9C("pullingText",C.lcZ(12,14,"core.pulltorefresh")),C.xp6(2),C.Q6J("hideUntil",e.completionLoaded),C.xp6(),C.Q6J("ngIf",e.user),C.xp6(),C.Q6J("ngIf",e.completion&&e.tracked),C.xp6(),C.Q6J("ngIf",e.completion&&e.tracked),C.xp6(),C.Q6J("ngIf",e.showSelfComplete&&e.tracked),C.xp6(),C.Q6J("ngIf",!e.tracked))},dependencies:[Z.sg,Z.O5,f.r,A.X,x.I,T.r,q.t,h.O,I.YG,I.Sm,I.PM,I.wI,I.W2,I.Gu,I.gu,I.Ie,I.rH,I.Q$,I.nJ,I.Wo,I.Nd,I.wd,I.sr,I.oU,P.o,R.X$],encapsulation:2}),AddonCourseCompletionReportPage})();const U=[{path:"",component:w}];let L=(()=>{var o;class AddonCourseCompletionLazyModule{}return(o=AddonCourseCompletionLazyModule).ɵfac=function AddonCourseCompletionLazyModule_Factory(e){return new(e||o)},o.ɵmod=C.oAB({type:o}),o.ɵinj=C.cJS({imports:[r.Bz.forChild(U),n.L,i.H,l.g,r.Bz]}),AddonCourseCompletionLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&C.kYT(L,{declarations:[w],imports:[r.Bz,n.L,i.H,l.g],exports:[r.Bz]}))}}]);