"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1501],{61501:(e,t,o)=>{o.r(t),o.d(t,{AddonNotesLazyModule:()=>R});var n=o(13386),s=o(67643),i=o(24672),r=o(51845),a=o(49671),d=o(18005),c=o(31089),l=o(71473),_=o(46570),u=o(37328),p=o(7351),g=o(45151),f=o(31903),h=o(43468),m=o(43555),N=o(53564),I=o(13010),A=o(34749),Z=o(857),y=o(75803),L=o(10727),T=o(98370),x=o(88817),b=o(19212),w=o(96814),O=o(11771),P=o(17418),v=o(55126),J=o(66931),D=o(78308),U=o(80070),Q=o(31189),k=o(73946),C=o(86700),q=o(8947),M=o(29657),E=o(22068),S=o(5385),G=o(89515);function AddonNotesListPage_ion_item_24_Template(e,t){if(1&e&&(b.TgZ(0,"ion-item",19),b._UZ(1,"core-user-avatar",20),b.TgZ(2,"ion-label")(3,"p",21),b._uU(4),b.qZA()()()),2&e){const e=b.oxw();b.xp6(),b.Q6J("user",e.user)("courseId",e.courseId)("linkProfile",!1),b.xp6(3),b.Oqu(e.user.fullname)}}const _c0=e=>({$a:e});function AddonNotesListPage_ion_card_35_Template(e,t){1&e&&(b.TgZ(0,"ion-card",22)(1,"ion-item"),b._UZ(2,"ion-icon",23),b.TgZ(3,"ion-label"),b._uU(4),b.ALo(5,"translate"),b.ALo(6,"lowercase"),b.ALo(7,"translate"),b.qZA()()()),2&e&&(b.xp6(4),b.hij(" ",b.xi3(5,1,"core.thereisdatatosync",b.VKq(8,_c0,b.lcZ(6,4,b.lcZ(7,6,"addon.notes.notes"))))," "))}function AddonNotesListPage_core_empty_box_36_Template(e,t){1&e&&(b._UZ(0,"core-empty-box",24),b.ALo(1,"translate")),2&e&&b.Q6J("message",b.lcZ(1,1,"addon.notes.nonotes"))}function AddonNotesListPage_ng_container_37_ion_card_1_core_user_avatar_2_Template(e,t){if(1&e&&b._UZ(0,"core-user-avatar",31),2&e){const e=b.oxw().$implicit,t=b.oxw(2);b.Q6J("user",e)("courseId",t.courseId)}}function AddonNotesListPage_ng_container_37_ion_card_1_p_4_Template(e,t){if(1&e&&(b.TgZ(0,"p",21),b._uU(1),b.qZA()),2&e){const e=b.oxw().$implicit;b.xp6(),b.Oqu(e.userfullname)}}function AddonNotesListPage_ng_container_37_ion_card_1_p_5_Template(e,t){if(1&e&&(b.TgZ(0,"p",2)(1,"span",19),b._uU(2),b.ALo(3,"coreDateDayOrTime"),b.qZA()()),2&e){const e=b.oxw().$implicit;b.xp6(2),b.Oqu(b.lcZ(3,1,e.lastmodified))}}function AddonNotesListPage_ng_container_37_ion_card_1_p_6_Template(e,t){1&e&&(b.TgZ(0,"p",2),b._UZ(1,"ion-icon",32),b.TgZ(2,"span",19),b._uU(3),b.ALo(4,"translate"),b.qZA()()),2&e&&(b.xp6(3),b.hij(" ",b.lcZ(4,1,"core.notsent")," "))}function AddonNotesListPage_ng_container_37_ion_card_1_p_7_Template(e,t){1&e&&(b.TgZ(0,"p",2),b._UZ(1,"ion-icon",33),b.TgZ(2,"span",19),b._uU(3),b.ALo(4,"translate"),b.qZA()()),2&e&&(b.xp6(3),b.hij(" ",b.lcZ(4,1,"core.deletedoffline")," "))}function AddonNotesListPage_ng_container_37_ion_card_1_ion_button_8_Template(e,t){if(1&e){const e=b.EpF();b.TgZ(0,"ion-button",34),b.NdJ("click",(function AddonNotesListPage_ng_container_37_ion_card_1_ion_button_8_Template_ion_button_click_0_listener(t){b.CHM(e);const o=b.oxw().$implicit,n=b.oxw(2);return b.KtG(n.undoDeleteNote(t,o))})),b.ALo(1,"translate"),b._UZ(2,"ion-icon",35),b.qZA()}2&e&&b.uIk("aria-label",b.lcZ(1,1,"core.restore"))}function AddonNotesListPage_ng_container_37_ion_card_1_ion_button_9_Template(e,t){if(1&e){const e=b.EpF();b.TgZ(0,"ion-button",34),b.NdJ("click",(function AddonNotesListPage_ng_container_37_ion_card_1_ion_button_9_Template_ion_button_click_0_listener(t){b.CHM(e);const o=b.oxw().$implicit,n=b.oxw(2);return b.KtG(n.deleteNote(t,o))})),b.ALo(1,"translate"),b._UZ(2,"ion-icon",36),b.qZA()}2&e&&(b.Q6J("@coreSlideInOut","fromRight"),b.uIk("aria-label",b.lcZ(1,2,"core.delete")))}function AddonNotesListPage_ng_container_37_ion_card_1_Template(e,t){if(1&e&&(b.TgZ(0,"ion-card")(1,"ion-item",19),b.YNc(2,AddonNotesListPage_ng_container_37_ion_card_1_core_user_avatar_2_Template,1,2,"core-user-avatar",26),b.TgZ(3,"ion-label"),b.YNc(4,AddonNotesListPage_ng_container_37_ion_card_1_p_4_Template,2,1,"p",27)(5,AddonNotesListPage_ng_container_37_ion_card_1_p_5_Template,4,3,"p",28),b.qZA(),b.YNc(6,AddonNotesListPage_ng_container_37_ion_card_1_p_6_Template,5,3,"p",28)(7,AddonNotesListPage_ng_container_37_ion_card_1_p_7_Template,5,3,"p",28)(8,AddonNotesListPage_ng_container_37_ion_card_1_ion_button_8_Template,3,3,"ion-button",29)(9,AddonNotesListPage_ng_container_37_ion_card_1_ion_button_9_Template,3,4,"ion-button",29),b.qZA(),b.TgZ(10,"ion-item",19)(11,"ion-label"),b._UZ(12,"core-format-text",30),b.qZA()()()),2&e){const e=t.$implicit,o=b.oxw(2);b.xp6(2),b.Q6J("ngIf",!o.userId),b.xp6(2),b.Q6J("ngIf",!o.userId),b.xp6(),b.Q6J("ngIf",!e.deleted&&!e.offline),b.xp6(),b.Q6J("ngIf",e.offline),b.xp6(),b.Q6J("ngIf",e.deleted),b.xp6(),b.Q6J("ngIf",e.deleted),b.xp6(),b.Q6J("ngIf",o.showDelete&&!e.deleted&&("personal"!==o.type||e.usermodified===o.currentUserId)),b.xp6(3),b.Q6J("text",e.content)("filter",!1)}}function AddonNotesListPage_ng_container_37_Template(e,t){if(1&e&&(b.ynx(0),b.YNc(1,AddonNotesListPage_ng_container_37_ion_card_1_Template,13,9,"ion-card",25),b.BQk()),2&e){const e=b.oxw();b.xp6(),b.Q6J("ngForOf",e.notes)}}function AddonNotesListPage_ion_fab_38_Template(e,t){if(1&e){const e=b.EpF();b.TgZ(0,"ion-fab",37)(1,"ion-fab-button",38),b.NdJ("click",(function AddonNotesListPage_ion_fab_38_Template_ion_fab_button_click_1_listener(t){b.CHM(e);const o=b.oxw();return b.KtG(o.addNote(t))})),b.ALo(2,"translate"),b._UZ(3,"ion-icon",39),b.TgZ(4,"span",40),b._uU(5),b.ALo(6,"translate"),b.qZA()()()}2&e&&(b.xp6(),b.uIk("aria-label",b.lcZ(2,2,"addon.notes.addnewnote")),b.xp6(4),b.Oqu(b.lcZ(6,4,"addon.notes.addnewnote")))}let z=(()=>{var e;class AddonNotesListPage{constructor(){this.type="course",this.refreshIcon=d.i.ICON_LOADING,this.syncIcon=d.i.ICON_LOADING,this.notes=[],this.hasOffline=!1,this.notesLoaded=!1,this.showDelete=!1,this.canDeleteNotes=!1,this.logView=x.V.once((()=>this.performLogView()));try{this.courseId=m.b.getRequiredRouteNumberParam("courseId"),this.userId=m.b.getRouteNumberParam("userId")}catch(e){return I.OQ.showErrorModal(e),m.b.back(),void 0}this.syncObserver=T.R.on(u.s.AUTO_SYNCED,(e=>{var t;e.courseId==this.courseId&&(this.showSyncWarnings(e.warnings),this.notesLoaded=!1,this.refreshIcon=d.i.ICON_LOADING,this.syncIcon=d.i.ICON_LOADING,null===(t=this.content)||void 0===t||t.scrollToTop(),this.fetchNotes(!1))}),N.m9.getCurrentSiteId()),this.currentUserId=N.m9.getCurrentSiteUserId()}ngOnInit(){var e=this;return(0,a.Z)((function*(){yield e.fetchNotes(!0)}))()}fetchNotes(e=!1,t=!1){var o=this;return(0,a.Z)((function*(){e&&(yield o.syncNotes(t));try{const e=(yield l.S.getNotes(o.courseId,o.userId))[o.type+"notes"]||[];e.forEach((e=>{e.content=A._1.decodeHTML(e.content)})),yield l.S.setOfflineDeletedNotes(e,o.courseId),o.hasOffline=e.some((e=>e.offline||e.deleted)),o.userId?(o.notes=e,o.user=yield g.My.getProfile(o.userId,o.courseId,!0)):o.notes=yield l.S.getNotesUserData(e),o.logView()}catch(e){I.OQ.showErrorModal(e)}finally{let e=o.notes&&o.notes.length>0;e&&"personal"==o.type&&(e=!!o.notes.find((e=>e.usermodified==o.currentUserId))),o.canDeleteNotes=e,o.notesLoaded=!0,o.refreshIcon=d.i.ICON_REFRESH,o.syncIcon=d.i.ICON_SYNC}}))()}refreshNotes(e,t){this.refreshIcon=d.i.ICON_LOADING,this.syncIcon=d.i.ICON_LOADING,l.S.invalidateNotes(this.courseId,this.userId).finally((()=>{this.fetchNotes(!0,e).finally((()=>{t&&(null==t||t.complete())}))}))}typeChanged(e){var t=this;return(0,a.Z)((function*(){t.type=e,t.notesLoaded=!1,t.refreshIcon=d.i.ICON_LOADING,t.syncIcon=d.i.ICON_LOADING,yield t.fetchNotes(!0)}))()}addNote(e){var t=this;return(0,a.Z)((function*(){e.preventDefault(),e.stopPropagation(),t.logViewAdd();const o=yield I.OQ.openModal({component:c.C,componentProps:{userId:t.userId,courseId:t.courseId,type:t.type}});void 0!==o&&(o.sent&&o.type?(o.type!=t.type&&(t.type=o.type,t.notesLoaded=!1),t.refreshNotes(!1)):o.type&&o.type!=t.type&&t.typeChanged(o.type))}))()}deleteNote(e,t){var o=this;return(0,a.Z)((function*(){e.preventDefault(),e.stopPropagation();try{o.logViewDelete(t),yield I.OQ.showDeleteConfirm("addon.notes.deleteconfirm");try{yield l.S.deleteNote(t,o.courseId),o.showDelete=!1,o.refreshNotes(!1),I.OQ.showToast("addon.notes.eventnotedeleted",!0,I.O2.LONG)}catch(e){I.OQ.showErrorModalDefault(e,"Delete note failed.")}}catch{}}))()}undoDeleteNote(e,t){var o=this;return(0,a.Z)((function*(){e.preventDefault(),e.stopPropagation(),yield _.D.undoDeleteNote(t.id),o.refreshNotes(!1)}))()}toggleDelete(){this.showDelete=!this.showDelete}syncNotes(e){var t=this;return(0,a.Z)((function*(){try{const e=yield u.z.syncNotes(t.courseId);t.showSyncWarnings(e.warnings)}catch(t){e&&I.OQ.showErrorModalDefault(t,"core.errorsync",!0)}}))()}showSyncWarnings(e){const t=A._1.buildMessage(e);t&&I.OQ.showAlert(void 0,t)}performLogView(){var e=this;return(0,a.Z)((function*(){yield y.Tr.ignoreErrors(l.S.logView(e.courseId,e.userId)),h.ke.logEvent({type:h.gM.VIEW_ITEM_LIST,ws:"core_notes_view_notes",name:L.vN.instant("addon.notes.notes"),data:{courseid:e.courseId,userid:e.userId||0,category:"notes"},url:Z.T.addParamsToUrl("/notes/index.php",{user:e.userId,course:e.courseId!==N.m9.getCurrentSiteHomeId()?e.courseId:void 0})})}))()}logViewAdd(){var e=this;return(0,a.Z)((function*(){h.ke.logEvent({type:h.gM.VIEW_ITEM,ws:"core_notes_create_notes",name:L.vN.instant("addon.notes.notes"),data:{courseid:e.courseId,userid:e.userId||0,category:"notes"},url:Z.T.addParamsToUrl("/notes/edit.php",{courseid:e.courseId,userid:e.userId,publishstate:"personal"===e.type?"draft":"course"===e.type?"public":"site"})})}))()}logViewDelete(e){return(0,a.Z)((function*(){e.id&&h.ke.logEvent({type:h.gM.VIEW_ITEM,ws:"core_notes_delete_notes",name:L.vN.instant("addon.notes.notes"),data:{id:e.id,category:"notes"},url:`/notes/delete.php?id=${e.id}`})}))()}ngOnDestroy(){this.syncObserver&&this.syncObserver.off()}}return(e=AddonNotesListPage).ɵfac=function AddonNotesListPage_Factory(t){return new(t||e)},e.ɵcmp=b.Xpm({type:e,selectors:[["page-addon-notes-list-page"]],viewQuery:function AddonNotesListPage_Query(e,t){if(1&e&&b.Gf(f.W2,5),2&e){let e;b.iGM(e=b.CRH())&&(t.content=e.first)}},decls:39,vars:44,consts:[["slot","start"],[3,"text"],["slot","end"],["slot","end","fill","clear",3,"hidden","click"],["name","fas-pen","slot","icon-only","aria-hidden","true"],[3,"hidden","priority","content","iconAction","closeOnClick","action"],[1,"limited-width"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],["class","ion-text-wrap",4,"ngIf"],[3,"selection","onChange"],["value","site",1,"ion-text-wrap"],["value","course",1,"ion-text-wrap"],["value","personal",1,"ion-text-wrap"],["class","core-warning-card",4,"ngIf"],["icon","fas-receipt",3,"message",4,"ngIf"],[4,"ngIf"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end",4,"ngIf"],[1,"ion-text-wrap"],["slot","start",3,"user","courseId","linkProfile"],[1,"item-heading"],[1,"core-warning-card"],["name","fas-triangle-exclamation","slot","start","aria-hidden","true"],["icon","fas-receipt",3,"message"],[4,"ngFor","ngForOf"],["slot","start",3,"user","courseId",4,"ngIf"],["class","item-heading",4,"ngIf"],["slot","end",4,"ngIf"],["slot","end","fill","clear","color","danger",3,"click",4,"ngIf"],[3,"text","filter"],["slot","start",3,"user","courseId"],["name","fas-clock","aria-hidden","true"],["name","fas-trash","aria-hidden","true"],["slot","end","fill","clear","color","danger",3,"click"],["name","fas-rotate-left","slot","icon-only","aria-hidden","true"],["name","fas-trash","slot","icon-only","aria-hidden","true"],["slot","fixed","core-fab","","vertical","bottom","horizontal","end"],[3,"click"],["name","fas-plus","aria-hidden","true"],[1,"sr-only"]],template:function AddonNotesListPage_Template(e,t){1&e&&(b.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),b._UZ(3,"ion-back-button",1),b.ALo(4,"translate"),b.qZA(),b.TgZ(5,"ion-title")(6,"h1"),b._uU(7),b.ALo(8,"translate"),b.qZA()(),b._UZ(9,"ion-buttons",2),b.qZA()(),b.TgZ(10,"core-navbar-buttons",2)(11,"ion-button",3),b.NdJ("click",(function AddonNotesListPage_Template_ion_button_click_11_listener(){return t.toggleDelete()})),b.ALo(12,"translate"),b._UZ(13,"ion-icon",4),b.qZA(),b.TgZ(14,"core-context-menu")(15,"core-context-menu-item",5),b.NdJ("action",(function AddonNotesListPage_Template_core_context_menu_item_action_15_listener(){return t.refreshNotes(!1)})),b.ALo(16,"translate"),b.qZA(),b.TgZ(17,"core-context-menu-item",5),b.NdJ("action",(function AddonNotesListPage_Template_core_context_menu_item_action_17_listener(){return t.refreshNotes(!0)})),b.ALo(18,"translate"),b.qZA()()(),b.TgZ(19,"ion-content",6)(20,"ion-refresher",7),b.NdJ("ionRefresh",(function AddonNotesListPage_Template_ion_refresher_ionRefresh_20_listener(e){return t.refreshNotes(!1,e.target)})),b._UZ(21,"ion-refresher-content",8),b.ALo(22,"translate"),b.qZA(),b.TgZ(23,"core-loading",9),b.YNc(24,AddonNotesListPage_ion_item_24_Template,5,4,"ion-item",10),b.TgZ(25,"core-combobox",11),b.NdJ("onChange",(function AddonNotesListPage_Template_core_combobox_onChange_25_listener(e){return t.typeChanged(e)})),b.TgZ(26,"ion-select-option",12),b._uU(27),b.ALo(28,"translate"),b.qZA(),b.TgZ(29,"ion-select-option",13),b._uU(30),b.ALo(31,"translate"),b.qZA(),b.TgZ(32,"ion-select-option",14),b._uU(33),b.ALo(34,"translate"),b.qZA()(),b.YNc(35,AddonNotesListPage_ion_card_35_Template,8,10,"ion-card",15)(36,AddonNotesListPage_core_empty_box_36_Template,2,3,"core-empty-box",16)(37,AddonNotesListPage_ng_container_37_Template,2,1,"ng-container",17),b.qZA(),b.YNc(38,AddonNotesListPage_ion_fab_38_Template,7,6,"ion-fab",18),b.qZA()),2&e&&(b.xp6(3),b.Q6J("text",b.lcZ(4,26,"core.back")),b.xp6(4),b.Oqu(b.lcZ(8,28,"addon.notes.notes")),b.xp6(4),b.Q6J("hidden",!t.canDeleteNotes),b.uIk("aria-label",b.lcZ(12,30,"core.toggledelete")),b.xp6(4),b.Q6J("hidden",!(t.notesLoaded&&!t.hasOffline))("priority",100)("content",b.lcZ(16,32,"core.refresh"))("iconAction",t.refreshIcon)("closeOnClick",!0),b.xp6(2),b.Q6J("hidden",!(t.notesLoaded&&t.hasOffline))("priority",100)("content",b.lcZ(18,34,"core.settings.synchronizenow"))("iconAction",t.syncIcon)("closeOnClick",!1),b.xp6(3),b.Q6J("disabled",!t.notesLoaded),b.xp6(),b.s9C("pullingText",b.lcZ(22,36,"core.pulltorefresh")),b.xp6(2),b.Q6J("hideUntil",t.notesLoaded),b.xp6(),b.Q6J("ngIf",t.user),b.xp6(),b.Q6J("selection",t.type),b.xp6(2),b.hij(" ",b.lcZ(28,38,"addon.notes.sitenotes")," "),b.xp6(3),b.hij(" ",b.lcZ(31,40,"addon.notes.coursenotes")," "),b.xp6(3),b.hij(" ",b.lcZ(34,42,"addon.notes.personalnotes")," "),b.xp6(2),b.Q6J("ngIf",t.hasOffline),b.xp6(),b.Q6J("ngIf",t.notes&&0===t.notes.length),b.xp6(),b.Q6J("ngIf",t.notes&&t.notes.length>0),b.xp6(),b.Q6J("ngIf",t.userId&&t.notesLoaded))},dependencies:[w.sg,w.O5,O.P,P.l,v.z,J.r,D.J,U.X,Q.F,k.U,C.I,q.r,M.t,E.O,f.YG,f.Sm,f.PM,f.W2,f.IJ,f.W4,f.Gu,f.gu,f.Ie,f.Q$,f.nJ,f.Wo,f.n0,f.wd,f.sr,f.oU,w.i8,S.c,G.X$],encapsulation:2,data:{animation:[p.j.SLIDE_IN_OUT]}}),AddonNotesListPage})();const V=[{path:"",component:z}];let R=(()=>{var e;class AddonNotesLazyModule{}return(e=AddonNotesLazyModule).ɵfac=function AddonNotesLazyModule_Factory(t){return new(t||e)},e.ɵmod=b.oAB({type:e}),e.ɵinj=b.cJS({imports:[s.Bz.forChild(V),n.L,i.H,r.g,s.Bz]}),AddonNotesLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&b.kYT(R,{declarations:[z],imports:[s.Bz,n.L,i.H,r.g],exports:[s.Bz]}))}}]);