"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2365],{92365:(e,t,o)=>{o.r(t),o.d(t,{CoreReportBuilderLazyModule:()=>q});var n=o(13386),r=o(67643),i=o(19212),a=o(79210),l=o(96814),p=o(86700),c=o(8947),_=o(31903),s=o(89515);function CoreReportBuilderReportColumnComponent_p_3_Template(e,t){if(1&e&&(i.TgZ(0,"p",4),i._uU(1),i.qZA()),2&e){const e=i.oxw();i.xp6(),i.hij(" ",e.header," ")}}function CoreReportBuilderReportColumnComponent_h2_4_core_format_text_1_Template(e,t){if(1&e&&i._UZ(0,"core-format-text",7),2&e){const e=i.oxw(2);i.Q6J("text",e.column)("contextLevel",e.source)("contextInstanceId",e.contextId)}}function CoreReportBuilderReportColumnComponent_h2_4_ng_template_2_Template(e,t){if(1&e&&i._uU(0),2&e){const e=i.oxw(2);i.Oqu(e.column)}}function CoreReportBuilderReportColumnComponent_h2_4_Template(e,t){if(1&e&&(i.TgZ(0,"h2"),i.YNc(1,CoreReportBuilderReportColumnComponent_h2_4_core_format_text_1_Template,1,3,"core-format-text",5)(2,CoreReportBuilderReportColumnComponent_h2_4_ng_template_2_Template,1,1,"ng-template",null,6,i.W1O),i.qZA()),2&e){const e=i.MAs(3),t=i.oxw();i.xp6(),i.Q6J("ngIf",t.isString(t.column))("ngIfElse",e)}}function CoreReportBuilderReportColumnComponent_ng_container_5_core_format_text_1_Template(e,t){if(1&e&&i._UZ(0,"core-format-text",7),2&e){const e=i.oxw(2);i.Q6J("text",e.column)("contextLevel",e.source)("contextInstanceId",e.contextId)}}function CoreReportBuilderReportColumnComponent_ng_container_5_ng_template_2_Template(e,t){if(1&e&&i._uU(0),2&e){const e=i.oxw(2);i.Oqu(e.column)}}function CoreReportBuilderReportColumnComponent_ng_container_5_Template(e,t){if(1&e&&(i.ynx(0),i.YNc(1,CoreReportBuilderReportColumnComponent_ng_container_5_core_format_text_1_Template,1,3,"core-format-text",5)(2,CoreReportBuilderReportColumnComponent_ng_container_5_ng_template_2_Template,1,1,"ng-template",null,6,i.W1O),i.BQk()),2&e){const e=i.MAs(3),t=i.oxw();i.xp6(),i.Q6J("ngIf",t.isString(t.column))("ngIfElse",e)}}function CoreReportBuilderReportColumnComponent_ion_icon_6_Template(e,t){if(1&e&&i._UZ(0,"ion-icon",8),2&e){const e=i.oxw();i.ekj("expandable-status-icon-expanded",!e.isExpanded)}}let d=(()=>{var e;class CoreReportBuilderReportColumnComponent{constructor(){this.isExpanded=!1,this.isExpandable=!1,this.showFirstTitle=!1,this.onToggleRow=new i.vpe,this.isString=e=>a.$p.isString(e)}toggleRow(){this.onToggleRow.emit(this.rowIndex)}}return(e=CoreReportBuilderReportColumnComponent).ɵfac=function CoreReportBuilderReportColumnComponent_Factory(t){return new(t||e)},e.ɵcmp=i.Xpm({type:e,selectors:[["core-report-builder-report-column"]],inputs:{isExpanded:"isExpanded",isExpandable:"isExpandable",showFirstTitle:"showFirstTitle",columnIndex:"columnIndex",rowIndex:"rowIndex",column:"column",contextId:"contextId",header:"header",source:"source"},outputs:{onToggleRow:"onToggleRow"},decls:7,vars:11,consts:[["lines","inset",1,"ion-text-wrap",3,"detail","button","click"],["class","item-heading",4,"ngIf"],[4,"ngIf"],["slot","end","aria-hidden","true","name","fas-chevron-up","class","expandable-status-icon","flip-rtl","",3,"expandable-status-icon-expanded",4,"ngIf"],[1,"item-heading"],[3,"text","contextLevel","contextInstanceId",4,"ngIf","ngIfElse"],["notText",""],[3,"text","contextLevel","contextInstanceId"],["slot","end","aria-hidden","true","name","fas-chevron-up","flip-rtl","",1,"expandable-status-icon"]],template:function CoreReportBuilderReportColumnComponent_Template(e,t){1&e&&(i.TgZ(0,"ion-item",0),i.NdJ("click",(function CoreReportBuilderReportColumnComponent_Template_ion_item_click_0_listener(){return t.toggleRow()})),i.ALo(1,"translate"),i.TgZ(2,"ion-label"),i.YNc(3,CoreReportBuilderReportColumnComponent_p_3_Template,2,1,"p",1)(4,CoreReportBuilderReportColumnComponent_h2_4_Template,4,2,"h2",2)(5,CoreReportBuilderReportColumnComponent_ng_container_5_Template,4,2,"ng-container",2),i.qZA(),i.YNc(6,CoreReportBuilderReportColumnComponent_ion_icon_6_Template,1,2,"ion-icon",3),i.qZA()),2&e&&(i.Q6J("detail",!1)("button",t.isExpandable),i.uIk("aria-expanded",t.isExpanded)("aria-controls","core-report-builder-column-"+t.rowIndex)("aria-label",i.lcZ(1,9,t.isExpanded?"core.hidecolumns":"core.showcolumns")),i.xp6(3),i.Q6J("ngIf",0!==t.columnIndex||0===t.columnIndex&&t.showFirstTitle),i.xp6(),i.Q6J("ngIf",0===t.columnIndex),i.xp6(),i.Q6J("ngIf",0!==t.columnIndex),i.xp6(),i.Q6J("ngIf",t.isExpandable))},dependencies:[l.O5,p.I,c.r,_.gu,_.Ie,_.Q$,s.X$],styles:["[_nghost-%COMP%]{--rotate-expandable: rotate(180deg)}[_nghost-%COMP%]   .expandable-status-icon[_ngcontent-%COMP%]{font-size:var(--text-size);margin-inline-start:0;margin-inline-end:2px;transition:transform .2s ease-in-out}"]}),CoreReportBuilderReportColumnComponent})();var u=o(49671),g=o(31381),m=o(43468),f=o(43555),C=o(38049),x=o(53564),R=o(13010),h=o(75803),w=o(10727),b=o(88817),T=o(65619),I=o(37398),B=o(55126),Z=o(52133),y=o(66931);function CoreReportBuilderReportDetailComponent_ng_container_0_ng_container_5_ng_container_1_ion_card_1_core_report_builder_report_column_2_Template(e,t){if(1&e){const e=i.EpF();i.TgZ(0,"core-report-builder-report-column",10),i.NdJ("onToggleRow",(function CoreReportBuilderReportDetailComponent_ng_container_0_ng_container_5_ng_container_1_ion_card_1_core_report_builder_report_column_2_Template_core_report_builder_report_column_onToggleRow_0_listener(){i.CHM(e);const t=i.oxw().index,o=i.oxw(4);return i.KtG(o.toggleRow(t))})),i.ALo(1,"async"),i.qZA()}if(2&e){const e=t.$implicit,o=t.index,n=i.oxw(),r=n.index,a=n.$implicit,l=i.oxw(3).ngIf,p=i.oxw();i.Q6J("columnIndex",o)("rowIndex",r)("isExpandable",0===o&&a.columns.length>l.cardVisibleColumns)("isExpanded",a.isExpanded)("showFirstTitle",l.cardviewShowFirstTitle)("source",i.lcZ(1,9,p.source$))("contextId",l.report.details.contextid)("header",l.report.data.headers[o])("column",e)}}function CoreReportBuilderReportDetailComponent_ng_container_0_ng_container_5_ng_container_1_ion_card_1_Template(e,t){if(1&e&&(i.TgZ(0,"ion-card")(1,"ion-list",8),i.YNc(2,CoreReportBuilderReportDetailComponent_ng_container_0_ng_container_5_ng_container_1_ion_card_1_core_report_builder_report_column_2_Template,2,11,"core-report-builder-report-column",9),i.ALo(3,"slice"),i.qZA()()),2&e){const e=t.$implicit,o=i.oxw(3).ngIf;i.xp6(2),i.Q6J("ngForOf",i.Dn7(3,1,e.columns,0,e.isExpanded?e.columns.length:o.cardVisibleColumns))}}function CoreReportBuilderReportDetailComponent_ng_container_0_ng_container_5_ng_container_1_Template(e,t){if(1&e&&(i.ynx(0),i.YNc(1,CoreReportBuilderReportDetailComponent_ng_container_0_ng_container_5_ng_container_1_ion_card_1_Template,4,5,"ion-card",7),i.BQk()),2&e){const e=i.oxw(2).ngIf;i.xp6(),i.Q6J("ngForOf",e.report.data.rows)}}function CoreReportBuilderReportDetailComponent_ng_container_0_ng_container_5_ng_container_2_th_4_Template(e,t){if(1&e&&(i.TgZ(0,"th"),i._uU(1),i.qZA()),2&e){const e=t.$implicit;i.xp6(),i.hij(" ",e," ")}}function CoreReportBuilderReportDetailComponent_ng_container_0_ng_container_5_ng_container_2_tr_6_td_1_core_format_text_1_Template(e,t){if(1&e&&(i._UZ(0,"core-format-text",13),i.ALo(1,"async")),2&e){const e=i.oxw().$implicit,t=i.oxw(4).ngIf,o=i.oxw();i.Q6J("text",e)("contextLevel",i.lcZ(1,3,o.source$))("contextInstanceId",t.report.details.contextid)}}function CoreReportBuilderReportDetailComponent_ng_container_0_ng_container_5_ng_container_2_tr_6_td_1_ng_template_2_Template(e,t){if(1&e&&i._uU(0),2&e){const e=i.oxw().$implicit;i.hij(" ",e," ")}}function CoreReportBuilderReportDetailComponent_ng_container_0_ng_container_5_ng_container_2_tr_6_td_1_Template(e,t){if(1&e&&(i.TgZ(0,"td"),i.YNc(1,CoreReportBuilderReportDetailComponent_ng_container_0_ng_container_5_ng_container_2_tr_6_td_1_core_format_text_1_Template,2,5,"core-format-text",11)(2,CoreReportBuilderReportDetailComponent_ng_container_0_ng_container_5_ng_container_2_tr_6_td_1_ng_template_2_Template,1,1,"ng-template",null,12,i.W1O),i.qZA()),2&e){const e=t.$implicit,o=i.MAs(3),n=i.oxw(5);i.xp6(),i.Q6J("ngIf",n.isString(e))("ngIfElse",o)}}function CoreReportBuilderReportDetailComponent_ng_container_0_ng_container_5_ng_container_2_tr_6_Template(e,t){if(1&e&&(i.TgZ(0,"tr"),i.YNc(1,CoreReportBuilderReportDetailComponent_ng_container_0_ng_container_5_ng_container_2_tr_6_td_1_Template,4,2,"td",7),i.qZA()),2&e){const e=t.$implicit;i.xp6(),i.Q6J("ngForOf",e.columns)}}function CoreReportBuilderReportDetailComponent_ng_container_0_ng_container_5_ng_container_2_Template(e,t){if(1&e&&(i.ynx(0),i.TgZ(1,"table")(2,"thead")(3,"tr"),i.YNc(4,CoreReportBuilderReportDetailComponent_ng_container_0_ng_container_5_ng_container_2_th_4_Template,2,1,"th",7),i.qZA()(),i.TgZ(5,"tbody"),i.YNc(6,CoreReportBuilderReportDetailComponent_ng_container_0_ng_container_5_ng_container_2_tr_6_Template,2,1,"tr",7),i.qZA()(),i.BQk()),2&e){const e=i.oxw(2).ngIf;i.xp6(4),i.Q6J("ngForOf",e.report.data.headers),i.xp6(2),i.Q6J("ngForOf",e.report.data.rows)}}function CoreReportBuilderReportDetailComponent_ng_container_0_ng_container_5_Template(e,t){if(1&e&&(i.ynx(0),i.YNc(1,CoreReportBuilderReportDetailComponent_ng_container_0_ng_container_5_ng_container_1_Template,2,1,"ng-container",0)(2,CoreReportBuilderReportDetailComponent_ng_container_0_ng_container_5_ng_container_2_Template,7,2,"ng-container",0),i.BQk()),2&e){const e=i.oxw(2);i.xp6(),i.Q6J("ngIf",e.isCardLayout),i.xp6(),i.Q6J("ngIf",!e.isCardLayout)}}function CoreReportBuilderReportDetailComponent_ng_container_0_ng_template_6_Template(e,t){1&e&&(i.TgZ(0,"core-empty-box",14)(1,"p"),i._uU(2),i.ALo(3,"translate"),i.qZA()()),2&e&&(i.xp6(2),i.hij(" ",i.lcZ(3,1,"core.course.nocontentavailable")," "))}function CoreReportBuilderReportDetailComponent_ng_container_0_core_infinite_loading_8_Template(e,t){if(1&e){const e=i.EpF();i.TgZ(0,"core-infinite-loading",15),i.NdJ("action",(function CoreReportBuilderReportDetailComponent_ng_container_0_core_infinite_loading_8_Template_core_infinite_loading_action_0_listener(t){i.CHM(e);const o=i.oxw(2);return i.KtG(o.fetchMoreInfo(t))})),i.qZA()}if(2&e){const e=i.oxw().ngIf;i.Q6J("enabled",e.canLoadMoreRows)("error",e.errorLoadingRows)}}function CoreReportBuilderReportDetailComponent_ng_container_0_Template(e,t){if(1&e){const e=i.EpF();i.ynx(0),i.TgZ(1,"core-loading",1)(2,"ion-refresher",2),i.NdJ("ionRefresh",(function CoreReportBuilderReportDetailComponent_ng_container_0_Template_ion_refresher_ionRefresh_2_listener(t){i.CHM(e);const o=i.oxw();return i.KtG(o.refreshReport(t.target))})),i._UZ(3,"ion-refresher-content",3),i.ALo(4,"translate"),i.qZA(),i.YNc(5,CoreReportBuilderReportDetailComponent_ng_container_0_ng_container_5_Template,3,2,"ng-container",4)(6,CoreReportBuilderReportDetailComponent_ng_container_0_ng_template_6_Template,4,3,"ng-template",null,5,i.W1O)(8,CoreReportBuilderReportDetailComponent_ng_container_0_core_infinite_loading_8_Template,1,2,"core-infinite-loading",6),i.qZA(),i.BQk()}if(2&e){const e=t.ngIf,o=i.MAs(7),n=i.oxw();i.xp6(),i.Q6J("hideUntil",e.loaded),i.xp6(),i.Q6J("disabled",!e.loaded),i.xp6(),i.s9C("pullingText",i.lcZ(4,6,"core.pulltorefresh")),i.xp6(2),i.Q6J("ngIf",(null==e.report||null==e.report.data||null==e.report.data.rows?null:e.report.data.rows.length)&&(null==e.report||null==e.report.data?null:e.report.data.headers)&&(null==e.report?null:e.report.details))("ngIfElse",o),i.xp6(3),i.Q6J("ngIf",!n.isBlock&&(null==e.report||null==e.report.data||null==e.report.data.rows?null:e.report.data.rows.length)&&(null==e.report||null==e.report.data?null:e.report.data.headers)&&(null==e.report?null:e.report.details))}}let v=(()=>{var e;class CoreReportBuilderReportDetailComponent{get isCardLayout(){return"card"===this.layout||C.X4.isMobile&&"adaptative"===this.layout}constructor(){var e=this;this.isBlock=!0,this.layout="adaptative",this.onReportLoaded=new i.vpe,this.state$=new T.X({report:null,loaded:!1,canLoadMoreRows:!0,errorLoadingRows:!1,cardviewShowFirstTitle:!1,cardVisibleColumns:1,page:0}),this.isString=e=>a.$p.isString(e),this.source$=this.state$.pipe((0,I.U)((e=>{var t;const o=null===(t=e.report)||void 0===t?void 0:t.details.source.split("\\"),n=null==o?void 0:o[(null==o?void 0:o.length)-1];return null!=n?n:"system"}))),this.logView=b.V.once(function(){var t=(0,u.Z)((function*(t){yield h.Tr.ignoreErrors(a.$p.viewReport(e.reportId)),m.ke.logEvent({type:m.gM.VIEW_ITEM,ws:"core_reportbuilder_view_report",name:t.details.name,data:{id:e.reportId,category:"reportbuilder"},url:`/reportbuilder/view.php?id=${e.reportId}`})}));return function(e){return t.apply(this,arguments)}}())}ngOnInit(){var e=this;return(0,u.Z)((function*(){yield e.getReport(),e.updateState({loaded:!0})}))()}getReport(){var e=this;return(0,u.Z)((function*(){try{var t;if(!e.reportId)return R.OQ.showErrorModal(new g.G("No report found")),f.b.back(),void 0;const{page:o}=e.state$.getValue(),n=yield a.$p.loadReport(parseInt(e.reportId),o,null!==(t=e.perPage)&&void 0!==t?t:a.RV);if(!n)return R.OQ.showErrorModal(new g.G("No report found")),f.b.back(),void 0;e.updateState({report:n,cardVisibleColumns:n.details.settingsdata.cardviewVisibleColumns,cardviewShowFirstTitle:n.details.settingsdata.cardviewShowFirstTitle}),e.logView(n),e.onReportLoaded.emit(n.details)}catch{const t={title:w.vN.instant("core.error"),body:`\n                    <p>${w.vN.instant("addon.mod_page.errorwhileloadingthepage")}</p>\n                    <p>${w.vN.instant("core.course.useactivityonbrowser")}</p>\n                `,buttons:[{text:w.vN.instant("core.cancel"),role:"cancel",handler:(n=(0,u.Z)((function*(){return yield f.b.back()})),function handler(){return n.apply(this,arguments)})},{text:w.vN.instant("core.openinbrowser"),role:"confirm",handler:(o=(0,u.Z)((function*(){const t=`${x.m9.getRequiredCurrentSite().getURL()}/reportbuilder/view.php?id=${e.reportId}`;yield h.Tr.openInBrowser(t,{showBrowserWarning:!1}),yield f.b.back()})),function handler(){return o.apply(this,arguments)})}]};yield R.OQ.showErrorModal(t)}var o,n}))()}updateState(e){const t=this.state$.getValue();this.state$.next({...t,...e})}refreshReport(e){var t=this;return(0,u.Z)((function*(){yield h.Tr.ignoreErrors(a.$p.invalidateReport()),t.updateState({page:0,canLoadMoreRows:!1}),yield h.Tr.ignoreErrors(t.getReport()),yield null==e?void 0:e.complete(),t.updateState({canLoadMoreRows:!0})}))()}incrementPage(){const{page:e}=this.state$.getValue();this.updateState({page:e+1})}fetchMoreInfo(e){var t=this;return(0,u.Z)((function*(){const{canLoadMoreRows:o,report:n}=t.state$.getValue();if(!o)return e(),void 0;try{t.incrementPage();const{page:o}=t.state$.getValue(),r=yield a.$p.loadReport(parseInt(t.reportId),o,a.RV);if(!n||!r||0===r.data.rows.length)return t.updateState({canLoadMoreRows:!1}),e(),void 0;t.updateState({report:{...n,data:{...n.data,rows:[...n.data.rows,...r.data.rows]}}})}catch(e){R.OQ.showErrorModalDefault(e,"Error loading more reports"),t.updateState({canLoadMoreRows:!1}),t.updateState({errorLoadingRows:!0})}e()}))()}toggleRow(e){var t;const{report:o}=this.state$.getValue();null!=o&&null!==(t=o.data)&&void 0!==t&&t.rows[e]&&(o.data.rows[e].isExpanded=!o.data.rows[e].isExpanded,this.updateState({report:o}))}}return(e=CoreReportBuilderReportDetailComponent).ɵfac=function CoreReportBuilderReportDetailComponent_Factory(t){return new(t||e)},e.ɵcmp=i.Xpm({type:e,selectors:[["core-report-builder-report-detail"]],inputs:{reportId:"reportId",isBlock:"isBlock",perPage:"perPage",layout:"layout"},outputs:{onReportLoaded:"onReportLoaded"},decls:2,vars:3,consts:[[4,"ngIf"],[3,"hideUntil"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[4,"ngIf","ngIfElse"],["empty",""],[3,"enabled","error","action",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"ion-text-wrap"],[3,"columnIndex","rowIndex","isExpandable","isExpanded","showFirstTitle","source","contextId","header","column","onToggleRow",4,"ngFor","ngForOf"],[3,"columnIndex","rowIndex","isExpandable","isExpanded","showFirstTitle","source","contextId","header","column","onToggleRow"],[3,"text","contextLevel","contextInstanceId",4,"ngIf","ngIfElse"],["notText",""],[3,"text","contextLevel","contextInstanceId"],["icon","fas-rectangle-list"],[3,"enabled","error","action"]],template:function CoreReportBuilderReportDetailComponent_Template(e,t){1&e&&(i.YNc(0,CoreReportBuilderReportDetailComponent_ng_container_0_Template,9,8,"ng-container",0),i.ALo(1,"async")),2&e&&i.Q6J("ngIf",i.lcZ(1,1,t.state$))},dependencies:[l.sg,l.O5,B.z,Z.n,y.r,c.r,_.PM,_.q_,_.nJ,_.Wo,d,l.Ov,l.OU,s.X$],styles:["[_nghost-%COMP%]{--header-background: var(--white);--border-color: var(--stroke)}[_nghost-%COMP%]   .report-title[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   table[_ngcontent-%COMP%]{width:98%;margin:1em auto;border-collapse:collapse;color:var(--ion-text-color);overflow-x:auto;display:block}[_nghost-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]{display:table}[_nghost-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:var(--header-background)}[_nghost-%COMP%]   table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-bottom:1px solid var(--border-color)}[_nghost-%COMP%]   table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(2n){background:var(--light)}[_nghost-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], [_nghost-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-inline-end:8px;padding-top:8px;padding-bottom:8px;text-align:start;min-width:200px}[_nghost-%COMP%]   core-empty-box[_ngcontent-%COMP%]{color:var(--gray-500)}[_nghost-%COMP%]   core-empty-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--gray-900)}"],changeDetection:0}),CoreReportBuilderReportDetailComponent})();var M=o(83369),L=o(29657),O=o(22068);function CoreReportBuilderReportSummaryComponent_ion_item_16_Template(e,t){if(1&e&&(i.TgZ(0,"ion-item",14)(1,"ion-label")(2,"p"),i._uU(3),i.ALo(4,"translate"),i.qZA(),i._UZ(5,"core-format-text",8),i.qZA()()),2&e){const e=t.$implicit,o=i.oxw();i.Q6J("detail",!1),i.xp6(3),i.Oqu(i.lcZ(4,4,e.title)),i.xp6(2),i.Q6J("text",e.text)("contextInstanceId",o.reportDetail.id)}}const _c0=e=>({$a:e});let P=(()=>{var e;class CoreReportBuilderReportSummaryComponent{ngOnInit(){const e=new M.o,t=x.m9.getRequiredCurrentSite();this.reportUrl=`${t.getURL()}/reportbuilder/view.php?id=${this.reportDetail.id}`,this.reportDetailToDisplay=[{title:"core.reportbuilder.reportsource",text:this.reportDetail.sourcename},{title:"core.reportbuilder.timecreated",text:e.transform(1e3*this.reportDetail.timecreated)},{title:"addon.mod_data.timemodified",text:e.transform(1e3*this.reportDetail.timemodified)},{title:"core.reportbuilder.modifiedby",text:this.reportDetail.modifiedby.fullname}]}closeModal(){w.IN.dismiss()}}return(e=CoreReportBuilderReportSummaryComponent).ɵfac=function CoreReportBuilderReportSummaryComponent_Factory(t){return new(t||e)},e.ɵcmp=i.Xpm({type:e,selectors:[["core-report-builder-report-summary"]],inputs:{reportDetail:"reportDetail"},decls:24,vars:17,consts:[[1,"no-title"],["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click"],["slot","icon-only","name","fas-xmark","aria-hidden","true"],[1,"list-item-limited-width"],[1,"ion-text-wrap","course-name"],["contextLevel","report",3,"text","contextInstanceId"],["class","ion-text-wrap",3,"detail",4,"ngFor","ngForOf"],[1,"ion-no-border"],[1,"ion-text-wrap","filters-info"],["name","fas-circle-info","aria-hidden","true"],[3,"text","filter","captureLinks"],[1,"ion-text-wrap",3,"detail"]],template:function CoreReportBuilderReportSummaryComponent_Template(e,t){1&e&&(i.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),i._UZ(3,"ion-back-button",2),i.ALo(4,"translate"),i.qZA(),i._UZ(5,"ion-title"),i.TgZ(6,"ion-buttons",3)(7,"ion-button",4),i.NdJ("click",(function CoreReportBuilderReportSummaryComponent_Template_ion_button_click_7_listener(){return t.closeModal()})),i.ALo(8,"translate"),i._UZ(9,"ion-icon",5),i.qZA()()()(),i.TgZ(10,"ion-content")(11,"div",6)(12,"ion-item",7)(13,"ion-label")(14,"h1"),i._UZ(15,"core-format-text",8),i.qZA()()(),i.YNc(16,CoreReportBuilderReportSummaryComponent_ion_item_16_Template,6,6,"ion-item",9),i.qZA()(),i.TgZ(17,"ion-footer",10)(18,"ion-item",11)(19,"ion-label")(20,"p"),i._UZ(21,"ion-icon",12)(22,"core-format-text",13),i.ALo(23,"translate"),i.qZA()()()()),2&e&&(i.xp6(3),i.Q6J("text",i.lcZ(4,8,"core.back")),i.xp6(4),i.uIk("aria-label",i.lcZ(8,10,"core.close")),i.xp6(8),i.Q6J("text",t.reportDetail.name)("contextInstanceId",t.reportDetail.id),i.xp6(),i.Q6J("ngForOf",t.reportDetailToDisplay),i.xp6(6),i.Q6J("text",i.xi3(23,12,"core.reportbuilder.filtersapplied",i.VKq(15,_c0,t.reportUrl)))("filter",!1)("captureLinks",!1))},dependencies:[l.sg,p.I,c.r,L.t,O.O,_.YG,_.Sm,_.W2,_.fr,_.Gu,_.gu,_.Ie,_.Q$,_.wd,_.sr,_.oU,s.X$],styles:[".filters-info[_ngcontent-%COMP%]{padding-bottom:1rem}ion-footer[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px;color:#0f6cbf;margin-right:.3rem;vertical-align:middle}"],changeDetection:0}),CoreReportBuilderReportSummaryComponent})(),J=(()=>{var e;class CoreReportBuilderComponentsModule{}return(e=CoreReportBuilderComponentsModule).ɵfac=function CoreReportBuilderComponentsModule_Factory(t){return new(t||e)},e.ɵmod=i.oAB({type:e}),e.ɵinj=i.cJS({imports:[n.L]}),CoreReportBuilderComponentsModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&i.kYT(J,{declarations:[v,d,P],imports:[n.L],exports:[v,d,P]}));var D=o(1389),A=o(25233),Q=o(54129);class CoreReportBuilderReportsSource extends Q.H{getItemPath(e){return e.id.toString()}loadPageItems(e){var t=this;return(0,u.Z)((function*(){const o=yield a.$p.getReports(e,t.getPageLength());return{items:o,hasMoreItems:o.length>0}}))()}setItems(e,t){const o=e.slice(0);o.sort(((e,t)=>e.timemodified<t.timemodified?1:-1)),super.setItems(o,t)}getPageLength(){return a.Kj}}function CoreReportBuilderListPage_ion_content_9_ion_list_5_ion_item_1_Template(e,t){if(1&e){const e=i.EpF();i.TgZ(0,"ion-item",10),i.NdJ("click",(function CoreReportBuilderListPage_ion_content_9_ion_list_5_ion_item_1_Template_ion_item_click_0_listener(){const t=i.CHM(e).$implicit,o=i.oxw(3);return i.KtG(o.reports.select(t))})),i.TgZ(1,"ion-label")(2,"p",11),i._UZ(3,"core-format-text",12),i.qZA(),i.TgZ(4,"p"),i._uU(5),i.qZA()()()}if(2&e){const e=t.$implicit,o=i.oxw(3);i.Q6J("detail",!0)("button",!0),i.uIk("aria-current",o.reports.getItemAriaCurrent(e)),i.xp6(3),i.Q6J("clean",!0)("text",e.name)("filter",!1),i.xp6(2),i.Oqu(e.sourcename)}}function CoreReportBuilderListPage_ion_content_9_ion_list_5_Template(e,t){if(1&e&&(i.TgZ(0,"ion-list"),i.YNc(1,CoreReportBuilderListPage_ion_content_9_ion_list_5_ion_item_1_Template,6,7,"ion-item",9),i.qZA()),2&e){const e=i.oxw(2);i.xp6(),i.Q6J("ngForOf",e.reports.items)}}function CoreReportBuilderListPage_ion_content_9_ng_template_6_core_empty_box_0_Template(e,t){1&e&&(i._UZ(0,"core-empty-box",14),i.ALo(1,"translate")),2&e&&i.Q6J("message",i.lcZ(1,1,"core.course.nocontentavailable"))}function CoreReportBuilderListPage_ion_content_9_ng_template_6_Template(e,t){if(1&e&&i.YNc(0,CoreReportBuilderListPage_ion_content_9_ng_template_6_core_empty_box_0_Template,2,3,"core-empty-box",13),2&e){const e=i.oxw(2);i.Q6J("ngIf",!(null!=e.reports.items&&e.reports.items.length))}}function CoreReportBuilderListPage_ion_content_9_core_infinite_loading_8_Template(e,t){if(1&e){const e=i.EpF();i.TgZ(0,"core-infinite-loading",15),i.NdJ("action",(function CoreReportBuilderListPage_ion_content_9_core_infinite_loading_8_Template_core_infinite_loading_action_0_listener(t){i.CHM(e);const o=i.oxw(2);return i.KtG(o.fetchMoreReports(t))})),i.qZA()}if(2&e){const e=i.oxw().ngIf,t=i.oxw();i.Q6J("enabled",t.reports.loaded&&!t.reports.completed)("error",e.loadMoreError)}}function CoreReportBuilderListPage_ion_content_9_Template(e,t){if(1&e){const e=i.EpF();i.TgZ(0,"ion-content")(1,"ion-refresher",3),i.NdJ("ionRefresh",(function CoreReportBuilderListPage_ion_content_9_Template_ion_refresher_ionRefresh_1_listener(t){i.CHM(e);const o=i.oxw();return i.KtG(o.refreshReports(t.target))})),i._UZ(2,"ion-refresher-content",4),i.ALo(3,"translate"),i.qZA(),i.TgZ(4,"core-loading",5),i.YNc(5,CoreReportBuilderListPage_ion_content_9_ion_list_5_Template,2,1,"ion-list",6)(6,CoreReportBuilderListPage_ion_content_9_ng_template_6_Template,1,1,"ng-template",null,7,i.W1O)(8,CoreReportBuilderListPage_ion_content_9_core_infinite_loading_8_Template,1,2,"core-infinite-loading",8),i.qZA()()}if(2&e){const e=t.ngIf,o=i.MAs(7),n=i.oxw();i.xp6(),i.Q6J("disabled",!e.loaded),i.xp6(),i.s9C("pullingText",i.lcZ(3,6,"core.pulltorefresh")),i.xp6(2),i.Q6J("hideUntil",e.loaded),i.xp6(),i.Q6J("ngIf",null==n.reports.items?null:n.reports.items.length)("ngIfElse",o),i.xp6(3),i.Q6J("ngIf",null==n.reports.items?null:n.reports.items.length)}}let E=(()=>{var e;class CoreReportBuilderListPage{constructor(){this.state$=new T.X({page:1,perpage:a.Kj,loaded:!1,loadMoreError:!1}),this.logView=b.V.once((()=>this.performLogView()));try{const e=A.p.getOrCreateSource(CoreReportBuilderReportsSource,[]);this.reports=new D.a(e,CoreReportBuilderListPage)}catch(e){R.OQ.showErrorModal(e),f.b.back()}}ngAfterViewInit(){var e=this;return(0,u.Z)((function*(){try{yield e.fetchReports(!0),e.updateState({loaded:!0})}catch(t){R.OQ.showErrorModalDefault(t,"Error loading reports"),e.reports.reset()}}))()}fetchReports(e){var t=this;return(0,u.Z)((function*(){e?yield t.reports.reload():yield t.reports.load(),t.updateState({loadMoreError:!1}),t.logView()}))()}updateState(e){const t=this.state$.getValue();this.state$.next({...t,...e})}fetchMoreReports(e){var t=this;return(0,u.Z)((function*(){try{yield t.fetchReports(!1)}catch(e){R.OQ.showErrorModalDefault(e,"Error loading more reports"),t.updateState({loadMoreError:!0})}e()}))()}refreshReports(e){var t=this;return(0,u.Z)((function*(){yield h.Tr.ignoreErrors(a.$p.invalidateReportsList()),yield h.Tr.ignoreErrors(t.fetchReports(!0)),yield null==e?void 0:e.complete()}))()}performLogView(){m.ke.logEvent({type:m.gM.VIEW_ITEM_LIST,ws:"core_reportbuilder_list_reports",name:w.vN.instant("core.reportbuilder.reports"),data:{category:"reportbuilder"},url:"/reportbuilder/index.php"})}ngOnDestroy(){this.reports.destroy()}}return(e=CoreReportBuilderListPage).ɵfac=function CoreReportBuilderListPage_Factory(t){return new(t||e)},e.ɵcmp=i.Xpm({type:e,selectors:[["core-report-builder-list"]],decls:11,vars:9,consts:[["slot","start"],[3,"text"],[4,"ngIf"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[4,"ngIf","ngIfElse"],["empty",""],[3,"enabled","error","action",4,"ngIf"],["class","ion-text-wrap",3,"detail","button","click",4,"ngFor","ngForOf"],[1,"ion-text-wrap",3,"detail","button","click"],[1,"item-heading"],[3,"clean","text","filter"],["icon","fas-rectangle-list",3,"message",4,"ngIf"],["icon","fas-rectangle-list",3,"message"],[3,"enabled","error","action"]],template:function CoreReportBuilderListPage_Template(e,t){1&e&&(i.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),i._UZ(3,"ion-back-button",1),i.ALo(4,"translate"),i.qZA(),i.TgZ(5,"ion-title")(6,"h1"),i._uU(7),i.ALo(8,"translate"),i.qZA()()()(),i.YNc(9,CoreReportBuilderListPage_ion_content_9_Template,9,8,"ion-content",2),i.ALo(10,"async")),2&e&&(i.xp6(3),i.Q6J("text",i.lcZ(4,3,"core.back")),i.xp6(4),i.Oqu(i.lcZ(8,5,"core.reportbuilder.reports")),i.xp6(2),i.Q6J("ngIf",i.lcZ(10,7,t.state$)))},dependencies:[l.sg,l.O5,B.z,Z.n,y.r,c.r,L.t,_.Sm,_.W2,_.Gu,_.Ie,_.Q$,_.q_,_.nJ,_.Wo,_.wd,_.sr,_.oU,l.Ov,s.X$],encapsulation:2,changeDetection:0}),CoreReportBuilderListPage})();function CoreReportBuilderReportPage_ion_title_9_Template(e,t){if(1&e&&(i.TgZ(0,"ion-title")(1,"h1"),i._UZ(2,"core-format-text",7),i.qZA(),i.TgZ(3,"p",8),i._uU(4),i.qZA()()),2&e){const e=i.oxw();i.xp6(2),i.Q6J("clean",!0)("text",e.reportDetail.name)("filter",!1),i.xp6(2),i.hij(" ",e.reportDetail.sourcename," ")}}let k=(()=>{var e;class CoreReportBuilderReportPage{ngOnInit(){this.reportId=f.b.getRequiredRouteParam("id")}loadReportDetail(e){this.reportDetail=e}openInfo(){R.OQ.openSideModal({component:P,componentProps:{reportDetail:this.reportDetail}})}}return(e=CoreReportBuilderReportPage).ɵfac=function CoreReportBuilderReportPage_Factory(t){return new(t||e)},e.ɵcmp=i.Xpm({type:e,selectors:[["core-report-builder-report"]],decls:12,vars:9,consts:[["slot","start"],[3,"text"],["slot","end"],["fill","clear",3,"click"],["slot","icon-only","name","fas-circle-info","aria-hidden","true"],[4,"ngIf"],[3,"isBlock","reportId","onReportLoaded"],[3,"clean","text","filter"],[1,"subheading"]],template:function CoreReportBuilderReportPage_Template(e,t){1&e&&(i.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),i._UZ(3,"ion-back-button",1),i.ALo(4,"translate"),i.qZA(),i.TgZ(5,"ion-buttons",2)(6,"ion-button",3),i.NdJ("click",(function CoreReportBuilderReportPage_Template_ion_button_click_6_listener(){return t.openInfo()})),i.ALo(7,"translate"),i._UZ(8,"ion-icon",4),i.qZA()(),i.YNc(9,CoreReportBuilderReportPage_ion_title_9_Template,5,4,"ion-title",5),i.qZA()(),i.TgZ(10,"ion-content")(11,"core-report-builder-report-detail",6),i.NdJ("onReportLoaded",(function CoreReportBuilderReportPage_Template_core_report_builder_report_detail_onReportLoaded_11_listener(e){return t.loadReportDetail(e)})),i.qZA()()),2&e&&(i.xp6(3),i.Q6J("text",i.lcZ(4,5,"core.back")),i.xp6(3),i.uIk("aria-label",i.lcZ(7,7,"core.close")),i.xp6(3),i.Q6J("ngIf",t.reportDetail),i.xp6(2),i.Q6J("isBlock",!1)("reportId",t.reportId))},dependencies:[l.O5,p.I,c.r,L.t,O.O,_.YG,_.Sm,_.W2,_.Gu,_.gu,_.wd,_.sr,_.oU,v,s.X$],encapsulation:2}),CoreReportBuilderReportPage})();const $=[{path:"",component:E},{path:":id",component:k}];let q=(()=>{var e;class CoreReportBuilderLazyModule{}return(e=CoreReportBuilderLazyModule).ɵfac=function CoreReportBuilderLazyModule_Factory(t){return new(t||e)},e.ɵmod=i.oAB({type:e}),e.ɵinj=i.cJS({imports:[n.L,J,r.Bz.forChild($)]}),CoreReportBuilderLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&i.kYT(q,{declarations:[E,k],imports:[n.L,J,r.Bz]}))}}]);