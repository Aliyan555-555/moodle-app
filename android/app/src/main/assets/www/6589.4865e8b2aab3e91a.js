"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6589],{72795:(e,o,n)=>{n.r(o),n.d(o,{AddonModForumNewDiscussionLazyModule:()=>V});var s=n(67643),i=n(20982),t=n(84095),r=n(83599),d=n(13386),a=n(49671),c=n(56223),u=n(98370),l=n(95800),m=n(43555),p=n(45265),g=n(15945),_=n(6172),f=n(53564),h=n(13010),w=n(10727),I=n(12265),D=n(60855),A=n(75803),v=n(85277),M=n(90030),x=n(34749),T=n(40067),b=n(48263),N=n(51512),C=n(25233),P=n(88817),y=n(43468),Z=n(19212),F=n(30242),O=n(96814),G=n(72399),S=n(66931),L=n(86700),E=n(8947),J=n(5065),Q=n(29657),R=n(22068),k=n(31903),q=n(89515);const U=["newDiscFormEl"];function AddonModForumNewDiscussionPage_form_15_div_21_ion_item_1_Template(e,o){if(1&e){const e=Z.EpF();Z.TgZ(0,"ion-item")(1,"ion-toggle",24),Z.NdJ("ngModelChange",(function AddonModForumNewDiscussionPage_form_15_div_21_ion_item_1_Template_ion_toggle_ngModelChange_1_listener(o){Z.CHM(e);const n=Z.oxw(3);return Z.KtG(n.newDiscussion.postToAllGroups=o)})),Z._uU(2),Z.ALo(3,"translate"),Z.qZA()()}if(2&e){const e=Z.oxw(3);Z.xp6(),Z.Q6J("ngModel",e.newDiscussion.postToAllGroups),Z.xp6(),Z.hij(" ",Z.lcZ(3,2,"addon.mod_forum.posttomygroups")," ")}}function AddonModForumNewDiscussionPage_form_15_div_21_ion_item_2_ion_select_option_7_Template(e,o){if(1&e&&(Z.TgZ(0,"ion-select-option",29),Z._UZ(1,"core-format-text",30),Z.qZA()),2&e){const e=o.$implicit,n=Z.oxw(4);Z.Q6J("value",e.id),Z.xp6(),Z.Q6J("text",e.name)("contextInstanceId",n.courseId)("wsNotFiltered",!0)}}const _c1=e=>({header:e});function AddonModForumNewDiscussionPage_form_15_div_21_ion_item_2_Template(e,o){if(1&e){const e=Z.EpF();Z.TgZ(0,"ion-item",25)(1,"ion-select",26),Z.NdJ("ngModelChange",(function AddonModForumNewDiscussionPage_form_15_div_21_ion_item_2_Template_ion_select_ngModelChange_1_listener(o){Z.CHM(e);const n=Z.oxw(3);return Z.KtG(n.newDiscussion.groupId=o)}))("ionChange",(function AddonModForumNewDiscussionPage_form_15_div_21_ion_item_2_Template_ion_select_ionChange_1_listener(){Z.CHM(e);const o=Z.oxw(3);return Z.KtG(o.calculateGroupName())})),Z.ALo(2,"translate"),Z.ALo(3,"translate"),Z.TgZ(4,"p",27),Z._uU(5),Z.ALo(6,"translate"),Z.qZA(),Z.YNc(7,AddonModForumNewDiscussionPage_form_15_div_21_ion_item_2_ion_select_option_7_Template,2,4,"ion-select-option",28),Z.qZA()()}if(2&e){const e=Z.oxw(3);Z.xp6(),Z.Q6J("ngModel",e.newDiscussion.groupId)("disabled",e.newDiscussion.postToAllGroups)("interfaceOptions",Z.VKq(12,_c1,Z.lcZ(2,6,"addon.mod_forum.group")))("cancelText",Z.lcZ(3,8,"core.cancel")),Z.xp6(4),Z.Oqu(Z.lcZ(6,10,"addon.mod_forum.group")),Z.xp6(2),Z.Q6J("ngForOf",e.groups)}}function AddonModForumNewDiscussionPage_form_15_div_21_ion_item_7_Template(e,o){if(1&e){const e=Z.EpF();Z.TgZ(0,"ion-item",20)(1,"ion-toggle",31),Z.NdJ("ngModelChange",(function AddonModForumNewDiscussionPage_form_15_div_21_ion_item_7_Template_ion_toggle_ngModelChange_1_listener(o){Z.CHM(e);const n=Z.oxw(3);return Z.KtG(n.newDiscussion.pin=o)})),Z._uU(2),Z.ALo(3,"translate"),Z.qZA()()}if(2&e){const e=Z.oxw(3);Z.xp6(),Z.Q6J("ngModel",e.newDiscussion.pin),Z.xp6(),Z.hij(" ",Z.lcZ(3,2,"addon.mod_forum.discussionpinned")," ")}}function AddonModForumNewDiscussionPage_form_15_div_21_core_attachments_8_Template(e,o){if(1&e&&Z._UZ(0,"core-attachments",32),2&e){const e=Z.oxw(3);Z.Q6J("files",e.newDiscussion.files)("maxSize",e.forum.maxbytes)("maxSubmissions",e.forum.maxattachments)("component",e.component)("componentId",e.forum.cmid)("allowOffline",!0)("courseId",e.courseId)}}function AddonModForumNewDiscussionPage_form_15_div_21_Template(e,o){if(1&e){const e=Z.EpF();Z.TgZ(0,"div",18),Z.YNc(1,AddonModForumNewDiscussionPage_form_15_div_21_ion_item_1_Template,4,4,"ion-item",7)(2,AddonModForumNewDiscussionPage_form_15_div_21_ion_item_2_Template,8,14,"ion-item",19),Z.TgZ(3,"ion-item",20)(4,"ion-toggle",21),Z.NdJ("ngModelChange",(function AddonModForumNewDiscussionPage_form_15_div_21_Template_ion_toggle_ngModelChange_4_listener(o){Z.CHM(e);const n=Z.oxw(2);return Z.KtG(n.newDiscussion.subscribe=o)})),Z._uU(5),Z.ALo(6,"translate"),Z.qZA()(),Z.YNc(7,AddonModForumNewDiscussionPage_form_15_div_21_ion_item_7_Template,4,4,"ion-item",22)(8,AddonModForumNewDiscussionPage_form_15_div_21_core_attachments_8_Template,1,7,"core-attachments",23),Z.qZA()}if(2&e){const e=Z.oxw(2);Z.xp6(),Z.Q6J("ngIf",e.showGroups&&e.groupIds.length>1&&e.accessInfo.cancanposttomygroups),Z.xp6(),Z.Q6J("ngIf",e.showGroups),Z.xp6(2),Z.Q6J("ngModel",e.newDiscussion.subscribe),Z.xp6(),Z.hij(" ",Z.lcZ(6,6,"addon.mod_forum.discussionsubscription")," "),Z.xp6(2),Z.Q6J("ngIf",e.canPin),Z.xp6(),Z.Q6J("ngIf",e.canCreateAttachments&&e.forum&&e.forum.maxattachments>0)}}function AddonModForumNewDiscussionPage_form_15_ion_item_22_Template(e,o){if(1&e&&(Z.TgZ(0,"ion-item",33),Z._UZ(1,"ion-icon",34),Z.TgZ(2,"ion-label"),Z._UZ(3,"core-format-text",30),Z.qZA()()),2&e){const e=Z.oxw(2);Z.xp6(3),Z.Q6J("text",e.postInGroupMessage)("contextInstanceId",e.courseId)("wsNotFiltered",!0)}}function AddonModForumNewDiscussionPage_form_15_ion_col_26_Template(e,o){if(1&e){const e=Z.EpF();Z.TgZ(0,"ion-col")(1,"ion-button",35),Z.NdJ("click",(function AddonModForumNewDiscussionPage_form_15_ion_col_26_Template_ion_button_click_1_listener(){Z.CHM(e);const o=Z.oxw(2);return Z.KtG(o.discard())})),Z._uU(2),Z.ALo(3,"translate"),Z.qZA()()}2&e&&(Z.xp6(2),Z.Oqu(Z.lcZ(3,1,"core.discard")))}function AddonModForumNewDiscussionPage_form_15_Template(e,o){if(1&e){const e=Z.EpF();Z.TgZ(0,"form",null,8)(2,"ion-item")(3,"ion-input",9),Z.NdJ("ngModelChange",(function AddonModForumNewDiscussionPage_form_15_Template_ion_input_ngModelChange_3_listener(o){Z.CHM(e);const n=Z.oxw();return Z.KtG(n.newDiscussion.subject=o)})),Z.ALo(4,"translate"),Z.TgZ(5,"p"),Z._uU(6),Z.ALo(7,"translate"),Z.qZA()()(),Z.TgZ(8,"ion-item")(9,"ion-label",10),Z._uU(10),Z.ALo(11,"translate"),Z.qZA(),Z.TgZ(12,"core-rich-text-editor",11),Z.NdJ("contentChanged",(function AddonModForumNewDiscussionPage_form_15_Template_core_rich_text_editor_contentChanged_12_listener(o){Z.CHM(e);const n=Z.oxw();return Z.KtG(n.onMessageChange(o))})),Z.ALo(13,"translate"),Z.qZA()(),Z.TgZ(14,"ion-item",12),Z.NdJ("click",(function AddonModForumNewDiscussionPage_form_15_Template_ion_item_click_14_listener(){Z.CHM(e);const o=Z.oxw();return Z.KtG(o.toggleAdvanced())})),Z.ALo(15,"translate"),Z._UZ(16,"ion-icon",13),Z.TgZ(17,"ion-label")(18,"h2"),Z._uU(19),Z.ALo(20,"translate"),Z.qZA()()(),Z.YNc(21,AddonModForumNewDiscussionPage_form_15_div_21_Template,9,8,"div",14)(22,AddonModForumNewDiscussionPage_form_15_ion_item_22_Template,4,3,"ion-item",15),Z.TgZ(23,"ion-item",16)(24,"ion-label")(25,"ion-row"),Z.YNc(26,AddonModForumNewDiscussionPage_form_15_ion_col_26_Template,4,3,"ion-col",7),Z.TgZ(27,"ion-col")(28,"ion-button",17),Z.NdJ("click",(function AddonModForumNewDiscussionPage_form_15_Template_ion_button_click_28_listener(){Z.CHM(e);const o=Z.oxw();return Z.KtG(o.add())})),Z._uU(29),Z.ALo(30,"translate"),Z.qZA()()()()()()}if(2&e){const e=Z.oxw();Z.xp6(3),Z.Q6J("ngModel",e.newDiscussion.subject)("placeholder",Z.lcZ(4,21,"addon.mod_forum.subject")),Z.xp6(3),Z.Oqu(Z.lcZ(7,23,"addon.mod_forum.subject")),Z.xp6(4),Z.Oqu(Z.lcZ(11,25,"addon.mod_forum.message")),Z.xp6(2),Z.Q6J("control",e.messageControl)("placeholder",Z.lcZ(13,27,"addon.mod_forum.message"))("component",e.component)("componentId",e.forum.cmid)("autoSave",!0)("contextInstanceId",e.forum.cmid),Z.xp6(2),Z.Q6J("detail",!1),Z.uIk("aria-expanded",e.advanced)("aria-label",Z.lcZ(15,29,e.advanced?"core.hideadvanced":"core.showadvanced")),Z.xp6(2),Z.ekj("expandable-status-icon-expanded",e.advanced),Z.xp6(3),Z.Oqu(Z.lcZ(20,31,"addon.mod_forum.advanced")),Z.xp6(2),Z.Q6J("ngIf",e.advanced),Z.xp6(),Z.Q6J("ngIf",e.showGroups&&e.postInGroupMessage&&!e.newDiscussion.postToAllGroups),Z.xp6(4),Z.Q6J("ngIf",e.hasOffline),Z.xp6(2),Z.Q6J("disabled",""===e.newDiscussion.subject||null===e.newDiscussion.message),Z.xp6(),Z.hij(" ",Z.lcZ(30,33,"addon.mod_forum.posttoforum")," ")}}let j=(()=>{var e;class AddonModForumNewDiscussionPage{constructor(e,o){this.route=e,this.splitView=o,this.component=p.x.COMPONENT,this.messageControl=new c.NI(null),this.groupsLoaded=!1,this.showGroups=!1,this.hasOffline=!1,this.canCreateAttachments=!0,this.canPin=!1,this.showForm=!1,this.groups=[],this.groupIds=[],this.newDiscussion={subject:"",message:null,postToAllGroups:!1,groupId:0,subscribe:!0,pin:!1,files:[]},this.advanced=!1,this.accessInfo={},this.isDestroyed=!1,this.forceLeave=!1,this.logView=P.V.once((()=>{y.ke.logEvent({type:y.gM.VIEW_ITEM,ws:"mod_forum_add_discussion",name:w.vN.instant("addon.mod_forum.addanewdiscussion"),data:{id:this.forumId,category:"forum"},url:"/mod/forum/post.php"})}))}ngOnInit(){var e=this;return(0,a.Z)((function*(){try{var o;const s=e.route.snapshot.data;if(e.courseId=m.b.getRequiredRouteNumberParam("courseId"),e.cmId=m.b.getRequiredRouteNumberParam("cmId"),e.forumId=m.b.getRequiredRouteNumberParam("forumId"),e.timeCreated=m.b.getRequiredRouteNumberParam("timeCreated"),e.initialGroupId=m.b.getRouteNumberParam("groupId"),e.initialGroupId=0===e.initialGroupId?p.x.ALL_PARTICIPANTS:e.initialGroupId,0!==e.timeCreated&&(null===(o=s.swipeEnabled)||void 0===o||o)){var n;const o=C.p.getOrCreateSource(N.B,[e.courseId,e.cmId,null!==(n=s.discussionsPathPrefix)&&void 0!==n?n:""]);e.discussions=new AddonModForumNewDiscussionDiscussionsSwipeManager(o),yield e.discussions.start()}}catch(o){return h.OQ.showErrorModal(o),e.goBack(),void 0}e.fetchDiscussionData().finally((()=>{e.groupsLoaded=!0}))}))()}ionViewDidEnter(){this.syncObserver||(this.syncObserver=u.R.on(_.j.AUTO_SYNCED,(e=>{e.forumId==this.forumId&&e.userId==f.m9.getCurrentSiteUserId()&&(h.OQ.showAlertTranslated("core.notice","core.contenteditingsynced"),this.returnToDiscussions())}),f.m9.getCurrentSiteId()))}fetchDiscussionData(e){var o=this;return(0,a.Z)((function*(){try{const n=yield l.t.getActivityGroupMode(o.cmId),s=[];n===l.L.SEPARATEGROUPS||n===l.L.VISIBLEGROUPS?s.push(l.t.instance.getActivityAllowedGroups(o.cmId).then((e=>{let s;return s=n===l.L.VISIBLEGROUPS?o.validateVisibleGroups(e.groups):o.addAllParticipantsOption(e.groups,!0),s.then(function(){var e=(0,a.Z)((function*(e){if(e.length>0)return o.groups=e,o.groupIds=e.map((e=>e.id)).filter((e=>e>0)),o.newDiscussion.groupId=o.newDiscussion.groupId||o.getInitialGroupId(),o.showGroups=!0,yield o.calculateGroupName(),o.groupIds.length<=1&&(o.newDiscussion.postToAllGroups=!1),void 0;throw new Error(w.vN.instant(n===l.L.SEPARATEGROUPS?"addon.mod_forum.cannotadddiscussionall":"addon.mod_forum.cannotadddiscussion"))}));return function(o){return e.apply(this,arguments)}}())}))):(o.showGroups=!1,o.newDiscussion.postToAllGroups=!1,s.push(A.Tr.ignoreErrors(p.R.instance.canAddDiscussionToAll(o.forumId,{cmId:o.cmId}).then((e=>{o.canPin=!!e.canpindiscussions,o.canCreateAttachments=!!e.cancreateattachment}))))),s.push(p.R.getForum(o.courseId,o.cmId).then((e=>o.forum=e))),s.push(p.R.instance.getAccessInformation(o.forumId,{cmId:o.cmId}).then((e=>o.accessInfo=e))),yield Promise.all(s),o.timeCreated&&!e&&(o.syncId=_.y.getForumSyncId(o.forumId),yield _.y.waitForSync(o.syncId).then((()=>(o.isDestroyed||I.d.blockOperation(p.x.COMPONENT,o.syncId),D.B.instance.getNewDiscussion(o.forumId,o.timeCreated).then(function(){var e=(0,a.Z)((function*(e){if(o.hasOffline=!0,e.options=e.options||{},e.groupid==p.x.ALL_GROUPS?(o.newDiscussion.groupId=o.groups[0].id,o.newDiscussion.postToAllGroups=!0):(o.newDiscussion.groupId=e.groupid,o.newDiscussion.postToAllGroups=!1),o.newDiscussion.subject=e.subject,o.newDiscussion.message=e.message,o.newDiscussion.subscribe=!!e.options.discussionsubscribe,o.newDiscussion.pin=!!e.options.discussionpinned,o.messageControl.setValue(e.message),yield o.calculateGroupName(),"object"==typeof e.options.attachmentsid&&e.options.attachmentsid.offline){const e=yield v.P.getNewDiscussionStoredFiles(o.forumId,o.timeCreated);o.newDiscussion.files=e}(!o.newDiscussion.subscribe||o.newDiscussion.pin||o.newDiscussion.files.length||o.groups.length>0&&o.newDiscussion.groupId!=o.groups[0].id||o.newDiscussion.postToAllGroups)&&(o.advanced=!0)}));return function(o){return e.apply(this,arguments)}}()))))),o.originalData||(o.originalData={subject:o.newDiscussion.subject,message:o.newDiscussion.message,files:o.newDiscussion.files.slice()}),o.showForm=!0,o.logView()}catch(e){h.OQ.showErrorModalDefault(e,"addon.mod_forum.errorgetgroups",!0),o.showForm=!1}}))()}validateVisibleGroups(e){var o=this;return(0,a.Z)((function*(){let n;try{n=yield p.R.canAddDiscussionToAll(o.forumId,{cmId:o.cmId})}catch(e){n={status:!1,canpindiscussions:!1,cancreateattachment:!0}}if(o.canPin=!!n.canpindiscussions,o.canCreateAttachments=!!n.cancreateattachment,n.status)return o.addAllParticipantsOption(e,!1);const s=[],i=[];return e.forEach((e=>{s.push(p.R.instance.canAddDiscussion(o.forumId,e.id,{cmId:o.cmId}).catch((()=>({status:!0}))).then((o=>{o.status&&i.push(e)})))})),yield Promise.all(s),i}))()}filterGroups(e,o){const n=o.map((e=>e.id));return e.filter((e=>n.indexOf(e.id)>-1))}getInitialGroupId(){return this.initialGroupId&&this.groups.find((e=>e.id===this.initialGroupId))?this.initialGroupId:this.groups[0].id}addAllParticipantsOption(e,o){let n;return n=o?p.R.canAddDiscussionToAll(this.forumId,{cmId:this.cmId}).then((e=>(this.canPin=!!e.canpindiscussions,this.canCreateAttachments=!!e.cancreateattachment,e.status))).catch((()=>!1)):Promise.resolve(!0),n.then((o=>(o&&e.unshift({courseid:this.courseId,id:p.x.ALL_PARTICIPANTS,name:w.vN.instant("core.allparticipants")}),e)))}refreshGroups(e){const o=[l.t.invalidateActivityGroupMode(this.cmId),l.t.invalidateActivityAllowedGroups(this.cmId),p.R.invalidateCanAddDiscussion(this.forumId)];Promise.all(o).finally((()=>{this.fetchDiscussionData(!0).finally((()=>{null==e||e.complete()}))}))}returnToDiscussions(e,o){var n;this.forceLeave=!0,M.b.clearTmpFiles(this.newDiscussion.files),u.R.trigger(p.x.NEW_DISCUSSION_EVENT,{forumId:this.forumId,cmId:this.cmId,discussionIds:e,discTimecreated:o,groupId:this.showGroups&&!this.newDiscussion.postToAllGroups?this.newDiscussion.groupId:void 0},f.m9.getCurrentSiteId()),null!==(n=this.splitView)&&void 0!==n&&n.outletActivated?(this.hasOffline=!1,this.newDiscussion.subject="",this.newDiscussion.message=null,this.newDiscussion.files=[],this.newDiscussion.postToAllGroups=!1,this.messageEditor.clearText(),this.originalData=A.Tr.clone(this.newDiscussion)):m.b.back()}onMessageChange(e){this.newDiscussion.message=null!=e?e:null}add(){var e=this;return(0,a.Z)((function*(){const o=e.forum.name,n=e.newDiscussion.subject;let s=e.newDiscussion.message||"";const i=e.newDiscussion.pin,t=e.newDiscussion.files,r=e.timeCreated||Date.now(),d={discussionsubscribe:!!e.newDiscussion.subscribe};if(!n)return h.OQ.showErrorModal("addon.mod_forum.erroremptysubject",!0),void 0;if(!s)return h.OQ.showErrorModal("addon.mod_forum.erroremptymessage",!0),void 0;const a=yield h.OQ.showModalLoading("core.sending",!0);s=x._1.formatHtmlLines(s),i&&(d.discussionpinned=!0);const c=e.newDiscussion.postToAllGroups?e.groupIds:[e.newDiscussion.groupId];try{const i=yield v.P.addNewDiscussion(e.forumId,o,e.courseId,n,s,t,d,c,r);i&&(v.P.deleteNewDiscussionStoredFiles(e.forumId,r),u.R.trigger(u.R.ACTIVITY_DATA_SENT,{module:"forum"})),i&&i.length<c.length&&h.OQ.showErrorModalDefault(null,"addon.mod_forum.errorposttoallgroups",!0),T.o.triggerFormSubmittedEvent(e.formElement,!!i,f.m9.getCurrentSiteId()),e.returnToDiscussions(i,r)}catch(e){h.OQ.showErrorModalDefault(e,"addon.mod_forum.cannotcreatediscussion",!0)}finally{a.dismiss()}}))()}discard(){var e=this;return(0,a.Z)((function*(){try{yield h.OQ.showConfirm(w.vN.instant("core.areyousure"));const o=[];o.push(D.B.deleteNewDiscussion(e.forumId,e.timeCreated)),o.push(A.Tr.ignoreErrors(v.P.deleteNewDiscussionStoredFiles(e.forumId,e.timeCreated))),yield Promise.all(o),T.o.triggerFormCancelledEvent(e.formElement,f.m9.getCurrentSiteId()),e.returnToDiscussions()}catch(e){}}))()}toggleAdvanced(){this.advanced=!this.advanced}calculateGroupName(){var e=this;return(0,a.Z)((function*(){if(e.newDiscussion.groupId<=0)e.postInGroupMessage=void 0;else{var o;const n=null===(o=e.groups.find((o=>o.id===e.newDiscussion.groupId)))||void 0===o?void 0:o.name;e.postInGroupMessage=n&&w.vN.instant("addon.mod_forum.postingroup",{groupname:n})}}))()}canLeave(){var e=this;return(0,a.Z)((function*(){return e.forceLeave||(v.P.hasPostDataChanged(e.newDiscussion,e.originalData)&&(yield h.OQ.showConfirm(w.vN.instant("core.confirmcanceledit"))),M.b.clearTmpFiles(e.newDiscussion.files),e.formElement&&T.o.triggerFormCancelledEvent(e.formElement,f.m9.getCurrentSiteId())),!0}))()}ionViewWillLeave(){this.syncObserver&&this.syncObserver.off(),delete this.syncObserver}goBack(){var e;null!==(e=this.splitView)&&void 0!==e&&e.outletActivated?m.b.navigate("../../"):m.b.back()}ngOnDestroy(){var e;this.syncId&&I.d.unblockOperation(p.x.COMPONENT,this.syncId),this.isDestroyed=!0,null===(e=this.discussions)||void 0===e||e.destroy()}}return(e=AddonModForumNewDiscussionPage).ɵfac=function AddonModForumNewDiscussionPage_Factory(o){return new(o||e)(Z.Y36(s.gz),Z.Y36(F.A,8))},e.ɵcmp=Z.Xpm({type:e,selectors:[["page-addon-mod-forum-new-discussion"]],viewQuery:function AddonModForumNewDiscussionPage_Query(e,o){if(1&e&&(Z.Gf(U,5),Z.Gf(g.$,5)),2&e){let e;Z.iGM(e=Z.CRH())&&(o.formElement=e.first),Z.iGM(e=Z.CRH())&&(o.messageEditor=e.first)}},decls:16,vars:13,consts:[["slot","start"],[3,"text"],["slot","end"],[3,"core-swipe-navigation"],["slot","fixed",3,"disabled","ionRefresh"],[3,"pullingText"],[3,"hideUntil"],[4,"ngIf"],["newDiscFormEl",""],["labelPlacement","stacked","type","text","name","subject",3,"ngModel","placeholder","ngModelChange"],["position","stacked"],["name","addon_mod_forum_new_discussion","contextLevel","module","elementId","message",3,"control","placeholder","component","componentId","autoSave","contextInstanceId","contentChanged"],["button","","role","heading","aria-controls","addon-mod-forum-new-discussion-advanced",1,"divider","ion-text-wrap",3,"detail","click"],["name","fas-chevron-right","flip-rtl","","slot","start","aria-hidden","true",1,"expandable-status-icon"],["id","addon-mod-forum-new-discussion-advanced",4,"ngIf"],["class","addon-forum-group-info",4,"ngIf"],[1,"addon-forum-new-discussion-buttons"],["expand","block",3,"disabled","click"],["id","addon-mod-forum-new-discussion-advanced"],["class","core-edit-set-group ion-text-wrap",4,"ngIf"],[1,"ion-text-wrap"],["name","subscribe",3,"ngModel","ngModelChange"],["class","ion-text-wrap",4,"ngIf"],[3,"files","maxSize","maxSubmissions","component","componentId","allowOffline","courseId",4,"ngIf"],["name","postallgroups",3,"ngModel","ngModelChange"],[1,"core-edit-set-group","ion-text-wrap"],["interface","action-sheet","name","groupid",3,"ngModel","disabled","interfaceOptions","cancelText","ngModelChange","ionChange"],["slot","label",1,"item-heading"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["contextLevel","course",3,"text","contextInstanceId","wsNotFiltered"],["name","pin",3,"ngModel","ngModelChange"],[3,"files","maxSize","maxSubmissions","component","componentId","allowOffline","courseId"],[1,"addon-forum-group-info"],["name","fas-circle-info","slot","start","aria-hidden","true"],["expand","block","fill","outline",3,"click"]],template:function AddonModForumNewDiscussionPage_Template(e,o){1&e&&(Z.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),Z._UZ(3,"ion-back-button",1),Z.ALo(4,"translate"),Z.qZA(),Z.TgZ(5,"ion-title")(6,"h1"),Z._uU(7),Z.ALo(8,"translate"),Z.qZA()(),Z._UZ(9,"ion-buttons",2),Z.qZA()(),Z.TgZ(10,"ion-content",3)(11,"ion-refresher",4),Z.NdJ("ionRefresh",(function AddonModForumNewDiscussionPage_Template_ion_refresher_ionRefresh_11_listener(e){return o.refreshGroups(e.target)})),Z._UZ(12,"ion-refresher-content",5),Z.ALo(13,"translate"),Z.qZA(),Z.TgZ(14,"core-loading",6),Z.YNc(15,AddonModForumNewDiscussionPage_form_15_Template,31,35,"form",7),Z.qZA()()),2&e&&(Z.xp6(3),Z.Q6J("text",Z.lcZ(4,7,"core.back")),Z.xp6(4),Z.Oqu(Z.lcZ(8,9,"addon.mod_forum.addanewdiscussion")),Z.xp6(3),Z.Q6J("core-swipe-navigation",o.discussions),Z.xp6(),Z.Q6J("disabled",!o.groupsLoaded),Z.xp6(),Z.s9C("pullingText",Z.lcZ(13,11,"core.pulltorefresh")),Z.xp6(2),Z.Q6J("hideUntil",o.groupsLoaded),Z.xp6(),Z.Q6J("ngIf",o.showForm))},dependencies:[O.sg,O.O5,G.J,S.r,L.I,E.r,J.g,Q.t,R.O,c._Y,c.JJ,c.JL,c.On,c.F,k.YG,k.Sm,k.wI,k.W2,k.Gu,k.gu,k.pK,k.Ie,k.Q$,k.nJ,k.Wo,k.Nd,k.t9,k.n0,k.wd,k.ho,k.sr,k.w,k.QI,k.j9,k.oU,g.$,q.X$],styles:["[_nghost-%COMP%]   .addon-forum-group-info[_ngcontent-%COMP%] > ion-icon[slot][_ngcontent-%COMP%]{color:var(--ion-color-info);margin-inline-end:16px}[_nghost-%COMP%]   .addon-forum-new-discussion-buttons[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-top:0}[_nghost-%COMP%]   .addon-forum-new-discussion-buttons[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{padding-top:0;padding-bottom:0}"]}),AddonModForumNewDiscussionPage})();class AddonModForumNewDiscussionDiscussionsSwipeManager extends b.n{getSelectedItemPathFromRoute(e){const o=e instanceof s.De?e:e.snapshot;return`${this.getSource().DISCUSSIONS_PATH_PREFIX}new/${o.params.timeCreated}`}}const B=[{path:"",component:j,canDeactivate:[t.Y]}];let V=(()=>{var e;class AddonModForumNewDiscussionLazyModule{}return(e=AddonModForumNewDiscussionLazyModule).ɵfac=function AddonModForumNewDiscussionLazyModule_Factory(o){return new(o||e)},e.ɵmod=Z.oAB({type:e}),e.ɵinj=Z.cJS({imports:[s.Bz.forChild(B),d.L,i.Q,r.I]}),AddonModForumNewDiscussionLazyModule})();void(("undefined"==typeof ngJitMode||ngJitMode)&&Z.kYT(V,{declarations:[j],imports:[s.Bz,d.L,i.Q,r.I]}))},71460:(e,o,n)=>{n.d(o,{t:()=>CoreSwipeNavigationItemsManager});var s=n(49671),i=n(67643),t=n(43555),r=n(22594);class CoreSwipeNavigationItemsManager extends r.A{start(){var e=this;return(0,s.Z)((function*(){e.updateSelectedItem()}))()}navigateToNextItem(){var e=this;return(0,s.Z)((function*(){yield e.navigateToItemBy(1,"forward")}))()}navigateToPreviousItem(){var e=this;return(0,s.Z)((function*(){yield e.navigateToItemBy(-1,"back")}))()}hasNextItem(){var e=this;return(0,s.Z)((function*(){return!!(yield e.getItemBy(1))}))()}hasPreviousItem(){var e=this;return(0,s.Z)((function*(){return!!(yield e.getItemBy(-1))}))()}getCurrentPageRoute(){return t.b.getCurrentRoute()}getSelectedItemPathFromRoute(e){const o=[];for(;e;){if(o.push(...(e instanceof i.De?e:e.snapshot).url),!e.firstChild)break;e=e.firstChild}return o.map((e=>e.path)).join("/").replace(/\/+/,"/").trim()||null}navigateToItemBy(e,o){var n=this;return(0,s.Z)((function*(){const s=yield n.getItemBy(e);s&&(yield n.navigateToItem(s,{animationDirection:o,replace:!0}))}))()}getItemBy(e){var o=this;return(0,s.Z)((function*(){var n;const s=o.getSource().getItems(),i=null!==(n=o.selectedItem&&(null==s?void 0:s.indexOf(o.selectedItem)))&&void 0!==n?n:-1;if(-1===i||null===s)return null;const t=e>0?1:-1;let r=i,d=0;for(;d!==e;){if(r+=t,r<0)return null;if(r>=s.length)break;o.skipItemInSwipe(s[r])||(d+=t)}return d===e?s[r]:o.getSource().isCompleted()?null:(yield o.getSource().load(),o.getItemBy(e))}))()}skipItemInSwipe(e){return!1}}}}]);